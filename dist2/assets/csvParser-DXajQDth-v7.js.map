{"version":3,"file":"csvParser-DXajQDth-v7.js","sources":["../../src/utils/csvParser.js"],"sourcesContent":["export const parseCSV = (csvText) => {\r\n    const result = [];\r\n    let row = [];\r\n    let field = '';\r\n    let inQuotes = false;\r\n    const text = csvText.trim();\r\n\r\n    for (let i = 0; i < text.length; i++) {\r\n        const char = text[i];\r\n        const nextChar = text[i + 1];\r\n\r\n        if (inQuotes) {\r\n            if (char === '\"' && nextChar === '\"') {\r\n                field += '\"'; // Escaped quote\r\n                i++;\r\n            } else if (char === '\"') {\r\n                inQuotes = false;\r\n            } else {\r\n                field += char;\r\n            }\r\n        } else {\r\n            if (char === '\"') {\r\n                inQuotes = true;\r\n            } else if (char === ',') {\r\n                row.push(field.trim());\r\n                field = '';\r\n            } else if (char === '\\n' || char === '\\r') {\r\n                if (field || row.length > 0) {\r\n                    row.push(field.trim());\r\n                    result.push(row);\r\n                }\r\n                row = [];\r\n                field = '';\r\n                if (char === '\\r' && nextChar === '\\n') i++; // Handle CRLF\r\n            } else {\r\n                field += char;\r\n            }\r\n        }\r\n    }\r\n\r\n    if (field || row.length > 0) {\r\n        row.push(field.trim());\r\n        result.push(row);\r\n    }\r\n\r\n    if (result.length === 0) return [];\r\n\r\n    const headers = result[0];\r\n    return result.slice(1).map(rowData => {\r\n        const obj = {};\r\n        headers.forEach((header, index) => {\r\n            let val = rowData[index] || '';\r\n            // Handle Excel-style formulas like =\"0\"\r\n            if (val.startsWith('=\"') && val.endsWith('\"')) {\r\n                val = val.substring(2, val.length - 1);\r\n            }\r\n            // Remove remaining wrapping quotes if any\r\n            if (val.startsWith('\"') && val.endsWith('\"')) {\r\n                val = val.slice(1, -1);\r\n            }\r\n            obj[header] = val;\r\n        });\r\n        return obj;\r\n    });\r\n};\r\n\r\n/**\r\n * 상품명에서 기간(개월수) 추출\r\n */\r\nexport function extractMonthsFromProduct(productName) {\r\n    if (!productName) return 3;\r\n\r\n    if (productName.includes('TTC') || productName.includes('ttc')) {\r\n        return 6;\r\n    }\r\n\r\n    const monthMatch = productName.match(/(\\d+)개월/);\r\n    if (monthMatch) {\r\n        return parseInt(monthMatch[1], 10);\r\n    }\r\n\r\n    if (productName.includes('쿠폰')) {\r\n        return 3;\r\n    }\r\n\r\n    return 3;\r\n}\r\n\r\n/**\r\n * 판매일자에 개월수를 더해 만기일자 계산\r\n */\r\nexport function calculateEndDate(saleDate, months) {\r\n    if (!saleDate) return '';\r\n\r\n    try {\r\n        const date = new Date(saleDate);\r\n        if (isNaN(date.getTime())) return '';\r\n\r\n        date.setMonth(date.getMonth() + months);\r\n        return date.toLocaleDateString('sv-SE', { timeZone: 'Asia/Seoul' });\r\n    } catch (e) {\r\n        console.error('날짜 계산 오류:', e);\r\n        return '';\r\n    }\r\n}\r\n\r\n/**\r\n * 이용기간 문자열에서 종료일 추출\r\n */\r\nexport function extractEndDateFromPeriod(periodStr) {\r\n    if (!periodStr) return '';\r\n    \r\n    // 1. Tilde case: \"2024.01.01 ~ 2024.07.18\"\r\n    if (periodStr.includes('~')) {\r\n        const parts = periodStr.split('~').map(s => s.trim());\r\n        return parts.length === 2 ? parts[1] : '';\r\n    }\r\n\r\n    // 2. Single date case: \"2026-07-18\" or \"2026.07.18\"\r\n    const cleaned = periodStr.trim();\r\n    // Validate length to avoid returning garbage (e.g. \"1년\")\r\n    if (cleaned.length >= 8) { \r\n        return cleaned;\r\n    }\r\n    \r\n    return '';\r\n}\r\n\r\n/**\r\n * 회원번호를 branchId로 변환\r\n */\r\nexport function convertToBranchId(memberNum) {\r\n    if (!memberNum) return 'gwangheungchang';\r\n    const normalized = memberNum.trim().toLowerCase();\r\n    return normalized.includes('마포') ? 'mapo' : 'gwangheungchang';\r\n}\r\n\r\n/**\r\n * 남은횟수 문자열을 숫자로 변환\r\n */\r\nexport function parseCredits(creditsStr) {\r\n    if (!creditsStr || creditsStr.trim() === '') return 999;\r\n    const match = creditsStr.match(/(\\d+)/);\r\n    return match ? parseInt(match[1], 10) : 999;\r\n}\r\n\r\n/**\r\n * 판매금액 문자열을 숫자로 변환\r\n */\r\nexport function parseAmount(amountStr) {\r\n    if (!amountStr) return 0;\r\n    if (amountStr.includes('0') && !amountStr.match(/\\d{2,}/)) {\r\n        return 0;\r\n    }\r\n    const numbers = amountStr.replace(/[^\\d]/g, '');\r\n    return numbers ? parseInt(numbers, 10) : 0;\r\n}\r\n\r\n/**\r\n * 마지막출입 문자열을 ISO String으로 변환\r\n */\r\nexport function parseLastVisit(lastVisitStr) {\r\n    if (!lastVisitStr) return '';\r\n    const match = lastVisitStr.match(/(\\d{4}-\\d{2}-\\d{2})/);\r\n    if (match) {\r\n        try {\r\n            const date = new Date(match[1]);\r\n            return date.toISOString();\r\n        } catch {\r\n            return '';\r\n        }\r\n    }\r\n    return '';\r\n}\r\n\r\n"],"names":["parseCSV","csvText","result","row","field","inQuotes","text","i","char","nextChar","headers","rowData","obj","header","index","val","extractMonthsFromProduct","productName","monthMatch","calculateEndDate","saleDate","months","date","e","extractEndDateFromPeriod","periodStr","parts","s","cleaned","convertToBranchId","memberNum","parseCredits","creditsStr","match","parseAmount","amountStr","numbers","parseLastVisit","lastVisitStr"],"mappings":"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"}