{"version":3,"mappings":"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","names":["MEDITATION_CATEGORIES","MEDITATION_INTENTIONS","MEDITATION_MODES","INTERACTION_TYPES","DIAGNOSIS_OPTIONS","WEATHER_OPTIONS","AMBIENT_SOUNDS","AI_SESSION_MESSAGES","useAudioAnalyzer","micVolume","setMicVolume","useState","analyserRef","useRef","dataArrayRef","sourceRef","animationFrameRef","drawAudioVisualizer","useCallback","draw","sum","bufferLength","i","value","rms","normalizedLevel","setupAudioAnalysis","stream","audioCtx","analyser","source","dataArray","stopAudioAnalysis","track","e","pauseAudioAnalysis","resumeAudioAnalysis","useMeditationAudio","ttcEnabled","isPlayingRef","step","logDebug","setTtsState","audioVolumes","soundEnabled","audioContextRef","oscLeftRef","oscRightRef","gainNodeRef","currentAudioRef","ambientAudioRef","getAudioContext","playBinauralBeats","carrierFreq","beatFreq","volume","oscL","oscR","gainNode","pannerL","pannerR","stopBinauralBeats","updateBinauralVolume","currentTime","updateAmbientVolume","playAmbientMusic","ambientDef","audio","stopAmbientMusic","stopAmbientMusicAndReset","stopVoiceOnly","playAudio","base64String","onEndedCallback","prev","playPromise","speak","text","utterance","speakFallback","stopAllAudio","stopAmbient","useEffect","generateMeditationGuidance","httpsCallable","functions","SELECTED_DIAGNOSIS_FALLBACK","useMeditationAI","memberName","timeContext","selectedIntention","activeMode","interactionType","onExit","onMeditationReady","isAILoading","setIsAILoading","aiRequestLock","setAiRequestLock","aiLatency","setAiLatency","chatHistory","setChatHistory","currentAIChat","setCurrentAIChat","manualInput","setManualInput","aiPrescription","setAiPrescription","prescriptionReason","setPrescriptionReason","aiMessage","setAiMessage","sessionInfo","setSessionInfo","feedbackData","setFeedbackData","needsFeedback","setNeedsFeedback","currentRequestIdRef","messageIndexRef","sessionDiagnosisRef","consecutiveFailsRef","fetchAIPrescription","diagnosisId","weatherId","modeId","intType","currentSummary","startTime","prescResult","err","fetchAIQuestion","history","requestId","hour","currentContext","timeoutId","timeoutPromise","resolve","fallbackMsg","fallbackOptions","apiPromise","result","handleChatResponse","answer","trigger","diag","o","defaultMode","m","updatedHistory","aiText","isFallback","handleManualSubmit","handleReturnToChat","warmReconnectMsg","lastUserMsg","newHistory","fetchAISessionMessage","currentIndex","currentDiagnosis","_","reject","personalizedMsg","error","messages","msg","fetchAIFeedback","stabilityScore","customSummary","generateReason","time","timeText","coreMessage","useWeatherAwareness","weatherContext","setWeatherContext","detectWeather","position","latitude","longitude","data","weatherMain","weatherDesc","detected","w","fullWeatherData","Brain","PhosphorIcons","AI_LOADING_MESSAGES","AILoadingIndicator","compact","message","msgIndex","setMsgIndex","interval","displayMessage","jsxs","jsx","X","VolumeControlPanel","showVolumePanel","setShowVolumePanel","setAudioVolumes","setSoundEnabled","val","Heartbeat","FeedbackView","formatTime","timeLeft","modeName","onClose","useNavigate","actualTime","MeditationDebugOverlay","isVisible","ttsState","currentStep","audioLevels","currentText","Play","Pause","Wind","SpeakerHigh","SpeakerSlash","Microphone","VideoCamera","LockKey","SmileySad","Lightning","Barbell","Sparkle","Sun","CloudRain","CloudSnow","Cloud","ArrowLeft","size","color","ArrowUp","ICON_MAP","MeditationPage","navigate","cameraStreamRef","setStep","setTimeContext","selectedDiagnosis","setSelectedDiagnosis","setSelectedIntention","selectedCategory","setSelectedCategory","setActiveMode","setInteractionType","visualTheme","setVisualTheme","themes","randomTheme","isPlaying","setIsPlaying","setTimeLeft","setTtcEnabled","selectedAmbient","setSelectedAmbient","permissionError","setPermissionError","cameraStream","setCameraStream","showVolumeHint","setShowVolumeHint","stored","isDebugMode","setIsDebugMode","setDebugClickCount","handleDebugToggle","next","v","action","timestamp","lastSpokenMessage","setLastSpokenMessage","dynamicCategories","setDynamicCategories","dynamicIntentions","setDynamicIntentions","isOptionsLoading","setIsOptionsLoading","prepStep","setPrepStep","prepSelections","setPrepSelections","tCtx","mergedCats","c","dyn","d","mergedInts","setPoseData","setIsPoseLoading","setAlignmentScore","canvasRef","poseRef","timerRef","messageIntervalRef","videoRef","chatEndRef","stopSession","currentMode","currentDiag","elapsedTime","stabilityHistoryRef","postureIssuesRef","onPoseResults","results","canvas","ctx","width","height","drawLine","p1","p2","landmarks","nose","leftShoulder","rightShoulder","shoulderCenterX","deviation","shoulderY","neckLength","currentScore","initPoseEngine","Pose","tf","tfBackend","__vitePreload","n","pose","file","detectFrame","stopVoiceOnlyRef","context","feedbackResult","aiMsg","s","startMessageLoop","handleDiagnosisSelect","option","mode","weather","fallbackReason","handleWeatherSelect","weatherOption","startFromPrescription","startSession","initialVolume","introMessage","introTTS","finalIntroMsg","startTimer","completeSession","togglePlay","isAnalyzing","setIsAnalyzing","finishAnalysis","forceStart","regretMessages","randomMsg","poseMetrics","avgScore","acc","curr","issues","fbResult","p","seconds","mins","secs","category","categoryIntentions","intention","idx","isMe","timeStr","opt","summary","welcomeBackMessages","randomWelcome","t","ModeIcon","a","PREPARATION_GUIDES","key","info","points"],"ignoreList":[],"sources":["../../src/constants/meditationConstants.js","../../src/hooks/useAudioAnalyzer.js","../../src/hooks/useMeditationAudio.js","../../src/hooks/useMeditationAI.js","../../src/hooks/useWeatherAwareness.js","../../src/components/meditation/ui/AILoadingIndicator.jsx","../../src/components/meditation/ui/VolumeControlPanel.jsx","../../src/components/meditation/ui/FeedbackView.jsx","../../src/components/meditation/MeditationDebugOverlay.jsx","../../src/pages/MeditationPage.jsx"],"sourcesContent":["\r\n// ==========================================\r\n//  AI    - CONFIG\r\n// \"  ,   .\"\r\n// ==========================================\r\n\r\n//  Step 1: Meditation Categories -   ( vs )\r\nexport const MEDITATION_CATEGORIES = [\r\n    {\r\n        id: 'healing',\r\n        label: '   ',\r\n        subtitle: ' ',\r\n        description: '   .',\r\n        emoji: '',\r\n        direction: 'negative_to_zero' //  \r\n    },\r\n    {\r\n        id: 'growth',\r\n        label: '   ',\r\n        subtitle: ' ',\r\n        description: '      .',\r\n        emoji: '',\r\n        direction: 'zero_to_positive' //  \r\n    }\r\n];\r\n\r\n//  Step 2: Meditation Intentions -   ( 8)\r\nexport const MEDITATION_INTENTIONS = [\r\n    // === A:   (Healing) ===\r\n    {\r\n        id: 'body_rest',\r\n        category: 'healing',\r\n        label: '     ',\r\n        tag: '',\r\n        emoji: '',\r\n        focus: 'body',\r\n        keywords: [' ', ' ', '']\r\n    },\r\n    {\r\n        id: 'mind_calm',\r\n        category: 'healing',\r\n        label: '     ',\r\n        tag: '',\r\n        emoji: '',\r\n        focus: 'mind',\r\n        keywords: [' ', ' ', ' ']\r\n    },\r\n    {\r\n        id: 'emotion_release',\r\n        category: 'healing',\r\n        label: '      ',\r\n        tag: '',\r\n        emoji: '',\r\n        focus: 'emotion',\r\n        keywords: [' ', '  ']\r\n    },\r\n    {\r\n        id: 'let_go',\r\n        category: 'healing',\r\n        label: '      ',\r\n        tag: '',\r\n        emoji: '',\r\n        focus: 'detachment',\r\n        keywords: [' ', ' ']\r\n    },\r\n    \r\n    // === B:   (Growth) ===\r\n    {\r\n        id: 'inner_voice',\r\n        category: 'growth',\r\n        label: '  ,     ',\r\n        tag: '',\r\n        emoji: '',\r\n        focus: 'sensation',\r\n        keywords: [' ', ' ', '']\r\n    },\r\n    {\r\n        id: 'self_compassion',\r\n        category: 'growth',\r\n        label: ' ,     ',\r\n        tag: '',\r\n        emoji: '',\r\n        focus: 'acceptance',\r\n        keywords: [' ', ' ', '']\r\n    },\r\n    {\r\n        id: 'energy_recharge',\r\n        category: 'growth',\r\n        label: '  ,     ',\r\n        tag: '',\r\n        emoji: '',\r\n        focus: 'vitality',\r\n        keywords: [' ', ' ', '']\r\n    },\r\n    {\r\n        id: 'gratitude',\r\n        category: 'growth',\r\n        label: '      ',\r\n        tag: '',\r\n        emoji: '',\r\n        focus: 'gratitude',\r\n        keywords: [' ', ' ', '']\r\n    }\r\n];\r\n\r\nexport const MEDITATION_MODES = [\r\n    { id: 'breath', label: '3  ', time: 3 * 60, iconName: 'Wind', color: '#48dbfb', desc: '   ', freq: 10 },\r\n    { id: 'calm', label: '7  ', time: 7 * 60, iconName: 'Brain', color: '#FFD700', desc: '  ', freq: 8 },\r\n    { id: 'deep', label: '15  ', time: 15 * 60, iconName: 'Sparkle', color: '#a29bfe', desc: '  ', freq: 6 },\r\n];\r\n\r\n// Interaction Types - Bio-Feedback Loop\r\nexport const INTERACTION_TYPES = {\r\n    v1: { id: 'v1', label: '  ', desc: '      ', iconName: 'Wind' },\r\n    v2: { id: 'v2', label: ' ', desc: '      ', iconName: 'Microphone' },\r\n    v3: { id: 'v3', label: ' ', desc: '      2m ', iconName: 'VideoCamera' }\r\n};\r\n\r\nexport const DIAGNOSIS_OPTIONS = [\r\n    { id: 'stress', label: ' ', iconName: 'Lightning', color: '#FF6B6B', prescription: { modeId: 'calm', type: 'v2' } },\r\n    { id: 'stiff', label: ' ', iconName: 'Barbell', color: '#4ECDC4', prescription: { modeId: 'breath', type: 'v3' } },\r\n    { id: 'anxious', label: ' ', iconName: 'Heartbeat', color: '#FFD93D', prescription: { modeId: 'deep', type: 'v2' } },\r\n    { id: 'tired', label: '', iconName: 'SmileySad', color: '#A8A4CE', prescription: { modeId: 'calm', type: 'v1' } },\r\n    { id: 'overthink', label: '   ', iconName: 'Brain', color: '#a29bfe', prescription: { modeId: 'calm', type: 'v2' } },\r\n    { id: 'frustrated', label: ' ', iconName: 'Wind', color: '#48dbfb', prescription: { modeId: 'breath', type: 'v2' } },\r\n    { id: 'low_energy', label: ' ', iconName: 'Sparkle', color: '#FFD32A', prescription: { modeId: 'breath', type: 'v1' } },\r\n    { id: 'distracted', label: '  ', iconName: 'Lightning', color: '#32ff7e', prescription: { modeId: 'calm', type: 'v2' } }\r\n];\r\n\r\nexport const WEATHER_OPTIONS = [\r\n    { id: 'sun', label: '', iconName: 'Sun', color: '#FFD23F' },\r\n    { id: 'cloud', label: '', iconName: 'Cloud', color: '#B0C4DE' },\r\n    { id: 'rain', label: '', iconName: 'CloudRain', color: '#4895EF' },\r\n    { id: 'snow', label: '', iconName: 'CloudSnow', color: '#A8E6CF' },\r\n];\r\n\r\n//  Ambient Sound Options - Multi-layer audio for immersive meditation\r\nexport const AMBIENT_SOUNDS = [\r\n    { \r\n        id: 'none', \r\n        label: '', \r\n        desc: ' binaural beats',\r\n        iconName: 'Wind',\r\n        color: '#48dbfb',\r\n        audioUrl: null \r\n    },\r\n    { \r\n        id: 'rain', \r\n        label: '', \r\n        desc: '  ',\r\n        iconName: 'CloudRain',\r\n        color: '#4895EF',\r\n        // Free ambient audio from Pixabay (CC0)\r\n        audioUrl: 'https://cdn.pixabay.com/download/audio/2022/03/15/audio_7e3e9d3f44.mp3?filename=rain-and-thunder-sounds-for-sleeping-black-screen-126699.mp3'\r\n    },\r\n    { \r\n        id: 'ocean', \r\n        label: '', \r\n        desc: '  ',\r\n        iconName: 'Waves',\r\n        color: '#00d2d3',\r\n        audioUrl: 'https://cdn.pixabay.com/download/audio/2022/03/24/audio_f0a69b3d97.mp3?filename=ocean-waves-112906.mp3'\r\n    },\r\n    { \r\n        id: 'forest', \r\n        label: ' ', \r\n        desc: '  ',\r\n        iconName: 'Plant',\r\n        color: '#32ff7e',\r\n        audioUrl: 'https://cdn.pixabay.com/download/audio/2022/08/02/audio_884fe92c21.mp3?filename=forest-wind-and-birds-sounds-nature-sounds-8013.mp3'\r\n    },\r\n    { \r\n        id: 'singingbowl', \r\n        label: '', \r\n        desc: '  ',\r\n        iconName: 'Sparkle',\r\n        color: '#a29bfe',\r\n        audioUrl: 'https://cdn.pixabay.com/download/audio/2022/10/18/audio_69a97e72c8.mp3?filename=singing-bowl-sound-1-123051.mp3'\r\n    }\r\n];\r\n\r\nexport const SPECIALIST_QUESTIONS = {\r\n    morning: [\r\n        { \r\n            q: \"    ,   ?\",\r\n            sub: \"   \",\r\n            insight: \"   ,    ,   \"\r\n        },\r\n        { \r\n            q: \"  ,     ?\",\r\n            sub: \"    \",\r\n            insight: \"   ,    ,   \"\r\n        },\r\n        {\r\n            q: \"   ,    ?\",\r\n            sub: \"   \",\r\n            insight: \"    \"\r\n        },\r\n        {\r\n            q: \" 5  ...    ?\",\r\n            sub: \"    \",\r\n            insight: \"  ,    ,    \"\r\n        }\r\n    ],\r\n    afternoon: [\r\n        { \r\n            q: \"   ...  ?\",\r\n            sub: \"    \",\r\n            insight: \"  ,    ,   \"\r\n        },\r\n        { \r\n            q: \"    ?\",\r\n            sub: \"  \",\r\n            insight: \"    ,   /\"\r\n        },\r\n        {\r\n            q: \"     ?  .\",\r\n            sub: \"    \",\r\n            insight: \"      \"\r\n        },\r\n        {\r\n            q: \"   ?  .\",\r\n            sub: \"   \",\r\n            insight: \",  ,  \"\r\n        }\r\n    ],\r\n    night: [\r\n        { \r\n            q: \" ,    ?\",\r\n            sub: \"   \",\r\n            insight: \"    ,    \"\r\n        },\r\n        { \r\n            q: \"  ' ' ?\",\r\n            sub: \"   \",\r\n            insight: \"     \"\r\n        },\r\n        {\r\n            q: \"  '' ?\",\r\n            sub: \"   \",\r\n            insight: \"     \"\r\n        },\r\n        {\r\n            q: \"        ?\",\r\n            sub: \"   \",\r\n            insight: \"     \"\r\n        }\r\n    ]\r\n};\r\n\r\nexport const AI_SESSION_MESSAGES = {\r\n    v1: [\r\n        \"  .   .\",\r\n        \"  ... 4... ... 7... ... 8...\",\r\n        \"     .   .\",\r\n        \"   . , .\",\r\n        \" ,      .\",\r\n        \"    .\",\r\n        \"   .    .\",\r\n        \"     .\",\r\n        \" .     .\",\r\n        \",    '' .\"\r\n    ],\r\n    v2: [\r\n        \"   .  .\",\r\n        \"      .\",\r\n        \"  .  .\",\r\n        \"      .\",\r\n        \"   . , .\",\r\n        \"      .\"\r\n    ],\r\n    v3: [\r\n        \" .    ?\",\r\n        \"     .\",\r\n        \"   .  .\",\r\n        \"  .  .\",\r\n        \"    .\",\r\n        \"   .\"\r\n    ]\r\n};\r\n","import { useRef, useCallback, useState } from 'react';\r\n\r\nexport const useAudioAnalyzer = () => {\r\n    const [micVolume, setMicVolume] = useState(0);\r\n    const analyserRef = useRef(null);\r\n    const dataArrayRef = useRef(null);\r\n    const sourceRef = useRef(null);\r\n    const animationFrameRef = useRef(null);\r\n\r\n    const drawAudioVisualizer = useCallback(function draw() {\r\n        if (!analyserRef.current) return;\r\n        animationFrameRef.current = requestAnimationFrame(draw);\r\n        analyserRef.current.getByteTimeDomainData(dataArrayRef.current); // Time domain for breath\r\n        let sum = 0;\r\n        const bufferLength = dataArrayRef.current.length;\r\n        for (let i = 0; i < bufferLength; i++) {\r\n            const value = (dataArrayRef.current[i] - 128) / 128; // Normalize to -1..1\r\n            sum += value * value; // RMS calculation\r\n        }\r\n        const rms = Math.sqrt(sum / bufferLength);\r\n        const normalizedLevel = Math.min(rms * 8, 2.5); // Amplified for visual feedback\r\n        setMicVolume(normalizedLevel);\r\n    }, []);\r\n\r\n    const setupAudioAnalysis = useCallback((stream, audioCtx) => {\r\n        const analyser = audioCtx.createAnalyser();\r\n        const source = audioCtx.createMediaStreamSource(stream);\r\n        source.connect(analyser);\r\n        analyser.fftSize = 1024; // Higher resolution for breath detection\r\n        analyser.smoothingTimeConstant = 0.8; // Smoother transitions\r\n        const bufferLength = analyser.frequencyBinCount;\r\n        const dataArray = new Uint8Array(bufferLength);\r\n        \r\n        analyserRef.current = analyser;\r\n        dataArrayRef.current = dataArray;\r\n        sourceRef.current = source;\r\n        \r\n        drawAudioVisualizer();\r\n    }, [drawAudioVisualizer]);\r\n\r\n    const stopAudioAnalysis = useCallback(() => {\r\n        if (animationFrameRef.current) cancelAnimationFrame(animationFrameRef.current);\r\n        if (sourceRef.current) {\r\n            try {\r\n                sourceRef.current.disconnect();\r\n                if (sourceRef.current.mediaStream) {\r\n                    sourceRef.current.mediaStream.getTracks().forEach(track => track.stop());\r\n                }\r\n            } catch (e) {\r\n                console.warn(\"Source disconnect failed\", e);\r\n            }\r\n            sourceRef.current = null;\r\n        }\r\n        setMicVolume(0);\r\n    }, []);\r\n\r\n    const pauseAudioAnalysis = useCallback(() => {\r\n        if (animationFrameRef.current) cancelAnimationFrame(animationFrameRef.current);\r\n    }, []);\r\n\r\n    const resumeAudioAnalysis = useCallback(() => {\r\n        drawAudioVisualizer();\r\n    }, [drawAudioVisualizer]);\r\n\r\n    return {\r\n        micVolume,\r\n        setupAudioAnalysis,\r\n        stopAudioAnalysis,\r\n        pauseAudioAnalysis,\r\n        resumeAudioAnalysis\r\n    };\r\n};\r\n","import { useRef, useCallback, useEffect } from 'react';\r\n\r\nexport const useMeditationAudio = (ttcEnabled, isPlayingRef, step, logDebug, setTtsState, audioVolumes, soundEnabled) => {\r\n    const audioContextRef = useRef(null);\r\n    const oscLeftRef = useRef(null);\r\n    const oscRightRef = useRef(null);\r\n    const gainNodeRef = useRef(null);\r\n    const currentAudioRef = useRef(null);\r\n    const ambientAudioRef = useRef(null);\r\n\r\n    // Audio Context Getter\r\n    const getAudioContext = useCallback(() => {\r\n        if (!audioContextRef.current) {\r\n            audioContextRef.current = new (window.AudioContext || window.webkitAudioContext)();\r\n        }\r\n        return audioContextRef.current;\r\n    }, []);\r\n\r\n    // ---------------------------------------------------------\r\n    // 1. Binaural Beats Engine\r\n    // ---------------------------------------------------------\r\n    const playBinauralBeats = useCallback((carrierFreq = 200, beatFreq = 4, volume = 0.25) => {\r\n        const audioCtx = getAudioContext();\r\n        if (audioCtx.state === 'suspended') audioCtx.resume();\r\n\r\n        const oscL = audioCtx.createOscillator();\r\n        const oscR = audioCtx.createOscillator();\r\n        const gainNode = audioCtx.createGain();\r\n\r\n        oscL.type = 'sine'; oscR.type = 'sine';\r\n        oscL.frequency.value = carrierFreq;\r\n        oscR.frequency.value = carrierFreq + beatFreq;\r\n\r\n        const pannerL = audioCtx.createStereoPanner();\r\n        const pannerR = audioCtx.createStereoPanner();\r\n        pannerL.pan.value = -1; pannerR.pan.value = 1;\r\n\r\n        oscL.connect(pannerL); pannerL.connect(gainNode);\r\n        oscR.connect(pannerR); pannerR.connect(gainNode);\r\n\r\n        gainNode.connect(audioCtx.destination);\r\n        gainNode.gain.value = volume;\r\n\r\n        oscL.start(); oscR.start();\r\n\r\n        oscLeftRef.current = oscL;\r\n        oscRightRef.current = oscR;\r\n        gainNodeRef.current = gainNode;\r\n        \r\n        logDebug && logDebug(\"BinauralBeats:Start\", { carrierFreq, beatFreq, volume });\r\n    }, [getAudioContext, logDebug]);\r\n\r\n    const stopBinauralBeats = useCallback(() => {\r\n        if (oscLeftRef.current) { try { oscLeftRef.current.stop(); } catch { /* ignore */ } oscLeftRef.current = null; }\r\n        if (oscRightRef.current) { try { oscRightRef.current.stop(); } catch { /* ignore */ } oscRightRef.current = null; }\r\n        if (gainNodeRef.current) gainNodeRef.current = null;\r\n    }, []);\r\n\r\n    const updateBinauralVolume = useCallback((volume) => {\r\n        if (gainNodeRef.current && audioContextRef.current) {\r\n            const currentTime = audioContextRef.current.currentTime;\r\n            gainNodeRef.current.gain.setTargetAtTime(volume, currentTime, 0.5);\r\n        }\r\n    }, []);\r\n\r\n    // ---------------------------------------------------------\r\n    // 2. Ambient Environments Engine\r\n    // ---------------------------------------------------------\r\n    const updateAmbientVolume = useCallback((volume) => {\r\n        if (ambientAudioRef.current) {\r\n            ambientAudioRef.current.volume = volume;\r\n        }\r\n    }, []);\r\n\r\n    const playAmbientMusic = useCallback((ambientDef, volume) => {\r\n        if (!ambientDef || ambientDef.id === 'none') {\r\n            if (ambientAudioRef.current) {\r\n                ambientAudioRef.current.pause();\r\n                ambientAudioRef.current = null;\r\n            }\r\n            return;\r\n        }\r\n\r\n        if (!ambientAudioRef.current || !ambientAudioRef.current.src.includes(ambientDef.file)) {\r\n            if (ambientAudioRef.current) ambientAudioRef.current.pause();\r\n            const audio = new Audio(ambientDef.file);\r\n            audio.loop = true;\r\n            audio.volume = volume;\r\n            ambientAudioRef.current = audio;\r\n        }\r\n\r\n        ambientAudioRef.current.play().catch(e => {\r\n            console.warn(\"Ambient play failed:\", e);\r\n            logDebug && logDebug(\"Ambient:Error\", e);\r\n        });\r\n    }, [logDebug]);\r\n\r\n    const stopAmbientMusic = useCallback(() => {\r\n        if (ambientAudioRef.current) {\r\n            ambientAudioRef.current.pause();\r\n        }\r\n    }, []);\r\n\r\n    const stopAmbientMusicAndReset = useCallback(() => {\r\n        if (ambientAudioRef.current) {\r\n            ambientAudioRef.current.pause();\r\n            ambientAudioRef.current.currentTime = 0;\r\n            ambientAudioRef.current = null;\r\n        }\r\n    }, []);\r\n\r\n    // ---------------------------------------------------------\r\n    // 3. TTS Engines (Cloud & Local)\r\n    // ---------------------------------------------------------\r\n    const stopVoiceOnly = useCallback(() => {\r\n        if (window.speechSynthesis) window.speechSynthesis.cancel();\r\n        if (currentAudioRef.current) {\r\n            try { currentAudioRef.current.pause(); currentAudioRef.current.currentTime = 0; } catch { /* ignore */ }\r\n            currentAudioRef.current = null;\r\n        }\r\n    }, []);\r\n\r\n    const playAudio = useCallback((base64String, volume, onEndedCallback) => {\r\n        if (!ttcEnabled || !base64String) return null;\r\n        \r\n        try {\r\n            stopVoiceOnly();\r\n            \r\n            const audio = new Audio(`data:audio/mp3;base64,${base64String}`);\r\n            audio.volume = volume;\r\n            currentAudioRef.current = audio;\r\n\r\n            setTtsState && setTtsState({ isSpeaking: true, engine: 'Cloud TTS', volume: audio.volume });\r\n            logDebug && logDebug(\"PlayAudio:Start\", { vol: volume });\r\n\r\n            audio.onended = () => { \r\n                logDebug && logDebug(\"PlayAudio:Ended\");\r\n                setTtsState && setTtsState(prev => ({ ...prev, isSpeaking: false }));\r\n                if (currentAudioRef.current === audio) currentAudioRef.current = null;\r\n                if (onEndedCallback) onEndedCallback();\r\n            };\r\n            \r\n            const playPromise = audio.play();\r\n            if (playPromise !== undefined) {\r\n                playPromise.catch(e => {\r\n                    console.error(\" Audio Playback Failed:\", e);\r\n                    logDebug && logDebug(\"PlayAudio:Error\", e);\r\n                    setTtsState && setTtsState(prev => ({ ...prev, isSpeaking: false }));\r\n                });\r\n            }\r\n            \r\n            // Race condition check\r\n            if (!isPlayingRef.current && step === 'session') {\r\n                audio.pause();\r\n                currentAudioRef.current = null;\r\n            }\r\n            \r\n            return audio;\r\n        } catch (e) {\r\n            console.error(\" Audio Error:\", e);\r\n            logDebug && logDebug(\"PlayAudio:Catch\", e);\r\n            setTtsState && setTtsState(prev => ({ ...prev, isSpeaking: false }));\r\n            return null;\r\n        }\r\n    }, [ttcEnabled, stopVoiceOnly, setTtsState, logDebug, isPlayingRef, step]);\r\n\r\n    const speak = useCallback((text) => {\r\n        logDebug && logDebug(\"Speak:Start\", text);\r\n        console.log(\" [TTS Check] Speaking:\", text);\r\n        if (!text || typeof window === 'undefined' || !ttcEnabled || !window.speechSynthesis) return;\r\n        \r\n        stopVoiceOnly(); \r\n        \r\n        const utterance = new SpeechSynthesisUtterance(text);\r\n        utterance.lang = 'ko-KR';\r\n        utterance.rate = 0.9;\r\n        utterance.pitch = 1.0;\r\n        utterance.volume = 0.8;\r\n\r\n        utterance.onstart = () => setTtsState && setTtsState({ isSpeaking: true, engine: 'Local TTS', volume: 0.8 });\r\n        utterance.onend = () => setTtsState && setTtsState(prev => ({ ...prev, isSpeaking: false }));\r\n        utterance.onerror = () => setTtsState && setTtsState(prev => ({ ...prev, isSpeaking: false }));\r\n        \r\n        setTimeout(() => {\r\n            if (window.speechSynthesis && ttcEnabled && (step !== 'session' || isPlayingRef.current)) {\r\n                window.speechSynthesis.speak(utterance);\r\n            }\r\n        }, 100);\r\n    }, [ttcEnabled, step, stopVoiceOnly, logDebug, setTtsState, isPlayingRef]);\r\n\r\n    const speakFallback = useCallback((text) => {\r\n        if (!text || typeof window === 'undefined' || !ttcEnabled || !window.speechSynthesis) return;\r\n        \r\n        logDebug && logDebug(\"SpeakFallback\", text);\r\n        stopVoiceOnly();\r\n\r\n        const utterance = new SpeechSynthesisUtterance(text);\r\n        utterance.lang = 'ko-KR';\r\n        utterance.rate = 0.9;\r\n        utterance.pitch = 1.0; \r\n        utterance.volume = 0.8; \r\n        \r\n        setTimeout(() => {\r\n            if (window.speechSynthesis && ttcEnabled) {\r\n                window.speechSynthesis.speak(utterance);\r\n            }\r\n        }, 100);\r\n    }, [ttcEnabled, stopVoiceOnly, logDebug]);\r\n\r\n    // ---------------------------------------------------------\r\n    // 4. Global Cleanup\r\n    // ---------------------------------------------------------\r\n    const stopAllAudio = useCallback((stopAmbient = false) => {\r\n        stopVoiceOnly();\r\n        \r\n        if (stopAmbient) stopAmbientMusic();\r\n        \r\n        stopBinauralBeats();\r\n        \r\n        logDebug && logDebug(\"StopAllAudio\", { stopAmbient });\r\n    }, [stopVoiceOnly, stopAmbientMusic, stopBinauralBeats, logDebug]);\r\n\r\n    // Cleanup AudioContext on unmount\r\n    useEffect(() => {\r\n        return () => {\r\n            if (audioContextRef.current) {\r\n                audioContextRef.current.close().catch(e => console.error(e));\r\n                audioContextRef.current = null;\r\n            }\r\n        };\r\n    }, []);\r\n\r\n    // Provide raw refs to caller if needed\r\n    return {\r\n        audioContextRef,\r\n        ambientAudioRef,\r\n        currentAudioRef,\r\n        \r\n        getAudioContext,\r\n        playBinauralBeats,\r\n        stopBinauralBeats,\r\n        updateBinauralVolume,\r\n        playAmbientMusic,\r\n        stopAmbientMusic,\r\n        stopAmbientMusicAndReset,\r\n        updateAmbientVolume,\r\n        playAudio,\r\n        speak,\r\n        speakFallback,\r\n        stopVoiceOnly,\r\n        stopAllAudio\r\n    };\r\n};\r\n","import { useState, useRef, useCallback } from 'react';\r\nimport { httpsCallable } from 'firebase/functions';\r\nimport { functions } from '../firebase';\r\nimport { AI_SESSION_MESSAGES, MEDITATION_MODES, DIAGNOSIS_OPTIONS } from '../constants/meditationConstants';\r\n\r\nconst generateMeditationGuidance = httpsCallable(functions, 'generateMeditationGuidance');\r\nconst SELECTED_DIAGNOSIS_FALLBACK = DIAGNOSIS_OPTIONS[0];\r\n\r\nexport const useMeditationAI = ({\r\n    memberName,\r\n    timeContext,\r\n    selectedIntention,\r\n    activeMode,\r\n    interactionType,\r\n    micVolume,\r\n    isPlayingRef,\r\n    ttcEnabled,\r\n    stopAllAudio,\r\n    playAudio,\r\n    speak,\r\n    onExit,\r\n    onMeditationReady\r\n}) => {\r\n    // Basic States\r\n    const [isAILoading, setIsAILoading] = useState(true);\r\n    const [aiRequestLock, setAiRequestLock] = useState(false);\r\n    const [aiLatency, setAiLatency] = useState(0);\r\n\r\n    // AI Contents\r\n    const [chatHistory, setChatHistory] = useState([]);\r\n    const [currentAIChat, setCurrentAIChat] = useState(null);\r\n    const [manualInput, setManualInput] = useState(\"\");\r\n    const [aiPrescription, setAiPrescription] = useState(null);\r\n    const [prescriptionReason, setPrescriptionReason] = useState('');\r\n    const [aiMessage, setAiMessage] = useState(\"\");\r\n    \r\n    // Session Tracking\r\n    const [sessionInfo, setSessionInfo] = useState(null);\r\n    const [feedbackData, setFeedbackData] = useState(null);\r\n    const [needsFeedback, setNeedsFeedback] = useState(false);\r\n\r\n    // Refs\r\n    const currentRequestIdRef = useRef(0);\r\n    const messageIndexRef = useRef(0);\r\n    const sessionDiagnosisRef = useRef(null);\r\n    const consecutiveFailsRef = useRef(0);\r\n\r\n    // -----------------------------------------------------\r\n    // 1. Pre-Session: fetchAIPrescription\r\n    // -----------------------------------------------------\r\n    const fetchAIPrescription = useCallback(async (diagnosisId, weatherId, modeId, intType, currentSummary) => {\r\n        try {\r\n            const startTime = Date.now();\r\n            const prescResult = await generateMeditationGuidance({\r\n                type: 'prescription',\r\n                memberName: memberName,\r\n                timeContext: timeContext,\r\n                weather: weatherId,\r\n                diagnosis: diagnosisId,\r\n                analysisSummary: currentSummary,\r\n                mode: modeId === 'breath' ? '3min' : (modeId === 'calm' ? '7min' : '15min'),\r\n                interactionType: intType\r\n            });\r\n            setAiLatency(Date.now() - startTime);\r\n            \r\n            if (prescResult.data) {\r\n                if (prescResult.data.prescriptionReason) {\r\n                    prescResult.data.prescriptionReason = prescResult.data.prescriptionReason.replace(/OO/g, `${memberName}`);\r\n                }\r\n                if (prescResult.data.message) {\r\n                    prescResult.data.message = prescResult.data.message.replace(/OO/g, `${memberName}`);\r\n                }\r\n                setAiPrescription(prescResult.data);\r\n                setPrescriptionReason(prescResult.data.prescriptionReason || prescResult.data.message || '');\r\n            }\r\n        } catch (err) {\r\n            console.error('Standalone Prescription fetch failed:', err);\r\n        }\r\n    }, [memberName, timeContext, setAiLatency]);\r\n\r\n    // -----------------------------------------------------\r\n    // 2. Pre-Session: fetchAIQuestion\r\n    // -----------------------------------------------------\r\n    const fetchAIQuestion = useCallback(async (history = []) => {\r\n        if (aiRequestLock) return; \r\n        setAiRequestLock(true);\r\n        setIsAILoading(true);\r\n\r\n        const requestId = currentRequestIdRef.current + 1;\r\n        currentRequestIdRef.current = requestId;\r\n        \r\n        try {\r\n            const hour = new Date().getHours();\r\n            let currentContext = 'night';\r\n            if (hour >= 5 && hour < 12) currentContext = 'morning';\r\n            else if (hour >= 12 && hour < 18) currentContext = 'afternoon';\r\n            \r\n            let timeoutId;\r\n            const timeoutPromise = new Promise((resolve) => {\r\n                timeoutId = setTimeout(() => {\r\n                    const fallbackMsg = (history && history.length > 0) \r\n                        ? \"  .   ?\" \r\n                        : \"   ?\";\r\n                        \r\n                    const fallbackOptions = (history && history.length > 0)\r\n                        ? [\", \", \" \"]\r\n                        : [\"\", \" \", \"\"];\r\n\r\n                    resolve({\r\n                        data: {\r\n                            message: fallbackMsg,\r\n                            isFinalAnalysis: false,\r\n                            options: fallbackOptions,\r\n                            error: \"timeout\"\r\n                        }\r\n                    });\r\n                }, 18000); \r\n            });\r\n\r\n            const startTime = Date.now();\r\n            const apiPromise = generateMeditationGuidance({ \r\n                type: 'question', \r\n                memberName: memberName || '', \r\n                timeContext: currentContext,\r\n                chatHistory: history,\r\n                intentionFocus: selectedIntention?.focus\r\n            });\r\n\r\n            const result = await Promise.race([apiPromise, timeoutPromise]);\r\n            setAiLatency(Date.now() - startTime);\r\n            clearTimeout(timeoutId);\r\n\r\n            if (requestId !== currentRequestIdRef.current) return;\r\n\r\n            if (result.data) {\r\n                if (result.data.message) result.data.message = result.data.message.replace(/OO/g, `${memberName}`);\r\n                if (result.data.question) result.data.question = result.data.question.replace(/OO/g, `${memberName}`);\r\n                \r\n                if (result.data.isFinalAnalysis) {\r\n                    result.data.options = [];\r\n                    result.data.isTransition = true;\r\n                }\r\n                \r\n                setCurrentAIChat(result.data);\r\n                \r\n                if (result.data.audioContent) {\r\n                    playAudio(result.data.audioContent);\r\n                } else if (result.data.isFinalAnalysis) {\r\n                    if (ttcEnabled) speak(result.data.message);\r\n                }\r\n            }\r\n        } catch (error) {\r\n            if (requestId !== currentRequestIdRef.current) return;\r\n            setCurrentAIChat({\r\n                message: \",    .  ?\",\r\n                options: [\", \", \" \"]\r\n            });\r\n        } finally {\r\n            if (requestId === currentRequestIdRef.current) {\r\n                setIsAILoading(false);\r\n                setAiRequestLock(false);\r\n            }\r\n        }\r\n    }, [aiRequestLock, memberName, selectedIntention, playAudio, ttcEnabled, speak, setAiLatency]);\r\n\r\n    const handleChatResponse = useCallback(async (answer) => {\r\n        if (!answer || aiRequestLock) return;\r\n        \r\n        stopAllAudio();\r\n\r\n        if (answer === \" \") {\r\n            if (onExit) onExit();\r\n            return;\r\n        }\r\n        \r\n        if (currentAIChat?.isFinalAnalysis || [\", \", \"  \", \" \", \"\", \" \", \" \"].some(trigger => answer.includes(trigger))) {\r\n            const diag = DIAGNOSIS_OPTIONS.find(o => o.id === currentAIChat?.mappedDiagnosis) || SELECTED_DIAGNOSIS_FALLBACK;\r\n            const defaultMode = MEDITATION_MODES.find(m => m.id === diag?.prescription?.modeId) || MEDITATION_MODES[1];\r\n            \r\n            if (onMeditationReady) {\r\n                onMeditationReady(diag, defaultMode, diag?.prescription?.type || 'v1');\r\n            }\r\n            return;\r\n        }\r\n        \r\n        stopAllAudio();\r\n\r\n        let updatedHistory = [...chatHistory];\r\n        if (currentAIChat) {\r\n            const aiText = currentAIChat.message || currentAIChat.question;\r\n            const isFallback = aiText?.includes(\" \") || aiText?.includes(\"  \");\r\n            \r\n            if (aiText && !isFallback) {\r\n                updatedHistory = [...updatedHistory, { role: 'model', content: aiText }];\r\n            }\r\n        }\r\n\r\n        const isRespondingToFallback = currentAIChat?.message?.includes(\" \") || currentAIChat?.message?.includes(\"  \");\r\n        \r\n        if (!isRespondingToFallback) {\r\n            updatedHistory = [...updatedHistory, { role: 'user', content: answer }];\r\n        }\r\n        \r\n        setChatHistory(updatedHistory);\r\n        setCurrentAIChat(null); \r\n        setIsAILoading(true);\r\n\r\n        await fetchAIQuestion(updatedHistory);\r\n    }, [aiRequestLock, currentAIChat, chatHistory, stopAllAudio, onExit, onMeditationReady, fetchAIQuestion]);\r\n\r\n    const handleManualSubmit = useCallback((e) => {\r\n        e.preventDefault();\r\n        if (!manualInput.trim()) return;\r\n        const text = manualInput;\r\n        setManualInput(\"\");\r\n        handleChatResponse(text);\r\n    }, [manualInput, handleChatResponse]);\r\n\r\n    const handleReturnToChat = useCallback(async () => {\r\n        setIsAILoading(true);\r\n        \r\n        const warmReconnectMsg = `${memberName},  .      ?`;\r\n        setCurrentAIChat({\r\n            message: warmReconnectMsg,\r\n            options: [\", \", \", \"]\r\n        });\r\n        \r\n        if (ttcEnabled) speak(warmReconnectMsg);\r\n\r\n        const lastUserMsg = chatHistory.filter(m => m.role === 'user').pop()?.content || '';\r\n        const newHistory = [...chatHistory, { \r\n            role: 'system',\r\n            content: `[Context] User briefly viewed meditation options but chose to continue conversation. Last discussed: \"${lastUserMsg}\". Gently ask if they want to explore that topic more deeply, in a warm, human, conversational tone. Do NOT sound robotic or templated.` \r\n        }];\r\n        setChatHistory(newHistory);\r\n        \r\n        await fetchAIQuestion(newHistory);\r\n    }, [memberName, chatHistory, ttcEnabled, speak, fetchAIQuestion]);\r\n\r\n    // -----------------------------------------------------\r\n    // 3. In-Session: fetchAISessionMessage\r\n    // -----------------------------------------------------\r\n    const fetchAISessionMessage = useCallback(async () => {\r\n        try {\r\n            const currentIndex = messageIndexRef.current;\r\n            const currentDiagnosis = sessionDiagnosisRef.current;\r\n            \r\n            const startTime = Date.now();\r\n            let timeoutId;\r\n            const timeoutPromise = new Promise((_, reject) => {\r\n                timeoutId = setTimeout(() => reject(new Error('Session AI timeout (8s)')), 8000);\r\n            });\r\n            \r\n            const apiPromise = generateMeditationGuidance({\r\n                type: 'session_message',\r\n                memberName: memberName,\r\n                timeContext: timeContext,\r\n                diagnosis: currentDiagnosis,\r\n                mode: activeMode?.id === 'breath' ? '3min' : (activeMode?.id === 'calm' ? '7min' : '15min'),\r\n                interactionType: interactionType,\r\n                messageIndex: currentIndex,\r\n                breathLevel: interactionType === 'v2' ? micVolume : null\r\n            });\r\n            \r\n            const result = await Promise.race([apiPromise, timeoutPromise]);\r\n            clearTimeout(timeoutId);\r\n            setAiLatency(Date.now() - startTime);\r\n            \r\n            if (result.data && result.data.error) throw new Error(\"Backend Returned Error: \" + result.data.error);\r\n\r\n            if (result.data && result.data.message) {\r\n                const personalizedMsg = result.data.message.replace(/OO/g, `${memberName}`);\r\n                if (isPlayingRef.current) {\r\n                    setAiMessage(personalizedMsg);\r\n                    messageIndexRef.current = currentIndex + 1;\r\n                    consecutiveFailsRef.current = 0;\r\n                    \r\n                    if (result.data.audioContent) {\r\n                        playAudio(result.data.audioContent);\r\n                    }\r\n                }\r\n            }\r\n        } catch (error) {\r\n            console.error('AI Session message failed:', error.message);\r\n            if (isPlayingRef.current) {\r\n                const currentIndex = messageIndexRef.current;\r\n                consecutiveFailsRef.current += 1;\r\n                const failCount = consecutiveFailsRef.current;\r\n                \r\n                if (failCount > 3) return;\r\n                \r\n                const messages = AI_SESSION_MESSAGES[interactionType] || AI_SESSION_MESSAGES['v1'];\r\n                const msg = messages[currentIndex % messages.length];\r\n                setAiMessage(msg);\r\n                messageIndexRef.current = currentIndex + 1;\r\n            }\r\n        }\r\n    }, [memberName, timeContext, activeMode, interactionType, micVolume, isPlayingRef, playAudio, setAiLatency]);\r\n\r\n    // -----------------------------------------------------\r\n    // 4. Post-Session: fetchAIFeedback\r\n    // -----------------------------------------------------\r\n    const fetchAIFeedback = useCallback(async (stabilityScore, customSummary) => {\r\n        try {\r\n            const result = await generateMeditationGuidance({\r\n                type: 'feedback',\r\n                memberName: memberName,\r\n                sessionInfo: sessionInfo,\r\n                postureFeedback: customSummary,\r\n                stabilityScore: stabilityScore\r\n            });\r\n            \r\n            if (result.data && result.data.feedbackMessage) {\r\n                setFeedbackData({ \r\n                    message: result.data.feedbackMessage.replace(/OO/g, `${memberName}`),\r\n                    analysis: result.data.analysis \r\n                });\r\n            }\r\n            return result.data;\r\n        } catch (err) {\r\n            console.error('AI Feedback Failed:', err);\r\n            return null;\r\n        }\r\n    }, [memberName, sessionInfo]);\r\n\r\n    // Helpers\r\n    const generateReason = useCallback((time, weatherId, diagnosisId) => {\r\n        const timeText = time === 'morning' ? '  ,' : time === 'afternoon' ? '  ,' : '  ,';\r\n        let coreMessage = \"      .      ?\";\r\n        \r\n        if (diagnosisId === 'stress' || diagnosisId === 'overthink') {\r\n            coreMessage = \"       .   ,          .    .\";\r\n        } else if (diagnosisId === 'stiff') {\r\n            coreMessage = \"    .     ,     .\";\r\n        } else if (diagnosisId === 'anxious' || diagnosisId === 'frustrated') {\r\n            coreMessage = \"         .            .  .\";\r\n        } else if (diagnosisId === 'tired' || diagnosisId === 'low_energy') {\r\n            coreMessage = \"      .        .     .\";\r\n        } else if (diagnosisId === 'distracted') {\r\n            coreMessage = \"     ?    ' '   .\";\r\n        } \r\n        return `${timeText} ${coreMessage}`;\r\n    }, []);\r\n\r\n    return {\r\n        isAILoading, setIsAILoading,\r\n        aiRequestLock, setAiRequestLock,\r\n        aiLatency, setAiLatency,\r\n        chatHistory, setChatHistory,\r\n        currentAIChat, setCurrentAIChat,\r\n        manualInput, setManualInput,\r\n        aiPrescription, setAiPrescription,\r\n        prescriptionReason, setPrescriptionReason,\r\n        aiMessage, setAiMessage,\r\n        sessionInfo, setSessionInfo,\r\n        feedbackData, setFeedbackData,\r\n        needsFeedback, setNeedsFeedback,\r\n        \r\n        messageIndexRef,\r\n        sessionDiagnosisRef,\r\n        consecutiveFailsRef,\r\n\r\n        fetchAIPrescription,\r\n        fetchAIQuestion,\r\n        fetchAISessionMessage,\r\n        fetchAIFeedback,\r\n        handleChatResponse,\r\n        handleManualSubmit,\r\n        handleReturnToChat,\r\n        generateReason\r\n    };\r\n};\r\n","import { useState, useCallback } from 'react';\r\nimport { WEATHER_OPTIONS } from '../constants/meditationConstants';\r\n\r\nexport const useWeatherAwareness = () => {\r\n    const [weatherContext, setWeatherContext] = useState(null);\r\n\r\n    const detectWeather = useCallback(async () => {\r\n        try {\r\n            if (navigator.geolocation) {\r\n                navigator.geolocation.getCurrentPosition(\r\n                    async (position) => {\r\n                        const { latitude, longitude } = position.coords;\r\n                        try {\r\n                            const response = await fetch(\r\n                                `https://api.openweathermap.org/data/2.5/weather?lat=${latitude}&lon=${longitude}&appid=bd5e378503939ddaee76f12ad7a97608&units=metric`\r\n                            );\r\n                            const data = await response.json();\r\n                            const weatherMain = data.weather?.[0]?.main?.toLowerCase() || '';\r\n                            const weatherDesc = data.weather?.[0]?.description || '';\r\n                            \r\n                            let detected = WEATHER_OPTIONS[0]; // Default: sunny\r\n                            if (weatherMain.includes('rain') || weatherMain.includes('drizzle')) {\r\n                                detected = WEATHER_OPTIONS.find(w => w.id === 'rain');\r\n                            } else if (weatherMain.includes('snow')) {\r\n                                detected = WEATHER_OPTIONS.find(w => w.id === 'snow');\r\n                            } else if (weatherMain.includes('cloud') || weatherMain.includes('mist') || weatherMain.includes('fog')) {\r\n                                detected = WEATHER_OPTIONS.find(w => w.id === 'cloud');\r\n                            }\r\n                            \r\n                            //  FULL ENVIRONMENTAL DATA for AI\r\n                            const fullWeatherData = {\r\n                                ...detected,\r\n                                temp: Math.round(data.main?.temp) || 20,\r\n                                humidity: data.main?.humidity || 50,\r\n                                windSpeed: Math.round((data.wind?.speed || 0) * 3.6),\r\n                                description: weatherDesc,\r\n                                feelsLike: Math.round(data.main?.feels_like) || 20,\r\n                                city: data.name || '' //  \r\n                            };\r\n                            \r\n                            setWeatherContext(fullWeatherData);\r\n                            console.log(' Full Weather:', fullWeatherData);\r\n                        } catch (e) {\r\n                            console.error('Weather API failed:', e);\r\n                            setWeatherContext({ ...WEATHER_OPTIONS[0], temp: 20, humidity: 50, windSpeed: 5 });\r\n                        }\r\n                    },\r\n                    () => {\r\n                        // Geolocation denied\r\n                        setWeatherContext({ ...WEATHER_OPTIONS[0], temp: 20, humidity: 50, windSpeed: 5 });\r\n                    },\r\n                    { timeout: 5000 }\r\n                );\r\n            } else {\r\n                setWeatherContext({ ...WEATHER_OPTIONS[0], temp: 20, humidity: 50, windSpeed: 5 });\r\n            }\r\n        } catch (e) {\r\n            console.error('Weather detection failed:', e);\r\n            setWeatherContext({ ...WEATHER_OPTIONS[0], temp: 20, humidity: 50, windSpeed: 5 });\r\n        }\r\n    }, []);\r\n\r\n    return {\r\n        weatherContext,\r\n        setWeatherContext,\r\n        detectWeather\r\n    };\r\n};\r\n","import { useState, useEffect } from 'react';\r\nimport { Icons as PhosphorIcons } from '../../../components/CommonIcons';\r\n\r\nconst { Brain } = PhosphorIcons;\r\n\r\nconst AI_LOADING_MESSAGES = [\r\n    \"  ...\",\r\n    \"  ...\",\r\n    \"   ...\",\r\n    \"  ...\",\r\n    \",   ...\"\r\n];\r\n\r\nexport const AILoadingIndicator = ({ compact = false, message = null }) => {\r\n    const [msgIndex, setMsgIndex] = useState(0);\r\n    \r\n    useEffect(() => {\r\n        if (message) return; // Don't cycle if custom message provided\r\n        const interval = setInterval(() => {\r\n            setMsgIndex(prev => (prev + 1) % AI_LOADING_MESSAGES.length);\r\n        }, 2500);\r\n        return () => clearInterval(interval);\r\n    }, [message]);\r\n\r\n    const displayMessage = message || AI_LOADING_MESSAGES[msgIndex];\r\n    \r\n    if (compact) {\r\n        return (\r\n            <div style={{ \r\n                display: 'flex', alignItems: 'center', gap: '12px', \r\n                padding: '12px 20px', borderRadius: '20px',\r\n                background: 'rgba(212, 175, 55, 0.08)',\r\n                border: '1px solid rgba(212, 175, 55, 0.15)'\r\n            }}>\r\n                <div className=\"ai-thinking-icon\" style={{ \r\n                    width: '28px', height: '28px', \r\n                    display: 'flex', alignItems: 'center', justifyContent: 'center',\r\n                    color: 'var(--primary-gold, #d4af37)'\r\n                }}>\r\n                    <Brain size={24} weight=\"duotone\" />\r\n                </div>\r\n                <span style={{ color: 'rgba(255,255,255,0.8)', fontSize: '0.9rem' }}>{displayMessage}</span>\r\n            </div>\r\n        );\r\n    }\r\n    \r\n    return (\r\n        <div style={{ \r\n            display: 'flex', flexDirection: 'column', alignItems: 'center', \r\n            justifyContent: 'center', gap: '24px', padding: '40px'\r\n        }}>\r\n            {/* Rotating/Pulsing Icon */}\r\n            <div className=\"ai-thinking-icon\" style={{ \r\n                width: '80px', height: '80px', borderRadius: '50%',\r\n                background: 'rgba(212, 175, 55, 0.1)',\r\n                border: '2px solid rgba(212, 175, 55, 0.3)',\r\n                display: 'flex', alignItems: 'center', justifyContent: 'center',\r\n                color: 'var(--primary-gold, #d4af37)',\r\n                boxShadow: '0 0 30px rgba(212, 175, 55, 0.2)'\r\n            }}>\r\n                <Brain size={40} weight=\"duotone\" />\r\n            </div>\r\n            \r\n            {/* Message */}\r\n            <div style={{ textAlign: 'center' }}>\r\n                <div style={{ \r\n                    color: 'rgba(255,255,255,0.9)', fontSize: '1.1rem', fontWeight: '500',\r\n                    marginBottom: '8px', transition: 'opacity 0.3s ease'\r\n                }}>\r\n                    {displayMessage}\r\n                </div>\r\n                <div style={{ color: 'rgba(255,255,255,0.4)', fontSize: '0.85rem' }}>\r\n                      \r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","import React from 'react';\r\nimport { Icons as PhosphorIcons } from '../../../components/CommonIcons';\r\n\r\nconst { X } = PhosphorIcons;\r\n\r\nexport const VolumeControlPanel = ({\r\n    showVolumePanel,\r\n    setShowVolumePanel,\r\n    audioVolumes,\r\n    setAudioVolumes,\r\n    currentAudioRef,\r\n    updateAmbientVolume,\r\n    updateBinauralVolume,\r\n    soundEnabled,\r\n    setSoundEnabled\r\n}) => {\r\n    if (!showVolumePanel) return null;\r\n\r\n    return (\r\n        <div style={{\r\n            position: 'absolute', bottom: '180px', left: '50%', transform: 'translateX(-50%)',\r\n            width: '280px', background: 'rgba(0,0,0,0.85)', backdropFilter: 'blur(20px)',\r\n            borderRadius: '24px', padding: '20px', zIndex: 30,\r\n            border: '1px solid rgba(255,255,255,0.15)', boxShadow: '0 20px 60px rgba(0,0,0,0.6)',\r\n            animation: 'fadeIn 0.3s ease'\r\n        }}>\r\n            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '15px' }}>\r\n                <span style={{ color: 'var(--primary-gold)', fontSize: '0.85rem', fontWeight: 700 }}>  </span>\r\n                <button onClick={() => setShowVolumePanel(false)} style={{ background: 'none', border: 'none', color: 'rgba(255,255,255,0.5)', cursor: 'pointer', padding: '4px' }}>\r\n                    <X size={18} />\r\n                </button>\r\n            </div>\r\n            \r\n            {/* Voice Volume */}\r\n            <div style={{ marginBottom: '12px' }}>\r\n                <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '6px' }}>\r\n                    <span style={{ fontSize: '0.8rem', color: 'rgba(255,255,255,0.7)' }}>  </span>\r\n                    <span style={{ fontSize: '0.75rem', color: 'var(--primary-gold)' }}>{Math.round(audioVolumes.voice * 100)}%</span>\r\n                </div>\r\n                <input type=\"range\" min=\"0\" max=\"100\" value={Math.round(audioVolumes.voice * 100)}\r\n                    onChange={(e) => {\r\n                        const val = parseInt(e.target.value) / 100;\r\n                        setAudioVolumes(prev => ({ ...prev, voice: val }));\r\n                        if (currentAudioRef.current) currentAudioRef.current.volume = val;\r\n                    }}\r\n                    style={{ width: '100%', accentColor: 'var(--primary-gold)', height: '4px' }} />\r\n            </div>\r\n            \r\n            {/* Ambient Volume */}\r\n            <div style={{ marginBottom: '12px' }}>\r\n                <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '6px' }}>\r\n                    <span style={{ fontSize: '0.8rem', color: 'rgba(255,255,255,0.7)' }}> </span>\r\n                    <span style={{ fontSize: '0.75rem', color: 'var(--primary-gold)' }}>{Math.round(audioVolumes.ambient * 100)}%</span>\r\n                </div>\r\n                <input type=\"range\" min=\"0\" max=\"100\" value={Math.round(audioVolumes.ambient * 100)}\r\n                    onChange={(e) => {\r\n                        const val = parseInt(e.target.value) / 100;\r\n                        setAudioVolumes(prev => ({ ...prev, ambient: val }));\r\n                        updateAmbientVolume(val);\r\n                    }}\r\n                    style={{ width: '100%', accentColor: '#4ade80', height: '4px' }} />\r\n            </div>\r\n            \r\n            {/* Binaural Volume */}\r\n            <div>\r\n                <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '6px' }}>\r\n                    <span style={{ fontSize: '0.8rem', color: 'rgba(255,255,255,0.7)' }}> </span>\r\n                    <span style={{ fontSize: '0.75rem', color: 'var(--primary-gold)' }}>{Math.round(audioVolumes.binaural * 100)}%</span>\r\n                </div>\r\n                <input type=\"range\" min=\"0\" max=\"100\" value={Math.round(audioVolumes.binaural * 100)}\r\n                    onChange={(e) => {\r\n                        const val = parseInt(e.target.value) / 100;\r\n                        setAudioVolumes(prev => ({ ...prev, binaural: val }));\r\n                        updateBinauralVolume(val);\r\n                    }}\r\n                    style={{ width: '100%', accentColor: '#a29bfe', height: '4px' }} />\r\n            </div>\r\n            \r\n            {/* Mute All Toggle */}\r\n            <button onClick={() => {\r\n                setSoundEnabled(!soundEnabled);\r\n                if (soundEnabled) {\r\n                    // Mute all\r\n                    updateAmbientVolume(0);\r\n                    updateBinauralVolume(0);\r\n                } else {\r\n                    // Restore\r\n                    updateAmbientVolume(audioVolumes.ambient);\r\n                    updateBinauralVolume(audioVolumes.binaural);\r\n                }\r\n            }} style={{\r\n                marginTop: '12px', width: '100%', padding: '10px', borderRadius: '12px',\r\n                background: soundEnabled ? 'rgba(255,255,255,0.08)' : 'rgba(255,0,0,0.15)',\r\n                border: '1px solid rgba(255,255,255,0.1)', color: soundEnabled ? 'rgba(255,255,255,0.7)' : '#ff6b6b',\r\n                fontSize: '0.8rem', cursor: 'pointer', fontWeight: 600\r\n            }}>{soundEnabled ? '  ' : '  '}</button>\r\n        </div>\r\n    );\r\n};\r\n","import React from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { Icons as PhosphorIcons } from '../../../components/CommonIcons';\r\n\r\nconst { X, Heartbeat, Brain, Sparkle } = PhosphorIcons;\r\n\r\nexport const FeedbackView = ({ \r\n    activeMode, \r\n    feedbackData, \r\n    formatTime, \r\n    timeLeft, \r\n    modeName, \r\n    onClose \r\n}) => {\r\n    const navigate = useNavigate();\r\n    const duration = activeMode?.id === 'breath' ? 3 * 60 : (activeMode?.id === 'calm' ? 7 * 60 : 15 * 60);\r\n    const actualTime = duration - timeLeft;\r\n\r\n    return (\r\n        <div style={{\r\n            position: 'fixed', inset: 0, background: '#0a0a0c', zIndex: 4000,\r\n            display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center',\r\n            padding: '20px', overflowY: 'auto'\r\n        }}>\r\n            <button onClick={onClose} style={{\r\n                position: 'absolute', top: '20px', right: '20px',\r\n                background: 'rgba(255,255,255,0.1)', border: 'none', color: 'white',\r\n                width: '50px', height: '50px', borderRadius: '50%',\r\n                display: 'flex', alignItems: 'center', justifyContent: 'center', cursor: 'pointer'\r\n            }}><X size={24} /></button>\r\n\r\n            <div style={{\r\n                background: 'linear-gradient(145deg, rgba(30,30,35,0.9), rgba(15,15,20,0.9))',\r\n                borderRadius: '30px', padding: '40px', maxWidth: '600px', width: '100%',\r\n                border: `1px solid ${activeMode?.color}40`,\r\n                boxShadow: `0 20px 80px ${activeMode?.color}20`,\r\n                animation: 'fadeIn 0.5s ease-out'\r\n            }}>\r\n                <div style={{ textAlign: 'center', marginBottom: '30px' }}>\r\n                    <div style={{\r\n                        width: '80px', height: '80px', borderRadius: '50%',\r\n                        background: `${activeMode?.color}20`, margin: '0 auto 20px',\r\n                        display: 'flex', alignItems: 'center', justifyContent: 'center',\r\n                        color: activeMode?.color\r\n                    }}>\r\n                        <Brain size={40} weight=\"light\" />\r\n                    </div>\r\n                    <h2 style={{ color: 'white', fontSize: '1.8rem', fontWeight: 600, marginBottom: '10px' }}>\r\n                          \r\n                    </h2>\r\n                    <p style={{ color: 'rgba(255,255,255,0.6)', fontSize: '1.1rem' }}>\r\n                        {modeName}  {Math.floor(actualTime / 60)} {actualTime % 60} \r\n                    </p>\r\n                </div>\r\n\r\n                {feedbackData ? (\r\n                    <div style={{ \r\n                        background: 'rgba(0,0,0,0.3)', borderRadius: '20px', padding: '25px',\r\n                        border: '1px solid rgba(255,255,255,0.05)'\r\n                    }}>\r\n                        <div style={{ display: 'flex', alignItems: 'center', gap: '10px', marginBottom: '15px' }}>\r\n                            <Heartbeat size={24} color={activeMode?.color} />\r\n                            <h3 style={{ color: 'white', fontSize: '1.2rem', fontWeight: 500, margin: 0 }}>\r\n                                   \r\n                            </h3>\r\n                        </div>\r\n                        <p style={{ \r\n                            color: 'rgba(255,255,255,0.9)', lineHeight: 1.8, fontSize: '1.1rem',\r\n                            whiteSpace: 'pre-wrap'\r\n                        }}>\r\n                            {feedbackData.message}\r\n                        </p>\r\n                        \r\n                        {feedbackData.analysis && (\r\n                            <div style={{ \r\n                                marginTop: '20px', paddingTop: '20px', borderTop: '1px solid rgba(255,255,255,0.1)',\r\n                                display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '15px'\r\n                            }}>\r\n                                <div style={{ background: 'rgba(255,255,255,0.05)', padding: '15px', borderRadius: '15px' }}>\r\n                                    <span style={{ display: 'block', color: 'rgba(255,255,255,0.5)', fontSize: '0.85rem', marginBottom: '5px' }}> </span>\r\n                                    <span style={{ color: 'white', fontSize: '1.2rem', fontWeight: 600 }}>{feedbackData.analysis.stabilityScore}/100</span>\r\n                                </div>\r\n                                <div style={{ background: 'rgba(255,255,255,0.05)', padding: '15px', borderRadius: '15px' }}>\r\n                                    <span style={{ display: 'block', color: 'rgba(255,255,255,0.5)', fontSize: '0.85rem', marginBottom: '5px' }}> </span>\r\n                                    <span style={{ color: 'white', fontSize: '1.1rem', fontWeight: 500 }}>{feedbackData.analysis.energyShift}</span>\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                ) : (\r\n                    <div style={{ textAlign: 'center', padding: '40px 0' }}>\r\n                        <div className=\"breathing-circle\" style={{ \r\n                            width: '40px', height: '40px', margin: '0 auto 20px',\r\n                            background: activeMode?.color, borderRadius: '50%' \r\n                        }} />\r\n                        <p style={{ color: 'rgba(255,255,255,0.6)' }}>   ...</p>\r\n                    </div>\r\n                )}\r\n\r\n                <button onClick={onClose} style={{\r\n                    width: '100%', padding: '20px', marginTop: '30px',\r\n                    background: activeMode?.color, border: 'none', borderRadius: '15px',\r\n                    color: '#000', fontSize: '1.2rem', fontWeight: 600, cursor: 'pointer',\r\n                    boxShadow: `0 10px 30px ${activeMode?.color}40`\r\n                }}>\r\n                       \r\n                </button>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","import React from 'react';\r\n\r\n//  Meditation Debug Overlay Component\r\nexport const MeditationDebugOverlay = ({ isVisible, ttsState, currentStep, audioLevels, currentText, aiLatency }) => {\r\n    if (!isVisible) return null;\r\n\r\n    return (\r\n        <div style={{\r\n            position: 'fixed', top: '80px', left: '20px', right: '20px',\r\n            background: 'rgba(0,0,0,0.85)', backdropFilter: 'blur(10px)',\r\n            border: '1px solid rgba(0,255,255,0.3)', borderRadius: '15px',\r\n            padding: '15px', color: '#00ffff', fontSize: '0.75rem', zIndex: 10000,\r\n            fontFamily: 'monospace', pointerEvents: 'none', boxShadow: '0 10px 30px rgba(0,0,0,0.5)'\r\n        }}>\r\n            <div style={{ fontWeight: 'bold', marginBottom: '8px', borderBottom: '1px solid rgba(0,255,255,0.2)', paddingBottom: '4px', display: 'flex', justifyContent: 'space-between' }}>\r\n                <span>[MEDITATION DEBUG MODE]</span>\r\n                <span>Latency: {aiLatency}ms</span>\r\n            </div>\r\n            \r\n            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '10px' }}>\r\n                <div>\r\n                    <div style={{ color: '#fff', marginBottom: '4px' }}> AI & Step Status</div>\r\n                    <div>Step: {currentStep}</div>\r\n                    <div>TTS Engine: {ttsState.engine}</div>\r\n                    <div>Speaking: {ttsState.isSpeaking ? 'YES' : 'NO'}</div>\r\n                </div>\r\n                <div>\r\n                    <div style={{ color: '#fff', marginBottom: '4px' }}> Audio Levels</div>\r\n                    <div>Voice: {Math.round(audioLevels.voice * 100)}%</div>\r\n                    <div>Ambient: {Math.round(audioLevels.ambient * 100)}%</div>\r\n                    <div>Binaural: {Math.round(audioLevels.binaural * 100)}%</div>\r\n                </div>\r\n            </div>\r\n\r\n            <div style={{ marginTop: '10px', paddingTop: '8px', borderTop: '1px solid rgba(0,255,255,0.1)' }}>\r\n                <div style={{ color: '#fff', marginBottom: '4px' }}> Raw TTS Text:</div>\r\n                <div style={{ background: 'rgba(0,0,0,0.3)', padding: '6px', borderRadius: '4px', maxHeight: '60px', overflowY: 'auto', whiteSpace: 'pre-wrap' }}>\r\n                    {currentText || 'No text currently processed'}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","import { useState, useEffect, useRef, useCallback } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { httpsCallable } from 'firebase/functions';\r\nimport { functions } from '../firebase';\r\nimport { Icons } from '../components/CommonIcons';\r\nimport { MEDITATION_MODES, INTERACTION_TYPES, DIAGNOSIS_OPTIONS, WEATHER_OPTIONS, SPECIALIST_QUESTIONS, AI_SESSION_MESSAGES, AMBIENT_SOUNDS, MEDITATION_INTENTIONS, MEDITATION_CATEGORIES } from '../constants/meditationConstants';\r\n\r\n//  AI Posture Analysis (MediaPipe) - Loaded Dynamically\r\n// import { Pose } from '@mediapipe/pose'; // REMOVED: Dynamic import used instead\r\n// import * as tf from '@tensorflow/tfjs-core'; // REMOVED: Dynamic import used instead\r\n// import '@tensorflow/tfjs-backend-webgl'; // REMOVED: Dynamic import used instead\r\n\r\nimport { useAudioAnalyzer } from '../hooks/useAudioAnalyzer';\r\nimport { useMeditationAudio } from '../hooks/useMeditationAudio';\r\nimport { useMeditationAI } from '../hooks/useMeditationAI';\r\nimport { useWeatherAwareness } from '../hooks/useWeatherAwareness';\r\nimport { AILoadingIndicator } from '../components/meditation/ui/AILoadingIndicator';\r\nimport { ChatDialog } from '../components/meditation/ui/ChatDialog';\r\nimport { PoseCanvas } from '../components/meditation/ui/PoseCanvas';\r\nimport { VolumeControlPanel } from '../components/meditation/ui/VolumeControlPanel';\r\nimport { FeedbackView } from '../components/meditation/ui/FeedbackView';\r\nimport { MeditationDebugOverlay } from '../components/meditation/MeditationDebugOverlay';\r\nimport { Icons as PhosphorIcons } from '../components/CommonIcons';\r\nimport { storageService } from '../services/storage';\r\nconst { \r\n    Play, Pause, X, Wind, SpeakerHigh, SpeakerSlash, Brain, Microphone, VideoCamera, \r\n    LockKey, Heartbeat, SmileySad, Lightning, Barbell, Sparkle, Sun, CloudRain, \r\n    CloudSnow, Cloud\r\n} = PhosphorIcons;\r\n\r\n// [HOTFIX] Local ArrowLeft to prevent 'Ar' ReferenceError\r\nconst ArrowLeft = ({ size = 24, color = \"currentColor\" }) => (\r\n    <svg width={size} height={size} viewBox=\"0 0 256 256\" fill={color}>\r\n        <path d=\"M224,128a8,8,0,0,1-8,8H59.31l58.35,58.34a8,8,0,0,1-11.32,11.32l-72-72a8,8,0,0,1,0-11.32l72-72a8,8,0,0,1,11.32,11.32L59.31,120H216A8,8,0,0,1,224,128Z\" />\r\n    </svg>\r\n);\r\n\r\nconst ArrowUp = ({ size = 24, color = \"currentColor\" }) => (\r\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width={size} height={size} fill={color} viewBox=\"0 0 256 256\">\r\n        <path d=\"M213.66,122.34a8,8,0,0,1-11.32,0L136,56v152a8,8,0,0,1-16,0V56L53.66,122.34a8,8,0,0,1-11.32-11.32l80-80a8,8,0,0,1,11.32,0l80,80A8,8,0,0,1,213.66,122.34Z\"></path>\r\n    </svg>\r\n);\r\n\r\nconst ICON_MAP = {\r\n    Wind, Brain, Sparkle, Microphone, VideoCamera, Lightning, Barbell, Heartbeat, SmileySad, Sun, CloudRain, CloudSnow, Cloud\r\n};\r\n\r\n// Initialize Firebase Functions\r\nconst generateMeditationGuidance = httpsCallable(functions, 'generateMeditationGuidance');\r\n\r\nconst SELECTED_DIAGNOSIS_FALLBACK = DIAGNOSIS_OPTIONS[0];\r\n\r\n\r\nconst MeditationPage = ({ onClose }) => {\r\n    const navigate = useNavigate();\r\n    \r\n    // Stable Refs for cleanup without re-triggering effects\r\n    const cameraStreamRef = useRef(null);\r\n    const isPlayingRef = useRef(false); //      Ref ( )\r\n    const [step, setStep] = useState('initial_prep'); //     \r\n    \r\n    // Context State\r\n    const [timeContext, setTimeContext] = useState('morning');\r\n    const { weatherContext, setWeatherContext, detectWeather } = useWeatherAwareness();\r\n    const [selectedDiagnosis, setSelectedDiagnosis] = useState(null);\r\n    const [selectedIntention, setSelectedIntention] = useState(null); //   \r\n    const [selectedCategory, setSelectedCategory] = useState(null); //    (/)\r\n\r\n    // Session Settings\r\n    const [activeMode, setActiveMode] = useState(null); \r\n    const [interactionType, setInteractionType] = useState('v1');\r\n    \r\n    //  Visual Theme (Randomized)\r\n    const [visualTheme, setVisualTheme] = useState('heartbeat'); \r\n    \r\n    useEffect(() => {\r\n        const themes = ['heartbeat', 'candle', 'rain', 'snow'];\r\n        const randomTheme = themes[Math.floor(Math.random() * themes.length)];\r\n        setVisualTheme(randomTheme);\r\n        console.log(` [Visual Theme] Selected: ${randomTheme}`);\r\n    }, []);\r\n\r\n    const [isPlaying, setIsPlaying] = useState(false);\r\n    const [timeLeft, setTimeLeft] = useState(0);\r\n    const [soundEnabled, setSoundEnabled] = useState(true); \r\n    const [ttcEnabled, setTtcEnabled] = useState(true); // TTC (Text To Calm) Voice Guidance - Default ON\r\n    const [selectedAmbient, setSelectedAmbient] = useState('rain'); //  Default to 'rain' (User Request: Calm music from start)\r\n    const [audioVolumes, setAudioVolumes] = useState({\r\n        voice: 0.8,    //    ( 1)\r\n        ambient: 0.35, //   ()\r\n        binaural: 0.1  //    ( -  )\r\n    });\r\n    \r\n    // Audio/Video State\r\n    const { micVolume, setupAudioAnalysis, stopAudioAnalysis, pauseAudioAnalysis, resumeAudioAnalysis } = useAudioAnalyzer();\r\n\r\n    const [permissionError, setPermissionError] = useState(null);\r\n    const [cameraStream, setCameraStream] = useState(null);\r\n    const [showVolumePanel, setShowVolumePanel] = useState(false); //  Phase 3:   \r\n    const [showVolumeHint, setShowVolumeHint] = useState(false); //    \r\n\r\n    //  REAL-TIME AI States\r\n    const [memberName] = useState(() => {\r\n        try {\r\n            const stored = localStorage.getItem('member');\r\n            if (stored) {\r\n                const member = JSON.parse(stored);\r\n                return member.name || \"\";\r\n            }\r\n        } catch (e) {\r\n            console.warn(\"Failed to load member name\", e);\r\n        }\r\n        return \"\";\r\n    });\r\n\r\n    //  DEBUG MODE STATES (User Request)\r\n    const [isDebugMode, setIsDebugMode] = useState(false); //  Default to false (User: Record internally only)\r\n    const [, setDebugClickCount] = useState(0);\r\n    const [ttsState, setTtsState] = useState({ isSpeaking: false, engine: 'None', volume: 0 });\r\n\r\n    const handleDebugToggle = useCallback(() => {\r\n        setDebugClickCount(prev => {\r\n            const next = prev + 1;\r\n            if (next >= 5) {\r\n                setIsDebugMode(v => !v);\r\n                return 0;\r\n            }\r\n            return next;\r\n        });\r\n    }, []);\r\n\r\n    //  DEBUG LOGGING SYSTEM (User Request)\r\n    const logDebug = useCallback((action, data) => {\r\n        const timestamp = new Date().toLocaleTimeString();\r\n        console.log(`%c[MeditationDebug] ${timestamp} [${action}]`, 'color: #00ffff; font-weight: bold;', data || '');\r\n    }, []);\r\n\r\n    //  Extract Audio System hook\r\n    const {\r\n        audioContextRef,\r\n        ambientAudioRef,\r\n        currentAudioRef,\r\n        getAudioContext,\r\n        playBinauralBeats,\r\n        stopBinauralBeats,\r\n        updateBinauralVolume,\r\n        playAmbientMusic,\r\n        stopAmbientMusic,\r\n        stopAmbientMusicAndReset,\r\n        updateAmbientVolume,\r\n        playAudio,\r\n        speak,\r\n        speakFallback,\r\n        stopVoiceOnly,\r\n        stopAllAudio\r\n    } = useMeditationAudio(ttcEnabled, isPlayingRef, step, logDebug, setTtsState, audioVolumes, soundEnabled);\r\n\r\n    const {\r\n        isAILoading, setIsAILoading,\r\n        aiRequestLock, setAiRequestLock,\r\n        aiLatency, setAiLatency,\r\n        chatHistory, setChatHistory,\r\n        currentAIChat, setCurrentAIChat,\r\n        manualInput, setManualInput,\r\n        aiPrescription, setAiPrescription,\r\n        prescriptionReason, setPrescriptionReason,\r\n        aiMessage, setAiMessage,\r\n        sessionInfo, setSessionInfo,\r\n        feedbackData, setFeedbackData,\r\n        needsFeedback, setNeedsFeedback,\r\n        \r\n        messageIndexRef, sessionDiagnosisRef, consecutiveFailsRef,\r\n\r\n        fetchAIPrescription, fetchAIQuestion, fetchAISessionMessage, fetchAIFeedback,\r\n        handleChatResponse, handleManualSubmit, handleReturnToChat, generateReason\r\n    } = useMeditationAI({\r\n        memberName, \r\n        timeContext, \r\n        selectedIntention, \r\n        activeMode, \r\n        interactionType, \r\n        micVolume, \r\n        isPlayingRef, \r\n        ttcEnabled,\r\n        stopAllAudio, \r\n        playAudio, \r\n        speak,\r\n        onExit: () => { stopAllAudio(); if (onClose) onClose(); else navigate('/'); },\r\n        onMeditationReady: (diag, defaultMode, intType) => {\r\n            stopAllAudio();\r\n            setSelectedDiagnosis(diag);\r\n            setActiveMode(defaultMode);\r\n            setTimeLeft(defaultMode.time);\r\n            setInteractionType(intType);\r\n            setStep('interaction_select');\r\n        }\r\n    });\r\n    \r\n    const [lastSpokenMessage, setLastSpokenMessage] = useState(\"\"); // debug overlay\r\n    \r\n    //  Dynamic Options State (AI Generated)\r\n    const [dynamicCategories, setDynamicCategories] = useState(MEDITATION_CATEGORIES);\r\n    const [dynamicIntentions, setDynamicIntentions] = useState(MEDITATION_INTENTIONS);\r\n    const [isOptionsLoading, setIsOptionsLoading] = useState(true); //  Start with meditative loading\r\n\r\n    // [MOVED TO TOP] Debug & Audio Hooks\r\n    //  Preparation Flow States\r\n    const [prepStep, setPrepStep] = useState(1); \r\n    \r\n    //  Log Step Change for shared visibility\r\n    useEffect(() => {\r\n        logDebug(\"StepChange\", { step, prepStep });\r\n    }, [step, prepStep]);\r\n\r\n    const [prepSelections, setPrepSelections] = useState({\r\n        notified: false,\r\n        posture: 'chair', // 'chair', 'floor', 'lying'\r\n        goal: null\r\n    });\r\n\r\n    //  Initial AI Options Fetch\r\n    useEffect(() => {\r\n        logDebug(\"Mount\", { step, prepStep });\r\n        \r\n        const fetchOptions = async () => {\r\n            try {\r\n                // Time Context\r\n                const hour = new Date().getHours();\r\n                const tCtx = (hour >= 5 && hour < 11) ? 'morning' : \r\n                             (hour >= 18 || hour < 5) ? 'evening' : 'day';\r\n                setTimeContext(tCtx);\r\n                logDebug(\"TimeContext\", { tCtx });\r\n\r\n                // Fetch Dynamic Options\r\n                logDebug(\"FetchOptions:Start\");\r\n                const startTime = Date.now();\r\n                const result = await generateMeditationGuidance({ \r\n                    type: 'options_refresh', \r\n                    timeContext: tCtx,\r\n                    weather: 'unknown' // Client-side weather can be added if needed\r\n                });\r\n                setAiLatency(Date.now() - startTime);\r\n                logDebug(\"FetchOptions:Result\", result.data);\r\n\r\n                if (result.data) {\r\n                    if (result.data.categories && Array.isArray(result.data.categories)) {\r\n                        // Merge with constants to keep emojis/IDs but update labels\r\n                        const mergedCats = MEDITATION_CATEGORIES.map(c => {\r\n                            const dyn = result.data.categories.find(d => d.id === c.id);\r\n                            return dyn ? { ...c, label: dyn.label, description: dyn.description } : c;\r\n                        });\r\n                        setDynamicCategories(mergedCats);\r\n                    }\r\n                    if (result.data.intentions && Array.isArray(result.data.intentions)) {\r\n                        const mergedInts = MEDITATION_INTENTIONS.map(i => {\r\n                            const dyn = result.data.intentions.find(d => d.id === i.id);\r\n                            return dyn ? { ...i, label: dyn.label } : i;\r\n                        });\r\n                        setDynamicIntentions(mergedInts);\r\n                    }\r\n                }\r\n            } catch (error) {\r\n                console.error(\"Failed to fetch dynamic options:\", error);\r\n                logDebug(\"FetchOptions:Error\", error);\r\n                // Fallback to constants (already set as default)\r\n            } finally {\r\n                //  Minimum loading time for meditative feel (2s)\r\n                setTimeout(() => setIsOptionsLoading(false), 2000);\r\n            }\r\n        };\r\n        fetchOptions();\r\n    }, []);\r\n\r\n\r\n    // V3 Pose States\r\n    const [, setPoseData] = useState(null); //   \r\n    const [, setIsPoseLoading] = useState(false);\r\n    const [, setAlignmentScore] = useState(100); // 0-100  \r\n    \r\n    // Canvas Refs for Golden Skeleton\r\n    const canvasRef = useRef(null);\r\n    const poseRef = useRef(null); // MediaPipe Pose Instance Ref\r\n\r\n    // Refs\r\n    const timerRef = useRef(null);\r\n    const messageIntervalRef = useRef(null);\r\n    const videoRef = useRef(null);\r\n    const chatEndRef = useRef(null); // Fixed: Missing Ref\r\n    \r\n    // [MOVED TO TOP] Extra Audio System hooks\r\n    // Stop Session (useCallback for stability - removed stream dependency to fix V3 crash)\r\n    const stopSession = useCallback((stopAmbient = false) => {\r\n        //  STOP AI AUDIO (Fixed Bug)\r\n        if (currentAudioRef.current) {\r\n            currentAudioRef.current.pause();\r\n            currentAudioRef.current.currentTime = 0;\r\n            currentAudioRef.current = null; \r\n        }\r\n\r\n        clearInterval(timerRef.current); \r\n        clearInterval(messageIntervalRef.current);\r\n        // Stop Audio Analyzer Hook\r\n        stopAudioAnalysis();\r\n        \r\n        // Use Global Audio Manager\r\n        stopAllAudio(stopAmbient);\r\n        \r\n        // Use Ref for camera cleanup\r\n        if (cameraStreamRef.current) { \r\n            cameraStreamRef.current.getTracks().forEach(track => track.stop()); \r\n            cameraStreamRef.current = null;\r\n            setCameraStream(null); \r\n        }\r\n\r\n        if (audioContextRef.current) { audioContextRef.current.close().catch(e => console.error(e)); audioContextRef.current = null; }\r\n\r\n        if (poseRef.current) {\r\n            poseRef.current.close(); \r\n            poseRef.current = null;\r\n        }\r\n\r\n        //  Save session info before clearing (for feedback AI)\r\n        const currentMode = activeMode;\r\n        const currentDiag = selectedDiagnosis;\r\n        const elapsedTime = currentMode ? (currentMode.time - timeLeft) : 0;\r\n        \r\n        setIsPlaying(false);\r\n        isPlayingRef.current = false; //  Ref \r\n        setStep('diagnosis');\r\n        setPrepStep(1); // Reset prep\r\n        \r\n        // Save session info for feedback\r\n        if (currentMode) {\r\n            setSessionInfo({\r\n                mode: currentMode.id,\r\n                modeName: currentMode.label,\r\n                duration: elapsedTime,\r\n                diagnosis: currentDiag?.id\r\n            });\r\n        }\r\n        \r\n        //  [FIX]     (  )\r\n        setActiveMode(null);\r\n        setSelectedDiagnosis(null);\r\n        setSelectedIntention(null);\r\n        setSelectedCategory(null);\r\n        setChatHistory([]);\r\n        setIsAILoading(false); \r\n        setNeedsFeedback(true); //  Signal that we need to show feedback greeting\r\n        console.log(\" stopSession: needsFeedback set to true, step to diagnosis\");\r\n        setAiMessage(\"\");\r\n        setPrescriptionReason('');\r\n        setWeatherContext(null);\r\n        if (window.speechSynthesis) window.speechSynthesis.cancel();\r\n    }, [activeMode, selectedDiagnosis, timeLeft, stopAudioAnalysis]); \r\n\r\n    //  Stability Analysis Refs\r\n    const stabilityHistoryRef = useRef([]); // Stores {score, timestamp}\r\n    const postureIssuesRef = useRef(new Set()); // Stores detected issues (e.g., \"leaning_left\")\r\n\r\n    //  Draw Skeleton on Canvas (V3)\r\n    const onPoseResults = useCallback((results) => {\r\n        if (!results.poseLandmarks || !canvasRef.current || !videoRef.current) return;\r\n        \r\n        const canvas = canvasRef.current;\r\n        const ctx = canvas.getContext('2d');\r\n        const { width, height } = canvas;\r\n        \r\n        ctx.clearRect(0, 0, width, height);\r\n        \r\n        //  Draw Golden Skeleton\r\n        ctx.strokeStyle = '#d4af37'; // Gold\r\n        ctx.lineWidth = 4;\r\n        ctx.lineJoin = 'round';\r\n        ctx.lineCap = 'round';\r\n        ctx.shadowBlur = 10;\r\n        ctx.shadowColor = 'rgba(212, 175, 55, 0.5)';\r\n\r\n        const drawLine = (p1, p2) => {\r\n            if (!p1 || !p2 || p1.visibility < 0.5 || p2.visibility < 0.5) return;\r\n            ctx.beginPath();\r\n            ctx.moveTo(p1.x * width, p1.y * height);\r\n            ctx.lineTo(p2.x * width, p2.y * height);\r\n            ctx.stroke();\r\n        };\r\n\r\n        const landmarks = results.poseLandmarks;\r\n        \r\n        // Body Links (Simplified for Meditation)\r\n        drawLine(landmarks[11], landmarks[12]); // Shoulders\r\n        drawLine(landmarks[11], landmarks[23]); // Left Torso\r\n        drawLine(landmarks[12], landmarks[24]); // Right Torso\r\n        drawLine(landmarks[23], landmarks[24]); // Hips\r\n        drawLine(landmarks[11], landmarks[13]); // Left Arm\r\n        drawLine(landmarks[13], landmarks[15]);\r\n        drawLine(landmarks[12], landmarks[14]); // Right Arm\r\n        drawLine(landmarks[14], landmarks[16]);\r\n        \r\n        // Head (Simplified circle)\r\n        const nose = landmarks[0];\r\n        if (nose && nose.visibility > 0.5) {\r\n            ctx.beginPath();\r\n            ctx.arc(nose.x * width, nose.y * height, 10, 0, 2 * Math.PI);\r\n            ctx.stroke();\r\n        }\r\n\r\n        //  REAL-TIME STABILITY CALCULATION\r\n        if (nose && landmarks[11] && landmarks[12]) {\r\n            const leftShoulder = landmarks[11];\r\n            const rightShoulder = landmarks[12];\r\n            \r\n            // 1. Calculate Center of Shoulders\r\n            const shoulderCenterX = (leftShoulder.x + rightShoulder.x) / 2;\r\n            \r\n            // 2. Calculate Deviation (Nose vs Shoulder Center) - checks for leaning/sway\r\n            const deviation = Math.abs(nose.x - shoulderCenterX);\r\n            \r\n            // 3. Vertical alignment (Head drop check)\r\n            const shoulderY = (leftShoulder.y + rightShoulder.y) / 2;\r\n            const neckLength = Math.abs(nose.y - shoulderY);\r\n            \r\n            // 4. Score Calculation (0-100) - Simple inverse mapping\r\n            // Deviation > 0.1 is bad, < 0.02 is excellent\r\n            let currentScore = Math.max(0, 100 - (deviation * 500));\r\n            \r\n            // 5. Detect Issues\r\n            if (deviation > 0.08) {\r\n                if (nose.x < shoulderCenterX) postureIssuesRef.current.add(\"leaning_right\"); // Mirrored\r\n                else postureIssuesRef.current.add(\"leaning_left\");\r\n            }\r\n            if (neckLength < 0.15) { // Threshold depends on camera distance, heuristic\r\n                postureIssuesRef.current.add(\"head_drop\");\r\n            }\r\n\r\n            // 6. Smooth & Store\r\n            setAlignmentScore(prev => Math.round(prev * 0.9 + currentScore * 0.1));\r\n            stabilityHistoryRef.current.push({ score: currentScore, timestamp: Date.now() });\r\n\r\n            // Keep history manageable (last 5 mins max @ ~30fps is too much, keep last 1000 points?)\r\n            if (stabilityHistoryRef.current.length > 1000) stabilityHistoryRef.current.shift();\r\n        }\r\n\r\n        setPoseData(landmarks);\r\n    }, []);\r\n\r\n    //  AI Pose Initializer - DYNAMIC IMPORT\r\n    const initPoseEngine = useCallback(async () => {\r\n        if (!videoRef.current || poseRef.current) return;\r\n        \r\n        setIsPoseLoading(true);\r\n        try {\r\n            console.log(\" Loading AI Libraries Dynamically...\");\r\n            \r\n            // DYNAMIC IMPORTS\r\n            const [{ Pose }, tf, tfBackend] = await Promise.all([\r\n                import('@mediapipe/pose'),\r\n                import('@tensorflow/tfjs-core'),\r\n                import('@tensorflow/tfjs-backend-webgl')\r\n            ]);\r\n            \r\n            console.log(\" AI Libraries Loaded!\");\r\n\r\n            const pose = new Pose({\r\n                locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/pose@latest/${file}`,\r\n            });\r\n\r\n            pose.setOptions({\r\n                modelComplexity: 1,\r\n                smoothLandmarks: true,\r\n                enableSegmentation: false,\r\n                minDetectionConfidence: 0.5,\r\n                minTrackingConfidence: 0.5\r\n            });\r\n\r\n            pose.onResults(onPoseResults);\r\n            poseRef.current = pose;\r\n            \r\n            // Start detection loop\r\n            const detectFrame = async () => {\r\n                if (videoRef.current && poseRef.current && isPlaying) {\r\n                    await poseRef.current.send({ image: videoRef.current });\r\n                    if (isPlaying) requestAnimationFrame(detectFrame);\r\n                }\r\n            };\r\n            detectFrame();\r\n\r\n        } catch (error) {\r\n            console.error(\" Failed to load AI libraries:\", error);\r\n            setPermissionError(\"AI   .  .\");\r\n        } finally {\r\n            setIsPoseLoading(false);\r\n        }\r\n    }, [onPoseResults, isPlaying]);\r\n\r\n\r\n    // Initial Load with Auto Weather Detection\r\n    // ==========================================\r\n    //  REAL-TIME AI API CALLS (Hoisted Helpers - TDZ Fix)\r\n    // ==========================================\r\n    //  stopAllAudio useRef    \r\n    //  NEW: Stop Voice Only (preserves ambient & binaural)\r\n    const stopVoiceOnlyRef = useRef(null);\r\n    stopVoiceOnlyRef.current = () => {\r\n         if (typeof window !== 'undefined' && window.speechSynthesis) window.speechSynthesis.cancel();\r\n         // Cloud TTS Audio\r\n         if (currentAudioRef.current) {\r\n            try { currentAudioRef.current.pause(); currentAudioRef.current.currentTime = 0; } catch { /* ignore */ }\r\n            currentAudioRef.current = null;\r\n        }\r\n    };\r\n\r\n    //  Cleanup on Unmount\r\n    useEffect(() => {\r\n        const hour = new Date().getHours();\r\n        let context = 'morning';\r\n        if (hour >= 5 && hour < 12) context = 'morning';\r\n        else if (hour >= 12 && hour < 18) context = 'afternoon';\r\n        else context = 'night';\r\n        \r\n        setTimeContext(context);\r\n        \r\n\r\n\r\n        //  AUTO WEATHER DETECTION\r\n        detectWeather();\r\n\r\n        return () => { stopSession(); };\r\n        // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    }, [stopSession]);\r\n\r\n    //  Initial AI Question Load: Immediate Fetch (All AI)\r\n    useEffect(() => {\r\n        // [FIX] Removed !isAILoading ensure fetch triggers even if initialized as loading\r\n        if (step === 'diagnosis' && chatHistory.length === 0 && !currentAIChat) {\r\n             fetchAIQuestion(); \r\n        }\r\n        // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    }, [step, chatHistory.length]);\r\n\r\n    //  SESSION END FEEDBACK GREETING (Rock-solid trigger)\r\n    useEffect(() => {\r\n        console.log(` Feedback Effect check: step=${step}, needsFeedback=${needsFeedback}`);\r\n        if (step === 'diagnosis' && needsFeedback) {\r\n            console.log(\" Session Ended - Injecting Feedback Greeting for:\", memberName);\r\n            \r\n            //    (AI  )\r\n            const hour = new Date().getHours();\r\n            let fallbackMsg;\r\n            if (hour >= 5 && hour < 12) {\r\n                fallbackMsg = `${memberName},   ?       .     ?`;\r\n            } else if (hour >= 12 && hour < 18) {\r\n                fallbackMsg = `${memberName},  ?      .     ?`;\r\n            } else {\r\n                fallbackMsg = `${memberName},   ?    .     ?`;\r\n            }\r\n            \r\n            //  Clean up state\r\n            setAiRequestLock(false);\r\n            setIsAILoading(false);\r\n            \r\n            //    \r\n            setCurrentAIChat({\r\n                message: fallbackMsg,\r\n                options: [\",  \", \", \"]\r\n            });\r\n            \r\n            //  AI    ()\r\n            if (sessionInfo) {\r\n                (async () => {\r\n                    try {\r\n                        const feedbackResult = await generateMeditationGuidance({\r\n                            type: 'feedback_message',\r\n                            memberName: memberName,\r\n                            timeContext: timeContext,\r\n                            modeName: sessionInfo.modeName,\r\n                            duration: sessionInfo.duration,\r\n                            diagnosis: sessionInfo.diagnosis\r\n                        });\r\n                        \r\n                        if (feedbackResult.data?.message) {\r\n                            const aiMsg = feedbackResult.data.message.replace(/OO/g, `${memberName}`);\r\n                            setCurrentAIChat({\r\n                                message: aiMsg,\r\n                                options: [\" \"] //  \" ?\"  \" \"\r\n                            });\r\n                            \r\n                            // AI  \r\n                            if (feedbackResult.data.audioContent) {\r\n                                playAudio(feedbackResult.data.audioContent);\r\n                            } else if (ttcEnabled) {\r\n                                speak(aiMsg);\r\n                            }\r\n                        }\r\n                    } catch (err) {\r\n                        console.error('Feedback message AI failed, using fallback:', err);\r\n                        //   \r\n                        if (ttcEnabled) {\r\n                            speakFallback(fallbackMsg);\r\n                        }\r\n                    }\r\n                })();\r\n            } else {\r\n                //     TTS\r\n                if (ttcEnabled) {\r\n                    speakFallback(fallbackMsg);\r\n                }\r\n            }\r\n            \r\n            setNeedsFeedback(false); // Reset flag\r\n        }\r\n        // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    }, [step, needsFeedback, ttcEnabled, speakFallback, memberName, sessionInfo, timeContext, playAudio, speak]);\r\n\r\n\r\n    useEffect(() => {\r\n        if (cameraStream && videoRef.current) {\r\n            videoRef.current.srcObject = cameraStream;\r\n        }\r\n    }, [cameraStream]);\r\n\r\n    useEffect(() => {\r\n        // 1. Binaural Beats Volume\r\n        updateBinauralVolume(soundEnabled ? audioVolumes.binaural : 0);\r\n        // 2. Ambient Audio Volume\r\n        updateAmbientVolume(soundEnabled ? audioVolumes.ambient : 0);\r\n    }, [soundEnabled, audioVolumes, updateBinauralVolume, updateAmbientVolume]);\r\n\r\n    //  Global Ambient Audio Manager\r\n    useEffect(() => {\r\n        const activeAmbientSteps = ['prescription_summary', 'interaction_select', 'prescription', 'preparation', 'session'];\r\n        const shouldPlay = (isPlaying || activeAmbientSteps.includes(step)) && soundEnabled;\r\n\r\n        if (shouldPlay) {\r\n            const ambientDef = AMBIENT_SOUNDS.find(s => s.id === selectedAmbient);\r\n            playAmbientMusic(ambientDef, audioVolumes.ambient);\r\n        } else {\r\n            stopAmbientMusic();\r\n        }\r\n    }, [selectedAmbient, isPlaying, soundEnabled, audioVolumes.ambient, step, playAmbientMusic, stopAmbientMusic]);\r\n\r\n\r\n\r\n\r\n\r\n    const startMessageLoop = () => {\r\n        if (messageIntervalRef.current) clearInterval(messageIntervalRef.current);\r\n        \r\n        //     \r\n        consecutiveFailsRef.current = 0;\r\n        \r\n        // First message - try AI\r\n        fetchAISessionMessage();\r\n        \r\n        //   :  20,    35 \r\n        messageIntervalRef.current = setInterval(() => {\r\n            //   3    \r\n            if (consecutiveFailsRef.current >= 3) {\r\n                clearInterval(messageIntervalRef.current);\r\n                console.log('[Session] AI    35  ');\r\n                messageIntervalRef.current = setInterval(() => {\r\n                    fetchAISessionMessage();\r\n                }, 35000);\r\n            }\r\n            fetchAISessionMessage();\r\n        }, 20000);\r\n    };\r\n\r\n    //  TTS Wrapper (Consolidated)\r\n    // Removed auto-speak useEffect to prevent duplicate audio with Cloud TTS\r\n\r\n    // Auto-scroll to bottom of chat\r\n    useEffect(() => {\r\n        if (step === 'diagnosis' && chatEndRef.current) {\r\n            chatEndRef.current.scrollIntoView({ behavior: 'smooth' });\r\n        }\r\n    }, [chatHistory, isAILoading, currentAIChat, step]);\r\n\r\n\r\n\r\n    // --- Flow Handlers ---\r\n    const handleDiagnosisSelect = async (option) => {\r\n        setSelectedDiagnosis(option);\r\n        \r\n        // Get mode from diagnosis prescription\r\n        const mode = MEDITATION_MODES.find(m => m.id === option.prescription.modeId);\r\n        const intType = option.prescription.type;\r\n        \r\n        setActiveMode(mode);\r\n        setInteractionType(intType);\r\n        \r\n        // Weather is already auto-detected - use it directly\r\n        const weather = weatherContext || { id: 'sun', temp: 20, humidity: 50 };\r\n        \r\n        // Set fallback reason first\r\n        const fallbackReason = generateReason(timeContext, weather.id, option.id);\r\n        setPrescriptionReason(fallbackReason);\r\n        \r\n        // Then fetch real-time AI prescription\r\n        fetchAIPrescription(option.id, weather.id, mode.id, intType, \"\");\r\n        \r\n        // Skip weather step - go directly to prescription\r\n        setStep('prescription');\r\n    };\r\n\r\n    const handleWeatherSelect = async (weatherOption) => {\r\n        setWeatherContext(weatherOption);\r\n        \r\n        // Get AI prescription mode from diagnosis\r\n        const mode = MEDITATION_MODES.find(m => m.id === selectedDiagnosis.prescription.modeId);\r\n        const intType = selectedDiagnosis.prescription.type;\r\n        \r\n        setActiveMode(mode);\r\n        setInteractionType(intType);\r\n        \r\n        // Set local fallback first\r\n        const fallbackReason = generateReason(timeContext, weatherOption.id, selectedDiagnosis.id);\r\n        setPrescriptionReason(fallbackReason);\r\n        \r\n        // Then try to get real-time AI prescription (async, will update if successful)\r\n        fetchAIPrescription(selectedDiagnosis.id, weatherOption.id, mode.id, intType, \"\");\r\n        \r\n        setStep('prescription');\r\n    };\r\n\r\n\r\n\r\n    const startFromPrescription = () => {\r\n         logDebug(\"Flow:StartFromPrescription\");\r\n         setStep('preparation');\r\n         setPrepStep(3); //  Start with Posture Guide (New Flow)\r\n    };\r\n\r\n    // --- Session Logic ---\r\n    const startSession = async (mode) => {\r\n        setStep('session');\r\n        setPermissionError(null);\r\n        \r\n        //  FIX:       ref \r\n        sessionDiagnosisRef.current = selectedDiagnosis?.id || null;\r\n        messageIndexRef.current = 0;\r\n\r\n        \r\n        //       ( )\r\n        setShowVolumeHint(true);\r\n        setTimeout(() => setShowVolumeHint(false), 5000);\r\n        \r\n        const audioCtx = getAudioContext();\r\n\r\n        //  Always ensure AudioContext is ACTIVE\r\n        if (audioCtx.state === 'suspended') {\r\n            await audioCtx.resume();\r\n        }\r\n\r\n        // Binaural Beats\r\n        const initialVolume = soundEnabled ? audioVolumes.binaural : 0;\r\n        playBinauralBeats(200, mode.freq, initialVolume);\r\n\r\n        // Sensors\r\n        if (interactionType === 'v2') {\r\n            try {\r\n                const stream = await navigator.mediaDevices.getUserMedia({ \r\n                    audio: { echoCancellation: true, noiseSuppression: true, autoGainControl: true } \r\n                });\r\n                setupAudioAnalysis(stream, audioCtx);\r\n            } catch (err) {\r\n                console.error(\"Mic Error:\", err);\r\n                setPermissionError(\"  .\");\r\n                stopSession();\r\n                return;\r\n            }\r\n        } else if (interactionType === 'v3') {\r\n            try {\r\n                // AudioContext resumed above already\r\n                \r\n                const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' } });\r\n                cameraStreamRef.current = stream; // Update Ref\r\n                setCameraStream(stream);\r\n                initPoseEngine(); // Call (MOCKED) engine\r\n            } catch (err) {\r\n                console.error(\"Camera Error:\", err);\r\n                setPermissionError(\"  .    .\");\r\n                // Give user a moment to see the error before stopping\r\n                setTimeout(() => stopSession(), 3000);\r\n                return;\r\n            }\r\n        }\r\n\r\n        //  Ambient Sound is now handled by global useEffect\r\n        if (selectedAmbient === 'none') {\r\n             console.log(` [Audio Debug] No ambient sound selected (mode: 'none')`);\r\n        } else {\r\n             console.log(` [Audio Debug] Ambient '${selectedAmbient}' managing globally`);\r\n        }\r\n\r\n\r\n        setTimeLeft(mode.time);\r\n        setIsPlaying(true);\r\n        isPlayingRef.current = true; //  Misting Ref Update Fix\r\n\r\n        //  Opening Message - Phase 4 Pre-intro Logic\r\n        //  Opening Message - Phase 4 Pre-intro Logic\r\n        const getPreIntro = () => {\r\n             if (selectedIntention?.label) {\r\n                 return ` '${selectedIntention.label}'()  ,   .`;\r\n             }\r\n             return \"   ,    .\";\r\n        };\r\n        \r\n        const introMessage = getPreIntro();\r\n        setAiMessage(introMessage);\r\n        \r\n        \r\n        //  TTC Voice for Pre-intro - Cloud TTS (High Quality)\r\n        if (ttcEnabled) {\r\n            (async () => {\r\n                try {\r\n                    const introTTS = await generateMeditationGuidance({\r\n                        type: 'session_message',\r\n                        memberName: memberName,\r\n                        timeContext: timeContext,\r\n                        message: introMessage,\r\n                        messageIndex: 0\r\n                    });\r\n                    \r\n                    //  [FIX]        \r\n                    if (isPlayingRef.current) {\r\n                        if (introTTS.data?.message) {\r\n                            //  AI       (  )\r\n                            const finalIntroMsg = introTTS.data.message.replace(/OO/g, `${memberName}`);\r\n                            setAiMessage(finalIntroMsg);\r\n                        }\r\n\r\n                        if (introTTS.data?.audioContent) {\r\n                            playAudio(introTTS.data.audioContent);\r\n                        } else {\r\n                            // Fallback: Browser TTS\r\n                            speak(introMessage);\r\n                        }\r\n                    }\r\n                } catch (err) {\r\n                    console.error('Intro TTS failed:', err);\r\n                    if (isPlayingRef.current) speak(introMessage);\r\n                }\r\n            })();\r\n        }\r\n        \r\n        startTimer();\r\n        \r\n        // Delay the first AI session message to let pre-intro breathe\r\n        setTimeout(() => {\r\n            startMessageLoop();\r\n        }, 8000);\r\n    };\r\n\r\n\r\n\r\n    const startTimer = () => {\r\n        if (timerRef.current) clearInterval(timerRef.current);\r\n        timerRef.current = setInterval(() => {\r\n            setTimeLeft((prev) => {\r\n                if (prev <= 1) { completeSession(); return 0; }\r\n                return prev - 1;\r\n            });\r\n        }, 1000);\r\n    };\r\n\r\n    const togglePlay = () => {\r\n        if (isPlaying) {\r\n            clearInterval(timerRef.current); clearInterval(messageIntervalRef.current);\r\n            if (audioContextRef.current) audioContextRef.current.suspend();\r\n            pauseAudioAnalysis();\r\n            if (videoRef.current) videoRef.current.pause();\r\n            setIsPlaying(false);\r\n            isPlayingRef.current = false; //  Ref \r\n        } else {\r\n            setIsPlaying(true); \r\n            isPlayingRef.current = true; //  Ref \r\n            startTimer(); startMessageLoop();\r\n            if (audioContextRef.current) audioContextRef.current.resume();\r\n            if (interactionType === 'v2') resumeAudioAnalysis();\r\n            if (videoRef.current) videoRef.current.play();\r\n        }\r\n    };\r\n\r\n    // State for Analysis Transition\r\n    const [isAnalyzing, setIsAnalyzing] = useState(false);\r\n\r\n    const finishAnalysis = useCallback((forceStart = false) => {\r\n        setIsAnalyzing(true);\r\n        // Clean up chat loop\r\n        if (messageIntervalRef.current) clearInterval(messageIntervalRef.current);\r\n        \r\n        //  AI's empathetic/regret message when user chooses quick start\r\n        if (forceStart && chatHistory.length < 3) {\r\n            const regretMessages = [\r\n                \" , .    . \",\r\n                \"  ,    . .\",\r\n                \" . ,    .\"\r\n            ];\r\n            const randomMsg = regretMessages[Math.floor(Math.random() * regretMessages.length)];\r\n            setChatHistory(prev => [...prev, { role: 'model', content: randomMsg }]);\r\n            \r\n            // Speak the regret message if TTS is enabled\r\n            if (ttcEnabled) {\r\n                speak(randomMsg);\r\n            }\r\n        }\r\n        \r\n        // Transition delay for effect (longer to let user see the message)\r\n        setTimeout(() => {\r\n            setIsAnalyzing(false);\r\n            stopSession(true); // Stop background audio if any\r\n            setStep('interaction_select'); // Move to meditation type selection (//)\r\n        }, forceStart && chatHistory.length < 3 ? 3000 : 2000);\r\n        // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    }, [chatHistory.length, ttcEnabled, speak]);\r\n\r\n    const completeSession = () => {\r\n        stopSession(false); //  Keep ambient music playing\r\n        setStep('feedback');\r\n        setIsAILoading(true); // Show loading state in feedback screen\r\n\r\n        //  Calculate V3 Pose Metrics\r\n        let poseMetrics = null;\r\n        if (interactionType === 'v3' && stabilityHistoryRef.current.length > 0) {\r\n            const history = stabilityHistoryRef.current;\r\n            const avgScore = Math.round(history.reduce((acc, curr) => acc + curr.score, 0) / history.length);\r\n            const issues = Array.from(postureIssuesRef.current);\r\n            poseMetrics = {\r\n                stabilityScore: avgScore,\r\n                issues: issues\r\n            };\r\n            console.log(\" V3 Pose Analysis Result:\", poseMetrics);\r\n        }\r\n\r\n        // Generate Post-Session Feedback (Async)\r\n        (async () => {\r\n            try {\r\n                // Determine duration logic for context\r\n                // const duration = activeMode?.time || 300;\r\n                \r\n                const startTime = Date.now();\r\n                const fbResult = await generateMeditationGuidance({\r\n                    type: 'feedback_message',\r\n                    memberName, \r\n                    timeContext,\r\n                    diagnosis: selectedDiagnosis?.id || 'stress',\r\n                    mode: activeMode?.id || 'calm',\r\n                    poseMetrics: poseMetrics //  NEW\r\n                });\r\n                setAiLatency(Date.now() - startTime);\r\n                \r\n                if (fbResult.data) {\r\n                    // Personalize\r\n                    if (fbResult.data.message) {\r\n                        fbResult.data.message = fbResult.data.message.replace(/OO/g, `${memberName}`);\r\n                    }\r\n                    if (fbResult.data.feedbackPoints) {\r\n                        // Assuming backend returns points\r\n                        fbResult.data.feedbackPoints = fbResult.data.feedbackPoints.map(p => p.replace(/OO/g, `${memberName}`));\r\n                    }\r\n                    \r\n                    setFeedbackData(fbResult.data);\r\n                    \r\n                    if (fbResult.data.audioContent) {\r\n                        playAudio(fbResult.data.audioContent);\r\n                    } else if (ttcEnabled && fbResult.data.message) {\r\n                        speak(fbResult.data.message);\r\n                    }\r\n                }\r\n            } catch (e) {\r\n                console.error(\"Feedback Generation Failed:\", e);\r\n                // Fallback Feedback\r\n                setFeedbackData({\r\n                    message: `${memberName},      .`,\r\n                    feedbackPoints: [\r\n                        \"    .\",\r\n                        \"     .\",\r\n                        \"     .\",\r\n                        \"    .\"\r\n                    ]\r\n                });\r\n            } finally {\r\n                setIsAILoading(false);\r\n            }\r\n        })();\r\n    };\r\n\r\n    const formatTime = (seconds) => {\r\n        const mins = Math.floor(seconds / 60);\r\n        const secs = seconds % 60;\r\n        return `${mins}:${secs < 10 ? '0' : ''}${secs}`;\r\n    };\r\n\r\n    // ==========================================\r\n    //  RENDER (Refining V3 Overlay Rendering)\r\n    // ==========================================\r\n\r\n    // 0. Initial Preparation Step (Notifications Off - First Screen)\r\n    if (step === 'initial_prep') {\r\n        return (\r\n            <div style={{\r\n                position: 'fixed', inset: 0, background: '#0a0a0c', zIndex: 9999,\r\n                display: 'flex', flexDirection: 'column', padding: '20px', overflow: 'hidden'\r\n            }}>\r\n                <div className={`soul-light-base soul-theme-${visualTheme} active`} style={{ transition: 'all 1s ease', opacity: 0.4 }} />\r\n                <div style={{ position: 'relative', zIndex: 10, display: 'flex', flexDirection: 'column', height: '100%', width: '100%', alignItems: 'center', justifyContent: 'center' }}>\r\n                     {/*  Debug Overlay */}\r\n                     <MeditationDebugOverlay \r\n                        isVisible={isDebugMode}\r\n                        ttsState={ttsState}\r\n                        currentStep={step}\r\n                        audioLevels={audioVolumes}\r\n                        currentText={aiMessage}\r\n                        aiLatency={aiLatency}\r\n                    />\r\n                     <div style={{ width: '100%', maxWidth: '350px', animation: 'fadeIn 0.5s ease', textAlign: 'center' }}>\r\n                        <div style={{ marginBottom: '40px' }}>\r\n                            <div style={{ fontSize: '4rem', marginBottom: '20px' }}></div>\r\n                            <h3 style={{ fontSize: '1.5rem', fontWeight: 700, color: 'white', marginBottom: '10px' }}> </h3>\r\n                            <p style={{ color: 'rgba(255,255,255,0.5)', lineHeight: 1.6, marginBottom: '20px' }}>\r\n                                  <br/> &apos;&apos;  &apos;&apos;  <br/>?\r\n                            </p>\r\n                            \r\n                            {/*      */}\r\n                            <div style={{ \r\n                                background: 'rgba(76, 155, 251, 0.1)', \r\n                                border: '1px solid rgba(76, 155, 251, 0.2)',\r\n                                borderRadius: '15px', padding: '15px', marginTop: '10px',\r\n                                textAlign: 'left', fontSize: '0.85rem'\r\n                            }}>\r\n                                <div style={{ color: '#4c9bfb', fontWeight: 700, marginBottom: '5px', display: 'flex', alignItems: 'center', gap: '5px' }}>\r\n                                    <SpeakerHigh size={14} weight=\"fill\" /> \r\n                                </div>\r\n                                <div style={{ color: 'rgba(255,255,255,0.7)', lineHeight: 1.5 }}>\r\n                                    &apos;&apos; &apos;&apos;  **    .**     .\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                        <button onClick={() => { \r\n                            setPrepSelections(prev => ({...prev, notified: true})); \r\n                            setStep('intention'); // Proceed to Category Selection\r\n                        }}\r\n                            style={{\r\n                                width: '100%', background: 'var(--primary-gold)', color: 'black',\r\n                                padding: '18px', borderRadius: '20px', fontSize: '1.1rem', fontWeight: 800, border: 'none',\r\n                                cursor: 'pointer', display: 'flex', alignItems: 'center', justifyContent: 'center'\r\n                            }}></button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // 0-a. Intention Step (  - 2 )\r\n    if (step === 'intention') {\r\n        //  Meditative Loading Screen\r\n        if (isOptionsLoading) {\r\n             return (\r\n                <div style={{\r\n                    position: 'fixed', inset: 0, background: '#0a0a0c', zIndex: 9999,\r\n                    display: 'flex', flexDirection: 'column',\r\n                    justifyContent: 'center', alignItems: 'center', overflow: 'hidden'\r\n                }}>\r\n                    <div className={`soul-light-base soul-theme-${visualTheme} active`} style={{ transition: 'all 1s ease', opacity: 0.5 }} />\r\n                <div style={{ zIndex: 10, display: 'flex', flexDirection: 'column', alignItems: 'center' }}>\r\n                    {/*  Debug Overlay */}\r\n                    <MeditationDebugOverlay \r\n                        isVisible={isDebugMode}\r\n                        ttsState={ttsState}\r\n                        currentStep={step}\r\n                        audioLevels={audioVolumes}\r\n                        currentText={aiMessage}\r\n                        aiLatency={aiLatency}\r\n                    />\r\n                    <AILoadingIndicator />\r\n                    </div>\r\n                </div>\r\n             );\r\n        }\r\n\r\n        // 2-1:      \r\n        if (!selectedCategory) {\r\n            return (\r\n                <div style={{\r\n                    position: 'fixed', inset: 0, background: '#0a0a0c', zIndex: 9999,\r\n                    display: 'flex', flexDirection: 'column', overflow: 'hidden'\r\n                }}>\r\n                    <div className={`soul-light-base soul-theme-${visualTheme} active`} style={{ transition: 'all 1s ease', opacity: 0.4 }} />\r\n                    {/* Header */}\r\n                    <div style={{\r\n                        padding: '15px 20px', paddingTop: 'max(15px, env(safe-area-inset-top))',\r\n                        display: 'flex', alignItems: 'center', justifyContent: 'space-between',\r\n                        background: 'rgba(20, 20, 20, 0.4)',\r\n                        borderBottom: '1px solid rgba(255,255,255,0.05)', backdropFilter: 'blur(20px)',\r\n                        zIndex: 20\r\n                    }}>\r\n                        {/*  Debug Overlay */}\r\n                        <MeditationDebugOverlay \r\n                            isVisible={isDebugMode}\r\n                            ttsState={ttsState}\r\n                            currentStep={step}\r\n                            audioLevels={audioVolumes}\r\n                            currentText={lastSpokenMessage || aiMessage || currentAIChat?.message}\r\n                            aiLatency={aiLatency}\r\n                        />\r\n\r\n                        {/* Title - Left Side */}\r\n                        <div onClick={handleDebugToggle} style={{ cursor: 'pointer' }}>\r\n                            <span style={{ fontSize: '1.1rem', fontWeight: 700, color: 'white' }}>\r\n                                 \r\n                            </span>\r\n                        </div>\r\n                        <button onClick={() => { \r\n                                stopAllAudio(); \r\n                                if(onClose) onClose(); else navigate(-1); \r\n                            }} \r\n                            style={{ \r\n                                padding: '8px 16px', \r\n                                border: '1px solid rgba(255,255,255,0.15)', \r\n                                borderRadius: '20px',\r\n                                background: 'rgba(255, 255, 255, 0.08)', \r\n                                cursor: 'pointer',\r\n                                color: 'rgba(255,255,255,0.9)',\r\n                                fontSize: '0.85rem',\r\n                                fontWeight: '600',\r\n                                display: 'flex',\r\n                                alignItems: 'center',\r\n                                gap: '6px'\r\n                            }}>\r\n                            <span></span>\r\n                            <X size={16} weight=\"bold\" />\r\n                        </button>\r\n                    </div>\r\n\r\n                    {/* Main Content */}\r\n                    <div style={{\r\n                        flex: 1, display: 'flex', flexDirection: 'column', \r\n                        justifyContent: 'flex-start', alignItems: 'center', padding: '100px 20px 40px', //  Adjusted layout\r\n                        zIndex: 10\r\n                    }}>\r\n                        {/* Title */}\r\n                        <div style={{ textAlign: 'center', marginBottom: '50px' }}>\r\n                            <h2 style={{ \r\n                                fontSize: '1.6rem', fontWeight: 600, color: '#4c9bfb', \r\n                                marginBottom: '15px', lineHeight: 1.4\r\n                            }}>\r\n                                  <br/>  ?\r\n                            </h2>\r\n                            <p style={{ fontSize: '0.9rem', color: 'rgba(255,255,255,0.5)' }}>\r\n                                    \r\n                            </p>\r\n                        </div>\r\n\r\n                        {/* Category Options (Dynamic) */}\r\n                        <div style={{ width: '100%', maxWidth: '400px', display: 'flex', flexDirection: 'column', gap: '20px' }}>\r\n                            {dynamicCategories.map(category => (\r\n                                <button\r\n                                    key={category.id}\r\n                                    onClick={() => {\r\n                                        setSelectedCategory(category);\r\n                                    }}\r\n                                    style={{\r\n                                        padding: '30px 25px',\r\n                                        background: 'rgba(255, 255, 255, 0.05)',\r\n                                        border: '1px solid rgba(255, 255, 255, 0.1)',\r\n                                        borderRadius: '20px',\r\n                                        color: 'white',\r\n                                        cursor: 'pointer',\r\n                                        transition: 'all 0.3s ease',\r\n                                        textAlign: 'left'\r\n                                    }}\r\n                                    onMouseEnter={(e) => {\r\n                                        e.currentTarget.style.background = 'rgba(76, 155, 251, 0.15)';\r\n                                        e.currentTarget.style.borderColor = '#4c9bfb';\r\n                                        e.currentTarget.style.transform = 'translateY(-2px)';\r\n                                    }}\r\n                                    onMouseLeave={(e) => {\r\n                                        e.currentTarget.style.background = 'rgba(255, 255, 255, 0.05)';\r\n                                        e.currentTarget.style.borderColor = 'rgba(255, 255, 255, 0.1)';\r\n                                        e.currentTarget.style.transform = 'translateY(0)';\r\n                                    }}\r\n                                >\r\n                                    <div style={{ display: 'flex', alignItems: 'center', marginBottom: '10px' }}>\r\n                                        <span style={{ fontSize: '2rem', marginRight: '15px' }}>{category.emoji}</span>\r\n                                        <div style={{ flex: 1 }}>\r\n                                            <div style={{ fontSize: '1.1rem', fontWeight: 600, marginBottom: '5px' }}>\r\n                                                {category.label}\r\n                                            </div>\r\n                                            <div style={{ fontSize: '0.85rem', color: 'rgba(255,255,255,0.5)' }}>\r\n                                                {category.description || category.subtitle}\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            );\r\n        }\r\n\r\n        // 2-2:       \r\n        const categoryIntentions = dynamicIntentions.filter(i => i.category === selectedCategory.id);\r\n        \r\n        return (\r\n            <div style={{\r\n                position: 'fixed', inset: 0, background: '#0a0a0c', zIndex: 9999,\r\n                display: 'flex', flexDirection: 'column', overflow: 'hidden'\r\n            }}>\r\n                <div className={`soul-light-base soul-theme-${visualTheme} active`} style={{ transition: 'all 1s ease', opacity: 0.4 }} />\r\n                <div style={{ position: 'relative', zIndex: 10, display: 'flex', flexDirection: 'column', height: '100%', width: '100%' }}>\r\n                    {/*  Debug Overlay */}\r\n                    <MeditationDebugOverlay \r\n                        isVisible={isDebugMode}\r\n                        ttsState={ttsState}\r\n                        currentStep={step}\r\n                        audioLevels={audioVolumes}\r\n                        currentText={aiMessage}\r\n                        aiLatency={aiLatency}\r\n                    />\r\n                    {/* Header */}\r\n                    <div style={{\r\n                        padding: '10px 15px', paddingTop: 'max(10px, env(safe-area-inset-top))',\r\n                        display: 'flex', alignItems: 'center', background: 'rgba(20, 20, 20, 0.4)',\r\n                        borderBottom: '1px solid rgba(255,255,255,0.05)', backdropFilter: 'blur(20px)',\r\n                        zIndex: 20\r\n                    }}>\r\n                        <button onClick={() => setSelectedCategory(null)} \r\n                            style={{ padding: '8px', border: 'none', background: 'none', cursor: 'pointer' }}>\r\n                            <ArrowLeft size={22} color=\"white\" />\r\n                        </button>\r\n                        <div style={{ marginLeft: '10px' }}>\r\n                            <span style={{ fontSize: '1rem', fontWeight: 600, color: 'white' }}>\r\n                                {selectedCategory.label}\r\n                            </span>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Main Content */}\r\n                    <div style={{\r\n                        flex: 1, display: 'flex', flexDirection: 'column', \r\n                        justifyContent: 'center', alignItems: 'center', padding: '40px 20px'\r\n                    }}>\r\n                        {/* Title */}\r\n                        <div style={{ textAlign: 'center', marginBottom: '40px' }}>\r\n                            <h2 style={{ \r\n                                fontSize: '1.5rem', fontWeight: 600, color: '#4c9bfb', \r\n                                marginBottom: '10px' \r\n                            }}>\r\n                                   ?\r\n                            </h2>\r\n                            <p style={{ fontSize: '0.9rem', color: 'rgba(255,255,255,0.6)', lineHeight: 1.6 }}>\r\n                                {selectedCategory.description}\r\n                            </p>\r\n                        </div>\r\n\r\n                        {/* Options (Dynamic) */}\r\n                        <div style={{ width: '100%', maxWidth: '400px', display: 'flex', flexDirection: 'column', gap: '15px' }}>\r\n                            {categoryIntentions.map(intention => (\r\n                                <button\r\n                                    key={intention.id}\r\n                                    onClick={() => {\r\n                                        setSelectedIntention(intention);\r\n                                        setStep('diagnosis');\r\n                                        fetchAIQuestion([{ role: 'user', content: intention.label }]);\r\n                                    }}\r\n                                    style={{\r\n                                        padding: '20px', background: 'rgba(255, 255, 255, 0.05)',\r\n                                        border: '1px solid rgba(255, 255, 255, 0.1)', borderRadius: '15px',\r\n                                        color: 'white', fontSize: '1rem', cursor: 'pointer', transition: 'all 0.3s ease', textAlign: 'left'\r\n                                    }}\r\n                                >\r\n                                    <div style={{ display: 'flex', alignItems: 'center' }}>\r\n                                        <span style={{ marginRight: '12px', fontSize: '1.5rem' }}>{intention.emoji}</span>\r\n                                        <div style={{ flex: 1 }}>\r\n                                            <div style={{ fontSize: '0.75rem', color: 'rgba(255,255,255,0.5)', marginBottom: '5px' }}>\r\n                                                {intention.tag}\r\n                                            </div>\r\n                                            <div style={{ fontSize: '0.95rem' }}>\r\n                                                {intention.label}\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // 1. Diagnosis Step (Conversational AI - Dark Mode)\r\n    if (step === 'diagnosis') {\r\n        return (\r\n            <div style={{\r\n                position: 'fixed', inset: 0, background: '#0a0a0c', zIndex: 9999, //  Dark Mode\r\n                display: 'flex', flexDirection: 'column', overflow: 'hidden'\r\n            }}>\r\n                <div className={`soul-light-base soul-theme-${visualTheme} active`} style={{ transition: 'all 1s ease', opacity: 0.4 }} />\r\n                <div style={{ position: 'relative', zIndex: 10, display: 'flex', flexDirection: 'column', height: '100%', width: '100%' }}>\r\n                    {/*  Debug Overlay */}\r\n                    <MeditationDebugOverlay \r\n                        isVisible={isDebugMode}\r\n                        ttsState={ttsState}\r\n                        currentStep={step}\r\n                        audioLevels={audioVolumes}\r\n                        currentText={aiMessage}\r\n                        aiLatency={aiLatency}\r\n                    />\r\n                    {/* 1. Header (Translucent Dark) */}\r\n                    <div style={{\r\n                        padding: '10px 15px', paddingTop: 'max(10px, env(safe-area-inset-top))',\r\n                        display: 'flex', alignItems: 'center', justifyContent: 'space-between', //  Adjusted layout\r\n                        background: 'rgba(20, 20, 20, 0.4)',\r\n                        borderBottom: '1px solid rgba(255,255,255,0.05)', backdropFilter: 'blur(20px)',\r\n                        zIndex: 20\r\n                    }}>\r\n                        <div style={{ display: 'flex', alignItems: 'center' }}>\r\n                            <button onClick={() => { stopAllAudio(); if(onClose) onClose(); else navigate(-1); }} style={{ padding: '8px', border: 'none', background: 'none', cursor: 'pointer' }}>\r\n                                <ArrowLeft size={22} color=\"white\" />\r\n                            </button>\r\n                            <div onClick={handleDebugToggle} style={{ marginLeft: '10px', display: 'flex', flexDirection: 'column', cursor: 'pointer' }}>\r\n                                <span style={{ fontSize: '1rem', fontWeight: 600, color: 'white' }}> ( )</span>\r\n                                <div style={{ display: 'flex', alignItems: 'center', gap: '4px' }}>\r\n                                    <SpeakerHigh size={12} color={ttcEnabled ? \"#4caf50\" : \"#666\"} weight=\"fill\" />\r\n                                    <span style={{ fontSize: '0.7rem', color: 'rgba(255,255,255,0.6)' }}>\r\n                                        {isAnalyzing ? (\r\n                                            <span className=\"blinking-text\"> ...</span> //  Blinking Effect\r\n                                        ) : isAILoading ? ' ...' : '  '}\r\n                                    </span>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/*  START NOW BUTTON */}\r\n                        {!isAnalyzing && (\r\n                            <button \r\n                                onClick={() => finishAnalysis(true)}\r\n                                style={{\r\n                                    padding: '6px 12px',\r\n                                    borderRadius: '20px',\r\n                                    background: 'rgba(76, 155, 251, 0.2)',\r\n                                    border: '1px solid #4c9bfb',\r\n                                    color: '#4c9bfb',\r\n                                    fontSize: '0.8rem',\r\n                                    fontWeight: '600',\r\n                                    cursor: 'pointer'\r\n                                }}\r\n                            >\r\n                                 \r\n                            </button>\r\n                        )}\r\n                    </div>\r\n\r\n                    {/* 2. Chat Area (Scrollable) */}\r\n                    <div style={{\r\n                        flex: 1, overflowY: 'auto', padding: '20px 15px',\r\n                        paddingBottom: '20px', display: 'flex', flexDirection: 'column', gap: '20px'\r\n                    }} className=\"no-scrollbar\">\r\n                        {/* Date Divider */}\r\n                        <div style={{ alignSelf: 'center', background: 'rgba(255,255,255,0.1)', padding: '4px 12px', borderRadius: '12px', fontSize: '0.75rem', color: 'rgba(255,255,255,0.6)', marginBottom: '10px' }}>\r\n                            {new Date().toLocaleDateString()}\r\n                        </div>\r\n\r\n                        {/* Chat Bubbles */}\r\n                        {chatHistory.filter(msg => !msg.content.startsWith('[System]:')).map((msg, idx) => {\r\n                            const isMe = msg.role === 'user';\r\n                            const timeStr = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\r\n\r\n                            return (\r\n                                <div key={idx} style={{\r\n                                    display: 'flex', justifyContent: isMe ? 'flex-end' : 'flex-start',\r\n                                    alignItems: 'flex-start', gap: '8px'\r\n                                }}>\r\n                                    {!isMe && (\r\n                                        <div style={{\r\n                                            width: '40px', height: '40px', borderRadius: '50%',\r\n                                            background: 'var(--primary-gold)', display: 'flex', alignItems: 'center', justifyContent: 'center',\r\n                                            overflow: 'hidden', border: '1px solid rgba(255,255,255,0.1)', flexShrink: 0,\r\n                                            fontSize: '1.2rem'\r\n                                        }}></div>\r\n                                    )}\r\n                                    <div style={{ display: 'flex', flexDirection: isMe ? 'row-reverse' : 'row', alignItems: 'flex-end', gap: '6px' }}>\r\n                                         <div style={{\r\n                                             background: isMe ? 'linear-gradient(135deg, #d4af37, #f1c40f)' : 'rgba(255,255,255,0.08)',\r\n                                             color: isMe ? '#000' : '#fff', padding: '12px 16px',\r\n                                             borderRadius: isMe ? '18px 4px 18px 18px' : '4px 18px 18px 18px',\r\n                                             maxWidth: '75vw', fontSize: '0.95rem', lineHeight: '1.6',\r\n                                             boxShadow: '0 4px 15px rgba(0,0,0,0.2)', wordBreak: 'keep-all',\r\n                                             border: isMe ? 'none' : '1px solid rgba(255,255,255,0.1)'\r\n                                         }}>{msg.content}</div>\r\n                                         <span style={{ fontSize: '0.7rem', color: 'rgba(255,255,255,0.4)', marginBottom: '2px', minWidth: '55px', textAlign: isMe ? 'right' : 'left' }}>\r\n                                             {timeStr}\r\n                                         </span>\r\n                                    </div>\r\n                                </div>\r\n                            );\r\n                        })}\r\n\r\n                        {/* Latest AI Question */}\r\n                        {currentAIChat && !isAILoading && (\r\n                             <div style={{ display: 'flex', justifyContent: 'flex-start', alignItems: 'flex-start', gap: '8px' }}>\r\n                                 <div style={{\r\n                                     width: '40px', height: '40px', borderRadius: '50%',\r\n                                     background: 'white', display: 'flex', alignItems: 'center', justifyContent: 'center',\r\n                                     overflow: 'hidden', border: '1px solid rgba(255,255,255,0.1)', flexShrink: 0\r\n                                 }}>\r\n                                      <img src=\"/pwa-192x192.png\" alt=\"AI\" style={{ width: '100%', height: '100%', objectFit: 'cover' }} onError={(e) => { e.target.style.display='none'; e.target.parentNode.innerText=''; }} />\r\n                                 </div>\r\n                                 <div style={{ display: 'flex', flexDirection: 'row', alignItems: 'flex-end', gap: '6px' }}>\r\n                                     <div style={{\r\n                                         background: 'rgba(255,255,255,0.08)', color: 'white', padding: '14px 18px',\r\n                                         borderRadius: '4px 18px 18px 18px', maxWidth: '75vw', fontSize: '1.0rem', lineHeight: '1.6',\r\n                                         boxShadow: '0 4px 15px rgba(0,0,0,0.3)', border: '1px solid rgba(255,255,255,0.15)', backdropFilter: 'blur(10px)'\r\n                                     }}>{currentAIChat.message || currentAIChat.question || \"  ?\"}</div>\r\n                                     <span style={{ fontSize: '0.7rem', color: 'rgba(255,255,255,0.4)', marginBottom: '2px' }}>\r\n                                         {new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\r\n                                     </span>\r\n                                 </div>\r\n                             </div>\r\n                        )}\r\n\r\n                        {isAILoading && (\r\n                             <div style={{ alignSelf: 'center', marginTop: '10px' }}>\r\n                                 <AILoadingIndicator compact={true} message={chatHistory.length === 0 ? \"AI     ...\" : null} />\r\n                             </div>\r\n                        )}\r\n                        <div ref={chatEndRef} style={{ height: '2px', width: '100%' }} />\r\n                    </div>\r\n\r\n                    {/* 3. Bottom Options & Input */}\r\n                    <div style={{\r\n                        background: '#1a1a1d', borderTop: '1px solid rgba(255,255,255,0.1)',\r\n                        padding: '15px', paddingBottom: 'calc(15px + env(safe-area-inset-bottom))',\r\n                        display: 'flex', flexDirection: 'column', gap: '12px', zIndex: 20\r\n                    }}>\r\n                        {/*  Phase 1:    -    */}\r\n                        {!isAILoading && currentAIChat?.isFinalAnalysis && (\r\n                            <div style={{ display: 'flex', flexDirection: 'column', gap: '10px', animation: 'fadeIn 0.5s ease' }}>\r\n                                <button onClick={() => {\r\n                                    stopAllAudio();\r\n                                    const diag = DIAGNOSIS_OPTIONS.find(o => o.id === currentAIChat?.mappedDiagnosis) || SELECTED_DIAGNOSIS_FALLBACK;\r\n                                    setSelectedDiagnosis(diag);\r\n                                    const defaultMode = MEDITATION_MODES.find(m => m.id === diag?.prescription?.modeId) || MEDITATION_MODES[1];\r\n                                    setActiveMode(defaultMode);\r\n                                    setTimeLeft(defaultMode.time);\r\n                                    setInteractionType(diag?.prescription?.type || 'v1');\r\n                                    setStep('interaction_select');\r\n                                }} style={{\r\n                                    width: '100%', background: 'var(--primary-gold)', color: 'black',\r\n                                    padding: '18px', borderRadius: '20px', fontSize: '1.1rem', fontWeight: 800, border: 'none',\r\n                                    cursor: 'pointer', display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '8px',\r\n                                    boxShadow: '0 10px 20px rgba(212,175,55,0.3)'\r\n                                }}>  </button>\r\n                                <p style={{ textAlign: 'center', fontSize: '0.8rem', color: 'rgba(255,255,255,0.4)' }}>\r\n                                       \r\n                                </p>\r\n                            </div>\r\n                        )}\r\n\r\n                        {/*   :   (isFinalAnalysis  ) */}\r\n                        {!isAILoading && currentAIChat?.options?.length > 0 && !currentAIChat?.isFinalAnalysis && (\r\n                            <div className=\"no-scrollbar\" style={{ display: 'flex', gap: '8px', overflowX: 'auto', paddingBottom: '10px', scrollbarWidth: 'none', justifyContent: 'flex-start' }}>\r\n                                {currentAIChat.options.map((opt, i) => (\r\n                                    <button key={i} onClick={() => { stopAllAudio(); handleChatResponse(opt); }}\r\n                                        style={{\r\n                                            flex: '0 0 auto', background: 'rgba(255,255,255,0.08)', border: '1px solid rgba(255,255,255,0.15)',\r\n                                            padding: '10px 18px', borderRadius: '18px', color: 'rgba(255,255,255,0.9)', \r\n                                            fontSize: '0.9rem', cursor: 'pointer', transition: 'all 0.2s', backdropFilter: 'blur(5px)'\r\n                                        }}>{opt}</button>\r\n                                ))}\r\n                            </div>\r\n                        )}\r\n\r\n                        {/*  :    isTransition   */}\r\n                        {!currentAIChat?.isFinalAnalysis && !currentAIChat?.isTransition && !isAnalyzing && (\r\n                            <form onSubmit={(e) => { try { handleManualSubmit(e); } catch (err) { setIsAILoading(false); } }} \r\n                                style={{ \r\n                                    display: 'flex', gap: '10px', alignItems: 'center', background: 'rgba(255,255,255,0.05)', \r\n                                    borderRadius: '28px', padding: '6px 6px 6px 20px', border: '1px solid rgba(255,255,255,0.1)'\r\n                                }}>\r\n                                <input type=\"text\" value={manualInput} onChange={(e) => setManualInput(e.target.value)}\r\n                                    disabled={isAILoading} autoFocus placeholder={isAILoading ? \"  ...\" : \" ...\"}\r\n                                    style={{ flex: 1, background: 'transparent', border: 'none', color: 'white', fontSize: '1rem', outline: 'none' }} />\r\n                                <button type=\"submit\" disabled={!manualInput.trim() || isAILoading}\r\n                                    style={{\r\n                                        background: manualInput.trim() ? 'var(--primary-gold)' : 'rgba(255,255,255,0.1)',\r\n                                        color: manualInput.trim() ? 'black' : 'rgba(255,255,255,0.2)',\r\n                                        border: 'none', borderRadius: '50%', width: '40px', height: '40px',\r\n                                        display: 'flex', alignItems: 'center', justifyContent: 'center', cursor: 'pointer'\r\n                                    }}><ArrowUp size={24} weight=\"bold\" /></button>\r\n                            </form>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (step === 'diagnosis_manual') {\r\n        return (\r\n            <div style={{\r\n                position: 'fixed', inset: 0, background: '#0a0a0c', zIndex: 2000,\r\n                display: 'flex', flexDirection: 'column', padding: '20px', overflow: 'hidden'\r\n            }}>\r\n                <div className={`soul-light-base soul-theme-${visualTheme} active`} style={{ transition: 'all 1s ease', opacity: 0.4 }} />\r\n                <div style={{ position: 'relative', zIndex: 10, display: 'flex', flexDirection: 'column', height: '100%', width: '100%' }}>\r\n                    {/*  Debug Overlay */}\r\n                    <MeditationDebugOverlay \r\n                        isVisible={isDebugMode}\r\n                        ttsState={ttsState}\r\n                        currentStep={step}\r\n                        audioLevels={audioVolumes}\r\n                        currentText={aiMessage}\r\n                        aiLatency={aiLatency}\r\n                    />\r\n                    <div style={{ display: 'flex', alignItems: 'center', marginBottom: '30px' }}>\r\n                        <button onClick={() => setStep('diagnosis')} style={{ padding: '10px', color: 'white', background: 'none', border: 'none' }}>\r\n                            <ArrowLeft size={24} />\r\n                        </button>\r\n                        <h1 style={{ flex: 1, textAlign: 'center', fontSize: '1.1rem', fontWeight: 600, color: 'rgba(255,255,255,0.5)', marginRight: '44px' }}>\r\n                             \r\n                        </h1>\r\n                    </div>\r\n\r\n                    <div style={{ flex: 1, display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'flex-start', paddingTop: '30px' }}>\r\n                        <p style={{ color: 'rgba(255,255,255,0.6)', marginBottom: '25px', fontSize: '0.95rem' }}>\r\n                               \r\n                        </p>\r\n\r\n                        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '15px', width: '100%', maxWidth: '400px' }}>\r\n                            {DIAGNOSIS_OPTIONS.map((option) => (\r\n                                <button key={option.id} onClick={() => handleDiagnosisSelect(option)} style={{\r\n                                    background: 'rgba(255,255,255,0.05)', border: '1px solid rgba(255,255,255,0.1)',\r\n                                    borderRadius: '20px', padding: '20px', display: 'flex', flexDirection: 'column', alignItems: 'center', gap: '15px',\r\n                                    transition: 'all 0.3s ease', cursor: 'pointer'\r\n                                }}>\r\n                                    <div style={{ \r\n                                        width: '50px', height: '50px', borderRadius: '50%', background: `${option.color}20`,\r\n                                        display: 'flex', alignItems: 'center', justifyContent: 'center', color: option.color \r\n                                    }}>\r\n                                        <option.icon size={28} weight=\"fill\" />\r\n                                    </div>\r\n                                    <span style={{ color: 'white', fontWeight: 600 }}>{option.label}</span>\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // 2. Weather Step\r\n    if (step === 'weather') {\r\n        return (\r\n             <div style={{\r\n                position: 'fixed', inset: 0, background: '#0a0a0c', zIndex: 2000,\r\n                display: 'flex', flexDirection: 'column', padding: '20px', overflow: 'hidden'\r\n            }}>\r\n                <div className={`soul-light-base soul-theme-${visualTheme} active`} style={{ transition: 'all 1s ease', opacity: 0.4 }} />\r\n                <div style={{ position: 'relative', zIndex: 10, display: 'flex', flexDirection: 'column', height: '100%', width: '100%' }}>\r\n                    {/*  Debug Overlay */}\r\n                    <MeditationDebugOverlay \r\n                        isVisible={isDebugMode}\r\n                        ttsState={ttsState}\r\n                        currentStep={step}\r\n                        audioLevels={audioVolumes}\r\n                        currentText={aiMessage}\r\n                        aiLatency={aiLatency}\r\n                    />\r\n                    <div style={{ display: 'flex', alignItems: 'center', marginBottom: '30px' }}>\r\n                        <button onClick={() => setStep('diagnosis')} style={{ padding: '10px', color: 'white', background: 'none', border: 'none' }}>\r\n                            <ArrowLeft size={24} />\r\n                        </button>\r\n                        <h1 style={{ flex: 1, textAlign: 'center', fontSize: '1.1rem', fontWeight: 600, color: 'rgba(255,255,255,0.5)', marginRight: '44px' }}>\r\n                             \r\n                        </h1>\r\n                    </div>\r\n\r\n                    <div style={{ flex: 1, display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'flex-start', paddingTop: '40px' }}>\r\n                        <h2 style={{ fontSize: '1.6rem', fontWeight: 700, color: 'white', marginBottom: '10px', textAlign: 'center' }}>\r\n                               ?\r\n                        </h2>\r\n                        <p style={{ color: 'rgba(255,255,255,0.5)', marginBottom: '50px', textAlign: 'center', fontSize: '0.9rem' }}>\r\n                                 \r\n                        </p>\r\n\r\n                        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '15px', width: '100%', maxWidth: '400px' }}>\r\n                            {WEATHER_OPTIONS.map((option) => (\r\n                                <button key={option.id} onClick={() => handleWeatherSelect(option)} style={{\r\n                                    background: 'rgba(255,255,255,0.05)', border: '1px solid rgba(255,255,255,0.1)',\r\n                                    borderRadius: '20px', padding: '24px', display: 'flex', flexDirection: 'column', alignItems: 'center', gap: '10px',\r\n                                    cursor: 'pointer'\r\n                                }}>\r\n                                    <option.icon size={36} color={option.color} weight=\"duotone\" />\r\n                                    <span style={{ color: 'white', fontSize: '1.1rem', marginTop: '5px' }}>{option.label}</span>\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // 1-a. Prescription Summary (New AI Analysis View)\r\n    if (step === 'prescription_summary') {\r\n        const summary = currentAIChat?.analysisSummary || prescriptionReason || \"    .\";\r\n        return (\r\n            <div style={{\r\n                position: 'fixed', inset: 0, background: '#0a0a0c', zIndex: 2000,\r\n                display: 'flex', flexDirection: 'column', padding: '20px', overflow: 'hidden'\r\n            }}>\r\n                <div className={`soul-light-base soul-theme-${visualTheme} active`} style={{ transition: 'all 1s ease', opacity: 0.4 }} />\r\n                <div style={{ position: 'relative', zIndex: 10, display: 'flex', flexDirection: 'column', height: '100%', width: '100%', alignItems: 'center', justifyContent: 'center' }}>\r\n                    <div style={{ marginBottom: '30px', color: 'var(--primary-gold)', textAlign: 'center' }}>\r\n                        <Brain size={60} weight=\"fill\" />\r\n                        <h2 style={{ fontSize: '1.8rem', fontWeight: 800, color: 'white', marginTop: '20px' }}>AI  </h2>\r\n                    </div>\r\n                    \r\n                    <div style={{ \r\n                        width: '100%', maxWidth: '400px', background: 'rgba(255,255,255,0.08)', \r\n                        borderRadius: '24px', padding: '30px', border: '1px solid rgba(255,255,255,0.1)',\r\n                        marginBottom: '40px', boxShadow: '0 20px 40px rgba(0,0,0,0.5)'\r\n                    }}>\r\n                        <p style={{ color: 'white', fontSize: '1.15rem', lineHeight: 1.7, textAlign: 'center', wordBreak: 'keep-all' }}>\r\n                            &quot;{summary}&quot;\r\n                        </p>\r\n                    </div>\r\n\r\n                    <button onClick={() => setStep('interaction_select')}\r\n                        style={{\r\n                            width: '100%', maxWidth: '300px', background: 'var(--primary-gold)', color: 'black',\r\n                            padding: '20px', borderRadius: '20px', fontSize: '1.2rem', fontWeight: 800, border: 'none',\r\n                            cursor: 'pointer', boxShadow: '0 10px 20px rgba(212,175,55,0.3)'\r\n                        }}>  </button>\r\n                    \r\n                    <button onClick={() => {\r\n                            //  AI's warm welcome message when returning to chat\r\n                            const welcomeBackMessages = [\r\n                                \" !   ? \",\r\n                                \",    .  ?\",\r\n                                \"  .       .\"\r\n                            ];\r\n                            const randomWelcome = welcomeBackMessages[Math.floor(Math.random() * welcomeBackMessages.length)];\r\n                            setChatHistory(prev => [...prev, { role: 'model', content: randomWelcome }]);\r\n                            if (ttcEnabled) speak(randomWelcome);\r\n                            setStep('diagnosis');\r\n                        }}\r\n                        style={{ marginTop: '20px', background: 'none', border: 'none', color: 'rgba(255,255,255,0.4)', textDecoration: 'underline' }}>\r\n                          \r\n                    </button>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // 1-b. Interaction Selection (New Dedicated View)\r\n    if (step === 'interaction_select') {\r\n        return (\r\n            <div style={{\r\n                position: 'fixed', inset: 0, background: '#0a0a0c', zIndex: 2000,\r\n                display: 'flex', flexDirection: 'column', padding: '20px', overflow: 'hidden'\r\n            }}>\r\n                <div className={`soul-light-base soul-theme-${visualTheme} active`} style={{ transition: 'all 1s ease', opacity: 0.4 }} />\r\n                <div style={{ position: 'relative', zIndex: 10, display: 'flex', flexDirection: 'column', height: '100%', width: '100%' }}>\r\n                    <div style={{ padding: '20px 0', textAlign: 'center' }}>\r\n                        <h2 style={{ fontSize: '1.6rem', fontWeight: 800, color: 'white' }}>  ?</h2>\r\n                        <p style={{ color: 'rgba(255,255,255,0.5)', marginTop: '8px' }}>    </p>\r\n                    </div>\r\n\r\n                    <div style={{ flex: 1, display: 'flex', flexDirection: 'column', gap: '15px', justifyContent: 'center', width: '100%', maxWidth: '400px', margin: '0 auto' }}>\r\n                        {Object.values(INTERACTION_TYPES).map(t => (\r\n                            <button key={t.id} onClick={() => {\r\n                                setInteractionType(t.id);\r\n                                const defaultMode = MEDITATION_MODES.find(m => m.id === selectedDiagnosis?.prescription.modeId) || MEDITATION_MODES[1];\r\n                                setActiveMode(defaultMode);\r\n                                setTimeLeft(defaultMode.time);\r\n                                // Fetch real prescription details in background\r\n                                fetchAIPrescription(selectedDiagnosis?.id || 'stress', weatherContext?.id || 'sun', defaultMode.id, t.id, \"\");\r\n                                setStep('preparation');\r\n                                setPrepStep(3); // Go to Posture Guide\r\n                            }}\r\n                                style={{\r\n                                    display: 'flex', alignItems: 'center', gap: '20px', padding: '25px',\r\n                                    background: 'rgba(255,255,255,0.05)', border: '1px solid rgba(255,255,255,0.1)',\r\n                                    borderRadius: '24px', color: 'white', textAlign: 'left', cursor: 'pointer', transition: 'all 0.3s'\r\n                                }}>\r\n                                <div style={{ width: '50px', height: '50px', borderRadius: '15px', background: 'rgba(212,175,55,0.1)', display: 'flex', alignItems: 'center', justifyContent: 'center', color: 'var(--primary-gold)' }}>\r\n                                    {t.id === 'v1' ? <Wind size={28} /> : t.id === 'v2' ? <Microphone size={28} /> : <VideoCamera size={28} />}\r\n                                </div>\r\n                                <div style={{ flex: 1 }}>\r\n                                    <div style={{ fontSize: '1.15rem', fontWeight: 700, marginBottom: '4px' }}>{t.label}</div>\r\n                                    <div style={{ fontSize: '0.85rem', color: 'rgba(255,255,255,0.5)', lineHeight: 1.4 }}>{t.desc}</div>\r\n                                </div>\r\n                            </button>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (step === 'prescription' && selectedDiagnosis && activeMode) {\r\n        const ModeIcon = ICON_MAP[activeMode.iconName] || ICON_MAP.Wind;\r\n        \r\n        return (\r\n            <div style={{\r\n                position: 'fixed', inset: 0, background: '#0a0a0c', zIndex: 2000,\r\n                display: 'flex', flexDirection: 'column', padding: '20px', overflow: 'hidden'\r\n            }}>\r\n                <div className={`soul-light-base soul-theme-${visualTheme} active`} style={{ transition: 'all 1s ease', opacity: 0.4 }} />\r\n                <div style={{ position: 'relative', zIndex: 10, display: 'flex', flexDirection: 'column', height: '100%', width: '100%', overflowY: 'auto' }} className=\"no-scrollbar\">\r\n                    {/*  Debug Overlay */}\r\n                    <MeditationDebugOverlay \r\n                        isVisible={isDebugMode}\r\n                        ttsState={ttsState}\r\n                        currentStep={step}\r\n                        audioLevels={audioVolumes}\r\n                        currentText={aiMessage}\r\n                        aiLatency={aiLatency}\r\n                    />\r\n                    <div style={{ marginTop: '20px', flex: 1, display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'flex-start', paddingBottom: '40px' }}>\r\n                        <div style={{ marginBottom: '20px', color: 'var(--primary-gold)' }}><Sparkle size={48} weight=\"fill\" /></div>\r\n                        <h2 style={{ fontSize: '1.4rem', fontWeight: 700, color: 'white', marginBottom: '20px', textAlign: 'center' }}>\r\n                              AI \r\n                        </h2>\r\n\r\n                        <div style={{ \r\n                            width: '100%', maxWidth: '350px', background: 'rgba(255,255,255,0.08)', \r\n                            borderRadius: '24px', padding: '20px', border: '1px solid rgba(255,255,255,0.1)',\r\n                            display: 'flex', flexDirection: 'column', gap: '15px'\r\n                        }}>\r\n                            {/* 1. AI Analysis */}\r\n                            <div style={{ background: 'rgba(255,255,255,0.05)', padding: '15px', borderRadius: '15px', fontSize: '0.9rem', color: 'rgba(255,255,255,0.9)', lineHeight: 1.6 }}>\r\n                                <div style={{ color: 'var(--primary-gold)', fontWeight: 700, marginBottom: '8px', fontSize: '0.85rem' }}> AI   </div>\r\n                                <div>{currentAIChat?.isFinalAnalysis ? (currentAIChat.analysisSummary || prescriptionReason) : prescriptionReason}</div>\r\n                            </div>\r\n\r\n                            <div style={{ height: '1px', background: 'rgba(255,255,255,0.1)', margin: '5px 0' }} />\r\n\r\n                            {/* 2. Recommendation Hero Card */}\r\n                            <div style={{ display: 'flex', alignItems: 'center', gap: '15px' }}>\r\n                                <div style={{ width: '60px', height: '60px', borderRadius: '18px', background: `${activeMode.color}30`, display: 'flex', alignItems: 'center', justifyContent: 'center', color: activeMode.color }}>\r\n                                    <ModeIcon size={32} weight=\"duotone\" />\r\n                                </div>\r\n                                <div>\r\n                                    <div style={{ fontSize: '0.85rem', color: 'var(--primary-gold)', fontWeight: 600, marginBottom: '2px' }}> AI  </div>\r\n                                    <div style={{ fontSize: '1.25rem', fontWeight: 700, color: 'white' }}>{activeMode.label}</div>\r\n                                    <div style={{ fontSize: '0.85rem', color: 'rgba(255,255,255,0.6)' }}>\r\n                                        {interactionType === 'v1' && '  '}\r\n                                        {interactionType === 'v2' && ' '}\r\n                                        {interactionType === 'v3' && ' '}\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* 3. User Options */}\r\n                            <div style={{ marginTop: '10px' }}>\r\n                                 <div style={{ color: 'rgba(255,255,255,0.5)', fontSize: '0.75rem', marginBottom: '10px' }}> </div>\r\n                                \r\n                                {/* Time Selection */}\r\n                                <div style={{ marginBottom: '10px', display: 'flex', gap: '8px' }}>\r\n                                    {MEDITATION_MODES.map(m => (\r\n                                        <button key={m.id} onClick={() => { setActiveMode(m); setTimeLeft(m.time); }}\r\n                                            style={{\r\n                                                flex: 1, padding: '8px', borderRadius: '10px', fontSize: '0.75rem',\r\n                                                background: activeMode.id === m.id ? 'rgba(255,255,255,0.2)' : 'rgba(255,255,255,0.05)',\r\n                                                color: activeMode.id === m.id ? 'white' : 'rgba(255,255,255,0.6)',\r\n                                                border: activeMode.id === m.id ? '1px solid rgba(255,255,255,0.3)' : 'none', fontWeight: 600\r\n                                            }}>{m.label.split(' ')[0]}</button>\r\n                                    ))}\r\n                                </div>\r\n\r\n                                {/* Type Selection */}\r\n                                <div style={{ display: 'flex', gap: '8px' }}>\r\n                                    {Object.values(INTERACTION_TYPES).map(t => (\r\n                                        <button key={t.id} onClick={() => setInteractionType(t.id)}\r\n                                            style={{\r\n                                                flex: 1, padding: '8px', borderRadius: '10px', fontSize: '0.75rem',\r\n                                                background: interactionType === t.id ? 'rgba(255,255,255,0.2)' : 'rgba(255,255,255,0.05)',\r\n                                                color: interactionType === t.id ? 'white' : 'rgba(255,255,255,0.6)',\r\n                                                border: interactionType === t.id ? '1px solid rgba(255,255,255,0.3)' : 'none', fontWeight: 600\r\n                                            }}>{t.id === 'v1' ? '' : t.id === 'v2' ? '' : ''}</button>\r\n                                    ))}\r\n                                </div>\r\n\r\n                                {/*  Ambient Sound Selection */}\r\n                                <div style={{ marginTop: '15px' }}>\r\n                                    <div style={{ color: 'rgba(255,255,255,0.5)', fontSize: '0.75rem', marginBottom: '8px' }}> </div>\r\n                                    <div style={{ display: 'flex', gap: '6px', flexWrap: 'wrap' }}>\r\n                                        {AMBIENT_SOUNDS.map(a => (\r\n                                            <button key={a.id} onClick={() => setSelectedAmbient(a.id)}\r\n                                                style={{\r\n                                                    padding: '6px 12px', borderRadius: '12px', fontSize: '0.7rem',\r\n                                                    background: selectedAmbient === a.id ? `${a.color}30` : 'rgba(255,255,255,0.05)',\r\n                                                    color: selectedAmbient === a.id ? a.color : 'rgba(255,255,255,0.5)',\r\n                                                    border: selectedAmbient === a.id ? `1px solid ${a.color}50` : '1px solid transparent',\r\n                                                    fontWeight: 600, cursor: 'pointer'\r\n                                                }}>{a.label}</button>\r\n                                        ))}\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div style={{ width: '100%', maxWidth: '350px', marginTop: '30px' }}>\r\n                            <button onClick={startFromPrescription} style={{\r\n                                width: '100%', background: 'var(--primary-gold)', color: 'black',\r\n                                padding: '16px', borderRadius: '18px', fontSize: '1.1rem', fontWeight: 800, border: 'none',\r\n                                display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '10px', \r\n                                cursor: 'pointer', boxShadow: '0 10px 20px rgba(212,175,55,0.3)'\r\n                            }}><Play size={24} weight=\"fill\" /> </button>\r\n                            \r\n                            <button onClick={handleReturnToChat} style={{ \r\n                                marginTop: '15px', width: '100%', background: 'transparent', border: 'none', \r\n                                color: 'rgba(255,255,255,0.4)', textDecoration: 'underline', cursor: 'pointer', fontSize: '0.85rem'\r\n                            }}>  ( )</button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    //  Phase 4: Preparation Flow Step\r\n    if (step === 'preparation') {\r\n        const PREPARATION_GUIDES = {\r\n            chair: {\r\n                title: \" \", desc: \"  \",\r\n                steps: [\"    .\", \"     .\", \"    .\"]\r\n            },\r\n            floor: {\r\n                title: \" \", desc: \"  \",\r\n                steps: [\"    .\", \"     .\", \"     .\"]\r\n            },\r\n            lying: {\r\n                title: \" \", desc: \"   \",\r\n                steps: [\"   .\", \"     .\", \"       .\"]\r\n            }\r\n        };\r\n\r\n        return (\r\n            <div style={{\r\n                position: 'fixed', inset: 0, background: '#0a0a0c', zIndex: 2000,\r\n                display: 'flex', flexDirection: 'column', padding: '20px', overflow: 'hidden'\r\n            }}>\r\n                <div className={`soul-light-base soul-theme-${visualTheme} active`} style={{ transition: 'all 1s ease', opacity: 0.4 }} />\r\n                <div style={{ position: 'relative', zIndex: 10, display: 'flex', flexDirection: 'column', height: '100%', width: '100%' }}>\r\n                    {/*  Debug Overlay */}\r\n                    <MeditationDebugOverlay \r\n                        isVisible={isDebugMode}\r\n                        ttsState={ttsState}\r\n                        currentStep={step}\r\n                        audioLevels={audioVolumes}\r\n                        currentText={aiMessage}\r\n                        aiLatency={aiLatency}\r\n                    />\r\n                    <div style={{ display: 'flex', alignItems: 'center', marginBottom: '30px' }}>\r\n                        <button onClick={() => setStep('interaction_select')} style={{ padding: '10px', color: 'white', background: 'none', border: 'none' }}>\r\n                            <ArrowLeft size={24} />\r\n                        </button>\r\n                        <div style={{ flex: 1, textAlign: 'center' }}>\r\n                            <div style={{ fontSize: '0.8rem', color: 'var(--primary-gold)', fontWeight: 600 }}>  ({prepStep}/3)</div>\r\n                            <div style={{ fontSize: '1.1rem', fontWeight: 700, color: 'white' }}> </div>\r\n                        </div>\r\n                        <div style={{ width: '44px' }} />\r\n                    </div>\r\n\r\n                    <div style={{ flex: 1, display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'flex-start', paddingTop: '10px' }}>\r\n                        {/* STEP 1: Notifications Off */}\r\n                        {prepStep === 1 && (\r\n                            <div style={{ width: '100%', maxWidth: '350px', animation: 'fadeIn 0.5s ease' }}>\r\n                                <div style={{ textAlign: 'center', marginBottom: '40px' }}>\r\n                                    <div style={{ fontSize: '4rem', marginBottom: '20px' }}></div>\r\n                                    <h3 style={{ fontSize: '1.5rem', fontWeight: 700, color: 'white', marginBottom: '10px' }}> </h3>\r\n                                    <p style={{ color: 'rgba(255,255,255,0.5)', lineHeight: 1.6, marginBottom: '20px' }}>\r\n                                          <br/> &apos;&apos;  &apos;&apos;  <br/>?\r\n                                    </p>\r\n\r\n                                    {/*      */}\r\n                                    <div style={{ \r\n                                        background: 'rgba(76, 155, 251, 0.1)', \r\n                                        border: '1px solid rgba(76, 155, 251, 0.2)',\r\n                                        borderRadius: '15px', padding: '15px', marginTop: '10px',\r\n                                        textAlign: 'left', fontSize: '0.85rem'\r\n                                    }}>\r\n                                        <div style={{ color: '#4c9bfb', fontWeight: 700, marginBottom: '5px', display: 'flex', alignItems: 'center', gap: '5px' }}>\r\n                                            <SpeakerHigh size={14} weight=\"fill\" /> \r\n                                        </div>\r\n                                        <div style={{ color: 'rgba(255,255,255,0.7)', lineHeight: 1.5 }}>\r\n                                            &apos;&apos; &apos;&apos;  **    .**     .\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                                <button onClick={() => { setPrepSelections({...prepSelections, notified: true}); setPrepStep(2); }}\r\n                                    style={{\r\n                                        width: '100%', background: 'var(--primary-gold)', color: 'black',\r\n                                        padding: '18px', borderRadius: '20px', fontSize: '1.1rem', fontWeight: 800, border: 'none',\r\n                                        cursor: 'pointer', display: 'flex', alignItems: 'center', justifyContent: 'center'\r\n                                    }}></button>\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* STEP 3: Posture Guide */}\r\n                        {prepStep === 3 && (\r\n                            <div style={{ width: '100%', maxWidth: '400px', animation: 'fadeIn 0.5s ease' }}>\r\n                                <h3 style={{ fontSize: '1.3rem', fontWeight: 700, color: 'white', marginBottom: '15px', textAlign: 'center' }}>   </h3>\r\n                                <div style={{ display: 'flex', gap: '8px', marginBottom: '15px' }}>\r\n                                    {Object.entries(PREPARATION_GUIDES).map(([key, info]) => (\r\n                                        <button key={key} onClick={() => setPrepSelections({...prepSelections, posture: key})}\r\n                                            style={{\r\n                                                flex: 1, padding: '10px 4px', borderRadius: '12px', fontSize: '0.8rem',\r\n                                                background: prepSelections.posture === key ? 'rgba(255,255,255,0.15)' : 'rgba(255,255,255,0.03)',\r\n                                                color: prepSelections.posture === key ? 'white' : 'rgba(255,255,255,0.4)',\r\n                                                border: prepSelections.posture === key ? '1px solid rgba(255,255,255,0.3)' : '1px solid transparent',\r\n                                                fontWeight: 600\r\n                                            }}>{info.title}</button>\r\n                                    ))}\r\n                                </div>\r\n                                <div style={{ \r\n                                    background: 'rgba(255,255,255,0.05)', borderRadius: '24px', padding: '20px',\r\n                                    border: '1px solid rgba(255,255,255,0.1)', marginBottom: '20px', minHeight: '180px'\r\n                                }}>\r\n                                    <div style={{ color: 'var(--primary-gold)', fontSize: '0.75rem', fontWeight: 700, marginBottom: '4px' }}>{PREPARATION_GUIDES[prepSelections.posture].desc}</div>\r\n                                    <div style={{ fontSize: '1.1rem', fontWeight: 800, color: 'white', marginBottom: '12px' }}>{PREPARATION_GUIDES[prepSelections.posture].title} </div>\r\n                                    <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\r\n                                        {PREPARATION_GUIDES[prepSelections.posture].steps.map((s, i) => (\r\n                                            <div key={i} style={{ display: 'flex', gap: '8px', color: 'rgba(255,255,255,0.8)', fontSize: '0.9rem', lineHeight: 1.4 }}>\r\n                                                <span style={{ color: 'var(--primary-gold)', fontWeight: 800 }}>{i+1}</span>\r\n                                                <span>{s}</span>\r\n                                            </div>\r\n                                        ))}\r\n                                    </div>\r\n                                </div>\r\n                                <button onClick={() => setPrepStep(2)} //  Go to Phone Placement NEXT\r\n                                    style={{\r\n                                        width: '100%', background: 'white', color: 'black',\r\n                                        padding: '18px', borderRadius: '20px', fontSize: '1.1rem', fontWeight: 800, border: 'none',\r\n                                        cursor: 'pointer', marginBottom: '15px'\r\n                                    }}>  </button>\r\n                            </div>\r\n                        )}\r\n                        \r\n                        {/* STEP 2: Phone Placement (Moved AFTER posture) */}\r\n                        {prepStep === 2 && (\r\n                            <div style={{ width: '100%', maxWidth: '350px', animation: 'fadeIn 0.5s ease' }}>\r\n                                <div style={{ textAlign: 'center', marginBottom: '40px' }}>\r\n                                    <div style={{ fontSize: '4rem', marginBottom: '20px' }}>\r\n                                        {interactionType === 'v3' ? '' : (interactionType === 'v2' ? '' : '')}\r\n                                    </div>\r\n                                    <h3 style={{ fontSize: '1.5rem', fontWeight: 700, color: 'white', marginBottom: '10px' }}>  </h3>\r\n                                    <p style={{ color: 'rgba(255,255,255,0.7)', lineHeight: 1.6, fontSize: '1.1rem' }}>\r\n                                        {interactionType === 'v3' ? \"     2m  .\" : (interactionType === 'v2' ? \"     (30cm )  .\" : \"     .\")}\r\n                                    </p>\r\n                                    {interactionType === 'v2' && (\r\n                                        <div style={{ \r\n                                            marginTop: '20px', padding: '12px', background: 'rgba(74, 222, 128, 0.1)', \r\n                                            borderRadius: '12px', border: '1px solid rgba(74, 222, 128, 0.2)', fontSize: '0.85rem', color: '#4ade80'\r\n                                        }}> <b>Tip:</b>           .</div>\r\n                                    )}\r\n                                </div>\r\n                                <button onClick={() => startSession(activeMode)}\r\n                                    style={{\r\n                                        width: '100%', background: 'var(--primary-gold)', color: 'black',\r\n                                        padding: '18px', borderRadius: '20px', fontSize: '1.1rem', fontWeight: 800, border: 'none',\r\n                                        cursor: 'pointer', display: 'flex', alignItems: 'center', justifyContent: 'center'\r\n                                    }}>  ( )</button>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // 5. Feedback Step\r\n    if (step === 'feedback') {\r\n        const points = feedbackData?.feedbackPoints || [];\r\n        \r\n        return (\r\n            <FeedbackView\r\n                visualTheme={visualTheme}\r\n                isDebugMode={isDebugMode}\r\n                ttsState={ttsState}\r\n                step={step}\r\n                audioVolumes={audioVolumes}\r\n                aiMessage={aiMessage}\r\n                aiLatency={aiLatency}\r\n                isAILoading={isAILoading}\r\n                points={points}\r\n                feedbackData={feedbackData}\r\n                stopAllAudio={stopAllAudio}\r\n                setAiMessage={setAiMessage}\r\n                setChatHistory={setChatHistory}\r\n                onClose={onClose}\r\n            />\r\n        );\r\n    }\r\n\r\n    // 4. Active Session Step\r\n    const breathingScale = interactionType === 'v2' ? 1 + micVolume : 1;\r\n\r\n    return (\r\n        <div style={{\r\n            position: 'fixed', inset: 0, background: '#0a0a0c', zIndex: 3000,\r\n            display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center',\r\n            overflow: 'hidden'\r\n        }}>\r\n            {/* V3 Camera Layer */}\r\n            {interactionType === 'v3' && (\r\n                <div style={{ position: 'absolute', inset: 0, zIndex: 1, opacity: 0.6 }}>\r\n                    <video \r\n                        ref={videoRef} \r\n                        autoPlay \r\n                        playsInline \r\n                        muted \r\n                        style={{ width: '100%', height: '100%', objectFit: 'cover', transform: 'scaleX(-1)' }} \r\n                    />\r\n                    <canvas\r\n                        ref={canvasRef}\r\n                        width={window.innerWidth}\r\n                        height={window.innerHeight}\r\n                        style={{\r\n                            position: 'absolute', inset: 0,\r\n                            width: '100%', height: '100%',\r\n                            transform: 'scaleX(-1)', // Mirror to match video\r\n                            pointerEvents: 'none'\r\n                        }}\r\n                    />\r\n                    <div style={{\r\n                        position: 'absolute', top: '50%', left: '50%', transform: 'translate(-50%, -50%)',\r\n                        width: '280px', height: '350px',\r\n                        border: '1px solid rgba(255, 215, 0, 0.3)', borderRadius: '120px',\r\n                        boxShadow: '0 0 80px rgba(255, 215, 0, 0.1) inset'\r\n                    }} />\r\n                </div>\r\n            )}\r\n\r\n            {/* Global Dynamic Background */}\r\n            <div \r\n                className={`soul-light-base soul-theme-${visualTheme} ${isPlaying && interactionType !== 'v2' ? 'active' : ''}`} \r\n                style={{\r\n                     transform: interactionType === 'v2' && isPlaying \r\n                        ? `translate(-50%, -50%) scale(${1 + Math.min(micVolume, 0.5)})` \r\n                        : undefined,\r\n                     transition: interactionType === 'v2' ? 'transform 0.1s ease-out' : 'all 1s ease',\r\n                     zIndex: 0\r\n                 }}\r\n            />\r\n\r\n            {/* Content Overlay */}\r\n            <div style={{ zIndex: 10, textAlign: 'center', width: '100%', padding: '20px', maxWidth: '600px' }}>\r\n                <div style={{ marginBottom: '20px', minHeight: '80px', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>\r\n                    <p style={{ \r\n                        color: 'white', fontSize: '1.2rem', fontWeight: 500, lineHeight: 1.6,\r\n                        opacity: isPlaying ? 1 : 0.5, transition: 'opacity 1s ease',\r\n                        textShadow: '0 4px 20px rgba(0,0,0,0.8)', background: interactionType === 'v3' ? 'rgba(0,0,0,0.6)' : 'transparent',\r\n                        padding: interactionType === 'v3' ? '15px' : '0', borderRadius: '15px'\r\n                    }}>\r\n                        {aiMessage}\r\n                    </p>\r\n                </div>\r\n\r\n                <div style={{ fontSize: '4.5rem', fontWeight: 200, color: 'white', fontVariantNumeric: 'tabular-nums', letterSpacing: '-2px', textShadow: '0 0 30px rgba(255,255,255,0.3)', marginBottom: '10px' }}>\r\n                    {formatTime(timeLeft)}\r\n                </div>\r\n\r\n                {/*  Breath Level Meter (NEW: User Request) */}\r\n                {interactionType === 'v2' && (\r\n                    <div style={{ \r\n                        marginTop: '20px', display: 'flex', flexDirection: 'column', alignItems: 'center', gap: '8px',\r\n                        animation: 'fadeIn 0.5s ease'\r\n                    }}>\r\n                        <div style={{ display: 'flex', alignItems: 'center', gap: '8px', color: micVolume > 0.1 ? '#4ade80' : 'rgba(255,255,255,0.3)', transition: 'color 0.2s' }}>\r\n                            <Microphone size={20} weight={micVolume > 0.1 ? \"fill\" : \"regular\"} style={{ transform: `scale(${1 + Math.min(micVolume, 0.5)})` }} />\r\n                            <span style={{ fontSize: '0.8rem', fontWeight: 600, letterSpacing: '1px' }}>BREATH LEVEL</span>\r\n                        </div>\r\n                        <div style={{ \r\n                            width: '120px', height: '4px', background: 'rgba(255,255,255,0.1)', borderRadius: '2px', overflow: 'hidden',\r\n                            boxShadow: '0 0 10px rgba(0,0,0,0.5)'\r\n                        }}>\r\n                            <div style={{ \r\n                                height: '100%', \r\n                                width: `${Math.min(micVolume * 100, 100)}%`, \r\n                                background: 'linear-gradient(90deg, #4ade80, #32ff7e)',\r\n                                transition: 'width 0.1s ease-out',\r\n                                boxShadow: '0 0 10px rgba(74, 222, 128, 0.5)'\r\n                            }} />\r\n                        </div>\r\n                        {micVolume > 0.1 && (\r\n                            <span style={{ fontSize: '0.7rem', color: '#4ade80', animation: 'pulse 1s infinite' }}> ...</span>\r\n                        )}\r\n                    </div>\r\n                )}\r\n\r\n                {/* Privacy Notice or TTC Indicator */}\r\n                <div style={{ height: '30px', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>\r\n                    {ttcEnabled ? (\r\n                        <div style={{ display: 'flex', alignItems: 'center', gap: '5px', color: 'var(--primary-gold)', fontSize: '0.8rem', fontWeight: 'bold', animation: 'pulse 2s infinite' }}>\r\n                            <SpeakerHigh size={16} weight=\"fill\" />    \r\n                        </div>\r\n                    ) : (\r\n                        (interactionType === 'v2' || interactionType === 'v3') && (\r\n                            <div style={{ display: 'flex', alignItems: 'center', gap: '5px', color: 'rgba(255,255,255,0.4)', fontSize: '0.75rem' }}>\r\n                                <LockKey size={12} weight=\"fill\" color=\"#4ade80\" />    \r\n                            </div>\r\n                        )\r\n                    )}\r\n                </div>\r\n                \r\n                {permissionError && (\r\n                    <div style={{ marginTop: '20px', padding: '10px', background: 'rgba(255,0,0,0.2)', color: '#ff6b6b', borderRadius: '8px', fontSize: '0.9rem' }}>\r\n                         {permissionError}\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* Controls */}\r\n            <div style={{ position: 'absolute', bottom: '60px', display: 'flex', alignItems: 'center', gap: '40px', zIndex: 20 }}>\r\n                <button onClick={() => { \r\n                    //  Phase 2: X      ( )\r\n                    completeSession();\r\n                }} style={{\r\n                    width: '60px', height: '60px', borderRadius: '50%',\r\n                    background: 'rgba(255,255,255,0.1)', border: 'none', color: 'white',\r\n                    display: 'flex', alignItems: 'center', justifyContent: 'center', cursor: 'pointer'\r\n                }}>\r\n                    <X size={28} />\r\n                </button>\r\n\r\n                <button onClick={togglePlay} style={{\r\n                    width: '80px', height: '80px', borderRadius: '50%',\r\n                    background: activeMode?.color, border: 'none', color: '#000',\r\n                    display: 'flex', alignItems: 'center', justifyContent: 'center',\r\n                    boxShadow: `0 0 30px ${activeMode?.color}60`, cursor: 'pointer'\r\n                }}>\r\n                    {isPlaying ? <Pause size={32} weight=\"fill\" /> : <Play size={32} weight=\"fill\" />}\r\n                </button>\r\n\r\n                <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', gap: '4px' }}>\r\n                    <button onClick={() => setShowVolumePanel(!showVolumePanel)} style={{\r\n                        width: '60px', height: '60px', borderRadius: '50%',\r\n                        background: showVolumePanel ? 'rgba(212,175,55,0.3)' : 'rgba(255,255,255,0.1)', border: 'none', \r\n                        color: soundEnabled ? 'white' : 'rgba(255,255,255,0.3)',\r\n                        display: 'flex', alignItems: 'center', justifyContent: 'center', cursor: 'pointer',\r\n                        transition: 'all 0.3s ease'\r\n                    }}>\r\n                        {soundEnabled ? <SpeakerHigh size={28} /> : <SpeakerSlash size={28} />}\r\n                    </button>\r\n                    <span style={{ fontSize: '0.65rem', color: 'rgba(255,255,255,0.5)', fontWeight: '600' }}> </span>\r\n                </div>\r\n\r\n\r\n            </div>\r\n\r\n            {/*  Phase 3: Volume Control Panel */}\r\n            <VolumeControlPanel\r\n                showVolumePanel={showVolumePanel}\r\n                setShowVolumePanel={setShowVolumePanel}\r\n                audioVolumes={audioVolumes}\r\n                setAudioVolumes={setAudioVolumes}\r\n                currentAudioRef={currentAudioRef}\r\n                updateAmbientVolume={updateAmbientVolume}\r\n                updateBinauralVolume={updateBinauralVolume}\r\n                soundEnabled={soundEnabled}\r\n                setSoundEnabled={setSoundEnabled}\r\n            />\r\n\r\n            {/*      */}\r\n            {showVolumeHint && !showVolumePanel && (\r\n                <div style={{\r\n                    position: 'absolute', bottom: '190px', left: '50%', transform: 'translateX(-50%)',\r\n                    background: 'rgba(212,175,55,0.2)', backdropFilter: 'blur(10px)',\r\n                    border: '1px solid rgba(212,175,55,0.3)', borderRadius: '20px',\r\n                    padding: '8px 16px', color: 'rgba(255,255,255,0.8)', fontSize: '0.75rem',\r\n                    whiteSpace: 'nowrap', animation: 'fadeIn 0.5s ease-out',\r\n                    pointerEvents: 'none'\r\n                }}>\r\n                         \r\n                </div>\r\n            )}\r\n\r\n            {/*  Debug Overlay */}\r\n            <MeditationDebugOverlay \r\n                isVisible={isDebugMode}\r\n                ttsState={ttsState}\r\n                currentStep={step}\r\n                audioLevels={audioVolumes}\r\n                currentText={aiMessage}\r\n                aiLatency={aiLatency}\r\n            />\r\n\r\n            <style>{`\r\n                .no-scrollbar::-webkit-scrollbar {\r\n                    display: none;\r\n                }\r\n                .no-scrollbar {\r\n                    -ms-overflow-style: none;  /* IE and Edge */\r\n                    scrollbar-width: none;  /* Firefox */\r\n                }\r\n                @keyframes breathe {\r\n                    0%, 100% { transform: scale(1); opacity: 0.5; }\r\n                    50% { transform: scale(1.5); opacity: 0.8; }\r\n                }\r\n                @keyframes breathe-inner {\r\n                    0%, 100% { transform: scale(1); opacity: 0.8; }\r\n                    50% { transform: scale(1.3); opacity: 0.4; }\r\n                }\r\n                @keyframes float {\r\n                    0% { transform: rotate(0deg) scale(1) translate(0, 0); }\r\n                    33% { transform: rotate(120deg) scale(1.1) translate(20px, -20px); }\r\n                    66% { transform: rotate(240deg) scale(0.9) translate(-20px, 20px); }\r\n                    100% { transform: rotate(360deg) scale(1) translate(0, 0); }\r\n                }\r\n                @keyframes float-rev {\r\n                    0% { transform: rotate(0deg) scale(1.1) translate(0, 0); }\r\n                    50% { transform: rotate(-180deg) scale(0.9) translate(30px, 30px); }\r\n                    100% { transform: rotate(-360deg) scale(1.1) translate(0, 0); }\r\n                }\r\n\r\n                .breathing-circle.animate { animation: breathe 8s infinite ease-in-out; }\r\n                .breathing-circle-inner.animate-inner { animation: breathe-inner 8s infinite ease-in-out; }\r\n                .floating-circle.animate-float { animation: float 20s infinite linear; }\r\n                .floating-circle-rev.animate-float-rev { animation: float-rev 25s infinite linear; }\r\n                .paused { animation-play-state: paused !important; }\r\n                @keyframes fadeIn {\r\n                    from { opacity: 0; transform: translateY(10px); }\r\n                    to { opacity: 1; transform: translateY(0); }\r\n                }\r\n            `}</style>\r\n        </div>\r\n    );\r\n};\r\n\r\n\r\n\r\nexport default MeditationPage;\r\n"],"file":"MeditationPage-C3pt8ShF-v7.js"}