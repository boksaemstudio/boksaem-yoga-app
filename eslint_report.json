[{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\analyze_afternoon.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\audit_deep_dive.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\check_8745.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\check_attendance.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\check_class_attendance.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\check_daily_classes.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\check_db_schema.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\check_errors.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\check_functions_execution.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\check_history.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\check_hyowon_login.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\check_last_attendance.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\check_leesooyeon.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\check_login_failures.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\check_member.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\check_member_attendance.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\check_member_seo.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\check_pending.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\check_push_issue.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\check_recent_attendance.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\check_recent_members.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\check_sales_duplicate.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\check_song_daemin.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\check_sync_mode.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\check_today_all.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\check_today_attendance.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\check_today_attendance.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\check_today_attendance_placeholder.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\check_tokens.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\check_user_token.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\check_user_v2.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\check_user_v3.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\cleanup_invalid_tokens.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\daily_audit_runner.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\daily_audit_script.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\debug_attendance_data.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\debug_dasol.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\debug_dasol_admin.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\debug_dasol_admin_v2.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\debug_data_v2.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\debug_data_v3.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\debug_index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\debug_member_4569.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\debug_push_notifications.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\debug_sales.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\debug_schedule.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\debug_schedule.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\debug_selfpractice.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\debug_system_wide.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\debug_system_wide_v2.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\debug_tokens.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\deep_investigate_attendance.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\delete_sales_doc.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\eslint.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\fetch_full_daily.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\find_recent_duplicates.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\fix_7073_token.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\fix_afternoon_bulk.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\fix_attendance_data.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\fix_duplicate_attendance.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\fix_sales_date.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\full_system_audit.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\check_all_logs.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\check_error_logs.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\check_jungeun.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\check_kimhyeryeon.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\check_lang.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\check_leesooyeon_admin.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\check_logs.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\check_notice.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\check_recent_messages.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\check_song_msg.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\debug_capabilities.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\delete_logs.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\final_fix.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\fix_and_inspect.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\fix_goya.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\fix_hwang.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\fix_leesooyeon.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\fix_missing_status.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\helpers\\common.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\inspect_attendance.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\list_collections.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\list_voices.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\modules\\ai.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\modules\\attendance.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\modules\\meditation.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\modules\\member.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\modules\\push.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\modules\\scheduled.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\modules\\solapi.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\revert_branch.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\analyze_csv_duplicates.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\analyze_mapo.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\audit_morning.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\audit_today_credits.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\check_ai_stats.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\check_attendance_integrity.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\check_attendance_undesignated.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\check_cleanup_status.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\check_config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\check_daily_classes.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\check_daily_classes_raw.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\check_duplicates.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\check_error_logs.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\check_feb15.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\check_firestore_errors.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\check_hwang.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\check_instructor_token.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\check_integrity.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\check_member_history.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\check_moon_branch.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\check_pending.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\check_performance.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\check_raw.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\check_sales_data.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\check_schedule.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\check_system_logs.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\check_template.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\check_today_attendance_details.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\check_today_sync.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\check_undesignated.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\cleanup_fcm.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\cleanup_test_members.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\daily_audit.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\daily_audit_check.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\daily_audit_data.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\daily_audit_report.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\debug_instructor_att.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\debug_pending_details.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\debug_recent_attendance.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\debug_selfpractice.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\deep_inspect_daily_classes.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\diagnose_schedule.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\finalize_audit.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\find_duplicate_members.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\find_member.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\find_member_2789.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\find_missing_enddate.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\fix_and_check_schedule.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\fix_attendance.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\fix_duplicates.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\fix_dynamic.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\fix_gwangheung.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\fix_hwang.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\fix_moon.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\fix_sales_branch.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\fix_self_practice.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\fix_selfpractice.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\fix_startdate.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\fix_yerin.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\generate_checkin_audio.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\get_detailed_attendance.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\get_mysore_attendance.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\global_audit.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\init_config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\inspect_daily_classes.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\inspect_structure.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\investigate_pending.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\list_admins.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\list_users.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\manual_batch_process.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\manual_process_pending.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\normalize_morning.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\production_cleanup.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\reproduce_checkin.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\scan_historical_attendance.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\scan_historical_simple.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\set_admin_claim.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\simulate_matching.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\summarize_attendance.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\system_cleanup.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\test_audio_model.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\test_offline_sync.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\test_schema_validation.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\verify_ai_meditation.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\verify_attendance.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\verify_index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\verify_matching_actual.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\scripts\\verify_query_no_order.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\simple_fix.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\temp_v2.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\test_models.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\test_trigger.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\tests\\logic_test_manual_attendance.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\tests\\logic_test_multisession.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\tests\\read_ai_logs.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\tests\\simulation_runner.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\tests\\syntax_check.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\tests\\syntax_check_v2.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\tests\\test_ai_json_robustness.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\tests\\test_ai_parsing.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\tests\\test_chat_flow.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\tests\\test_gemini3_meditation.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\tests\\test_pose_feedback.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\tests\\verify_turns.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\utils\\ai.js","messages":[],"suppressedMessages":[{"ruleId":"no-control-regex","severity":2,"message":"Unexpected control character(s) in regular expression: \\x00, \\x08, \\x0b, \\x0c, \\x0e, \\x1f.","line":48,"column":35,"nodeType":"Literal","messageId":"unexpected","endLine":48,"endColumn":66,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\functions\\verify_ai_simple.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\inspect_data.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\list-all-models.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\list-models.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\list_collections.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\public\\firebase-messaging-sw.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\reproduce_issue.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\revert_attendance_fix.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\run_audit.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\scripts\\adjust_credits.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\scripts\\admin_audit.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\scripts\\analyze_lee_logs.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\scripts\\audit-data.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\scripts\\browser_check_errors.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\scripts\\check_attendance_today.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\scripts\\check_attendance_v2.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\scripts\\check_db_size.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\scripts\\check_error_logs.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\scripts\\check_fix_lee.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\scripts\\check_logs_today.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\scripts\\check_member_phones.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\scripts\\check_notices.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\scripts\\check_shin_attendance.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\scripts\\check_times.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\scripts\\check_user.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\scripts\\check_user_placeholder.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\scripts\\count_lines.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\scripts\\debug_duplicates.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\scripts\\fix-data.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\scripts\\import_schedules.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\scripts\\init_settings.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\scripts\\run_simulation.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\scripts\\run_simulation_admin.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\scripts\\setup_schedules.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\scripts\\simulate_month.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\scripts\\test_gemini_model.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\scripts\\test_stress_simulation.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\scripts\\update_members_from_csv.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\scripts\\upload_to_firestore.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\scripts\\verify_assets.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\scripts\\verify_checkin.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\scripts\\verify_data.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\scripts\\verify_lee.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\scripts\\verify_notices.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\simulate_match.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\simulate_offline_sync.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\App.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\AdminInsights.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\AdminMemberDetailModal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\AdminPriceManager.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\AdminRevenue.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\AdminScheduleManager.jsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadMonthlyData'. Either include it or remove the dependency array.","line":76,"column":8,"nodeType":"ArrayExpression","endLine":76,"endColumn":31,"suggestions":[{"desc":"Update the dependencies array to be: [branchId, year, month, loadMonthlyData]","fix":{"range":[3911,3934],"text":"[branchId, year, month, loadMonthlyData]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\CommonIcons.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\ErrorBoundary.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\InstallGuideModal.jsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n   8 |         const ua = window.navigator.userAgent.toLowerCase();\n   9 |         if (/iphone|ipad|ipod|macintosh/.test(ua) && 'ontouchend' in document) {\n> 10 |             setTab('ios');\n     |             ^^^^^^ Avoid calling setState() directly within an effect\n  11 |         } else {\n  12 |             setTab('android');\n  13 |         }","line":10,"column":13,"nodeType":null,"endLine":10,"endColumn":19}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { X, Share, DotsThreeVertical, PlusSquare, ArrowRight, Monitor, Devices } from '@phosphor-icons/react';\r\n\r\nconst InstallGuideModal = ({ isOpen, onClose }) => {\r\n    const [tab, setTab] = useState('android'); // 'android' or 'ios'\r\n\r\n    useEffect(() => {\r\n        const ua = window.navigator.userAgent.toLowerCase();\r\n        if (/iphone|ipad|ipod|macintosh/.test(ua) && 'ontouchend' in document) {\r\n            setTab('ios');\r\n        } else {\r\n            setTab('android');\r\n        }\r\n    }, [isOpen]);\r\n\r\n    if (!isOpen) return null;\r\n\r\n    return (\r\n        <div\r\n            className=\"modal-overlay\"\r\n            onClick={() => {\r\n                // Background click does nothing\r\n            }}\r\n            style={{ zIndex: 3000, background: 'rgba(0,0,0,0.92)', touchAction: 'none' }}\r\n        >\r\n            <div\r\n                className=\"modal-content glass-panel\"\r\n                onClick={e => e.stopPropagation()}\r\n                onTouchStart={e => e.stopPropagation()}\r\n                style={{\r\n                    width: '90%',\r\n                    maxWidth: '1200px',\r\n                    height: 'auto',\r\n                    minHeight: '70vh',\r\n                    padding: '0',\r\n                    display: 'flex',\r\n                    flexDirection: 'column',\r\n                    overflow: 'hidden',\r\n                    borderRadius: '40px',\r\n                    border: '1px solid rgba(255, 215, 0, 0.3)',\r\n                    boxShadow: '0 50px 100px rgba(0,0,0,0.8)'\r\n                }}\r\n            >\r\n                {/* Header */}\r\n                <div style={{\r\n                    padding: '20px 40px',\r\n                    borderBottom: '1px solid rgba(255,255,255,0.1)',\r\n                    display: 'flex',\r\n                    justifyContent: 'space-between',\r\n                    alignItems: 'center',\r\n                    background: 'linear-gradient(to right, rgba(0,0,0,0.3), transparent)'\r\n                }}>\r\n                    <div>\r\n                        <h2 style={{ fontSize: '2.4rem', margin: 0, color: 'var(--primary-gold)', fontWeight: 900, letterSpacing: '-0.5px' }}>\r\n                              \r\n                        </h2>\r\n                        <p style={{ margin: '5px 0 0', fontSize: '1.2rem', color: 'rgba(255,255,255,0.6)' }}>\r\n                                  .\r\n                        </p>\r\n                    </div>\r\n                    <div style={{ display: 'flex', gap: '15px' }}>\r\n                        <button onClick={onClose} style={{ padding: '10px', color: 'rgba(255,255,255,0.5)', transition: '0.2s' }} className=\"hover-bright\">\r\n                            <X size={32} weight=\"bold\" />\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Tabs */}\r\n                <div style={{ display: 'flex', background: 'rgba(255,255,255,0.03)' }}>\r\n                    <button\r\n                        onClick={() => setTab('android')}\r\n                        style={{\r\n                            flex: 1,\r\n                            padding: '15px',\r\n                            fontSize: '1.5rem',\r\n                            fontWeight: 800,\r\n                            background: tab === 'android' ? 'rgba(164, 198, 57, 0.1)' : 'transparent',\r\n                            color: tab === 'android' ? '#a4c639' : 'rgba(255,255,255,0.4)',\r\n                            borderBottom: tab === 'android' ? '4px solid #a4c639' : 'none',\r\n                            transition: 'all 0.3s ease',\r\n                            display: 'flex',\r\n                            alignItems: 'center',\r\n                            justifyContent: 'center',\r\n                            gap: '12px'\r\n                        }}\r\n                    >\r\n                        <Devices size={24} />   / \r\n                    </button>\r\n                    <button\r\n                        onClick={() => setTab('ios')}\r\n                        style={{\r\n                            flex: 1,\r\n                            padding: '15px',\r\n                            fontSize: '1.5rem',\r\n                            fontWeight: 800,\r\n                            background: tab === 'ios' ? 'rgba(0, 122, 255, 0.1)' : 'transparent',\r\n                            color: tab === 'ios' ? '#007aff' : 'rgba(255,255,255,0.4)',\r\n                            borderBottom: tab === 'ios' ? '4px solid #007aff' : 'none',\r\n                            transition: 'all 0.3s ease',\r\n                            display: 'flex',\r\n                            alignItems: 'center',\r\n                            justifyContent: 'center',\r\n                            gap: '12px'\r\n                        }}\r\n                    >\r\n                        <Monitor size={24} />  / iPad (iOS)\r\n                    </button>\r\n                </div>\r\n\r\n                {/* Content */}\r\n                <div style={{ flex: 1, padding: '30px 40px' }}>\r\n                    {tab === 'android' ? <AndroidGuide /> : <IOSGuide />}\r\n                </div>\r\n\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nconst StepItem = ({ number, icon, text, subtext, isLast }) => (\r\n    <div style={{\r\n        flex: 1,\r\n        display: 'flex',\r\n        flexDirection: 'column',\r\n        alignItems: 'center',\r\n        textAlign: 'center',\r\n        position: 'relative'\r\n    }}>\r\n        <div style={{\r\n            width: '70px',\r\n            height: '70px',\r\n            borderRadius: '24px',\r\n            background: 'rgba(255,255,255,0.08)',\r\n            border: '1px solid rgba(255,255,255,0.1)',\r\n            display: 'flex',\r\n            justifyContent: 'center',\r\n            alignItems: 'center',\r\n            marginBottom: '20px',\r\n            color: 'var(--primary-gold)',\r\n            position: 'relative',\r\n            boxShadow: '0 10px 20px rgba(0,0,0,0.3)'\r\n        }}>\r\n            <div style={{\r\n                position: 'absolute',\r\n                top: '-10px',\r\n                left: '-10px',\r\n                width: '30px',\r\n                height: '30px',\r\n                background: 'var(--primary-gold)',\r\n                color: 'black',\r\n                borderRadius: '50%',\r\n                display: 'flex',\r\n                justifyContent: 'center',\r\n                alignItems: 'center',\r\n                fontSize: '1.2rem',\r\n                fontWeight: 900,\r\n                boxShadow: '0 5px 10px rgba(0,0,0,0.5)'\r\n            }}>\r\n                {number}\r\n            </div>\r\n            {React.cloneElement(icon, { size: 36 })}\r\n        </div>\r\n\r\n        <div style={{ padding: '0 10px' }}>\r\n            <h4 style={{ fontSize: '2rem', fontWeight: 800, color: 'white', marginBottom: '15px', wordBreak: 'keep-all', lineHeight: 1.3 }}>\r\n                {text}\r\n            </h4>\r\n            <p style={{ fontSize: '1.4rem', color: 'rgba(255,255,255,0.5)', margin: 0, wordBreak: 'keep-all', lineHeight: 1.5 }}>\r\n                {subtext}\r\n            </p>\r\n        </div>\r\n\r\n        {!isLast && (\r\n            <div style={{\r\n                position: 'absolute',\r\n                right: '-15%',\r\n                top: '50px',\r\n                color: 'rgba(255,255,255,0.1)',\r\n                display: 'flex',\r\n                alignItems: 'center'\r\n            }}>\r\n                <ArrowRight size={40} weight=\"bold\" />\r\n            </div>\r\n        )}\r\n    </div>\r\n);\r\n\r\nconst AndroidGuide = () => (\r\n    <div className=\"guide-ani-fade\">\r\n        <div style={{ display: 'flex', justifyContent: 'space-between', gap: '30px', width: '100%' }}>\r\n            <StepItem\r\n                number=\"1\"\r\n                icon={<DotsThreeVertical size={50} weight=\"bold\" />}\r\n                text=\"  \"\r\n                subtext=\"   ' 3'  ''  .\"\r\n            />\r\n            <StepItem\r\n                number=\"2\"\r\n                icon={<PlusSquare size={50} weight=\"bold\" />}\r\n                text=\"  \"\r\n                subtext=\"'  '  ' '   .\"\r\n            />\r\n            <StepItem\r\n                number=\"3\"\r\n                icon={<span style={{ fontSize: '2.4rem', fontWeight: 900 }}></span>}\r\n                text=\" \"\r\n                subtext=\" ''    .\"\r\n                isLast={true}\r\n            />\r\n        </div>\r\n    </div>\r\n);\r\n\r\nconst IOSGuide = () => (\r\n    <div className=\"guide-ani-fade\">\r\n        <div style={{ display: 'flex', justifyContent: 'space-between', gap: '30px', width: '100%' }}>\r\n            <StepItem\r\n                number=\"1\"\r\n                icon={<Share size={50} weight=\"bold\" />}\r\n                text=\"  \"\r\n                subtext=\"   '' ( )  .\"\r\n            />\r\n            <StepItem\r\n                number=\"2\"\r\n                icon={<PlusSquare size={50} weight=\"bold\" />}\r\n                text=\"  \"\r\n                subtext=\"   '  ' .\"\r\n            />\r\n            <StepItem\r\n                number=\"3\"\r\n                icon={<span style={{ fontSize: '2.4rem', fontWeight: 900 }}></span>}\r\n                text=\" \"\r\n                subtext=\"  ''   .\"\r\n                isLast={true}\r\n            />\r\n        </div>\r\n    </div>\r\n);\r\n\r\nexport default InstallGuideModal;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\InstructorQRModal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\InteractiveParticles.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\Keypad.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\LanguageSelector.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\MemberScheduleCalendar.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\ReloadPrompt.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\ScheduleHelpers.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\admin\\charts\\AdminCharts.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\admin\\member-detail\\AttendanceTab.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\admin\\member-detail\\MessagesTab.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":34,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":34,"endColumn":27},{"ruleId":"no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":258,"column":45,"nodeType":"Identifier","messageId":"unusedVar","endLine":258,"endColumn":46}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useRef } from 'react';\r\n\r\nimport { storageService } from '../../../services/storage';\r\nimport { onSnapshot, collection, query, where, orderBy, limit as firestoreLimit, getDocs } from 'firebase/firestore';\r\nimport { db } from '../../../firebase';\r\nimport { STUDIO_CONFIG } from '../../../studioConfig';\r\nimport { Info, Copy } from '@phosphor-icons/react';\r\n\r\nconst MessagesTab = ({ memberId }) => {\r\n    const [message, setMessage] = useState('');\r\n    const [sending, setSending] = useState(false);\r\n    const [history, setHistory] = useState([]);\r\n    const [msgLimit, setMsgLimit] = useState(10);\r\n    const [notices, setNotices] = useState([]);\r\n    \r\n    // [NEW] Scheduled Sending State\r\n    const [isScheduled, setIsScheduled] = useState(false);\r\n    const [scheduledTime, setScheduledTime] = useState('');\r\n    const [selectedTemplateId, setSelectedTemplateId] = useState('');\r\n    const scheduleInputRef = useRef(null);\r\n\r\n    // [Solapi] AlimTalk Templates\r\n    const alimTalkTemplates = STUDIO_CONFIG.ALIMTALK_TEMPLATES || [];\r\n    const selectedTemplate = alimTalkTemplates.find(t => t.id === selectedTemplateId);\r\n\r\n    // [UX] Auto-open picker when scheduled is checked\r\n    const handleScheduleToggle = (e) => {\r\n        const checked = e.target.checked;\r\n        setIsScheduled(checked);\r\n        if (checked) {\r\n            setTimeout(() => {\r\n                try {\r\n                    if (scheduleInputRef.current) scheduleInputRef.current.showPicker();\r\n                } catch (e) {\r\n                    // ignore\r\n                }\r\n            }, 100);\r\n        }\r\n    };\r\n\r\n    const handleTemplateSelect = (e) => {\r\n        const id = e.target.value;\r\n        setSelectedTemplateId(id);\r\n    };\r\n\r\n    const handleCopyTemplate = () => {\r\n        if (selectedTemplate && selectedTemplate.content) {\r\n            setMessage(selectedTemplate.content);\r\n        }\r\n    };\r\n\r\n    // [REAL-TIME] Individual Message History Listener\r\n    useEffect(() => {\r\n        if (!memberId) return;\r\n\r\n        console.log(`[MessagesTab] Subscribing to messages for member: ${memberId}`);\r\n        const q = query(\r\n            collection(db, 'messages'),\r\n            where(\"memberId\", \"==\", memberId),\r\n            orderBy(\"timestamp\", \"desc\"),\r\n            firestoreLimit(msgLimit)\r\n        );\r\n\r\n        const unsub = onSnapshot(q, (snap) => {\r\n            const logs = snap.docs.map(doc => ({ id: doc.id, ...doc.data(), type: 'individual' }));\r\n            // [FIX] Sort client-side\r\n            logs.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));\r\n            setHistory(logs);\r\n        }, (err) => {\r\n            console.error(\"[MessagesTab] History listener error:\", err);\r\n        });\r\n\r\n        return () => unsub();\r\n    }, [memberId, msgLimit]);\r\n\r\n    // [NEW] Load Notice/Campaign Push History\r\n    useEffect(() => {\r\n        const loadNotices = async () => {\r\n            try {\r\n                const q = query(\r\n                    collection(db, 'push_history'),\r\n                    where('type', 'in', ['campaign', 'notice']),\r\n                    orderBy('createdAt', 'desc'),\r\n                    firestoreLimit(20)\r\n                );\r\n                const snapshot = await getDocs(q);\r\n                const noticeList = snapshot.docs.map(doc => ({\r\n                    id: doc.id,\r\n                    ...doc.data(),\r\n                    type: 'notice',\r\n                    timestamp: doc.data().createdAt?.toDate()?.toISOString() || new Date().toISOString()\r\n                }));\r\n                setNotices(noticeList);\r\n            } catch (err) {\r\n                console.error('[MessagesTab] Failed to load notices:', err);\r\n            }\r\n        };\r\n        loadNotices();\r\n    }, []);\r\n\r\n    const handleSend = async () => {\r\n        if (!message.trim() || !memberId) return;\r\n        \r\n        let method = selectedTemplateId ? '' : '(LMS)';\r\n        let confirmMsg = `  ?   ${method} .`;\r\n        if (isScheduled) {\r\n            if (!scheduledTime) {\r\n                alert('  .');\r\n                return;\r\n            }\r\n            const scheduledDate = new Date(scheduledTime);\r\n            if (scheduledDate <= new Date()) {\r\n                alert('     .');\r\n                return;\r\n            }\r\n            confirmMsg = ` ?\\n : ${scheduledDate.toLocaleString()}`;\r\n        }\r\n\r\n        if (!confirm(confirmMsg)) return;\r\n\r\n        setSending(true);\r\n        try {\r\n            await storageService.addMessage(\r\n                memberId, \r\n                message, \r\n                isScheduled ? new Date(scheduledTime).toISOString() : null,\r\n                selectedTemplateId\r\n            );\r\n            setMessage('');\r\n            setIsScheduled(false);\r\n            setScheduledTime('');\r\n            setSelectedTemplateId('');\r\n            if (isScheduled) alert(' .');\r\n        } catch (error) {\r\n            console.error(\"Message send failed:\", error);\r\n            alert(' .   .');\r\n        } finally {\r\n            setSending(false);\r\n        }\r\n    };\r\n\r\n    const templates = [\r\n        \",  .  ! \",\r\n        \"!    .\",\r\n        \"!   \",\r\n        \" 7 .\"\r\n    ];\r\n\r\n    return (\r\n        <div className=\"fade-in\" style={{ display: 'flex', flexDirection: 'column', height: '100%' }}>\r\n            {/* Input Area */}\r\n            <div style={{ background: 'rgba(255,255,255,0.05)', padding: '15px', borderRadius: '12px', marginBottom: '20px' }}>\r\n                \r\n                {/* [Solapi] Template Selection */}\r\n                <div style={{ marginBottom: '12px' }}>\r\n                    <label style={{ display: 'block', marginBottom: '6px', fontSize: '0.8rem', color: '#a1a1aa' }}>  (/)</label>\r\n                    <select\r\n                        value={selectedTemplateId}\r\n                        onChange={handleTemplateSelect}\r\n                        style={{\r\n                            width: '100%', padding: '8px', borderRadius: '8px',\r\n                            background: 'rgba(255,255,255,0.08)', border: '1px solid rgba(255,255,255,0.1)',\r\n                            color: 'white', outline: 'none', cursor: 'pointer', fontSize: '0.9rem'\r\n                        }}\r\n                    >\r\n                        {alimTalkTemplates.map(t => (\r\n                            <option key={t.id} value={t.id} style={{ background: '#1d1d2b' }}>\r\n                                {t.name}\r\n                            </option>\r\n                        ))}\r\n                    </select>\r\n\r\n                    {/* [NEW] AlimTalk Template Preview */}\r\n                    {selectedTemplateId && selectedTemplate && (\r\n                        <div style={{ \r\n                            marginTop: '12px', padding: '12px', \r\n                            background: 'rgba(212, 175, 55, 0.05)', \r\n                            borderRadius: '8px', border: '1px dashed rgba(212, 175, 55, 0.3)' \r\n                        }}>\r\n                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '8px' }}>\r\n                                <div style={{ display: 'flex', alignItems: 'center', gap: '6px', fontSize: '0.75rem', color: 'var(--primary-gold)' }}>\r\n                                    <Info size={14} />   \r\n                                </div>\r\n                                <button \r\n                                    onClick={handleCopyTemplate}\r\n                                    style={{ \r\n                                        background: 'rgba(212, 175, 55, 0.2)', color: 'white', \r\n                                        border: 'none', borderRadius: '4px', padding: '4px 8px', \r\n                                        fontSize: '0.7rem', cursor: 'pointer', display: 'flex', alignItems: 'center', gap: '4px' \r\n                                    }}\r\n                                >\r\n                                    <Copy size={12} />  \r\n                                </button>\r\n                            </div>\r\n                            <div style={{ fontSize: '0.85rem', color: '#e4e4e7', lineHeight: '1.4', wordBreak: 'break-all' }}>\r\n                                {selectedTemplate.content}\r\n                            </div>\r\n                            <div style={{ marginTop: '8px', fontSize: '0.7rem', color: '#a1a1aa' }}>\r\n                                *     .    .\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                <textarea\r\n                    value={message}\r\n                    onChange={e => setMessage(e.target.value)}\r\n                    placeholder={selectedTemplateId ? \"    .\" : \"   ...\"}\r\n                    style={{\r\n                        width: '100%', height: '80px', background: 'transparent', border: 'none',\r\n                        color: 'white', fontSize: '1rem', resize: 'none', outline: 'none'\r\n                    }}\r\n                />\r\n                \r\n                {/* [NEW] Cost Estimation */}\r\n                <div style={{ display: 'flex', justifyContent: 'flex-end', fontSize: '0.8rem', color: '#a1a1aa', borderBottom: '1px solid rgba(255,255,255,0.1)', paddingBottom: '8px', marginBottom: '8px' }}>\r\n                    {(() => {\r\n                        // Simple byte calculation (Korean ~2bytes, English 1byte)\r\n                        // Solapi/LMS standard: SMS <= 90 bytes, LMS > 90 bytes\r\n                        let bytes = 0;\r\n                        for (let i = 0; i < message.length; i++) {\r\n                            const code = message.charCodeAt(i);\r\n                            bytes += (code >> 7) ? 2 : 1;\r\n                        }\r\n                        const isLMS = bytes > 90;\r\n                        const cost = selectedTemplateId ? 15 : (isLMS ? 45 : 18); // Approx rates\r\n                        return (\r\n                            <span style={{ color: selectedTemplateId ? 'var(--primary-gold)' : (isLMS ? '#f59e0b' : '#10b981') }}>\r\n                                {bytes} bytes ({selectedTemplateId ? '' : (isLMS ? 'LMS' : 'SMS')})   :  {cost}\r\n                            </span>\r\n                        );\r\n                    })()}\r\n                </div>\r\n\r\n                {/* [NEW] Scheduling UI */}\r\n                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginTop: '0px' }}>\r\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n                        <input \r\n                            type=\"checkbox\" \r\n                            id=\"scheduleCheck\" \r\n                            checked={isScheduled} \r\n                            onChange={handleScheduleToggle}\r\n                            style={{ accentColor: 'var(--primary-gold)', width: '16px', height: '16px', cursor: 'pointer' }}\r\n                        />\r\n                        <label htmlFor=\"scheduleCheck\" style={{ color: '#e4e4e7', fontSize: '0.9rem', cursor: 'pointer', display: 'flex', alignItems: 'center' }}>\r\n                              \r\n                        </label>\r\n                        \r\n                        {isScheduled && (\r\n                            <input \r\n                                ref={scheduleInputRef}\r\n                                type=\"datetime-local\" \r\n                                value={scheduledTime}\r\n                                onChange={e => setScheduledTime(e.target.value)}\r\n                                onClick={() => {\r\n                                    try {\r\n                                        if(scheduleInputRef.current) scheduleInputRef.current.showPicker();\r\n                                    } catch(e) {\r\n                                        // ignore\r\n                                    }\r\n                                }}\r\n                                style={{ \r\n                                    background: 'rgba(0,0,0,0.3)', \r\n                                    border: '1px solid rgba(255,255,255,0.2)', \r\n                                    borderRadius: '6px', \r\n                                    padding: '4px 8px', \r\n                                    color: 'white', \r\n                                    marginLeft: '8px',\r\n                                    fontSize: '0.9rem',\r\n                                    cursor: 'pointer'\r\n                                }}\r\n                            />\r\n                        )}\r\n                    </div>\r\n                \r\n                    <button\r\n                        onClick={handleSend}\r\n                        disabled={sending || !message.trim()}\r\n                        style={{\r\n                            background: sending ? '#52525b' : 'var(--primary-gold)',\r\n                            color: sending ? '#d4d4d8' : 'black',\r\n                            border: 'none', borderRadius: '8px', padding: '8px 20px',\r\n                            fontWeight: 'bold', cursor: sending ? 'wait' : 'pointer'\r\n                        }}\r\n                    >\r\n                        {sending ? ' ...' : (isScheduled ? ' ' : ' ')}\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Templates */}\r\n            <div style={{ marginBottom: '25px' }}>\r\n                <p style={{ color: '#a1a1aa', fontSize: '0.85rem', marginBottom: '8px' }}>   (  )</p>\r\n                <div style={{ display: 'flex', flexWrap: 'wrap', gap: '8px' }}>\r\n                    {templates.map((t, i) => (\r\n                        <button\r\n                            key={i}\r\n                            onClick={() => setMessage(t)}\r\n                            style={{\r\n                                background: 'rgba(255,255,255,0.1)', border: '1px solid rgba(255,255,255,0.1)',\r\n                                borderRadius: '20px', padding: '8px 12px', color: '#e4e4e7', fontSize: '0.85rem',\r\n                                cursor: 'pointer', textAlign: 'left'\r\n                            }}\r\n                        >\r\n                            {t}\r\n                        </button>\r\n                    ))}\r\n                </div>\r\n            </div>\r\n\r\n            {/* History */}\r\n            <div style={{ flex: 1, overflowY: 'auto' }}>\r\n                <h4 style={{ color: 'var(--primary-gold)', fontSize: '0.95rem', marginBottom: '10px' }}>  ( + )</h4>\r\n                {(() => {\r\n                    // Merge and sort messages and notices\r\n                    const combined = [...history, ...notices];\r\n                    combined.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));\r\n                    return combined.length === 0 ? (\r\n                        <p style={{ color: '#52525b', textAlign: 'center', marginTop: '20px', fontSize: '0.9rem' }}>  .</p>\r\n                    ) : (\r\n                        <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\r\n                            {combined.map(log => (\r\n                                <div key={log.id} style={{ \r\n                                    background: log.type === 'notice' ? 'rgba(212, 175, 55, 0.1)' : 'rgba(0,0,0,0.3)', \r\n                                    padding: '12px', \r\n                                    borderRadius: '8px',\r\n                                    border: log.type === 'notice' ? '1px solid rgba(212, 175, 55, 0.2)' : 'none'\r\n                                }}>\r\n                                    <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '5px', alignItems: 'center' }}>\r\n                                        <div style={{ display: 'flex', gap: '8px', alignItems: 'center' }}>\r\n                                            <span style={{ \r\n                                                fontSize: '0.7rem', \r\n                                                color: log.type === 'notice' ? 'var(--primary-gold)' : '#3B82F6',\r\n                                                fontWeight: '700',\r\n                                                padding: '2px 6px',\r\n                                                background: log.type === 'notice' ? 'rgba(212, 175, 55, 0.15)' : 'rgba(59, 130, 246, 0.15)',\r\n                                                borderRadius: '4px'\r\n                                            }}>\r\n                                                {log.type === 'notice' ? '' : ''}\r\n                                            </span>\r\n                                            <span style={{ fontSize: '0.8rem', color: '#a1a1aa' }}>\r\n                                                {log.timestamp ? new Date(log.timestamp).toLocaleString() : ' ...'}\r\n                                            </span>\r\n                                        </div>\r\n                                        {log.type === 'individual' && (\r\n                                            log.pushStatus?.sent ? (\r\n                                                <span style={{ fontSize: '0.8rem', color: '#10b981' }}>  </span>\r\n                                            ) : (\r\n                                                <span style={{ fontSize: '0.8rem', color: '#f59e0b' }}> </span>\r\n                                            )\r\n                                        )}\r\n                                    </div>\r\n                                    <div style={{ color: 'white', fontSize: '0.9rem' }}>{log.content || log.body}</div>\r\n                                </div>\r\n                            ))}\r\n\r\n                            {/* Pagination: Load More */}\r\n                            {history.length >= msgLimit && (\r\n                                <button\r\n                                    onClick={() => setMsgLimit(prev => prev + 10)}\r\n                                    style={{\r\n                                        width: '100%',\r\n                                        padding: '10px',\r\n                                        background: 'rgba(255,255,255,0.05)',\r\n                                        color: '#a1a1aa',\r\n                                        border: '1px dashed rgba(255,255,255,0.2)',\r\n                                        borderRadius: '8px',\r\n                                        marginTop: '5px',\r\n                                        cursor: 'pointer',\r\n                                        fontSize: '0.85rem'\r\n                                    }}\r\n                                >\r\n                                        (10 )\r\n                                </button>\r\n                            )}\r\n                        </div>\r\n                    );\r\n                })()}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default MessagesTab;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\admin\\member-detail\\RegistrationTab.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\admin\\member-detail\\SalesHistoryTab.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchHistory'. Either include it or remove the dependency array.","line":43,"column":8,"nodeType":"ArrayExpression","endLine":43,"endColumn":18,"suggestions":[{"desc":"Update the dependencies array to be: [fetchHistory, memberId]","fix":{"range":[1365,1375],"text":"[fetchHistory, memberId]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { ClockCounterClockwise, Trash } from '@phosphor-icons/react';\r\nimport { storageService } from '../../../services/storage';\r\n\r\n// [FIX]     \r\nconst MEMBERSHIP_TYPE_LABELS = {\r\n    'general': '',\r\n    'advanced': '',\r\n    'kids': '',\r\n    'pregnant': '',\r\n    'saturday': '',\r\n};\r\n\r\nconst getMembershipLabel = (type) => {\r\n    if (!type) return '';\r\n    return MEMBERSHIP_TYPE_LABELS[type] || type;\r\n};\r\n\r\nconst SalesHistoryTab = ({ memberId, member }) => {\r\n    const [history, setHistory] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [deleting, setDeleting] = useState(null);\r\n\r\n    const fetchHistory = async () => {\r\n        try {\r\n            setLoading(true);\r\n            const data = await storageService.getSalesHistory(memberId);\r\n            const sorted = [...data].sort((a, b) => {\r\n                const timeA = new Date(a.timestamp || a.date).getTime();\r\n                const timeB = new Date(b.timestamp || b.date).getTime();\r\n                return timeB - timeA;\r\n            });\r\n            setHistory(sorted);\r\n        } catch (e) {\r\n            console.error('Failed to fetch sales history:', e);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        fetchHistory();\r\n    }, [memberId]);\r\n\r\n    const handleDelete = async (salesId, itemName) => {\r\n        if (!confirm(`\"${itemName}\"   ?\\n\\n     .`)) return;\r\n\r\n        try {\r\n            setDeleting(salesId);\r\n            await storageService.deleteSalesRecord(salesId);\r\n            //   \r\n            setHistory(prev => prev.filter(h => h.id !== salesId));\r\n        } catch (e) {\r\n            alert('   : ' + e.message);\r\n        } finally {\r\n            setDeleting(null);\r\n        }\r\n    };\r\n\r\n    // Derived active membership info\r\n    const isActive = member && member.endDate && new Date(member.endDate) >= new Date();\r\n    const isExpired = member && member.endDate && new Date(member.endDate) < new Date();\r\n\r\n    if (loading) {\r\n        return (\r\n            <div style={{ textAlign: 'center', padding: '40px', color: '#52525b' }}>\r\n                <p> ...</p>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div>\r\n            {/* 1. Current Membership Status */}\r\n            {member && (\r\n                <div style={{ marginBottom: '20px' }}>\r\n                    <h4 style={{ color: 'var(--text-secondary)', fontSize: '0.9rem', marginBottom: '10px' }}>  </h4>\r\n                    <div style={{\r\n                        background: 'linear-gradient(135deg, rgba(212,175,55,0.1) 0%, rgba(0,0,0,0) 100%)',\r\n                        padding: '15px',\r\n                        borderRadius: '10px',\r\n                        border: '1px solid var(--primary-gold)'\r\n                    }}>\r\n                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '12px' }}>\r\n                            <div style={{ display: 'flex', flexDirection: 'column' }}>\r\n                                <span style={{ color: 'var(--primary-gold)', fontWeight: 'bold', fontSize: '1.2rem' }}>\r\n                                    {getMembershipLabel(member.membershipType)}\r\n                                </span>\r\n                                <span style={{ fontSize: '0.85rem', color: 'rgba(255,255,255,0.7)' }}>\r\n                                    {member.subject || getMembershipLabel(member.membershipType)}\r\n                                </span>\r\n                            </div>\r\n                            <span style={{\r\n                                color: isActive ? '#10b981' : (isExpired ? '#ef4444' : '#a1a1aa'),\r\n                                fontWeight: 'bold',\r\n                                fontSize: '0.9rem',\r\n                                padding: '4px 10px',\r\n                                background: isActive ? 'rgba(16,185,129,0.1)' : (isExpired ? 'rgba(239,68,68,0.1)' : 'rgba(255,255,255,0.05)'),\r\n                                borderRadius: '12px',\r\n                                border: `1px solid ${isActive ? 'rgba(16,185,129,0.2)' : (isExpired ? 'rgba(239,68,68,0.2)' : 'rgba(255,255,255,0.1)')}`\r\n                            }}>\r\n                                {isActive ? ' ' : (isExpired ? '' : '')}\r\n                            </span>\r\n                        </div>\r\n\r\n                        <div style={{\r\n                            display: 'grid',\r\n                            gridTemplateColumns: '1fr 1fr',\r\n                            gap: '10px',\r\n                            fontSize: '0.9rem',\r\n                            color: '#e4e4e7',\r\n                            marginBottom: '10px',\r\n                            background: 'rgba(0,0,0,0.2)',\r\n                            padding: '10px',\r\n                            borderRadius: '8px'\r\n                        }}>\r\n                            <div style={{ display: 'flex', flexDirection: 'column', gap: '4px' }}>\r\n                                <span style={{ fontSize: '0.75rem', color: '#a1a1aa' }}></span>\r\n                                <span style={{ fontWeight: '600' }}>{member.startDate || '-'}</span>\r\n                            </div>\r\n                            <div style={{ display: 'flex', flexDirection: 'column', gap: '4px', textAlign: 'right' }}>\r\n                                <span style={{ fontSize: '0.75rem', color: '#a1a1aa' }}></span>\r\n                                <span style={{ fontWeight: '600' }}>{member.endDate || '-'}</span>\r\n                            </div>\r\n                            <div style={{ display: 'flex', flexDirection: 'column', gap: '4px' }}>\r\n                                <span style={{ fontSize: '0.75rem', color: '#a1a1aa' }}> </span>\r\n                                <span style={{ fontWeight: '600' }}>\r\n                                    {member.credits >= 9000 ? ' ' : `${member.credits}`}\r\n                                </span>\r\n                            </div>\r\n                            <div style={{ display: 'flex', flexDirection: 'column', gap: '4px', textAlign: 'right' }}>\r\n                                <span style={{ fontSize: '0.75rem', color: '#a1a1aa' }}> </span>\r\n                                <span style={{ fontWeight: '600', color: 'var(--primary-gold)' }}>\r\n                                    {member.credits >= 9000 ? '' : `${member.credits}`}\r\n                                </span>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {member.regDate && (\r\n                            <div style={{ fontSize: '0.8rem', color: '#52525b', textAlign: 'right' }}>\r\n                                 : {member.regDate}\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            <h4 style={{ color: 'var(--text-secondary)', fontSize: '0.9rem', marginBottom: '10px' }}>  </h4>\r\n\r\n            {history.length === 0 ? (\r\n                <div style={{ textAlign: 'center', padding: '20px', color: '#52525b', background: 'rgba(255,255,255,0.02)', borderRadius: '10px' }}>\r\n                    <ClockCounterClockwise size={32} style={{ marginBottom: '10px', opacity: 0.5 }} />\r\n                    <p>   .</p>\r\n                </div>\r\n            ) : (\r\n                <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\r\n                    {history.map((item) => (\r\n                        <div key={item.id} style={{\r\n                            background: 'rgba(255,255,255,0.05)',\r\n                            padding: '15px',\r\n                            borderRadius: '10px',\r\n                            border: '1px solid rgba(255,255,255,0.1)'\r\n                        }}>\r\n                            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '8px' }}>\r\n                                <span style={{ color: 'white', fontWeight: 'bold' }}>{item.item}</span>\r\n                                <span style={{ color: '#10b981', fontWeight: 'bold' }}>{(item.amount || 0).toLocaleString()}</span>\r\n                            </div>\r\n                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', fontSize: '0.85rem' }}>\r\n                                <span style={{ color: '#a1a1aa' }}>\r\n                                    {item.paymentMethod === 'card' ? '' : item.paymentMethod === 'cash' ? '' : ''}\r\n                                </span>\r\n                                <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\r\n                                    <span style={{ color: '#a1a1aa' }}>{new Date(item.timestamp || item.date).toLocaleDateString()}</span>\r\n                                    <button\r\n                                        onClick={() => handleDelete(item.id, item.item || ' ')}\r\n                                        disabled={deleting === item.id}\r\n                                        style={{\r\n                                            background: 'rgba(239, 68, 68, 0.1)',\r\n                                            border: '1px solid rgba(239, 68, 68, 0.2)',\r\n                                            color: '#ef4444',\r\n                                            borderRadius: '6px',\r\n                                            padding: '4px 8px',\r\n                                            cursor: deleting === item.id ? 'not-allowed' : 'pointer',\r\n                                            display: 'flex',\r\n                                            alignItems: 'center',\r\n                                            gap: '4px',\r\n                                            fontSize: '0.75rem',\r\n                                            opacity: deleting === item.id ? 0.5 : 1\r\n                                        }}\r\n                                    >\r\n                                        <Trash size={14} />\r\n                                        {deleting === item.id ? '...' : ''}\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default SalesHistoryTab;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\admin\\modals\\BulkMessageModal.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,13],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":218,"column":41,"nodeType":"Identifier","messageId":"unusedVar","endLine":218,"endColumn":42}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useRef } from 'react';\r\nimport { X, PaperPlaneTilt, Calendar, CurrencyKrw, Info, Copy } from '@phosphor-icons/react';\r\nimport { storageService } from '../../../services/storage';\r\nimport { STUDIO_CONFIG } from '../../../studioConfig';\r\n\r\nconst BulkMessageModal = ({ isOpen, onClose, selectedMemberIds, memberCount }) => {\r\n    const [message, setMessage] = useState('');\r\n    const [sending, setSending] = useState(false);\r\n    const [isScheduled, setIsScheduled] = useState(false);\r\n    const [scheduledTime, setScheduledTime] = useState('');\r\n    const [selectedTemplateId, setSelectedTemplateId] = useState('');\r\n    const scheduleInputRef = useRef(null);\r\n\r\n    if (!isOpen) return null;\r\n\r\n    const templates = [\r\n        \",  .  ! \",\r\n        \"!    .\",\r\n        \"!   \",\r\n        \" 7 .\",\r\n        \"[]      \"\r\n    ];\r\n\r\n    // [Solapi] AlimTalk Templates\r\n    const alimTalkTemplates = STUDIO_CONFIG.ALIMTALK_TEMPLATES || [];\r\n    const selectedTemplate = alimTalkTemplates.find(t => t.id === selectedTemplateId);\r\n\r\n    const calculateCost = (msg) => {\r\n        let bytes = 0;\r\n        for (let i = 0; i < msg.length; i++) {\r\n            const code = msg.charCodeAt(i);\r\n            bytes += (code >> 7) ? 2 : 1;\r\n        }\r\n        const isLMS = bytes > 90;\r\n        // AlimTalk is usually cheaper (e.g., 15 KRW), but fallback to LMS if failed. \r\n        // Let's assume standard LMS cost for safety estimation or 15 won if AlimTalk.\r\n        const costPerMsg = selectedTemplateId ? 15 : (isLMS ? 45 : 18);\r\n        return { bytes, isLMS, costPerMsg, totalCost: costPerMsg * memberCount };\r\n    };\r\n\r\n    const costInfo = calculateCost(message);\r\n\r\n    const handleSend = async () => {\r\n        if (!message.trim()) return;\r\n        if (isScheduled && !scheduledTime) {\r\n            alert(\"  .\");\r\n            return;\r\n        }\r\n\r\n        const method = selectedTemplateId ? '' : (costInfo.isLMS ? 'LMS' : 'SMS');\r\n        if (!confirm(`${memberCount} ${method} ?\\n :  ${costInfo.totalCost.toLocaleString()}`)) {\r\n            return;\r\n        }\r\n\r\n        setSending(true);\r\n        try {\r\n            // [Solapi] Pass selectedTemplateId\r\n            await storageService.sendBulkMessages(selectedMemberIds, message, isScheduled ? scheduledTime : null, selectedTemplateId);\r\n            alert(\" .\");\r\n            onClose();\r\n            setMessage('');\r\n            setIsScheduled(false);\r\n            setScheduledTime('');\r\n            setSelectedTemplateId('');\r\n        } catch (error) {\r\n            console.error(\"Bulk send failed:\", error);\r\n            alert(\" : \" + error.message);\r\n        } finally {\r\n            setSending(false);\r\n        }\r\n    };\r\n\r\n    // [UX] Auto-open picker when scheduled is checked\r\n    const handleScheduleToggle = (e) => {\r\n        const checked = e.target.checked;\r\n        setIsScheduled(checked);\r\n        if (checked) {\r\n            setTimeout(() => {\r\n                try {\r\n                    if (scheduleInputRef.current) scheduleInputRef.current.showPicker();\r\n                } catch (err) { console.log('showPicker not supported', err); }\r\n            }, 100);\r\n        }\r\n    };\r\n\r\n    const handleTemplateSelect = (e) => {\r\n        const id = e.target.value;\r\n        setSelectedTemplateId(id);\r\n    };\r\n\r\n    const handleCopyTemplate = () => {\r\n        if (selectedTemplate && selectedTemplate.content) {\r\n            setMessage(selectedTemplate.content);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div style={{\r\n            position: 'fixed', top: 0, left: 0, width: '100%', height: '100%',\r\n            background: 'rgba(0,0,0,0.7)', display: 'flex', justifyContent: 'center', alignItems: 'center',\r\n            zIndex: 1000, backdropFilter: 'blur(5px)'\r\n        }}>\r\n            <div className=\"fade-in\" style={{\r\n                background: '#1d1d2b', width: '90%', maxWidth: '500px',\r\n                borderRadius: '16px', border: '1px solid rgba(255,255,255,0.1)',\r\n                padding: '24px', color: 'white',\r\n                boxShadow: '0 25px 50px -12px rgba(0,0,0,0.5)'\r\n            }}>\r\n                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px' }}>\r\n                    <h3 style={{ margin: 0, color: 'white', display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n                        <PaperPlaneTilt weight=\"fill\" color=\"var(--primary-gold)\" />\r\n                          \r\n                    </h3>\r\n                    <button onClick={onClose} style={{ background: 'none', border: 'none', color: '#a1a1aa', cursor: 'pointer' }}>\r\n                        <X size={24} />\r\n                    </button>\r\n                </div>\r\n\r\n                <div style={{ marginBottom: '16px', color: '#e4e4e7', fontSize: '0.95rem' }}>\r\n                    <span style={{ color: 'var(--primary-gold)', fontWeight: 'bold' }}>{memberCount}</span>   .\r\n                </div>\r\n\r\n                {/* [Solapi] Template Selection */}\r\n                <div style={{ marginBottom: '16px' }}>\r\n                    <label style={{ display: 'block', marginBottom: '6px', fontSize: '0.85rem', color: '#a1a1aa' }}>  (/)</label>\r\n                    <select\r\n                        value={selectedTemplateId}\r\n                        onChange={handleTemplateSelect}\r\n                        style={{\r\n                            width: '100%', padding: '10px', borderRadius: '8px',\r\n                            background: 'rgba(255,255,255,0.05)', border: '1px solid rgba(255,255,255,0.1)',\r\n                            color: 'white', outline: 'none', cursor: 'pointer'\r\n                        }}\r\n                    >\r\n                        {alimTalkTemplates.map(t => (\r\n                            <option key={t.id} value={t.id} style={{ background: '#1d1d2b' }}>\r\n                                {t.name}\r\n                            </option>\r\n                        ))}\r\n                    </select>\r\n\r\n                    {/* [NEW] AlimTalk Template Preview */}\r\n                    {selectedTemplateId && selectedTemplate && (\r\n                        <div style={{ \r\n                            marginTop: '12px', padding: '12px', \r\n                            background: 'rgba(212, 175, 55, 0.05)', \r\n                            borderRadius: '8px', border: '1px dashed rgba(212, 175, 55, 0.3)' \r\n                        }}>\r\n                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '8px' }}>\r\n                                <div style={{ display: 'flex', alignItems: 'center', gap: '6px', fontSize: '0.75rem', color: 'var(--primary-gold)' }}>\r\n                                    <Info size={14} />   \r\n                                </div>\r\n                                <button \r\n                                    onClick={handleCopyTemplate}\r\n                                    style={{ \r\n                                        background: 'rgba(212, 175, 55, 0.2)', color: 'white', \r\n                                        border: 'none', borderRadius: '4px', padding: '4px 8px', \r\n                                        fontSize: '0.7rem', cursor: 'pointer', display: 'flex', alignItems: 'center', gap: '4px' \r\n                                    }}\r\n                                >\r\n                                    <Copy size={12} />  \r\n                                </button>\r\n                            </div>\r\n                            <div style={{ fontSize: '0.85rem', color: '#e4e4e7', lineHeight: '1.4', wordBreak: 'break-all' }}>\r\n                                {selectedTemplate.content}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                <div style={{ background: 'rgba(255,255,255,0.05)', padding: '15px', borderRadius: '12px', marginBottom: '16px' }}>\r\n                    <textarea\r\n                        value={message}\r\n                        onChange={e => setMessage(e.target.value)}\r\n                        placeholder={selectedTemplateId ? \"    .\" : \"  ...\"}\r\n                        style={{\r\n                            width: '100%', height: '120px', background: 'transparent', border: 'none',\r\n                            color: 'white', fontSize: '1rem', resize: 'none', outline: 'none'\r\n                        }}\r\n                    />\r\n                    \r\n                    {/* Cost Info */}\r\n                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', borderTop: '1px solid rgba(255,255,255,0.1)', paddingTop: '10px', marginTop: '10px' }}>\r\n                        <span style={{ fontSize: '0.8rem', color: selectedTemplateId ? 'var(--primary-gold)' : '#a1a1aa' }}>\r\n                            {selectedTemplateId ? ' ' : (costInfo.isLMS ? 'LMS' : 'SMS')}\r\n                        </span>\r\n                        <div style={{ display: 'flex', alignItems: 'center', gap: '10px', fontSize: '0.85rem', color: '#a1a1aa' }}>\r\n                            <span>{costInfo.bytes}B</span>\r\n                            <span style={{ color: costInfo.isLMS ? '#f59e0b' : '#10b981', display: 'flex', alignItems: 'center', gap: '4px' }}>\r\n                                <CurrencyKrw size={14} />\r\n                                 {costInfo.totalCost.toLocaleString()}\r\n                            </span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Scheduling */}\r\n                <div style={{ marginBottom: '20px', display: 'flex', alignItems: 'center', gap: '10px', background: 'rgba(0,0,0,0.2)', padding: '12px', borderRadius: '8px' }}>\r\n                    <input \r\n                        type=\"checkbox\" \r\n                        id=\"bulkSchedule\" \r\n                        checked={isScheduled} \r\n                        onChange={handleScheduleToggle}\r\n                        style={{ accentColor: 'var(--primary-gold)', width: '16px', height: '16px', cursor: 'pointer' }}\r\n                    />\r\n                    <label htmlFor=\"bulkSchedule\" style={{ color: '#e4e4e7', fontSize: '0.9rem', cursor: 'pointer', display: 'flex', alignItems: 'center', gap: '6px' }}>\r\n                        <Calendar size={16} />  \r\n                    </label>\r\n                    {isScheduled && (\r\n                        <input \r\n                            ref={scheduleInputRef}\r\n                            type=\"datetime-local\" \r\n                            value={scheduledTime}\r\n                            onChange={e => setScheduledTime(e.target.value)}\r\n                            onClick={() => {\r\n                                try {\r\n                                    if(scheduleInputRef.current) scheduleInputRef.current.showPicker();\r\n                                } catch(e) { /* ignore */ }\r\n                            }}\r\n                            style={{ \r\n                                background: 'rgba(255,255,255,0.1)', \r\n                                border: '1px solid rgba(255,255,255,0.2)', \r\n                                borderRadius: '6px', \r\n                                padding: '6px 8px', \r\n                                color: 'white', \r\n                                fontSize: '0.9rem',\r\n                                marginLeft: 'auto',\r\n                                cursor: 'pointer'\r\n                            }}\r\n                        />\r\n                    )}\r\n                </div>\r\n\r\n                {/* Templates (Quick Text) - Only show if standard SMS/LMS mode */}\r\n                {!selectedTemplateId && (\r\n                    <div style={{ marginBottom: '25px' }}>\r\n                        <p style={{ color: '#a1a1aa', fontSize: '0.85rem', marginBottom: '8px' }}>  </p>\r\n                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '8px' }}>\r\n                            {templates.map((t, i) => (\r\n                                <button\r\n                                    key={i}\r\n                                    onClick={() => setMessage(t)}\r\n                                    style={{\r\n                                        background: 'rgba(255,255,255,0.1)', border: '1px solid rgba(255,255,255,0.1)',\r\n                                        borderRadius: '20px', padding: '6px 12px', color: '#e4e4e7', fontSize: '0.8rem',\r\n                                        cursor: 'pointer'\r\n                                    }}\r\n                                >\r\n                                    {t.length > 15 ? t.substring(0, 15) + '...' : t}\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                <button\r\n                    onClick={handleSend}\r\n                    disabled={sending || !message.trim()}\r\n                    style={{\r\n                        width: '100%',\r\n                        background: sending ? '#52525b' : 'var(--primary-gold)',\r\n                        color: sending ? '#d4d4d8' : 'black',\r\n                        border: 'none', borderRadius: '12px', padding: '14px',\r\n                        fontSize: '1rem', fontWeight: 'bold', cursor: sending ? 'wait' : 'pointer',\r\n                        boxShadow: sending ? 'none' : '0 4px 12px rgba(212, 175, 55, 0.3)'\r\n                    }}\r\n                >\r\n                    {sending ? ' ...' : (isScheduled ? ' ' : '')}\r\n                </button>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default BulkMessageModal;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\admin\\modals\\ExtensionModal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\admin\\modals\\ImageModals.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\admin\\modals\\InstallGuideModal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\admin\\modals\\MemberAddModal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\admin\\modals\\MemberNoteModal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\admin\\modals\\MessageModal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\admin\\modals\\NoticeModal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\admin\\tabs\\DataMigrationTab.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\admin\\tabs\\LogsTab.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'STUDIO_CONFIG' is defined but never used.","line":3,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":23,"suggestions":[{"messageId":"removeVar","data":{"varName":"STUDIO_CONFIG"},"fix":{"range":[186,200],"text":""},"desc":"Remove unused variable 'STUDIO_CONFIG'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'guessClassTime' is defined but never used.","line":4,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":24,"suggestions":[{"messageId":"removeVar","data":{"varName":"guessClassTime"},"fix":{"range":[294,309],"text":""},"desc":"Remove unused variable 'guessClassTime'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'idx' is defined but never used.","line":322,"column":47,"nodeType":"Identifier","messageId":"unusedVar","endLine":322,"endColumn":50,"suggestions":[{"messageId":"removeVar","data":{"varName":"idx"},"fix":{"range":[16055,16060],"text":""},"desc":"Remove unused variable 'idx'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from 'react';\r\nimport { ClockCounterClockwise, Trash, Sparkle, CaretLeft, CaretRight, CalendarBlank } from '@phosphor-icons/react';\r\nimport { STUDIO_CONFIG, getBranchName, getBranchColor, getBranchThemeColor } from '../../../studioConfig';\r\nimport { guessClassTime, guessClassInfo } from '../../../utils/classUtils';\r\nimport { storageService } from '../../../services/storage';\r\n\r\n//  Mini Calendar Popup \r\nconst MiniCalendar = ({ selectedDate, onSelect, onClose }) => {\r\n    const sel = new Date(selectedDate + 'T00:00:00+09:00');\r\n    const [viewYear, setViewYear] = useState(sel.getFullYear());\r\n    const [viewMonth, setViewMonth] = useState(sel.getMonth());\r\n\r\n    const todayStr = new Date().toLocaleDateString('sv-SE', { timeZone: 'Asia/Seoul' });\r\n    const daysInMonth = new Date(viewYear, viewMonth + 1, 0).getDate();\r\n    const startDay = new Date(viewYear, viewMonth, 1).getDay();\r\n    const dayNames = ['', '', '', '', '', '', ''];\r\n\r\n    const dates = [];\r\n    for (let i = 0; i < startDay; i++) dates.push(null);\r\n    for (let i = 1; i <= daysInMonth; i++) dates.push(i);\r\n\r\n    const handleSelect = (day) => {\r\n        if (!day) return;\r\n        const dateStr = `${viewYear}-${String(viewMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;\r\n        //   \r\n        if (dateStr > todayStr) return;\r\n        onSelect(dateStr);\r\n        onClose();\r\n    };\r\n\r\n    const prevMonth = () => {\r\n        if (viewMonth === 0) { setViewYear(y => y - 1); setViewMonth(11); }\r\n        else setViewMonth(m => m - 1);\r\n    };\r\n    const nextMonth = () => {\r\n        if (viewMonth === 11) { setViewYear(y => y + 1); setViewMonth(0); }\r\n        else setViewMonth(m => m + 1);\r\n    };\r\n\r\n    return (\r\n        <div style={{ position: 'absolute', top: '100%', left: '50%', transform: 'translateX(-50%)', zIndex: 100, marginTop: '8px' }}>\r\n            {/* Backdrop */}\r\n            <div style={{ position: 'fixed', top: 0, left: 0, right: 0, bottom: 0, zIndex: -1 }} onClick={onClose} />\r\n            <div style={{\r\n                background: 'var(--bg-surface, #1a1a2e)',\r\n                border: '1px solid rgba(212,175,55,0.3)',\r\n                borderRadius: '12px',\r\n                padding: '16px',\r\n                boxShadow: '0 8px 32px rgba(0,0,0,0.5)',\r\n                minWidth: '280px'\r\n            }}>\r\n                {/* Header */}\r\n                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '12px' }}>\r\n                    <button onClick={prevMonth} style={calNavBtn}><CaretLeft size={14} /></button>\r\n                    <span style={{ fontWeight: 'bold', fontSize: '0.95rem' }}>{viewYear} {viewMonth + 1}</span>\r\n                    <button onClick={nextMonth} style={calNavBtn}><CaretRight size={14} /></button>\r\n                </div>\r\n                {/* Day names */}\r\n                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(7, 1fr)', gap: '2px', marginBottom: '4px' }}>\r\n                    {dayNames.map(d => (\r\n                        <div key={d} style={{ textAlign: 'center', fontSize: '0.7rem', color: 'var(--text-secondary)', padding: '4px', fontWeight: 'bold' }}>{d}</div>\r\n                    ))}\r\n                </div>\r\n                {/* Dates */}\r\n                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(7, 1fr)', gap: '2px' }}>\r\n                    {dates.map((day, i) => {\r\n                        if (!day) return <div key={`e-${i}`} />;\r\n                        const dateStr = `${viewYear}-${String(viewMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;\r\n                        const isSelected = dateStr === selectedDate;\r\n                        const isToday = dateStr === todayStr;\r\n                        const isFuture = dateStr > todayStr;\r\n                        const isSunday = new Date(viewYear, viewMonth, day).getDay() === 0;\r\n                        return (\r\n                            <button\r\n                                key={day}\r\n                                onClick={() => handleSelect(day)}\r\n                                disabled={isFuture}\r\n                                style={{\r\n                                    width: '36px', height: '36px',\r\n                                    borderRadius: '50%',\r\n                                    border: isToday ? '2px solid var(--primary-gold)' : 'none',\r\n                                    background: isSelected ? 'var(--primary-gold)' : 'transparent',\r\n                                    color: isSelected ? 'black' : isFuture ? 'rgba(255,255,255,0.15)' : isSunday ? '#ff6b6b' : 'var(--text-primary)',\r\n                                    fontWeight: isSelected || isToday ? 'bold' : 'normal',\r\n                                    fontSize: '0.85rem',\r\n                                    cursor: isFuture ? 'not-allowed' : 'pointer',\r\n                                    display: 'flex', alignItems: 'center', justifyContent: 'center',\r\n                                    transition: 'all 0.15s ease',\r\n                                    margin: '0 auto'\r\n                                }}\r\n                                onMouseEnter={e => { if (!isFuture && !isSelected) e.currentTarget.style.background = 'rgba(212,175,55,0.15)'; }}\r\n                                onMouseLeave={e => { if (!isFuture && !isSelected) e.currentTarget.style.background = 'transparent'; }}\r\n                            >\r\n                                {day}\r\n                            </button>\r\n                        );\r\n                    })}\r\n                </div>\r\n                {/* Today shortcut */}\r\n                <button\r\n                    onClick={() => { onSelect(todayStr); onClose(); }}\r\n                    style={{\r\n                        marginTop: '10px', width: '100%', padding: '6px',\r\n                        background: 'rgba(212,175,55,0.1)', border: '1px solid rgba(212,175,55,0.25)',\r\n                        borderRadius: '6px', color: 'var(--primary-gold)', fontWeight: 'bold',\r\n                        fontSize: '0.8rem', cursor: 'pointer'\r\n                    }}\r\n                > </button>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nconst calNavBtn = {\r\n    background: 'none', border: '1px solid rgba(255,255,255,0.1)', borderRadius: '50%',\r\n    width: '28px', height: '28px', display: 'flex', alignItems: 'center', justifyContent: 'center',\r\n    cursor: 'pointer', color: 'var(--text-primary)'\r\n};\r\n\r\n//  Main Component \r\nconst LogsTab = ({ todayClasses, logs, currentLogPage, setCurrentLogPage, members = [], onMemberClick, summary }) => {\r\n    const todayStr = new Date().toLocaleDateString('sv-SE', { timeZone: 'Asia/Seoul' });\r\n    const [selectedDate, setSelectedDate] = useState(todayStr);\r\n    const [selectedClassKey, setSelectedClassKey] = useState(null);\r\n    const [showCalendar, setShowCalendar] = useState(false);\r\n    const [historicalLogs, setHistoricalLogs] = useState([]);\r\n    const [loadingHistorical, setLoadingHistorical] = useState(false);\r\n\r\n    const isToday = selectedDate === todayStr;\r\n\r\n    //     Firestore  \r\n    const fetchHistoricalData = useCallback(async (dateStr) => {\r\n        if (dateStr === todayStr) return;\r\n        setLoadingHistorical(true);\r\n        try {\r\n            const data = await storageService.getAttendanceByDate(dateStr);\r\n            setHistoricalLogs(data);\r\n        } catch (e) {\r\n            console.error('[LogsTab] Failed to fetch historical data:', e);\r\n            setHistoricalLogs([]);\r\n        } finally {\r\n            setLoadingHistorical(false);\r\n        }\r\n    }, [todayStr]);\r\n\r\n    useEffect(() => {\r\n        if (!isToday) {\r\n            fetchHistoricalData(selectedDate);\r\n        }\r\n        setSelectedClassKey(null);\r\n        setCurrentLogPage(1);\r\n    }, [selectedDate, isToday, fetchHistoricalData, setCurrentLogPage]);\r\n\r\n    //    \r\n    const activeLogs = (() => {\r\n        if (isToday) {\r\n            return logs.filter(l => {\r\n                // [FIX] Use stored 'date' field first for robustness (avoids client locale/timezone issues)\r\n                if (l.date) return l.date === todayStr;\r\n                \r\n                // Fallback: Parse timestamp if date field is missing (legacy)\r\n                if (!l.timestamp) return false;\r\n                const logDate = new Date(l.timestamp).toLocaleDateString('sv-SE', { timeZone: 'Asia/Seoul' });\r\n                return logDate === todayStr;\r\n            });\r\n        }\r\n        return historicalLogs;\r\n    })();\r\n\r\n    //     ( todayClasses prop,    )\r\n    const classCards = (() => {\r\n        if (isToday) return todayClasses;\r\n        const groups = {};\r\n\r\n        activeLogs.forEach(log => {\r\n            const info = guessClassInfo(log);\r\n            const classTime = info?.startTime || '00:00';\r\n            const canonicalClassName = info?.className || log.className || '';\r\n            const canonicalInstructor = info?.instructor || log.instructor || '';\r\n\r\n            const key = `${canonicalClassName}-${canonicalInstructor}-${log.branchId}-${classTime}`;\r\n            \r\n            if (!groups[key]) {\r\n                groups[key] = {\r\n                    className: canonicalClassName,\r\n                    instructor: canonicalInstructor,\r\n                    branchId: log.branchId,\r\n                    classTime: classTime,\r\n                    count: 0,\r\n                    deniedCount: 0,\r\n                    memberNames: [] \r\n                };\r\n            }\r\n            if (log.status === 'denied') groups[key].deniedCount++;\r\n            else {\r\n                groups[key].count++;\r\n                // If it's a historical log, we might not have easy access to multiAttendedMemberIds here,\r\n                // but we can at least show those tagged as multi-session in the log itself.\r\n                if (log.memberName && (log.sessionCount > 1 || log.isMultiSession)) {\r\n                    if (!groups[key].memberNames.includes(log.memberName)) {\r\n                        groups[key].memberNames.push(log.memberName);\r\n                    }\r\n                }\r\n            }\r\n        });\r\n        \r\n        // [UX] Sort by classTime Descending (Latest First)\r\n        return Object.values(groups).sort((a, b) => {\r\n            if (!a.classTime) return 1;\r\n            if (!b.classTime) return -1;\r\n            return b.classTime.localeCompare(a.classTime);\r\n        });\r\n    })();\r\n\r\n    const handleClassClick = (cls) => {\r\n        const key = `${cls.className}-${cls.instructor}-${cls.branchId}-${cls.classTime || 'no-time'}`;\r\n        // [UX] Toggle selection: if already selected, deselect (show all)\r\n        setSelectedClassKey(prev => prev === key ? null : key);\r\n        setCurrentLogPage(1);\r\n    };\r\n\r\n    const handleDateChange = (dateStr) => {\r\n        setSelectedDate(dateStr);\r\n    };\r\n\r\n    const handlePrevDay = () => {\r\n        const d = new Date(selectedDate + 'T00:00:00+09:00');\r\n        d.setDate(d.getDate() - 1);\r\n        setSelectedDate(d.toLocaleDateString('sv-SE', { timeZone: 'Asia/Seoul' }));\r\n    };\r\n\r\n    const handleNextDay = () => {\r\n        const d = new Date(selectedDate + 'T00:00:00+09:00');\r\n        d.setDate(d.getDate() + 1);\r\n        const nextStr = d.toLocaleDateString('sv-SE', { timeZone: 'Asia/Seoul' });\r\n        if (nextStr <= todayStr) setSelectedDate(nextStr);\r\n    };\r\n\r\n    //  : \"2 16 ()\"\r\n    const formatDisplayDate = (dateStr) => {\r\n        const d = new Date(dateStr + 'T00:00:00+09:00');\r\n        const m = d.getMonth() + 1;\r\n        const day = d.getDate();\r\n        const dayName = ['', '', '', '', '', '', ''][d.getDay()];\r\n        return `${m} ${day} (${dayName})`;\r\n    };\r\n\r\n    return (\r\n        <div style={{ display: 'flex', flexDirection: 'column', gap: '24px' }}>\r\n            {/*  Date Navigation  */}\r\n            <div style={{\r\n                display: 'flex', justifyContent: 'center', alignItems: 'center', gap: '12px',\r\n                padding: '12px 0', position: 'relative'\r\n            }}>\r\n                <button onClick={handlePrevDay} style={dateNavBtn}><CaretLeft size={18} weight=\"bold\" /></button>\r\n                <button\r\n                    onClick={() => setShowCalendar(v => !v)}\r\n                    style={{\r\n                        background: isToday ? 'rgba(212,175,55,0.1)' : 'rgba(255,255,255,0.05)',\r\n                        border: isToday ? '1px solid rgba(212,175,55,0.3)' : '1px solid rgba(255,255,255,0.1)',\r\n                        borderRadius: '10px',\r\n                        padding: '8px 20px',\r\n                        color: isToday ? 'var(--primary-gold)' : 'var(--text-primary)',\r\n                        fontWeight: 'bold',\r\n                        fontSize: '1rem',\r\n                        cursor: 'pointer',\r\n                        display: 'flex', alignItems: 'center', gap: '8px',\r\n                        transition: 'all 0.2s ease'\r\n                    }}\r\n                >\r\n                    <CalendarBlank size={18} />\r\n                    {formatDisplayDate(selectedDate)}\r\n                    {isToday && <span style={{ fontSize: '0.7rem', background: 'var(--primary-gold)', color: 'black', padding: '2px 6px', borderRadius: '4px', fontWeight: 'bold' }}></span>}\r\n                </button>\r\n                <button\r\n                    onClick={handleNextDay}\r\n                    disabled={selectedDate >= todayStr}\r\n                    style={{ ...dateNavBtn, opacity: selectedDate >= todayStr ? 0.3 : 1, cursor: selectedDate >= todayStr ? 'not-allowed' : 'pointer' }}\r\n                ><CaretRight size={18} weight=\"bold\" /></button>\r\n\r\n                {!isToday && (\r\n                    <button\r\n                        onClick={() => setSelectedDate(todayStr)}\r\n                        style={{\r\n                            background: 'var(--primary-gold)', color: 'black', border: 'none',\r\n                            padding: '6px 14px', borderRadius: '8px', fontWeight: 'bold',\r\n                            fontSize: '0.8rem', cursor: 'pointer',\r\n                            boxShadow: '0 2px 8px rgba(212,175,55,0.3)'\r\n                        }}\r\n                    ></button>\r\n                )}\r\n\r\n                {showCalendar && (\r\n                    <MiniCalendar\r\n                        selectedDate={selectedDate}\r\n                        onSelect={handleDateChange}\r\n                        onClose={() => setShowCalendar(false)}\r\n                    />\r\n                )}\r\n            </div>\r\n\r\n            {/*  Loading State  */}\r\n            {loadingHistorical && (\r\n                <div style={{ textAlign: 'center', padding: '30px', color: 'var(--text-secondary)' }}>\r\n                    <div style={{\r\n                        width: '32px', height: '32px', border: '3px solid rgba(212,175,55,0.2)',\r\n                        borderTop: '3px solid var(--primary-gold)', borderRadius: '50%',\r\n                        animation: 'spin 0.8s linear infinite', margin: '0 auto 12px'\r\n                    }} />\r\n                       ...\r\n                    <style>{`@keyframes spin { to { transform: rotate(360deg); } }`}</style>\r\n                </div>\r\n            )}\r\n\r\n            {/*  Class Summary Cards  */}\r\n            {!loadingHistorical && classCards.length > 0 && (\r\n                <div className=\"dashboard-card\" style={{ border: '1px solid rgba(212,175,55,0.2)' }}>\r\n                    <h3 className=\"card-label\" style={{ marginBottom: '15px', color: 'var(--primary-gold)', display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n                        <ClockCounterClockwise size={18} /> {isToday ? '' : formatDisplayDate(selectedDate)}   \r\n                    </h3>\r\n                    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '12px' }}>\r\n                        {classCards.map((cls, idx) => {\r\n                            const key = `${cls.className}-${cls.instructor}-${cls.branchId}-${cls.classTime || 'no-time'}`;\r\n                            const isSelected = selectedClassKey === key;\r\n                            return (\r\n                                <div\r\n                                    key={key}\r\n                                    onClick={() => handleClassClick(cls)}\r\n                                    style={{\r\n                                        padding: '12px',\r\n                                        borderRadius: '10px',\r\n                                        background: isSelected ? 'rgba(212,175,55,0.1)' : 'rgba(255,255,255,0.03)',\r\n                                        border: isSelected ? '1px solid var(--primary-gold)' : '1px solid rgba(255,255,255,0.05)',\r\n                                        position: 'relative',\r\n                                        cursor: 'pointer',\r\n                                        transition: 'all 0.2s ease',\r\n                                        boxShadow: isSelected ? '0 0 15px rgba(212,175,55,0.2)' : 'none'\r\n                                    }}\r\n                                >\r\n                                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '4px' }}>\r\n                                        <div style={{ display: 'flex', flexDirection: 'column', gap: '2px' }}>\r\n                                            {cls.classTime && (\r\n                                                <div style={{ fontSize: '0.75rem', color: 'var(--primary-gold)', fontWeight: 'bold' }}>\r\n                                                    {cls.classTime}\r\n                                                </div>\r\n                                            )}\r\n                                            <div style={{ fontSize: '0.9rem', fontWeight: 'bold', color: isSelected ? 'var(--primary-gold)' : 'inherit' }}>{cls.className}</div>\r\n                                        </div>\r\n                                        <span style={{\r\n                                            fontSize: '0.65rem', padding: '2px 6px', borderRadius: '4px',\r\n                                            background: `${getBranchColor(cls.branchId)}20`,\r\n                                            color: getBranchThemeColor(cls.branchId),\r\n                                            fontWeight: 'bold', border: `1px solid ${getBranchColor(cls.branchId)}33`\r\n                                        }}>\r\n                                            {getBranchName(cls.branchId)}\r\n                                        </span>\r\n                                    </div>\r\n                                    <div style={{ fontSize: '0.75rem', opacity: 0.6, marginBottom: '8px' }}>{cls.instructor} </div>\r\n                                    <div style={{ display: 'flex', alignItems: 'flex-end', gap: '4px' }}>\r\n                                        <span style={{ fontSize: '1.4rem', fontWeight: '800', color: 'var(--primary-gold)', lineHeight: 1 }}>{cls.count}</span>\r\n                                        <span style={{ fontSize: '0.8rem', opacity: 0.5 }}> </span>\r\n                                        {cls.deniedCount > 0 && (\r\n                                            <span style={{\r\n                                                fontSize: '0.7rem', color: '#ff4d4f', background: 'rgba(255, 77, 79, 0.1)',\r\n                                                padding: '2px 6px', borderRadius: '4px', border: '1px solid rgba(255, 77, 79, 0.2)',\r\n                                                fontWeight: 'bold', marginLeft: '6px'\r\n                                            }}>\r\n                                                  {cls.deniedCount}\r\n                                            </span>\r\n                                        )}\r\n                                    </div>\r\n                                    {/* [NEW] Show multi-attendance member names */}\r\n                                    {cls.memberNames?.length > 0 && (\r\n                                        <div style={{ marginTop: '8px', paddingTop: '8px', borderTop: '1px solid rgba(255,255,255,0.05)', display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\r\n                                            {cls.memberNames.map(name => (\r\n                                                <span key={name} style={{\r\n                                                    fontSize: '0.8rem', \r\n                                                    color: 'var(--primary-gold)', // Just color change requested\r\n                                                    fontWeight: 'bold'\r\n                                                }}>\r\n                                                    {name}\r\n                                                </span>\r\n                                            ))}\r\n                                        </div>\r\n                                    )}\r\n                                    {/* [UX] Removed \"Filtering...\" text as requested */}\r\n                                </div>\r\n                            );\r\n                        })}\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/*  Empty State  */}\r\n            {!loadingHistorical && classCards.length === 0 && activeLogs.length === 0 && (\r\n                <div className=\"dashboard-card\" style={{ textAlign: 'center', padding: '40px 20px', color: 'var(--text-secondary)' }}>\r\n                    <CalendarBlank size={48} style={{ opacity: 0.3, marginBottom: '12px' }} />\r\n                    <div style={{ fontSize: '1rem', fontWeight: 'bold', marginBottom: '6px' }}>\r\n                        {formatDisplayDate(selectedDate)}   .\r\n                    </div>\r\n                    <div style={{ fontSize: '0.85rem', opacity: 0.6 }}>\r\n                          .\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/*  Activity Log List  */}\r\n            {!loadingHistorical && (\r\n                <div className=\"dashboard-card\">\r\n                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '15px', flexWrap: 'wrap', gap: '10px' }}>\r\n                        <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n                            <h3 className=\"card-label\" style={{ margin: 0 }}>\r\n                                {isToday ? '  ' : `${formatDisplayDate(selectedDate)}  `}\r\n                            </h3>\r\n                            <span style={{ fontSize: '0.75rem', color: 'var(--text-secondary)', background: 'rgba(255,255,255,0.05)', padding: '2px 8px', borderRadius: '4px' }}>\r\n                                {activeLogs.length}\r\n                            </span>\r\n                            {selectedClassKey && (\r\n                                <button\r\n                                    onClick={() => setSelectedClassKey(null)}\r\n                                    style={{\r\n                                        background: 'var(--primary-gold)', color: 'black', border: 'none',\r\n                                        padding: '4px 10px', borderRadius: '6px', fontSize: '0.75rem',\r\n                                        fontWeight: 'bold', cursor: 'pointer',\r\n                                        display: 'flex', alignItems: 'center', gap: '4px'\r\n                                    }}\r\n                                >\r\n                                    <ClockCounterClockwise size={14} />  \r\n                                </button>\r\n                            )}\r\n                        </div>\r\n\r\n                    </div>\r\n                    <div style={{ marginTop: '10px' }}>\r\n                        {(() => {\r\n                            const filteredLogs = (selectedClassKey\r\n                                ? activeLogs.filter(l => {\r\n                                    const info = guessClassInfo(l);\r\n                                    const classTime = info?.startTime || '00:00';\r\n                                    const canonicalClassName = info?.className || l.className || '';\r\n                                    const canonicalInstructor = info?.instructor || l.instructor || '';\r\n                                    return `${canonicalClassName}-${canonicalInstructor}-${l.branchId}-${classTime}` === selectedClassKey;\r\n                                })\r\n                                : activeLogs\r\n                            ).sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));\r\n\r\n                            const itemsPerPage = 15;\r\n                            const startIndex = (currentLogPage - 1) * itemsPerPage;\r\n                            const paginatedLogs = filteredLogs.slice(startIndex, startIndex + itemsPerPage);\r\n                            const totalLogPages = Math.ceil(filteredLogs.length / itemsPerPage);\r\n\r\n                            if (filteredLogs.length === 0) {\r\n                                return <div style={{ textAlign: 'center', padding: '20px', color: 'var(--text-secondary)', fontSize: '0.9rem' }}>  .</div>;\r\n                            }\r\n\r\n                            return (\r\n                                <>\r\n                                    {paginatedLogs.map((log, index) => (\r\n                                        <div\r\n                                            key={log.id || index}\r\n                                            onClick={() => {\r\n                                                if (log.memberId && onMemberClick) {\r\n                                                    const member = members.find(m => m.id === log.memberId);\r\n                                                    if (member) onMemberClick(member);\r\n                                                }\r\n                                            }}\r\n                                            className=\"log-item\"\r\n                                            style={{\r\n                                                display: 'flex', alignItems: 'center', padding: '12px',\r\n                                                marginBottom: '6px', background: 'rgba(255,255,255,0.02)',\r\n                                                borderRadius: '8px',\r\n                                                cursor: log.memberId ? 'pointer' : 'default',\r\n                                                transition: 'all 0.2s ease',\r\n                                                borderLeft: `3px solid ${\r\n                                                    log.status === 'denied' ? '#ff4d4f' :\r\n                                                    log.type === 'checkin' ? 'var(--accent-success)' :\r\n                                                    log.type === 'register' ? 'var(--primary-gold)' :\r\n                                                    log.type === 'extend' ? '#3B82F6' :\r\n                                                    'var(--text-secondary)'\r\n                                                }`\r\n                                            }}\r\n                                            onMouseEnter={(e) => { if (log.memberId) e.currentTarget.style.background = 'rgba(255,255,255,0.05)'; }}\r\n                                            onMouseLeave={(e) => { if (log.memberId) e.currentTarget.style.background = 'rgba(255,255,255,0.02)'; }}\r\n                                        >\r\n                                            <div style={{ width: '60px', fontSize: '0.75rem', opacity: 0.6, textAlign: 'center' }}>\r\n                                                {new Date(log.timestamp).toLocaleTimeString('ko-KR', { timeZone: 'Asia/Seoul', hour: '2-digit', minute: '2-digit', hour12: false })}\r\n                                            </div>\r\n                                            <div style={{ flex: 1, paddingLeft: '12px' }}>\r\n                                                <div style={{ display: 'flex', alignItems: 'center', gap: '8px', flexWrap: 'wrap' }}>\r\n                                                    <span style={{ fontWeight: 'bold' }}>{log.memberName || log.name || '  '}</span>\r\n                                                    <span style={{ fontSize: '0.7rem', color: 'var(--primary-gold)', background: 'rgba(212,175,55,0.1)', padding: '1px 6px', borderRadius: '4px' }}>\r\n                                                        {log.className || ''}\r\n                                                    </span>\r\n                                                    <span className=\"badge\" style={{\r\n                                                        fontSize: '0.65rem', padding: '2px 6px',\r\n                                                        background: `${getBranchColor(log.branchId)}20`,\r\n                                                        color: getBranchThemeColor(log.branchId),\r\n                                                        border: `1px solid ${getBranchColor(log.branchId)}33`,\r\n                                                        fontWeight: 'bold'\r\n                                                    }}>\r\n                                                        {getBranchName(log.branchId)}\r\n                                                    </span>\r\n                                                    {log.status === 'denied' && (\r\n                                                        <span style={{\r\n                                                            fontSize: '0.65rem', padding: '1px 6px', borderRadius: '10px',\r\n                                                            background: 'rgba(255, 77, 79, 0.15)', color: '#ff4d4f',\r\n                                                            border: '1px solid rgba(255, 77, 79, 0.3)', fontWeight: 'bold',\r\n                                                            display: 'flex', alignItems: 'center', gap: '3px'\r\n                                                        }}>\r\n                                                              ({log.denialReason === 'expired' ? '' : ''})\r\n                                                        </span>\r\n                                                    )}\r\n                                                    {(log.sessionCount > 1 || log.isMultiSession) && (\r\n                                                        <span style={{\r\n                                                            fontSize: '0.65rem', padding: '1px 6px', borderRadius: '10px',\r\n                                                            background: 'var(--primary-gold)', color: 'black', fontWeight: 'bold',\r\n                                                            display: 'flex', alignItems: 'center', gap: '3px'\r\n                                                        }}>\r\n                                                            <Sparkle size={10} weight=\"fill\" />\r\n                                                            {log.sessionCount || '2'} Passion\r\n                                                        </span>\r\n                                                    )}\r\n                                                    {isToday && summary?.multiAttendedMemberIds?.includes(log.memberId) && (\r\n                                                        <span className=\"badge\" style={{\r\n                                                            fontSize: '0.65rem', padding: '2px 6px',\r\n                                                            background: 'rgba(245, 158, 11, 0.25)', color: '#FBBF24',\r\n                                                            border: '1px solid rgba(245, 158, 11, 0.5)', fontWeight: 'bold',\r\n                                                            height: 'max-content'\r\n                                                        }}>\r\n                                                             2  \r\n                                                        </span>\r\n                                                    )}\r\n                                                </div>\r\n                                                <div style={{ fontSize: '0.85rem', opacity: 0.8, marginTop: '2px', color: log.status === 'denied' ? '#ff4d4f' : 'inherit' }}>\r\n                                                    {log.status === 'denied'\r\n                                                        ? `   (${log.denialReason === 'expired' ? '' : ''})`\r\n                                                        : (log.action?.includes('') ? `${log.className || ''}   (${log.instructor || ''} )` : log.action)\r\n                                                    }\r\n                                                </div>\r\n                                            </div>\r\n                                            {log.type === 'checkin' && isToday && (\r\n                                                <button\r\n                                                    onClick={async (e) => {\r\n                                                        e.stopPropagation();\r\n                                                        if (confirm('   ?')) {\r\n                                                            await storageService.deleteAttendance(log.id);\r\n                                                        }\r\n                                                    }}\r\n                                                    style={{\r\n                                                        background: 'none', border: 'none',\r\n                                                        color: 'rgba(244, 63, 94, 0.5)', cursor: 'pointer', padding: '8px'\r\n                                                    }}\r\n                                                    onMouseOver={(e) => e.currentTarget.style.color = '#F43F5E'}\r\n                                                    onMouseOut={(e) => e.currentTarget.style.color = 'rgba(244, 63, 94, 0.5)'}\r\n                                                >\r\n                                                    <Trash size={16} />\r\n                                                </button>\r\n                                            )}\r\n                                        </div>\r\n                                    ))}\r\n\r\n                                    {totalLogPages > 1 && (\r\n                                        <div style={{ display: 'flex', justifyContent: 'center', gap: '10px', marginTop: '20px' }}>\r\n                                            <button disabled={currentLogPage === 1} onClick={() => setCurrentLogPage(p => p - 1)} className=\"action-btn sm\">&lt;</button>\r\n                                            <span style={{ display: 'flex', alignItems: 'center', fontSize: '0.9rem' }}>{currentLogPage} / {totalLogPages}</span>\r\n                                            <button disabled={currentLogPage === totalLogPages} onClick={() => setCurrentLogPage(p => p + 1)} className=\"action-btn sm\">&gt;</button>\r\n                                        </div>\r\n                                    )}\r\n                                </>\r\n                            );\r\n                        })()}\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\n//  Styles \r\nconst dateNavBtn = {\r\n    background: 'none',\r\n    border: '1px solid rgba(255,255,255,0.1)',\r\n    borderRadius: '50%',\r\n    width: '36px', height: '36px',\r\n    display: 'flex', alignItems: 'center', justifyContent: 'center',\r\n    cursor: 'pointer',\r\n    color: 'var(--text-primary)',\r\n    transition: 'all 0.2s ease'\r\n};\r\n\r\nexport default LogsTab;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\admin\\tabs\\MembersTab.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,13],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'getBranchColor' is defined but never used.","line":3,"column":25,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":39,"suggestions":[{"messageId":"removeVar","data":{"varName":"getBranchColor"},"fix":{"range":[164,180],"text":""},"desc":"Remove unused variable 'getBranchColor'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'getBranchThemeColor' is defined but never used.","line":3,"column":41,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":60,"suggestions":[{"messageId":"removeVar","data":{"varName":"getBranchThemeColor"},"fix":{"range":[180,201],"text":""},"desc":"Remove unused variable 'getBranchThemeColor'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useMemo } from 'react';\r\nimport { BellRinging, Check, Info, Plus, NotePencil, PaperPlaneTilt } from '@phosphor-icons/react';\r\nimport { getBranchName, getBranchColor, getBranchThemeColor } from '../../../studioConfig';\r\n\r\n\r\n\r\nconst MembersTab = ({\r\n    filteredMembers,\r\n    summary,\r\n    searchTerm,\r\n    setSearchTerm,\r\n    filterType,\r\n    handleToggleFilter,\r\n    selectExpiringMembers,\r\n    selectedMemberIds,\r\n    toggleMemberSelection,\r\n    selectFilteredMembers,\r\n    currentPage,\r\n    setCurrentPage,\r\n    itemsPerPage,\r\n    handleOpenEdit,\r\n    setShowAddModal,\r\n    pushTokens,\r\n    setActiveTab,\r\n    setShowBulkMessageModal, // [FIX] Add this prop\r\n    getDormantSegments // [FIX] Receive this prop\r\n}) => {\r\n    const todayKstStr = useMemo(() => new Date().toLocaleDateString('sv-SE', { timeZone: 'Asia/Seoul' }), []);\r\n    const todayStartMs = useMemo(() => {\r\n        const d = new Date();\r\n        d.setHours(0,0,0,0);\r\n        return d.getTime();\r\n    }, []);\r\n\r\n    const finalFiltered = useMemo(() => {\r\n        if (filterType === 'dormant' && getDormantSegments) {\r\n            const segments = getDormantSegments(filteredMembers);\r\n            return segments['all'] || [];\r\n        }\r\n        return filteredMembers;\r\n    }, [filteredMembers, filterType, getDormantSegments]);\r\n\r\n    if (!summary || !filteredMembers) return <div style={{ padding: '20px', textAlign: 'center', color: 'var(--text-secondary)' }}>  ...</div>;\r\n    return (\r\n        <div className=\"members-tab-container\">\r\n\r\n            <div style={{ marginBottom: '20px', display: 'flex', justifyContent: 'center' }}>\r\n                <button onClick={() => setShowAddModal(true)} className=\"action-btn primary\" style={{ flex: 'none', width: 'auto', minWidth: '350px', height: '54px', fontSize: '1.2rem', borderRadius: '12px', boxShadow: '0 8px 24px var(--primary-gold-glow)', fontWeight: 'bold', display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '8px' }}>\r\n                    <Plus size={24} weight=\"bold\" />   \r\n                </button>\r\n            </div>\r\n\r\n\r\n\r\n            {/* Summary Grid */}\r\n            <div className=\"stats-grid\">\r\n                <div className={`dashboard-card interactive ${filterType === 'all' ? 'highlight' : ''}`}\r\n                    onClick={() => handleToggleFilter('all')}>\r\n                    <div className=\"card-label\" style={{ display: 'flex', alignItems: 'center', gap: '6px' }}>\r\n                         \r\n                        <div className=\"tooltip-container\" onClick={e => e.stopPropagation()}>\r\n                            <Info size={14} style={{ opacity: 0.7 }} />\r\n                            <span className=\"tooltip-text\">  <br />  (/ )</span>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"card-value\">{summary.totalMembers}</div>\r\n                </div>\r\n                <div className={`dashboard-card interactive ${filterType === 'active' ? 'highlight' : ''}`}\r\n                    onClick={() => handleToggleFilter('active')}>\r\n                    <div className=\"card-label\" style={{ display: 'flex', alignItems: 'center', gap: '6px' }}>\r\n                         \r\n                        <div className=\"tooltip-container\" onClick={e => e.stopPropagation()}>\r\n                            <Info size={14} style={{ opacity: 0.7 }} />\r\n                            <span className=\"tooltip-text\">  1 (0 )<br />    </span>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"card-value gold\">{summary.activeMembers}</div>\r\n                </div>\r\n                <div className={`dashboard-card interactive ${filterType === 'attendance' ? 'highlight' : ''}`}\r\n                    onClick={() => handleToggleFilter('attendance')}>\r\n                    <div className=\"card-label\"> </div>\r\n                    <div className=\"card-value\">{summary.todayAttendance} / <span style={{ fontSize: '1rem', opacity: 0.8 }}>{summary.totalAttendanceToday}</span></div>\r\n                    {/* [NEW] Denied Stats Display */}\r\n                    {summary.deniedCount > 0 && (\r\n                        <div style={{ marginTop: '8px', paddingTop: '8px', borderTop: '1px solid rgba(255,255,255,0.1)', fontSize: '0.85rem', color: '#ff4d4f', fontWeight: 'bold', display: 'flex', alignItems: 'center', gap: '4px' }}>\r\n                            <span>  {summary.deniedCount}</span>\r\n                            <span style={{ fontSize: '0.75rem', opacity: 0.8, fontWeight: 'normal' }}>\r\n                                ( {summary.deniedExpiredCount || 0},  {summary.deniedNoCreditsCount || 0})\r\n                            </span>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n                <div className={`dashboard-card interactive ${filterType === 'registration' ? 'highlight' : ''}`}\r\n                    onClick={() => handleToggleFilter('registration')}>\r\n                    <div className=\"card-label\" style={{ display: 'flex', alignItems: 'center', gap: '6px' }}>\r\n                          \r\n                        <div className=\"tooltip-container\" onClick={e => e.stopPropagation()}>\r\n                            <Info size={14} style={{ opacity: 0.7 }} />\r\n                            <span className=\"tooltip-text\">    <br />(  +   )</span>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"card-value success\" style={{ fontSize: '1.8rem' }}>\r\n                        {summary.todayRegistration}\r\n                    </div>\r\n                    <div style={{ fontSize: '0.85rem', color: '#86efac', display: 'flex', gap: '8px', marginTop: '4px', fontWeight: 'bold' }}>\r\n                        <span> {summary.todayNewCount || 0}</span>\r\n                        <span style={{ opacity: 0.4 }}>|</span>\r\n                        <span> {summary.todayReRegCount || 0}</span>\r\n                    </div>\r\n                </div>\r\n                <div className={`dashboard-card interactive ${filterType === 'expiring' ? 'highlight' : ''}`}\r\n                    onClick={selectExpiringMembers}\r\n                    style={{ transition: 'all 0.3s ease' }}>\r\n                    <div className=\"card-label\" style={{ display: 'flex', alignItems: 'center', gap: '6px' }}>\r\n                        / \r\n                        <div className=\"tooltip-container\" onClick={e => e.stopPropagation()}>\r\n                            <Info size={14} style={{ opacity: 0.7 }} />\r\n                            <span className=\"tooltip-text\" style={{ width: '220px', left: '-100px' }}>\r\n                                 1  <br /> 7  ~   30 \r\n                            </span>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"card-value error\">{summary.expiringMembersCount}</div>\r\n                </div>\r\n                {/* [NEW] Dormant Members Card */}\r\n                <div className={`dashboard-card interactive ${filterType === 'dormant' ? 'highlight' : ''}`}\r\n                    onClick={() => handleToggleFilter('dormant')}\r\n                    style={{ transition: 'all 0.3s ease', background: filterType === 'dormant' ? 'var(--primary-gold)' : 'linear-gradient(135deg, rgba(30, 30, 60, 0.4), rgba(50, 50, 80, 0.6))', border: filterType === 'dormant' ? 'none' : '1px solid rgba(100, 100, 255, 0.2)' }}>\r\n                    <div className=\"card-label\" style={{ display: 'flex', alignItems: 'center', gap: '6px', color: filterType === 'dormant' ? 'black' : '#A0A0FF' }}>\r\n                         \r\n                        <div className=\"tooltip-container\" onClick={e => e.stopPropagation()}>\r\n                            <Info size={14} style={{ opacity: 0.7 }} />\r\n                            <span className=\"tooltip-text\" style={{ width: '220px', left: '-100px' }}>\r\n                                  <br />  14  \r\n                            </span>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"card-value\" style={{ color: filterType === 'dormant' ? 'black' : '#E0E0FF' }}>{summary.dormantMembersCount || 0}</div>\r\n                </div>\r\n                {/* [NEW] App Usage & Push Stats (Redesigned) */}\r\n                <div className={`dashboard-card interactive ${filterType === 'installed' ? 'highlight' : ''}`}\r\n                    onClick={() => handleToggleFilter('installed')}\r\n                    style={{ background: filterType === 'installed' ? 'var(--primary-gold)' : 'linear-gradient(135deg, rgba(20, 30, 48, 0.6), rgba(36, 59, 85, 0.4))', border: filterType === 'installed' ? 'none' : '1px solid rgba(16, 185, 129, 0.2)' }}>\r\n                    <div className=\"card-label\" style={{ display: 'flex', alignItems: 'center', gap: '6px', color: filterType === 'installed' ? 'black' : '#6EE7B7' }}>\r\n                        <BellRinging size={16} weight=\"fill\" />   \r\n                        <div className=\"tooltip-container\">\r\n                            <Info size={14} style={{ opacity: 0.7 }} />\r\n                            <span className=\"tooltip-text\" style={{ width: '240px', left: '-120px' }}>\r\n                                      <br/>(  +   )\r\n                            </span>\r\n                        </div>\r\n                    </div>\r\n                    <div style={{ display: 'flex', flexDirection: 'column', marginTop: '4px' }}>\r\n                        <div style={{ display: 'flex', alignItems: 'baseline', gap: '4px' }}>\r\n                            <div className=\"card-value\" style={{ color: filterType === 'installed' ? 'black' : '#10B981', fontSize: '1.6rem', textShadow: filterType !== 'installed' ? '0 0 15px rgba(16, 185, 129, 0.4)' : 'none' }}>\r\n                                {summary.pushEnabledCount}\r\n                            </div>\r\n                            <span style={{ fontSize: '0.9rem', color: filterType === 'installed' ? 'rgba(0,0,0,0.6)' : '#6EE7B7', fontWeight: 'bold' }}>\r\n                                ({summary.reachableRatio}%)\r\n                            </span>\r\n                        </div>\r\n                        <div style={{ fontSize: '0.8rem', color: filterType === 'installed' ? 'rgba(0,0,0,0.7)' : 'var(--text-secondary)', marginTop: '6px' }}>\r\n                            <span style={{ color: filterType === 'installed' ? 'black' : '#93C5FD' }}>  {summary.installedCount} ({summary.installRatio}%)</span>\r\n                            <span style={{ margin: '0 4px', opacity: 0.3 }}>|</span>\r\n                              +{summary.todayInstalledCount}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Revenue Card (Visual Bar Chart Simulated) */}\r\n            <div className=\"dashboard-card interactive\" style={{ marginBottom: '24px', cursor: 'pointer' }} onClick={() => setActiveTab('revenue')}>\r\n                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-end', marginBottom: '10px' }}>\r\n                    <div>\r\n                        <span className=\"card-label outfit-font\" style={{ letterSpacing: '0.1em', textTransform: 'uppercase', fontSize: '0.7rem' }}>  </span>\r\n                        <div className=\"outfit-font\" style={{ fontSize: '1.6rem', fontWeight: '800', color: 'var(--primary-gold)', textShadow: '0 0 20px var(--primary-gold-glow)' }}>\r\n                            {summary.monthlyRevenue.toLocaleString()}\r\n                        </div>\r\n                    </div>\r\n                    <div style={{ fontSize: '0.9rem', color: 'var(--text-secondary)' }}>\r\n                        : {summary.totalRevenueToday.toLocaleString()}\r\n                    </div>\r\n                </div>\r\n                <div style={{ display: 'flex', height: '10px', width: '100%', background: 'rgba(255,255,255,0.05)', borderRadius: '5px', overflow: 'hidden' }}>\r\n                    <div style={{ width: '100%', background: 'linear-gradient(90deg, var(--primary-gold-dim), var(--primary-gold))' }}></div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Legend */}\r\n            <div style={{ display: 'flex', gap: '15px', fontSize: '0.8rem', padding: '0 10px 10px', color: 'var(--text-tertiary)', justifyContent: 'flex-end' }}>\r\n                <div style={{ display: 'flex', alignItems: 'center', gap: '5px' }}><div style={{ width: 8, height: 8, borderRadius: '50%', background: 'var(--accent-error)' }} /> /</div>\r\n                <div style={{ display: 'flex', alignItems: 'center', gap: '5px' }}><div style={{ width: 8, height: 8, borderRadius: '50%', background: '#f59e0b' }} />  (7/3)</div>\r\n                <div style={{ display: 'flex', alignItems: 'center', gap: '5px' }}><div style={{ width: 8, height: 8, borderRadius: '50%', background: 'var(--text-tertiary)' }} /> </div>\r\n            </div>\r\n\r\n            {/* Search & Bulk Actions */}\r\n            <div className=\"search-row\" style={{ display: 'flex', gap: '10px', marginBottom: '16px', alignItems: 'center', flexWrap: 'wrap' }}>\r\n                <div style={{ position: 'relative', flex: 1, minWidth: '200px' }}>\r\n                    <input\r\n                        className=\"search-input\"\r\n                        placeholder=\"    ...\"\r\n                        value={searchTerm}\r\n                        onChange={(e) => { setSearchTerm(e.target.value); setCurrentPage(1); }}\r\n                        style={{ margin: 0 }}\r\n                        lang=\"ko\"\r\n                        inputMode=\"search\"\r\n                        spellCheck=\"false\"\r\n                        autoCorrect=\"off\"\r\n                    />\r\n                </div>\r\n            </div>\r\n\r\n            {/* List Criteria Display */}\r\n            <div style={{ padding: '0 4px', marginBottom: '10px', fontSize: '0.9rem', color: 'var(--text-tertiary)' }}>\r\n                 <strong style={{ color: 'var(--primary-gold)' }}>\r\n                    {filterType === 'all' && ' '}\r\n                    {filterType === 'active' && ' '}\r\n                    {filterType === 'attendance' && '  '}\r\n                    {filterType === 'registration' && '  '}\r\n                    {filterType === 'expiring' && '/  '}\r\n                    {filterType === 'dormant' && ' '}\r\n                    {filterType === 'installed' && '  '}\r\n                </strong>  <strong style={{ color: 'var(--text-secondary)' }}>\r\n                    {filterType === 'attendance' ? '  ' : (filterType === 'installed' ? '  ' : ' ')}\r\n                </strong>  .\r\n            </div>\r\n\r\n            {/* Member List */}\r\n            <div className=\"card-list\">\r\n                {(() => {\r\n                    const totalPages = Math.ceil(finalFiltered.length / itemsPerPage);\r\n                    const startIndex = (currentPage - 1) * itemsPerPage;\r\n                    const paginated = finalFiltered.slice(startIndex, startIndex + itemsPerPage);\r\n\r\n                    return (\r\n                        <>\r\n                            <div style={{ display: 'flex', justifyContent: 'space-between', padding: '0 4px 8px', fontSize: '0.85rem', color: 'var(--text-secondary)' }}>\r\n                                <div onClick={() => selectFilteredMembers(finalFiltered)} style={{ cursor: 'pointer', display: 'flex', alignItems: 'center', gap: '6px' }}>\r\n                                    <div style={{\r\n                                        width: '16px', height: '16px', borderRadius: '4px', border: '1px solid var(--border-color)',\r\n                                        background: finalFiltered.length > 0 && finalFiltered.every(m => selectedMemberIds.includes(m.id)) ? 'var(--primary-gold)' : 'transparent',\r\n                                        display: 'flex', alignItems: 'center', justifyContent: 'center'\r\n                                    }}>\r\n                                        {finalFiltered.length > 0 && finalFiltered.every(m => selectedMemberIds.includes(m.id)) && <Check size={10} color=\"#000\" weight=\"bold\" />}\r\n                                    </div>\r\n                                      ({finalFiltered.length})\r\n                                </div>\r\n                                \r\n                                {/* [NEW] Bulk Action Button */}\r\n                                {selectedMemberIds.length > 0 && (\r\n                                    <button \r\n                                        onClick={() => setShowBulkMessageModal(true)}\r\n                                        style={{\r\n                                            background: 'var(--primary-gold)', color: 'black', border: 'none',\r\n                                            borderRadius: '6px', padding: '4px 12px', fontSize: '0.8rem',\r\n                                            fontWeight: 'bold', cursor: 'pointer', display: 'flex', alignItems: 'center', gap: '4px'\r\n                                        }}\r\n                                    >\r\n                                        <PaperPlaneTilt weight=\"fill\" />\r\n                                          ({selectedMemberIds.length})\r\n                                    </button>\r\n                                )}\r\n\r\n                                <div> {currentPage} / {totalPages || 1}</div>\r\n                            </div>\r\n\r\n                            {paginated.length === 0 ? (\r\n                                <div style={{ textAlign: 'center', padding: '60px 0', opacity: 0.5 }}>\r\n                                        .\r\n                                </div>\r\n                            ) : (\r\n                                paginated.map(member => (\r\n                                    <div\r\n                                        key={member.logId || member.id}\r\n                                        className=\"member-list-item\"\r\n                                        onClick={() => handleOpenEdit(member)}\r\n                                        style={{ cursor: 'pointer' }}\r\n                                    >\r\n                                        <div style={{ padding: '0 10px' }} onClick={(e) => e.stopPropagation()}>\r\n                                            <input\r\n                                                type=\"checkbox\"\r\n                                                checked={selectedMemberIds.includes(member.id)}\r\n                                                onChange={() => toggleMemberSelection(member.id)}\r\n                                            />\r\n                                        </div>\r\n                                        <div style={{ flex: 1, marginLeft: '10px', width: '100%' }}>\r\n                                            <div style={{ display: 'flex', alignItems: 'center', gap: '10px', marginBottom: '4px', flexWrap: 'wrap' }}>\r\n                                                <strong style={{ fontWeight: 800, fontSize: '1.1rem' }}>{member.name}</strong>\r\n                                                \r\n                                                {/* [NEW] Today Registration Badges */}\r\n                                                {member.regDate === todayKstStr && (\r\n                                                    <span className=\"badge\" style={{ background: 'rgba(16, 185, 129, 0.15)', color: '#10B981', border: '1px solid rgba(16, 185, 129, 0.3)' }}>\r\n                                                        \r\n                                                    </span>\r\n                                                )}\r\n                                                {/* Note: In MembersTab, we might not have todayReRegMemberIds prop yet. \r\n                                                    Let's use summary or pass it down. \r\n                                                    Ideally, we should rely on props. Assuming 'todayReRegMemberIds' is passed or available via context?\r\n                                                    Actually, I should check if I can access it. \r\n                                                    Since I cannot easily add a prop to the component signature without changing AdminDashboard first (which I did not do fully),\r\n                                                    I will assume AdminDashboard will pass it. \r\n                                                    Wait, I haven't added `todayReRegMemberIds` to MembersTab props in AdminDashboard yet.\r\n                                                    I will do that in the NEXT step. For now, I'll use optional chaining if possible or safe access.\r\n                                                 */}\r\n                                                 {summary.todayReRegMemberIds && summary.todayReRegMemberIds.includes(member.id) && (\r\n                                            <span className=\"badge\" style={{ background: 'rgba(59, 130, 246, 0.25)', color: '#60A5FA', border: '1px solid rgba(59, 130, 246, 0.5)', fontWeight: 'bold' }}>\r\n                                                \r\n                                            </span>\r\n                                        )}\r\n                                        {summary.multiAttendedMemberIds && summary.multiAttendedMemberIds.includes(member.id) && (\r\n                                            <span className=\"badge\" style={{\r\n                                                background: 'rgba(245, 158, 11, 0.25)', color: '#FBBF24',\r\n                                                border: '1px solid rgba(245, 158, 11, 0.5)', fontWeight: 'bold'\r\n                                            }}>\r\n                                                 2  \r\n                                            </span>\r\n                                        )}\r\n                                                {/* Status Context Badges */}\r\n                                                {filterType === 'dormant' && (() => {\r\n                                                    let lastDateMs = member.lastAttendance ? new Date(member.lastAttendance).getTime() : (member.regDate ? new Date(member.regDate).getTime() : null);\r\n\r\n                                                    if (!lastDateMs) return <span className=\"badge\" style={{ background: 'var(--gray-700)', color: '#bbb' }}> </span>;\r\n\r\n                                                    const diffTime = Math.abs(Date.now() - lastDateMs);\r\n                                                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\r\n\r\n                                                    return (\r\n                                                        <span className=\"badge\" style={{\r\n                                                            background: 'rgba(255, 59, 48, 0.15)',\r\n                                                            color: '#FF3B30',\r\n                                                            border: '1px solid rgba(255, 59, 48, 0.3)',\r\n                                                            fontSize: '0.75rem'\r\n                                                        }}>\r\n                                                            {diffDays} \r\n                                                        </span>\r\n                                                    );\r\n                                                })()}\r\n                                                {/* [NEW] Install Date Badge (Show only when filtered by installed) */}\r\n                                                {filterType === 'installed' && member.installedAt && (() => {\r\n                                                    const installDateStr = new Date(member.installedAt).toLocaleDateString('sv-SE', { timeZone: 'Asia/Seoul' });\r\n                                                    const isToday = installDateStr === todayKstStr;\r\n                                                    \r\n                                                    return (\r\n                                                        <span className=\"badge\" style={{ \r\n                                                            background: isToday ? 'rgba(76, 217, 100, 0.2)' : 'rgba(96, 165, 250, 0.15)', \r\n                                                            color: isToday ? '#4CD964' : '#60A5FA', \r\n                                                            border: isToday ? '1px solid rgba(76, 217, 100, 0.4)' : '1px solid rgba(96, 165, 250, 0.3)'\r\n                                                        }}>\r\n                                                            {isToday ? ' ' : `${installDateStr.slice(2)} `}\r\n                                                        </span>\r\n                                                    );\r\n                                                })()}\r\n\r\n                                                <span style={{ fontSize: '0.8rem', color: 'var(--text-secondary)' }}>{member.phone}</span>\r\n                                                <span className=\"badge\" style={{ \r\n                                                    fontSize: '0.7rem',\r\n                                                    // [UI] Neutralize branch color in member list as requested\r\n                                                    background: 'rgba(255, 255, 255, 0.05)',\r\n                                                    color: 'var(--text-secondary)',\r\n                                                    border: '1px solid rgba(255, 255, 255, 0.1)',\r\n                                                    fontWeight: 'normal'\r\n                                                }}>\r\n                                                    {getBranchName(member.homeBranch)}\r\n                                                </span>\r\n                                                {member.pushEnabled !== false && pushTokens.some(t => t.memberId === member.id) ? (\r\n                                                    <div style={{\r\n                                                        display: 'flex', alignItems: 'center', gap: '4px',\r\n                                                        background: 'rgba(52, 211, 153, 0.1)', color: '#34D399',\r\n                                                        padding: '2px 8px', borderRadius: '6px', fontSize: '0.7rem',\r\n                                                        fontWeight: 'bold', border: '1px solid rgba(52, 211, 153, 0.2)'\r\n                                                    }}>\r\n                                                        <BellRinging size={12} weight=\"fill\" />  ON\r\n                                                    </div>\r\n                                                ) : (\r\n                                                    filterType === 'installed' && (\r\n                                                        <div style={{\r\n                                                            display: 'flex', alignItems: 'center', gap: '4px',\r\n                                                            background: 'rgba(156, 163, 175, 0.1)', color: '#9CA3AF',\r\n                                                            padding: '2px 8px', borderRadius: '6px', fontSize: '0.7rem',\r\n                                                            border: '1px solid rgba(156, 163, 175, 0.2)'\r\n                                                        }}>\r\n                                                            <BellRinging size={12} weight=\"regular\" />  \r\n                                                        </div>\r\n                                                    )\r\n                                                )}\r\n                                                {member.attendanceTime && (\r\n                                                    member.attendanceStatus === 'denied' ? (\r\n                                                        <span style={{\r\n                                                            fontSize: '0.75rem',\r\n                                                            color: '#ff4d4f',\r\n                                                            background: 'rgba(255, 77, 79, 0.15)',\r\n                                                            border: '1px solid rgba(255, 77, 79, 0.3)',\r\n                                                            padding: '2px 8px',\r\n                                                            borderRadius: '6px',\r\n                                                            fontWeight: '700',\r\n                                                            display: 'flex', alignItems: 'center', gap: '4px'\r\n                                                        }}>\r\n                                                              ({member.denialReason === 'expired' ? '' : ''})\r\n                                                        </span>\r\n                                                    ) : (\r\n                                                        <span style={{\r\n                                                            fontSize: '0.75rem',\r\n                                                            color: 'rgba(0,0,0,0.85)',\r\n                                                            background: 'var(--primary-gold)',\r\n                                                            padding: '2px 8px',\r\n                                                            borderRadius: '6px',\r\n                                                            fontWeight: '700'\r\n                                                        }}>\r\n                                                            {member.originalLog?.branchId && `[${getBranchName(member.originalLog.branchId)}] `}\r\n                                                            {member.attendanceClass} ({member.attendanceTime})\r\n                                                        </span>\r\n                                                    )\r\n                                                )}\r\n                                            </div>\r\n                                            <div style={{ fontSize: '0.9rem', color: 'var(--text-secondary)', display: 'flex', flexWrap: 'wrap', gap: '8px', alignItems: 'center' }}>\r\n                                                <span>{member.subject || ''}</span>\r\n                                                <span style={{ opacity: 0.3 }}>|</span>\r\n                                                <span style={{ color: member.credits <= 0 ? 'var(--accent-error)' : (member.credits <= 3 ? '#f59e0b' : 'var(--text-primary)'), fontWeight: 'bold' }}> {member.credits}</span>\r\n                                                <span style={{ opacity: 0.3 }}>|</span>\r\n                                                <span style={{\r\n                                                    color: (() => {\r\n                                                        if (!member.endDate || member.endDate === 'TBD' || member.endDate === 'unlimited') return 'var(--text-tertiary)';\r\n                                                        const endMs = new Date(member.endDate).getTime();\r\n                                                        const diff = (endMs - todayStartMs) / (1000 * 60 * 60 * 24);\r\n                                                        \r\n                                                        if (diff < 0) return 'var(--accent-error)';\r\n                                                        if (diff <= 7) return '#f59e0b';\r\n                                                        return 'var(--text-tertiary)';\r\n                                                    })(),\r\n                                                    fontSize: '0.85rem'\r\n                                                }}>\r\n                                                    : {member.endDate === 'TBD' ? '   ' : (member.endDate || '')}\r\n                                                </span>\r\n                                            </div>\r\n                                            {member.notes && (\r\n                                                <div style={{ marginTop: '8px', padding: '8px', background: 'rgba(212,175,55,0.1)', borderRadius: '4px', fontSize: '0.8rem', color: 'var(--primary-gold)' }}>\r\n                                                    <NotePencil size={12} style={{ marginRight: '4px' }} /> {member.notes}\r\n                                                </div>\r\n                                            )}\r\n                                        </div>\r\n                                    </div>\r\n                                ))\r\n                            )}\r\n\r\n                            <div style={{ display: 'flex', justifyContent: 'center', gap: '6px', marginTop: '20px' }}>\r\n                                <button\r\n                                    onClick={() => setCurrentPage(p => Math.max(1, p - 1))}\r\n                                    disabled={currentPage === 1}\r\n                                    style={{\r\n                                        width: '32px', height: '32px', borderRadius: '8px',\r\n                                        background: 'var(--bg-surface)', border: '1px solid var(--border-color)',\r\n                                        color: 'white', opacity: currentPage === 1 ? 0.3 : 1\r\n                                    }}\r\n                                >\r\n                                    &lt;\r\n                                </button>\r\n\r\n                                {(() => {\r\n                                    const MAX_VISIBLE_PAGES = 5;\r\n                                    let startPage = Math.max(1, currentPage - Math.floor(MAX_VISIBLE_PAGES / 2));\r\n                                    let endPage = Math.min(totalPages, startPage + MAX_VISIBLE_PAGES - 1);\r\n\r\n                                    if (endPage - startPage + 1 < MAX_VISIBLE_PAGES) {\r\n                                        startPage = Math.max(1, endPage - MAX_VISIBLE_PAGES + 1);\r\n                                    }\r\n\r\n                                    const pages = [];\r\n                                    if (startPage > 1) {\r\n                                        pages.push(1);\r\n                                        if (startPage > 2) pages.push('...');\r\n                                    }\r\n\r\n                                    for (let i = startPage; i <= endPage; i++) {\r\n                                        pages.push(i);\r\n                                    }\r\n\r\n                                    if (endPage < totalPages) {\r\n                                        if (endPage < totalPages - 1) pages.push('...');\r\n                                        pages.push(totalPages);\r\n                                    }\r\n\r\n                                    return pages.map((page, idx) => (\r\n                                        <button\r\n                                            key={idx}\r\n                                            onClick={() => typeof page === 'number' && setCurrentPage(page)}\r\n                                            disabled={page === '...'}\r\n                                            style={{\r\n                                                width: '32px', height: '32px', borderRadius: '8px',\r\n                                                background: currentPage === page ? 'var(--primary-gold)' : 'var(--bg-surface)',\r\n                                                color: currentPage === page ? '#000' : 'var(--text-secondary)',\r\n                                                fontWeight: 'bold', border: '1px solid var(--border-color)',\r\n                                                cursor: page === '...' ? 'default' : 'pointer',\r\n                                                opacity: page === '...' ? 0.5 : 1\r\n                                            }}\r\n                                        >\r\n                                            {page}\r\n                                        </button>\r\n                                    ));\r\n                                })()}\r\n\r\n                                <button\r\n                                    onClick={() => setCurrentPage(p => Math.min(totalPages, p + 1))}\r\n                                    disabled={currentPage === totalPages}\r\n                                    style={{\r\n                                        width: '32px', height: '32px', borderRadius: '8px',\r\n                                        background: 'var(--bg-surface)', border: '1px solid var(--border-color)',\r\n                                        color: 'white', opacity: currentPage === totalPages ? 0.3 : 1\r\n                                    }}\r\n                                >\r\n                                    &gt;\r\n                                </button>\r\n                            </div>\r\n                        </>\r\n                    );\r\n                })()}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default MembersTab;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\admin\\tabs\\NoticesTab.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\admin\\tabs\\PushHistoryTab.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\admin\\tabs\\StatsTab.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\checkin\\DigitalClock.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\checkin\\TopBar.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\common\\CosmicParticles.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\common\\CustomDatePicker.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\common\\CustomGlassModal.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,18],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\n\r\n// [LUXURY] Glassmorphic Modal Component\r\nconst CustomGlassModal = ({ message, isConfirm, onConfirm, onCancel }) => (\r\n    <div style={{\r\n        position: 'fixed', top: 0, left: 0, right: 0, bottom: 0,\r\n        background: 'rgba(0,0,0,0.8)', \r\n        zIndex: 9999, display: 'flex', alignItems: 'center', justifyContent: 'center',\r\n        animation: 'fadeIn 0.2s ease-out'\r\n    }}>\r\n        <div style={{\r\n            background: 'rgba(25, 25, 28, 0.95)',\r\n            border: '1px solid rgba(255,255,255,0.1)',\r\n            borderRadius: '24px',\r\n            padding: '30px',\r\n            width: '85%',\r\n            maxWidth: '320px',\r\n            textAlign: 'center',\r\n            boxShadow: '0 20px 50px rgba(0,0,0,0.5)',\r\n            transform: 'scale(1)',\r\n            animation: 'scaleUp 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)'\r\n        }}>\r\n           <h3 style={{ color: 'white', fontSize: '1.1rem', marginBottom: '20px', fontWeight: '600', lineHeight: '1.5' }}>\r\n               {message}\r\n           </h3>\r\n           <div style={{ display: 'flex', gap: '10px', justifyContent: 'center' }}>\r\n               {isConfirm && (\r\n                   <button onClick={onCancel} style={{\r\n                       padding: '12px 24px', borderRadius: '14px', border: 'none',\r\n                       background: 'rgba(255,255,255,0.1)', color: 'white', fontWeight: '600', flex: 1\r\n                   }}>\r\n                       \r\n                   </button>\r\n               )}\r\n               <button onClick={onConfirm || onCancel} style={{\r\n                   padding: '12px 24px', borderRadius: '14px', border: 'none',\r\n                   background: 'var(--primary-gold)', color: 'black', fontWeight: '700', flex: 1,\r\n                   boxShadow: '0 4px 15px rgba(255, 215, 0, 0.2)'\r\n               }}>\r\n                   \r\n               </button>\r\n           </div>\r\n        </div>\r\n    </div>\r\n);\r\n\r\nexport default CustomGlassModal;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\common\\ImageLightbox.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\common\\NetworkStatus.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'WifiHigh' is defined but never used.","line":3,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":18,"suggestions":[{"messageId":"removeVar","data":{"varName":"WifiHigh"},"fix":{"range":[121,130],"text":""},"desc":"Remove unused variable 'WifiHigh'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'WifiSlash' is defined but never used.","line":3,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":29,"suggestions":[{"messageId":"removeVar","data":{"varName":"WifiSlash"},"fix":{"range":[129,140],"text":""},"desc":"Remove unused variable 'WifiSlash'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'isOnline' is assigned a value but never used.","line":8,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":21,"suggestions":[{"messageId":"removeVar","data":{"varName":"isOnline"},"fix":{"range":[376,410],"text":""},"desc":"Remove unused variable 'isOnline'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { memo, useState, useEffect } from 'react';\r\nimport { useNetwork } from '../../context/NetworkContext';\r\nimport { WifiHigh, WifiSlash, CloudArrowUp } from '@phosphor-icons/react'; // [ICON] CloudArrowUp for sync\r\nimport { collection, query, where, onSnapshot } from 'firebase/firestore';\r\nimport { db } from '../../firebase';\r\n\r\nconst NetworkStatus = memo(() => {\r\n    const { isOnline } = useNetwork();\r\n    const [pendingCount, setPendingCount] = useState(0);\r\n\r\n    // [SYNC] Monitor pending offline data count\r\n    useEffect(() => {\r\n        const q = query(\r\n            collection(db, 'pending_attendance'),\r\n            where('status', '==', 'pending-offline')\r\n        );\r\n\r\n        const unsubscribe = onSnapshot(q, (snapshot) => {\r\n            setPendingCount(snapshot.size);\r\n        }, (error) => {\r\n            console.warn(\"[NetworkStatus] Failed to subscribe to pending count:\", error);\r\n        });\r\n\r\n        return () => unsubscribe();\r\n    }, []);\r\n\r\n    // [UI] Only show if there are pending items AND we are in Kiosk mode (root path)\r\n    // User Request: '       '\r\n    const isKioskMode = window.location.pathname === '/';\r\n\r\n    if (!isKioskMode || pendingCount === 0) return null;\r\n\r\n    return (\r\n        <div \r\n            className=\"global-network-status\"\r\n            style={{\r\n                position: 'fixed',\r\n                bottom: '24px',\r\n                right: '24px',\r\n                zIndex: 9999,\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                gap: '8px',\r\n                padding: '8px 16px',\r\n                background: 'rgba(255, 183, 77, 0.9)', // Orange background\r\n                backdropFilter: 'blur(10px)',\r\n                border: '1px solid rgba(255, 183, 77, 1)',\r\n                borderRadius: '30px',\r\n                fontSize: '0.9rem',\r\n                fontWeight: 700,\r\n                color: '#000', // Black text for contrast\r\n                boxShadow: '0 4px 15px rgba(0,0,0,0.3)',\r\n                pointerEvents: 'none',\r\n            }}\r\n        >\r\n            <CloudArrowUp size={20} weight=\"duotone\" />\r\n            <span>  : {pendingCount}</span>\r\n        </div>\r\n    );\r\n});\r\n\r\nNetworkStatus.displayName = 'NetworkStatus';\r\n\r\nexport default NetworkStatus;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\common\\NotificationListener.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\common\\SimpleImageModal.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,18],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { createPortal } from 'react-dom';\r\nimport { X } from '@phosphor-icons/react';\r\n\r\nconst SimpleImageModal = ({ isOpen, onClose, imageSrc }) => {\r\n    if (!isOpen || !imageSrc) return null;\r\n\r\n    return createPortal(\r\n        <div \r\n            style={{\r\n                position: 'fixed',\r\n                top: 0,\r\n                left: 0,\r\n                right: 0,\r\n                bottom: 0,\r\n                backgroundColor: 'black', //  \r\n                zIndex: 9999, // \r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                padding: '20px',\r\n                backdropFilter: 'none' //       \r\n            }}\r\n            onClick={onClose}\r\n        >\r\n            <button \r\n                onClick={onClose}\r\n                style={{\r\n                    position: 'absolute',\r\n                    top: '20px',\r\n                    right: '20px',\r\n                    background: 'rgba(255, 255, 255, 0.15)',\r\n                    border: 'none',\r\n                    borderRadius: '50%',\r\n                    width: '44px',\r\n                    height: '44px',\r\n                    display: 'flex',\r\n                    alignItems: 'center',\r\n                    justifyContent: 'center',\r\n                    cursor: 'pointer',\r\n                    color: 'white',\r\n                    zIndex: 10000,\r\n                    backdropFilter: 'blur(4px)'\r\n                }}\r\n            >\r\n                <X size={28} />\r\n            </button>\r\n            \r\n            <img \r\n                src={imageSrc} \r\n                alt=\"Enlarged view\" \r\n                style={{\r\n                    maxWidth: '100%',\r\n                    maxHeight: '90vh',\r\n                    objectFit: 'contain',\r\n                    borderRadius: '4px',\r\n                    boxShadow: '0 4px 30px rgba(0,0,0,0.5)'\r\n                }}\r\n                onClick={(e) => e.stopPropagation()} \r\n            />\r\n        </div>,\r\n        document.body\r\n    );\r\n};\r\n\r\nexport default SimpleImageModal;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\instructor\\InstructorHome.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\instructor\\InstructorLogin.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\instructor\\InstructorNotices.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\instructor\\InstructorSchedule.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\meditation\\MeditationDebugOverlay.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,18],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\n\r\n//  Meditation Debug Overlay Component\r\nexport const MeditationDebugOverlay = ({ isVisible, ttsState, currentStep, audioLevels, currentText, aiLatency }) => {\r\n    if (!isVisible) return null;\r\n\r\n    return (\r\n        <div style={{\r\n            position: 'fixed', top: '80px', left: '20px', right: '20px',\r\n            background: 'rgba(0,0,0,0.85)', backdropFilter: 'blur(10px)',\r\n            border: '1px solid rgba(0,255,255,0.3)', borderRadius: '15px',\r\n            padding: '15px', color: '#00ffff', fontSize: '0.75rem', zIndex: 10000,\r\n            fontFamily: 'monospace', pointerEvents: 'none', boxShadow: '0 10px 30px rgba(0,0,0,0.5)'\r\n        }}>\r\n            <div style={{ fontWeight: 'bold', marginBottom: '8px', borderBottom: '1px solid rgba(0,255,255,0.2)', paddingBottom: '4px', display: 'flex', justifyContent: 'space-between' }}>\r\n                <span>[MEDITATION DEBUG MODE]</span>\r\n                <span>Latency: {aiLatency}ms</span>\r\n            </div>\r\n            \r\n            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '10px' }}>\r\n                <div>\r\n                    <div style={{ color: '#fff', marginBottom: '4px' }}> AI & Step Status</div>\r\n                    <div>Step: {currentStep}</div>\r\n                    <div>TTS Engine: {ttsState.engine}</div>\r\n                    <div>Speaking: {ttsState.isSpeaking ? 'YES' : 'NO'}</div>\r\n                </div>\r\n                <div>\r\n                    <div style={{ color: '#fff', marginBottom: '4px' }}> Audio Levels</div>\r\n                    <div>Voice: {Math.round(audioLevels.voice * 100)}%</div>\r\n                    <div>Ambient: {Math.round(audioLevels.ambient * 100)}%</div>\r\n                    <div>Binaural: {Math.round(audioLevels.binaural * 100)}%</div>\r\n                </div>\r\n            </div>\r\n\r\n            <div style={{ marginTop: '10px', paddingTop: '8px', borderTop: '1px solid rgba(0,255,255,0.1)' }}>\r\n                <div style={{ color: '#fff', marginBottom: '4px' }}> Raw TTS Text:</div>\r\n                <div style={{ background: 'rgba(0,0,0,0.3)', padding: '6px', borderRadius: '4px', maxHeight: '60px', overflowY: 'auto', whiteSpace: 'pre-wrap' }}>\r\n                    {currentText || 'No text currently processed'}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\meditation\\ui\\AILoadingIndicator.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\meditation\\ui\\ChatDialog.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,18],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { AILoadingIndicator } from './AILoadingIndicator';\r\nimport { Icons as PhosphorIcons } from '../../../components/CommonIcons';\r\n\r\nconst { Microphone, LockKey } = PhosphorIcons;\r\n\r\nexport const ChatDialog = ({\r\n    chatHistory,\r\n    currentAIChat,\r\n    isAILoading,\r\n    chatEndRef,\r\n    stopAllAudio,\r\n    handleChatResponse,\r\n    manualInput,\r\n    setManualInput,\r\n    handleManualSubmit,\r\n    isAnalyzing,\r\n    onStartMeditation\r\n}) => {\r\n    return (\r\n        <div style={{\r\n            position: 'absolute', bottom: '0', left: '0', right: '0',\r\n            background: 'linear-gradient(to top, rgba(10,10,12,0.95) 40%, rgba(10,10,12,0.8) 80%, transparent)',\r\n            display: 'flex', flexDirection: 'column', zIndex: 100,\r\n            paddingTop: '60px'\r\n        }}>\r\n            {/* 2. Messages Area */}\r\n            <div className=\"no-scrollbar\" style={{ \r\n                flex: 1, overflowY: 'auto', padding: '0 20px 20px', \r\n                display: 'flex', flexDirection: 'column', gap: '16px' \r\n            }}>\r\n                {chatHistory.map((chat, idx) => (\r\n                    <div key={idx} style={{\r\n                        alignSelf: chat.role === 'user' ? 'flex-end' : 'flex-start',\r\n                        maxWidth: '80vw', opacity: 0.9, lineHeight: '1.5',\r\n                        display: 'flex', flexDirection: 'row', alignItems: 'flex-end', gap: '8px'\r\n                    }}>\r\n                        {chat.role === 'model' && (\r\n                            <div style={{\r\n                                width: '36px', height: '36px', borderRadius: '50%',\r\n                                background: 'rgba(255,255,255,0.1)', display: 'flex', alignItems: 'center', justifyContent: 'center',\r\n                                overflow: 'hidden', border: '1px solid rgba(255,255,255,0.05)', flexShrink: 0\r\n                            }}>\r\n                                <img src=\"/pwa-192x192.png\" alt=\"AI\" style={{ width: '100%', height: '100%', objectFit: 'cover' }} onError={(e) => { e.target.style.display='none'; e.target.parentNode.innerText=''; }} />\r\n                            </div>\r\n                        )}\r\n                        <div style={{\r\n                            background: chat.role === 'user' ? 'rgba(212,175,55,0.15)' : 'rgba(255,255,255,0.05)',\r\n                            color: chat.role === 'user' ? 'var(--primary-gold)' : 'white',\r\n                            padding: '12px 18px',\r\n                            borderRadius: chat.role === 'user' ? '18px 18px 4px 18px' : '18px 18px 18px 4px',\r\n                            border: chat.role === 'user' ? '1px solid rgba(212,175,55,0.3)' : '1px solid rgba(255,255,255,0.1)',\r\n                            fontSize: '0.95rem'\r\n                        }}>{chat.content}</div>\r\n                    </div>\r\n                ))}\r\n                \r\n                {/* AI Response Area */}\r\n                {currentAIChat && !isAILoading && (\r\n                    <div style={{ display: 'flex', justifyContent: 'flex-start', alignItems: 'flex-start', gap: '8px' }}>\r\n                        <div style={{\r\n                            width: '40px', height: '40px', borderRadius: '50%',\r\n                            background: 'white', display: 'flex', alignItems: 'center', justifyContent: 'center',\r\n                            overflow: 'hidden', border: '1px solid rgba(255,255,255,0.1)', flexShrink: 0\r\n                        }}>\r\n                            <img src=\"/pwa-192x192.png\" alt=\"AI\" style={{ width: '100%', height: '100%', objectFit: 'cover' }} onError={(e) => { e.target.style.display='none'; e.target.parentNode.innerText=''; }} />\r\n                        </div>\r\n                        <div style={{ display: 'flex', flexDirection: 'row', alignItems: 'flex-end', gap: '6px' }}>\r\n                            <div style={{\r\n                                background: 'rgba(255,255,255,0.08)', color: 'white', padding: '14px 18px',\r\n                                borderRadius: '4px 18px 18px 18px', maxWidth: '75vw', fontSize: '1.0rem', lineHeight: '1.6',\r\n                                boxShadow: '0 4px 15px rgba(0,0,0,0.3)', border: '1px solid rgba(255,255,255,0.15)', backdropFilter: 'blur(10px)'\r\n                            }}>{currentAIChat.message || currentAIChat.question || \"  ?\"}</div>\r\n                            <span style={{ fontSize: '0.7rem', color: 'rgba(255,255,255,0.4)', marginBottom: '2px' }}>\r\n                                {new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\r\n                            </span>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {isAILoading && (\r\n                    <div style={{ alignSelf: 'center', marginTop: '10px' }}>\r\n                        <AILoadingIndicator compact={true} message={chatHistory.length === 0 ? \"AI     ...\" : null} />\r\n                    </div>\r\n                )}\r\n                <div ref={chatEndRef} style={{ height: '2px', width: '100%' }} />\r\n            </div>\r\n\r\n            {/* 3. Bottom Options & Input */}\r\n            <div style={{\r\n                background: '#1a1a1d', borderTop: '1px solid rgba(255,255,255,0.1)',\r\n                padding: '15px', paddingBottom: 'calc(15px + env(safe-area-inset-bottom))',\r\n                display: 'flex', flexDirection: 'column', gap: '12px', zIndex: 20\r\n            }}>\r\n                {/*    */}\r\n                {!isAILoading && currentAIChat?.isFinalAnalysis && (\r\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '10px', animation: 'fadeIn 0.5s ease' }}>\r\n                        <button onClick={onStartMeditation} style={{\r\n                            width: '100%', background: 'var(--primary-gold)', color: 'black',\r\n                            padding: '18px', borderRadius: '20px', fontSize: '1.1rem', fontWeight: 800, border: 'none',\r\n                            cursor: 'pointer', display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '8px',\r\n                            boxShadow: '0 10px 20px rgba(212,175,55,0.3)'\r\n                        }}>  </button>\r\n                        <p style={{ textAlign: 'center', fontSize: '0.8rem', color: 'rgba(255,255,255,0.4)' }}>\r\n                               \r\n                        </p>\r\n                    </div>\r\n                )}\r\n\r\n                {/*    */}\r\n                {!isAILoading && currentAIChat?.options?.length > 0 && !currentAIChat?.isFinalAnalysis && (\r\n                    <div className=\"no-scrollbar\" style={{ display: 'flex', gap: '8px', overflowX: 'auto', paddingBottom: '10px', scrollbarWidth: 'none', justifyContent: 'flex-start' }}>\r\n                        {currentAIChat.options.map((opt, i) => (\r\n                            <button key={i} onClick={() => { stopAllAudio(); handleChatResponse(opt); }}\r\n                                style={{\r\n                                    flex: '0 0 auto', background: 'rgba(255,255,255,0.08)', border: '1px solid rgba(255,255,255,0.15)',\r\n                                    padding: '10px 18px', borderRadius: '18px', color: 'rgba(255,255,255,0.9)', \r\n                                    fontSize: '0.9rem', cursor: 'pointer', transition: 'all 0.2s', backdropFilter: 'blur(5px)'\r\n                                }}>{opt}</button>\r\n                        ))}\r\n                    </div>\r\n                )}\r\n\r\n                {/*  (/) */}\r\n                {!currentAIChat?.isFinalAnalysis && !currentAIChat?.isTransition && !isAnalyzing && (\r\n                    <form onSubmit={handleManualSubmit} style={{ display: 'flex', gap: '10px', alignItems: 'stretch', height: '52px' }}>\r\n                        {/* Audio Mock Record Button */}\r\n                        <button type=\"button\" style={{\r\n                            width: '52px', borderRadius: '16px', border: 'none',\r\n                            background: 'rgba(255,255,255,0.05)', color: 'white', display: 'flex', alignItems: 'center', justifyContent: 'center',\r\n                            flexShrink: 0\r\n                        }}>\r\n                            <Microphone size={24} weight=\"fill\" />\r\n                        </button>\r\n\r\n                        <div style={{ flex: 1, position: 'relative', display: 'flex', alignItems: 'center' }}>\r\n                            <input \r\n                                type=\"text\"\r\n                                value={manualInput}\r\n                                onChange={e => setManualInput(e.target.value)}\r\n                                placeholder=\"   ...\"\r\n                                disabled={isAILoading}\r\n                                style={{\r\n                                    width: '100%', height: '100%', background: 'rgba(255,255,255,0.05)', border: '1px solid rgba(255,255,255,0.1)',\r\n                                    borderRadius: '16px', color: 'white', padding: '0 45px 0 15px', fontSize: '0.95rem'\r\n                                }}\r\n                            />\r\n                            {isAILoading && <LockKey size={18} color=\"rgba(255,255,255,0.3)\" style={{ position: 'absolute', right: '15px' }} />}\r\n                        </div>\r\n                    </form>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\meditation\\ui\\FeedbackView.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,18],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'Sparkle' is assigned a value but never used.","line":5,"column":30,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":37,"suggestions":[{"messageId":"removeVar","data":{"varName":"Sparkle"},"fix":{"range":[181,190],"text":""},"desc":"Remove unused variable 'Sparkle'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'formatTime' is defined but never used.","line":10,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":15,"suggestions":[{"messageId":"removeVar","data":{"varName":"formatTime"},"fix":{"range":[280,298],"text":""},"desc":"Remove unused variable 'formatTime'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'navigate' is assigned a value but never used.","line":15,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":19,"suggestions":[{"messageId":"removeVar","data":{"varName":"navigate"},"fix":{"range":[361,392],"text":""},"desc":"Remove unused variable 'navigate'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { Icons as PhosphorIcons } from '../../../components/CommonIcons';\r\n\r\nconst { X, Heartbeat, Brain, Sparkle } = PhosphorIcons;\r\n\r\nexport const FeedbackView = ({ \r\n    activeMode, \r\n    feedbackData, \r\n    formatTime, \r\n    timeLeft, \r\n    modeName, \r\n    onClose \r\n}) => {\r\n    const navigate = useNavigate();\r\n    const duration = activeMode?.id === 'breath' ? 3 * 60 : (activeMode?.id === 'calm' ? 7 * 60 : 15 * 60);\r\n    const actualTime = duration - timeLeft;\r\n\r\n    return (\r\n        <div style={{\r\n            position: 'fixed', inset: 0, background: '#0a0a0c', zIndex: 4000,\r\n            display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center',\r\n            padding: '20px', overflowY: 'auto'\r\n        }}>\r\n            <button onClick={onClose} style={{\r\n                position: 'absolute', top: '20px', right: '20px',\r\n                background: 'rgba(255,255,255,0.1)', border: 'none', color: 'white',\r\n                width: '50px', height: '50px', borderRadius: '50%',\r\n                display: 'flex', alignItems: 'center', justifyContent: 'center', cursor: 'pointer'\r\n            }}><X size={24} /></button>\r\n\r\n            <div style={{\r\n                background: 'linear-gradient(145deg, rgba(30,30,35,0.9), rgba(15,15,20,0.9))',\r\n                borderRadius: '30px', padding: '40px', maxWidth: '600px', width: '100%',\r\n                border: `1px solid ${activeMode?.color}40`,\r\n                boxShadow: `0 20px 80px ${activeMode?.color}20`,\r\n                animation: 'fadeIn 0.5s ease-out'\r\n            }}>\r\n                <div style={{ textAlign: 'center', marginBottom: '30px' }}>\r\n                    <div style={{\r\n                        width: '80px', height: '80px', borderRadius: '50%',\r\n                        background: `${activeMode?.color}20`, margin: '0 auto 20px',\r\n                        display: 'flex', alignItems: 'center', justifyContent: 'center',\r\n                        color: activeMode?.color\r\n                    }}>\r\n                        <Brain size={40} weight=\"light\" />\r\n                    </div>\r\n                    <h2 style={{ color: 'white', fontSize: '1.8rem', fontWeight: 600, marginBottom: '10px' }}>\r\n                          \r\n                    </h2>\r\n                    <p style={{ color: 'rgba(255,255,255,0.6)', fontSize: '1.1rem' }}>\r\n                        {modeName}  {Math.floor(actualTime / 60)} {actualTime % 60} \r\n                    </p>\r\n                </div>\r\n\r\n                {feedbackData ? (\r\n                    <div style={{ \r\n                        background: 'rgba(0,0,0,0.3)', borderRadius: '20px', padding: '25px',\r\n                        border: '1px solid rgba(255,255,255,0.05)'\r\n                    }}>\r\n                        <div style={{ display: 'flex', alignItems: 'center', gap: '10px', marginBottom: '15px' }}>\r\n                            <Heartbeat size={24} color={activeMode?.color} />\r\n                            <h3 style={{ color: 'white', fontSize: '1.2rem', fontWeight: 500, margin: 0 }}>\r\n                                   \r\n                            </h3>\r\n                        </div>\r\n                        <p style={{ \r\n                            color: 'rgba(255,255,255,0.9)', lineHeight: 1.8, fontSize: '1.1rem',\r\n                            whiteSpace: 'pre-wrap'\r\n                        }}>\r\n                            {feedbackData.message}\r\n                        </p>\r\n                        \r\n                        {feedbackData.analysis && (\r\n                            <div style={{ \r\n                                marginTop: '20px', paddingTop: '20px', borderTop: '1px solid rgba(255,255,255,0.1)',\r\n                                display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '15px'\r\n                            }}>\r\n                                <div style={{ background: 'rgba(255,255,255,0.05)', padding: '15px', borderRadius: '15px' }}>\r\n                                    <span style={{ display: 'block', color: 'rgba(255,255,255,0.5)', fontSize: '0.85rem', marginBottom: '5px' }}> </span>\r\n                                    <span style={{ color: 'white', fontSize: '1.2rem', fontWeight: 600 }}>{feedbackData.analysis.stabilityScore}/100</span>\r\n                                </div>\r\n                                <div style={{ background: 'rgba(255,255,255,0.05)', padding: '15px', borderRadius: '15px' }}>\r\n                                    <span style={{ display: 'block', color: 'rgba(255,255,255,0.5)', fontSize: '0.85rem', marginBottom: '5px' }}> </span>\r\n                                    <span style={{ color: 'white', fontSize: '1.1rem', fontWeight: 500 }}>{feedbackData.analysis.energyShift}</span>\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                ) : (\r\n                    <div style={{ textAlign: 'center', padding: '40px 0' }}>\r\n                        <div className=\"breathing-circle\" style={{ \r\n                            width: '40px', height: '40px', margin: '0 auto 20px',\r\n                            background: activeMode?.color, borderRadius: '50%' \r\n                        }} />\r\n                        <p style={{ color: 'rgba(255,255,255,0.6)' }}>   ...</p>\r\n                    </div>\r\n                )}\r\n\r\n                <button onClick={onClose} style={{\r\n                    width: '100%', padding: '20px', marginTop: '30px',\r\n                    background: activeMode?.color, border: 'none', borderRadius: '15px',\r\n                    color: '#000', fontSize: '1.2rem', fontWeight: 600, cursor: 'pointer',\r\n                    boxShadow: `0 10px 30px ${activeMode?.color}40`\r\n                }}>\r\n                       \r\n                </button>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\meditation\\ui\\PoseCanvas.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,18],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\n\r\nexport const PoseCanvas = ({ videoRef, canvasRef }) => (\r\n    <div style={{ position: 'absolute', inset: 0, zIndex: 1, opacity: 0.6 }}>\r\n        <video \r\n            ref={videoRef} \r\n            autoPlay \r\n            playsInline \r\n            muted \r\n            style={{ width: '100%', height: '100%', objectFit: 'cover', transform: 'scaleX(-1)' }} \r\n        />\r\n        <canvas\r\n            ref={canvasRef}\r\n            width={window.innerWidth}\r\n            height={window.innerHeight}\r\n            style={{\r\n                position: 'absolute', inset: 0,\r\n                width: '100%', height: '100%',\r\n                transform: 'scaleX(-1)', // Mirror to match video\r\n                pointerEvents: 'none'\r\n            }}\r\n        />\r\n        <div style={{\r\n            position: 'absolute', top: '50%', left: '50%', transform: 'translate(-50%, -50%)',\r\n            width: '280px', height: '350px',\r\n            border: '1px solid rgba(255, 215, 0, 0.3)', borderRadius: '120px',\r\n            boxShadow: '0 0 80px rgba(255, 215, 0, 0.1) inset'\r\n        }} />\r\n    </div>\r\n);\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\meditation\\ui\\VolumeControlPanel.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,18],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { Icons as PhosphorIcons } from '../../../components/CommonIcons';\r\n\r\nconst { X } = PhosphorIcons;\r\n\r\nexport const VolumeControlPanel = ({\r\n    showVolumePanel,\r\n    setShowVolumePanel,\r\n    audioVolumes,\r\n    setAudioVolumes,\r\n    currentAudioRef,\r\n    updateAmbientVolume,\r\n    updateBinauralVolume,\r\n    soundEnabled,\r\n    setSoundEnabled\r\n}) => {\r\n    if (!showVolumePanel) return null;\r\n\r\n    return (\r\n        <div style={{\r\n            position: 'absolute', bottom: '180px', left: '50%', transform: 'translateX(-50%)',\r\n            width: '280px', background: 'rgba(0,0,0,0.85)', backdropFilter: 'blur(20px)',\r\n            borderRadius: '24px', padding: '20px', zIndex: 30,\r\n            border: '1px solid rgba(255,255,255,0.15)', boxShadow: '0 20px 60px rgba(0,0,0,0.6)',\r\n            animation: 'fadeIn 0.3s ease'\r\n        }}>\r\n            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '15px' }}>\r\n                <span style={{ color: 'var(--primary-gold)', fontSize: '0.85rem', fontWeight: 700 }}>  </span>\r\n                <button onClick={() => setShowVolumePanel(false)} style={{ background: 'none', border: 'none', color: 'rgba(255,255,255,0.5)', cursor: 'pointer', padding: '4px' }}>\r\n                    <X size={18} />\r\n                </button>\r\n            </div>\r\n            \r\n            {/* Voice Volume */}\r\n            <div style={{ marginBottom: '12px' }}>\r\n                <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '6px' }}>\r\n                    <span style={{ fontSize: '0.8rem', color: 'rgba(255,255,255,0.7)' }}>  </span>\r\n                    <span style={{ fontSize: '0.75rem', color: 'var(--primary-gold)' }}>{Math.round(audioVolumes.voice * 100)}%</span>\r\n                </div>\r\n                <input type=\"range\" min=\"0\" max=\"100\" value={Math.round(audioVolumes.voice * 100)}\r\n                    onChange={(e) => {\r\n                        const val = parseInt(e.target.value) / 100;\r\n                        setAudioVolumes(prev => ({ ...prev, voice: val }));\r\n                        if (currentAudioRef.current) currentAudioRef.current.volume = val;\r\n                    }}\r\n                    style={{ width: '100%', accentColor: 'var(--primary-gold)', height: '4px' }} />\r\n            </div>\r\n            \r\n            {/* Ambient Volume */}\r\n            <div style={{ marginBottom: '12px' }}>\r\n                <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '6px' }}>\r\n                    <span style={{ fontSize: '0.8rem', color: 'rgba(255,255,255,0.7)' }}> </span>\r\n                    <span style={{ fontSize: '0.75rem', color: 'var(--primary-gold)' }}>{Math.round(audioVolumes.ambient * 100)}%</span>\r\n                </div>\r\n                <input type=\"range\" min=\"0\" max=\"100\" value={Math.round(audioVolumes.ambient * 100)}\r\n                    onChange={(e) => {\r\n                        const val = parseInt(e.target.value) / 100;\r\n                        setAudioVolumes(prev => ({ ...prev, ambient: val }));\r\n                        updateAmbientVolume(val);\r\n                    }}\r\n                    style={{ width: '100%', accentColor: '#4ade80', height: '4px' }} />\r\n            </div>\r\n            \r\n            {/* Binaural Volume */}\r\n            <div>\r\n                <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '6px' }}>\r\n                    <span style={{ fontSize: '0.8rem', color: 'rgba(255,255,255,0.7)' }}> </span>\r\n                    <span style={{ fontSize: '0.75rem', color: 'var(--primary-gold)' }}>{Math.round(audioVolumes.binaural * 100)}%</span>\r\n                </div>\r\n                <input type=\"range\" min=\"0\" max=\"100\" value={Math.round(audioVolumes.binaural * 100)}\r\n                    onChange={(e) => {\r\n                        const val = parseInt(e.target.value) / 100;\r\n                        setAudioVolumes(prev => ({ ...prev, binaural: val }));\r\n                        updateBinauralVolume(val);\r\n                    }}\r\n                    style={{ width: '100%', accentColor: '#a29bfe', height: '4px' }} />\r\n            </div>\r\n            \r\n            {/* Mute All Toggle */}\r\n            <button onClick={() => {\r\n                setSoundEnabled(!soundEnabled);\r\n                if (soundEnabled) {\r\n                    // Mute all\r\n                    updateAmbientVolume(0);\r\n                    updateBinauralVolume(0);\r\n                } else {\r\n                    // Restore\r\n                    updateAmbientVolume(audioVolumes.ambient);\r\n                    updateBinauralVolume(audioVolumes.binaural);\r\n                }\r\n            }} style={{\r\n                marginTop: '12px', width: '100%', padding: '10px', borderRadius: '12px',\r\n                background: soundEnabled ? 'rgba(255,255,255,0.08)' : 'rgba(255,0,0,0.15)',\r\n                border: '1px solid rgba(255,255,255,0.1)', color: soundEnabled ? 'rgba(255,255,255,0.7)' : '#ff6b6b',\r\n                fontSize: '0.8rem', cursor: 'pointer', fontWeight: 600\r\n            }}>{soundEnabled ? '  ' : '  '}</button>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\member\\PushNotificationSettings.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\profile\\AISection.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\profile\\AttendanceHistory.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'idx' is defined but never used.","line":221,"column":41,"nodeType":"Identifier","messageId":"unusedVar","endLine":221,"endColumn":44,"suggestions":[{"messageId":"removeVar","data":{"varName":"idx"},"fix":{"range":[10673,10678],"text":""},"desc":"Remove unused variable 'idx'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { Icons } from '../CommonIcons';\r\nimport { getTranslatedClass } from '../../utils/classMapping';\r\nimport { getHolidayName } from '../../utils/holidays';\r\nimport { STUDIO_CONFIG } from '../../studioConfig';\r\n\r\n\r\nconst AttendanceHistory = ({ logs, member, language, t, aiAnalysis, onDelete, logLimit, setLogLimit }) => {\r\n    const [viewMode, setViewMode] = useState('list'); // 'list' or 'calendar'\r\n    const [currentDate, setCurrentDate] = useState(new Date());\r\n\r\n    const getDaysInMonth = (year, month) => new Date(year, month + 1, 0).getDate();\r\n    const getFirstDayOfMonth = (year, month) => new Date(year, month, 1).getDay();\r\n\r\n    const [loadingMsg, setLoadingMsg] = useState(t('analysisPending'));\r\n\r\n    // Rotating loading messages\r\n    useEffect(() => {\r\n        if (aiAnalysis) return;\r\n\r\n        const messages = language === 'ko' ? [\r\n            \"  ...\",\r\n            \"   ...\",\r\n            \"   ...\",\r\n            \"   ...\"\r\n        ] : [\r\n            \"Breathing in...\",\r\n            \"Reading your flow...\",\r\n            \"Connecting to your rhythm...\",\r\n            \"Preparing insights...\"\r\n        ];\r\n\r\n        let i = 0;\r\n        const interval = setInterval(() => {\r\n            setLoadingMsg(messages[i]);\r\n            i = (i + 1) % messages.length;\r\n        }, 2000);\r\n\r\n        return () => clearInterval(interval);\r\n    }, [aiAnalysis, language]);\r\n\r\n    const changeMonth = (delta) => {\r\n        const newDate = new Date(currentDate);\r\n        newDate.setMonth(newDate.getMonth() + delta);\r\n        setCurrentDate(newDate);\r\n    };\r\n\r\n    const renderCalendar = () => {\r\n        const year = currentDate.getFullYear();\r\n        const month = currentDate.getMonth();\r\n        const daysInMonth = getDaysInMonth(year, month);\r\n        const firstDay = getFirstDayOfMonth(year, month);\r\n        const days = [];\r\n\r\n        // Empty slots for previous month\r\n        for (let i = 0; i < firstDay; i++) {\r\n            days.push(<div key={`empty-${i}`} style={{ height: '80px', background: 'transparent' }} />);\r\n        }\r\n\r\n        // Days of current month\r\n        for (let day = 1; day <= daysInMonth; day++) {\r\n            const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;\r\n            const dayLogs = logs.filter(log => {\r\n                const logDate = new Date(log.timestamp);\r\n                return logDate.getFullYear() === year &&\r\n                    logDate.getMonth() === month &&\r\n                    logDate.getDate() === day;\r\n            });\r\n\r\n            const isToday = new Date().toDateString() === new Date(year, month, day).toDateString();\r\n            const holidayKey = getHolidayName(dateStr);\r\n            const isSunday = new Date(year, month, day).getDay() === 0;\r\n            const isRedDay = isSunday || holidayKey;\r\n\r\n            days.push(\r\n                <div key={day} style={{\r\n                    height: '80px',\r\n                    border: '1px solid rgba(255,255,255,0.1)',\r\n                    borderRadius: '8px',\r\n                    padding: '6px',\r\n                    position: 'relative',\r\n                    background: isToday ? 'rgba(212, 175, 55, 0.1)' : 'rgba(255,255,255,0.02)',\r\n                    display: 'flex',\r\n                    flexDirection: 'column',\r\n                    alignItems: 'center'\r\n                }}>\r\n                    <div style={{\r\n                        fontSize: '0.8rem',\r\n                        fontWeight: 'bold',\r\n                        color: isToday ? 'var(--primary-gold)' : (isRedDay ? '#ff6b6b' : 'rgba(255,255,255,0.7)'),\r\n                        marginBottom: '4px'\r\n                    }}>\r\n                        {day}\r\n                    </div>\r\n                    {/* Holiday Label */}\r\n                    {getHolidayName(dateStr) && (\r\n                        <div style={{ fontSize: '0.6rem', color: '#ff6b6b', marginBottom: '2px', overflow: 'hidden', whiteSpace: 'nowrap', textOverflow: 'ellipsis', maxWidth: '100%' }}>\r\n                            {t(getHolidayName(dateStr))}\r\n                        </div>\r\n                    )}\r\n                    {dayLogs.length > 0 && (\r\n                        <div style={{\r\n                            width: '100%',\r\n                            display: 'flex',\r\n                            flexDirection: 'column',\r\n                            gap: '2px',\r\n                            overflow: 'hidden'\r\n                        }}>\r\n                            {dayLogs.map((log, idx) => {\r\n                                const isExpired = isExpiredLog(log);\r\n                                const branchConfig = STUDIO_CONFIG.BRANCHES.find(b => b.id === log.branchId);\r\n                                const badgeColor = isExpired ? '#ff4d4f' : (branchConfig ? branchConfig.color : 'var(--primary-gold)');\r\n                                return (\r\n                                    <div key={idx} style={{\r\n                                        fontSize: '0.65rem',\r\n                                        background: badgeColor,\r\n                                        color: isExpired ? 'white' : 'black',\r\n                                        padding: '2px 4px',\r\n                                        borderRadius: '4px',\r\n                                        whiteSpace: 'nowrap',\r\n                                        overflow: 'hidden',\r\n                                        textOverflow: 'ellipsis',\r\n                                        fontWeight: 'bold',\r\n                                        textAlign: 'center',\r\n                                        opacity: isExpired ? 0.8 : 1\r\n                                    }}>\r\n                                        {isExpired ? '' : ''}{log.className ? getTranslatedClass(log.className, t) : t('selfPractice')}\r\n                                    </div>\r\n                                );\r\n                            })}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            );\r\n        }\r\n\r\n        return days;\r\n    };\r\n\r\n    const isExpiredLog = (log) => {\r\n        // [FIX] Check for explicit denied status OR date expiration\r\n        if (log.status === 'denied') return true;\r\n        \r\n        if (!member.endDate) return false;\r\n        const logTime = new Date(log.timestamp).getTime();\r\n        const endTime = new Date(member.endDate + 'T23:59:59').getTime();\r\n        return logTime > endTime;\r\n    };\r\n\r\n    const validLogs = logs.filter(log => !isExpiredLog(log));\r\n    const expiredLogsCount = logs.length - validLogs.length;\r\n\r\n    return (\r\n        <div className=\"fade-in\">\r\n            {/* Statistics / AI Analysis Panel */}\r\n            <div className=\"glass-panel\" style={{ padding: '20px', marginBottom: '20px', background: 'rgba(20, 20, 20, 0.9)', border: '1px solid rgba(212, 175, 55, 0.2)' }}>\r\n                <h3 style={{ fontSize: '1.1rem', marginBottom: '15px', color: 'var(--primary-gold)', display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n                     AI  \r\n                </h3>\r\n                <div style={{\r\n                    marginBottom: '15px',\r\n                    padding: '12px 16px',\r\n                    background: 'rgba(212, 175, 55, 0.1)',\r\n                    borderRadius: '10px',\r\n                    borderLeft: '3px solid var(--primary-gold)',\r\n                }}>\r\n                    <p style={{ margin: 0, fontSize: '1rem', lineHeight: '1.5', color: 'var(--primary-gold)', fontWeight: '700', wordBreak: 'keep-all', whiteSpace: 'pre-wrap' }}>\r\n                        {aiAnalysis ? aiAnalysis.message.replace(/\\*\\*/g, '') : loadingMsg}\r\n                    </p>\r\n                </div>\r\n                {logs.length === 0 && (\r\n                    <p style={{ textAlign: 'center', opacity: 0.5, fontSize: '0.9rem' }}> .</p>\r\n                )}\r\n            </div>\r\n\r\n            <div className=\"glass-panel\" style={{ padding: '20px', background: 'rgba(24, 24, 27, 0.9)', border: '1px solid rgba(255,255,255,0.1)' }}>\r\n                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px' }}>\r\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\r\n                        <h3 style={{ fontSize: '1.2rem', color: 'var(--primary-gold)', margin: 0 }}> </h3>\r\n                        <span style={{ fontSize: '0.85rem', color: 'rgba(255,255,255,0.5)' }}>\r\n                             {validLogs.length} \r\n                            {expiredLogsCount > 0 && <span style={{ color: '#ff4d4f', marginLeft: '4px' }}>( {expiredLogsCount})</span>}\r\n                        </span>\r\n                    </div>\r\n\r\n                    {/* View Toggle */}\r\n                    <div style={{ background: 'rgba(255,255,255,0.1)', borderRadius: '8px', padding: '2px', display: 'flex' }}>\r\n                        <button\r\n                            onClick={() => setViewMode('list')}\r\n                            style={{\r\n                                background: viewMode === 'list' ? 'var(--primary-gold)' : 'transparent',\r\n                                color: viewMode === 'list' ? 'black' : 'white',\r\n                                border: 'none',\r\n                                borderRadius: '6px',\r\n                                padding: '4px 10px',\r\n                                fontSize: '0.8rem',\r\n                                fontWeight: 'bold'\r\n                            }}\r\n                        >\r\n                            \r\n                        </button>\r\n                        <button\r\n                            onClick={() => setViewMode('calendar')}\r\n                            style={{\r\n                                background: viewMode === 'calendar' ? 'var(--primary-gold)' : 'transparent',\r\n                                color: viewMode === 'calendar' ? 'black' : 'white',\r\n                                border: 'none',\r\n                                borderRadius: '6px',\r\n                                padding: '4px 10px',\r\n                                fontSize: '0.8rem',\r\n                                fontWeight: 'bold'\r\n                            }}\r\n                        >\r\n                            \r\n                        </button>\r\n                    </div>\r\n                </div>\r\n\r\n                {viewMode === 'list' ? (\r\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>\r\n                        {logs.map((log, idx) => {\r\n                            const date = new Date(log.timestamp);\r\n                            const isValidDate = !isNaN(date.getTime());\r\n                            const isExpired = isExpiredLog(log);\r\n                            \r\n                            // Calculate proper index for valid logs\r\n                            // Assuming logs are sorted descending (latest first)\r\n                            // We want: Total Valid - (Count of valid logs before this one)\r\n                            // Simpler: filter validLogs, find index of this log in validLogs?\r\n                            // Performance: simple filter is fine for small lists\r\n                            \r\n                            let displayBadge = \"\";\r\n                            let badgeColor = \"var(--primary-gold)\";\r\n                            \r\n                            if (isExpired) {\r\n                                if (log.status === 'denied') {\r\n                                     displayBadge = log.denialReason === 'no_credits' ? \"()\" : \"()\";\r\n                                } else {\r\n                                     displayBadge = \"()\"; // Legacy fallback\r\n                                }\r\n                                badgeColor = \"#ff4d4f\";\r\n                            } else {\r\n                                // Find index in validLogs\r\n                                const validIndex = validLogs.findIndex(l => l.id === log.id);\r\n                                // Assuming logs are descending, the count is validLogs.length - validIndex\r\n                                displayBadge = `${validLogs.length - validIndex}`;\r\n                            }\r\n\r\n                            return (\r\n                                <div key={log.id} style={{ padding: '15px', background: 'rgba(255,255,255,0.03)', borderRadius: '12px', display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\r\n                                    <div>\r\n                                        <div style={{ fontSize: '0.8rem', color: isExpired ? '#ff4d4f' : 'var(--primary-gold)' }}>\r\n                                            {isValidDate ? (\r\n                                                <>\r\n                                                    {new Intl.DateTimeFormat(language === 'ko' ? 'ko-KR' : (language === 'en' ? 'en-US' : (language === 'ru' ? 'ru-RU' : (language === 'zh' ? 'zh-CN' : 'ja-JP'))), { year: 'numeric', month: '2-digit', day: '2-digit' }).format(date)} {date.toLocaleTimeString(language === 'ko' ? 'ko-KR' : (language === 'en' ? 'en-US' : (language === 'ru' ? 'ru-RU' : (language === 'zh' ? 'zh-CN' : 'ja-JP'))), { hour12: false, hour: '2-digit', minute: '2-digit' })}\r\n                                                </>\r\n                                            ) : (\r\n                                                <span>Invalid Date</span>\r\n                                            )}\r\n                                        </div>\r\n                                        <div style={{ fontSize: '1rem', fontWeight: 'bold', color: isExpired ? '#rgba(255,255,255,0.5)' : 'white', textDecoration: isExpired ? 'line-through' : 'none' }}>\r\n                                            {log.className || \" \"}\r\n                                            {log.instructor && `(${log.instructor})`}\r\n                                        </div>\r\n                                        <div style={{ fontSize: '0.75rem', opacity: 0.4, color: 'white' }}>\r\n                                            {log.branchId === 'gwangheungchang' ? t('branchGwangheungchang') : (log.branchId === 'mapo' ? t('branchMapo') : log.branchId)} |\r\n                                            {member.membershipType ? (t(`class_${member.membershipType}`) !== `class_${member.membershipType}` ? t(`class_${member.membershipType}`) : member.membershipType) : t('class_regular')}\r\n                                        </div>\r\n                                    </div>\r\n                                    <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n                                        <div style={{ \r\n                                            fontSize: '0.8rem', \r\n                                            color: badgeColor, \r\n                                            border: '1px solid currentColor', \r\n                                            padding: '2px 8px', \r\n                                            borderRadius: '10px' \r\n                                        }}>\r\n                                            {displayBadge}\r\n                                        </div>\r\n                                        {onDelete && (\r\n                                            <button\r\n                                                onClick={() => onDelete(log.id)}\r\n                                                style={{ background: 'rgba(239, 68, 68, 0.2)', color: '#ef4444', border: 'none', borderRadius: '6px', padding: '8px', cursor: 'pointer', display: 'flex' }}\r\n                                                title=\" \"\r\n                                            >\r\n                                                <Icons.Trash size={16} />\r\n                                            </button>\r\n                                        )}\r\n                                    </div>\r\n                                </div>\r\n                            );\r\n                        })}\r\n\r\n                        {/* Pagination: Load More Button */}\r\n                        {setLogLimit && logs.length >= logLimit && (\r\n                            <button\r\n                                onClick={() => setLogLimit(prev => prev + 10)}\r\n                                style={{\r\n                                    width: '100%',\r\n                                    padding: '12px',\r\n                                    background: 'rgba(255,255,255,0.05)',\r\n                                    color: 'var(--primary-gold)',\r\n                                    border: '1px dashed rgba(212, 175, 55, 0.5)',\r\n                                    borderRadius: '12px',\r\n                                    marginTop: '10px',\r\n                                    cursor: 'pointer',\r\n                                    fontWeight: 'bold',\r\n                                    fontSize: '0.9rem',\r\n                                    transition: 'all 0.2s'\r\n                                }}\r\n                            >\r\n                                 {t('loadMoreAttendance') || '   '} (10 )\r\n                            </button>\r\n                        )}\r\n                        {logs.length === 0 && (\r\n                            <div style={{ textAlign: 'center', padding: '40px 0', opacity: 0.3 }}>\r\n                                {t('noAttendanceHistory') || '  .'}\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                ) : (\r\n                    /* Calendar View Implementation */\r\n                    <div className=\"fade-in\">\r\n                        {/* Legend for Branches */}\r\n                        <div style={{ display: 'flex', justifyContent: 'center', gap: '15px', marginBottom: '15px' }}>\r\n                            {STUDIO_CONFIG.BRANCHES.map(branch => (\r\n                                <div key={branch.id} style={{ display: 'flex', alignItems: 'center', gap: '6px' }}>\r\n                                    <div style={{ width: '10px', height: '10px', borderRadius: '50%', backgroundColor: branch.color }}></div>\r\n                                    <span style={{ fontSize: '0.8rem', color: 'rgba(255,255,255,0.7)' }}>{branch.name}</span>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n\r\n                        <div style={{ display: 'flex', justifyContent: 'center', alignItems: 'center', gap: '20px', marginBottom: '20px' }}>\r\n                            <button onClick={() => changeMonth(-1)} style={{ background: 'none', border: 'none', color: 'white', fontSize: '1.2rem' }}>&lt;</button>\r\n                            <span style={{ fontSize: '1.1rem', fontWeight: 'bold', color: 'white' }}>\r\n                                {currentDate.getFullYear()}. {currentDate.getMonth() + 1}\r\n                            </span>\r\n                            <button onClick={() => changeMonth(1)} style={{ background: 'none', border: 'none', color: 'white', fontSize: '1.2rem' }}>&gt;</button>\r\n                        </div>\r\n                        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(7, 1fr)', gap: '5px', textAlign: 'center', marginBottom: '10px' }}>\r\n                            {['', '', '', '', '', '', ''].map(d => (\r\n                                <div key={d} style={{ fontSize: '0.8rem', color: 'rgba(255,255,255,0.5)' }}>{d}</div>\r\n                            ))}\r\n                        </div>\r\n                        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(7, 1fr)', gap: '5px' }}>\r\n                            {renderCalendar()}\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default AttendanceHistory;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\profile\\HomeYogaSection.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\profile\\MembershipInfo.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\profile\\MessagesTab.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\profile\\MyStatsChart.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\profile\\PWAInstallPrompts.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\profile\\ProfileHeader.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\profile\\ProfileTabs.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\profile\\RecentAttendance.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\profile\\SocialLinks.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\profile\\profileStyles.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\profile\\tabs\\NoticeTab.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,18],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport * as Icons from '@phosphor-icons/react';\r\n\r\nconst NoticeTab = ({\r\n    t,\r\n    notices,\r\n    selectedNoticeId,\r\n    setSelectedNoticeId,\r\n    setLightboxImage\r\n}) => {\r\n    return (\r\n        <div className=\"fade-in\">\r\n            <div style={{ padding: '0 5px 20px' }}>\r\n                <div style={{ display: 'flex', alignItems: 'center', gap: '10px', marginBottom: '25px' }}>\r\n                    <Icons.Megaphone size={28} color=\"var(--primary-gold)\" weight=\"fill\" />\r\n                    <h2 style={{ fontSize: '1.6rem', fontWeight: '800', color: 'white', margin: 0 }}>{t('noticesTitle')}</h2>\r\n                </div>\r\n                {Array.isArray(notices) && notices.length > 0 ? (\r\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '30px' }}>\r\n                        {notices.map((notice) => {\r\n                            const isSelected = selectedNoticeId && notice.id === selectedNoticeId;\r\n                            return (\r\n                                <div\r\n                                    key={notice.id}\r\n                                    ref={isSelected ? (el) => {\r\n                                        if (el) {\r\n                                            setTimeout(() => {\r\n                                                el.scrollIntoView({ behavior: 'smooth', block: 'center' });\r\n                                                setSelectedNoticeId(null);\r\n                                            }, 300);\r\n                                        }\r\n                                    } : null}\r\n                                    className=\"glass-panel\"\r\n                                    style={{\r\n                                        padding: 0,\r\n                                        background: isSelected ? 'rgba(212, 175, 55, 0.2)' : 'rgba(24, 24, 27, 0.7)',\r\n                                        border: isSelected ? '2px solid var(--primary-gold)' : '1px solid rgba(255,255,255,0.1)',\r\n                                        borderRadius: '24px',\r\n                                        overflow: 'hidden',\r\n                                        boxShadow: isSelected ? '0 0 30px rgba(212, 175, 55, 0.3)' : '0 15px 35px rgba(0,0,0,0.3)',\r\n                                        transition: 'all 0.3s ease'\r\n                                    }}>\r\n                                    {((notice.images && notice.images.length > 0) || notice.image || notice.imageUrl) ? (\r\n                                        <div>\r\n                                            {/* Header (Title & Date) - Now above image */}\r\n                                            <div style={{ padding: '24px 24px 15px' }}>\r\n                                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', gap: '15px' }}>\r\n                                                    <h3 style={{ fontSize: '1.4rem', fontWeight: '900', color: 'var(--primary-gold)', margin: 0, lineHeight: '1.3', wordBreak: 'keep-all', userSelect: 'text', WebkitUserSelect: 'text' }}>\r\n                                                        {notice.title}\r\n                                                    </h3>\r\n                                                    <span style={{\r\n                                                        fontSize: '0.7rem',\r\n                                                        color: 'rgba(255,255,255,0.7)',\r\n                                                        whiteSpace: 'nowrap',\r\n                                                        background: 'rgba(255, 255, 255, 0.1)',\r\n                                                        padding: '4px 12px',\r\n                                                        borderRadius: '20px',\r\n                                                        fontWeight: '600',\r\n                                                        border: '1px solid rgba(255,255,255,0.05)'\r\n                                                    }}>\r\n                                                        {notice.date || (notice.createdAt ? new Date(notice.createdAt).toLocaleDateString('sv-SE', { timeZone: 'Asia/Seoul' }) : '')}\r\n                                                    </span>\r\n                                                </div>\r\n                                            </div>\r\n\r\n                                            {/* Image - Now below title */}\r\n                                            <div style={{\r\n                                                display: 'flex',\r\n                                                overflowX: 'auto',\r\n                                                overflowY: 'hidden',\r\n                                                scrollSnapType: 'x mandatory',\r\n                                                gap: '0',\r\n                                                width: '100%',\r\n                                                WebkitOverflowScrolling: 'touch'\r\n                                            }}>\r\n                                                {notice.images && notice.images.length > 0 ? (\r\n                                                    notice.images.map((img, idx) => (\r\n                                                        <div key={idx} style={{\r\n                                                            minWidth: '100%',\r\n                                                            scrollSnapAlign: 'start',\r\n                                                            position: 'relative'\r\n                                                        }}>\r\n                                                            <img\r\n                                                                src={img}\r\n                                                                alt=\"notice\"\r\n                                                                style={{\r\n                                                                    width: '100%',\r\n                                                                    height: 'auto',\r\n                                                                    maxHeight: '500px',\r\n                                                                    objectFit: 'contain',\r\n                                                                    display: 'block',\r\n                                                                    borderTop: '1px solid rgba(255,255,255,0.05)',\r\n                                                                    borderBottom: '1px solid rgba(255,255,255,0.05)',\r\n                                                                    cursor: 'pointer',\r\n                                                                    backgroundColor: 'rgba(0,0,0,0.2)'\r\n                                                                }}\r\n                                                                onClick={() => setLightboxImage(img)}\r\n                                                            />\r\n                                                            {notice.images.length > 1 && (\r\n                                                                <div style={{\r\n                                                                    position: 'absolute',\r\n                                                                    bottom: '10px',\r\n                                                                    right: '10px',\r\n                                                                    background: 'rgba(0,0,0,0.6)',\r\n                                                                    padding: '4px 8px',\r\n                                                                    borderRadius: '12px',\r\n                                                                    color: 'white',\r\n                                                                    fontSize: '0.75rem',\r\n                                                                    fontWeight: 'bold'\r\n                                                                }}>\r\n                                                                    {idx + 1} / {notice.images.length}\r\n                                                                </div>\r\n                                                            )}\r\n                                                        </div>\r\n                                                    ))\r\n                                                ) : (\r\n                                                    <img\r\n                                                        src={notice.image || notice.imageUrl}\r\n                                                        alt=\"notice\"\r\n                                                        style={{\r\n                                                            width: '100%',\r\n                                                            height: 'auto',\r\n                                                            display: 'block',\r\n                                                            borderTop: '1px solid rgba(255,255,255,0.05)',\r\n                                                            borderBottom: '1px solid rgba(255,255,255,0.05)',\r\n                                                            cursor: 'pointer'\r\n                                                        }}\r\n                                                        onClick={() => setLightboxImage(notice.image || notice.imageUrl)}\r\n                                                    />\r\n                                                )}\r\n                                            </div>\r\n                                        </div>\r\n                                    ) : (\r\n                                        <div style={{ padding: '24px 24px 10px' }}>\r\n                                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '12px', gap: '10px' }}>\r\n                                                <h3 style={{ fontSize: '1.25rem', fontWeight: '800', color: 'var(--primary-gold)', margin: 0, lineHeight: '1.4', wordBreak: 'keep-all' }}>\r\n                                                    {notice.title}\r\n                                                </h3>\r\n                                                <span style={{\r\n                                                    fontSize: '0.75rem',\r\n                                                    color: 'rgba(255,255,255,0.5)',\r\n                                                    whiteSpace: 'nowrap',\r\n                                                    background: 'rgba(212, 175, 55, 0.15)',\r\n                                                    padding: '4px 12px',\r\n                                                    borderRadius: '20px',\r\n                                                    fontWeight: '600'\r\n                                                }}>\r\n                                                    {notice.date || (notice.createdAt ? new Date(notice.createdAt).toLocaleDateString('sv-SE', { timeZone: 'Asia/Seoul' }) : '')}\r\n                                                </span>\r\n                                            </div>\r\n                                        </div>\r\n                                    )}\r\n\r\n                                    <div style={{ padding: '20px 24px 30px' }}>\r\n                                        <p style={{\r\n                                            margin: 0,\r\n                                            fontSize: '1.05rem',\r\n                                            color: 'rgba(255,255,255,0.9)',\r\n                                            lineHeight: '1.8',\r\n                                            whiteSpace: 'pre-wrap',\r\n                                            wordBreak: 'break-all',\r\n                                            userSelect: 'text',\r\n                                            WebkitUserSelect: 'text'\r\n                                        }}>\r\n                                            {notice.content}\r\n                                        </p>\r\n                                    </div>\r\n                                </div>\r\n                            );\r\n                        })}\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"glass-panel\" style={{ padding: '40px 20px', textAlign: 'center', background: 'rgba(255,255,255,0.02)' }}>\r\n                        <Icons.Megaphone size={40} style={{ opacity: 0.2, marginBottom: '15px' }} />\r\n                        <p style={{ color: 'rgba(255,255,255,0.4)', margin: 0, textAlign: 'center' }}>{t('noNewNotices')}</p>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default NoticeTab;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\profile\\tabs\\PriceTab.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,18],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\n\r\nconst PriceTab = ({\r\n    images,\r\n    priceTable1,\r\n    priceTable2,\r\n    setLightboxImage\r\n}) => {\r\n    return (\r\n        <div className=\"fade-in\">\r\n            <img \r\n                src={images.price_table_1 || priceTable1} \r\n                style={{ width: '100%', borderRadius: '15px', marginBottom: '15px', cursor: 'pointer' }} \r\n                alt=\"price\" \r\n                onClick={() => setLightboxImage(images.price_table_1 || priceTable1)} \r\n            />\r\n            <img \r\n                src={images.price_table_2 || priceTable2} \r\n                style={{ width: '100%', borderRadius: '15px', cursor: 'pointer' }} \r\n                alt=\"price\" \r\n                onClick={() => setLightboxImage(images.price_table_2 || priceTable2)} \r\n            />\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default PriceTab;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\components\\profile\\tabs\\ScheduleTab.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,18],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'Icons' is defined but never used.","line":2,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":18,"suggestions":[{"messageId":"removeVar","data":{"varName":"Icons"},"fix":{"range":[35,51],"text":""},"desc":"Remove unused variable 'Icons'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport * as Icons from '@phosphor-icons/react';\r\nimport MemberScheduleCalendar from '../../MemberScheduleCalendar';\r\n\r\nconst ScheduleTab = ({\r\n    t,\r\n    scheduleView,\r\n    setScheduleView,\r\n    scheduleBranch,\r\n    setScheduleBranch,\r\n    STUDIO_CONFIG,\r\n    validLogs,\r\n    scheduleMonth,\r\n    setScheduleMonth,\r\n    images,\r\n    timeTable1,\r\n    timeTable2,\r\n    setLightboxImage\r\n}) => {\r\n    const viewToggleStyle = {\r\n        border: 'none',\r\n        padding: '6px 16px',\r\n        fontSize: '0.85rem',\r\n        fontWeight: 'bold',\r\n        cursor: 'pointer',\r\n        transition: 'all 0.3s ease',\r\n        whiteSpace: 'nowrap'\r\n    };\r\n\r\n    return (\r\n        <div className=\"fade-in\">\r\n            <div className=\"glass-panel\" style={{ padding: '24px', background: 'rgba(15, 15, 15, 0.9)', minHeight: '400px', border: '1px solid rgba(212, 175, 55, 0.2)' }}>\r\n                <div style={{ marginBottom: '25px', textAlign: 'left' }}>\r\n                    <h2 style={{ fontSize: '1.5rem', color: 'white', fontWeight: '800', margin: '0 0 8px 0', letterSpacing: '-0.02em' }}>{t('scheduleTitle')}</h2>\r\n                    <p style={{ margin: 0, fontSize: '0.95rem', color: 'var(--primary-gold)', opacity: 0.9, lineHeight: '1.5', whiteSpace: 'pre-wrap' }}>\r\n                        {t('scheduleSub')}\r\n                    </p>\r\n                </div>\r\n\r\n                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px' }}>\r\n                    <div style={{ background: 'rgba(255,255,255,0.05)', padding: '4px', borderRadius: '12px', display: 'flex', gap: '4px' }}>\r\n                        <button onClick={() => setScheduleView('calendar')} style={{ ...viewToggleStyle, background: scheduleView === 'calendar' ? 'white' : 'transparent', color: scheduleView === 'calendar' ? 'black' : 'white', borderRadius: '8px' }}>{t('viewCalendar')}</button>\r\n                        <button onClick={() => setScheduleView('image')} style={{ ...viewToggleStyle, background: scheduleView === 'image' ? 'white' : 'transparent', color: scheduleView === 'image' ? 'black' : 'white', borderRadius: '8px' }}>{t('viewWeekly')}</button>\r\n                    </div>\r\n                </div>\r\n\r\n                <div style={{ display: 'flex', gap: '10px', marginBottom: '25px' }}>\r\n                    {STUDIO_CONFIG.BRANCHES.map(b => (\r\n                        <button\r\n                            key={b.id}\r\n                            onClick={() => setScheduleBranch(b.id)}\r\n                            style={{\r\n                                flex: 1,\r\n                                padding: '12px',\r\n                                borderRadius: '12px',\r\n                                fontWeight: 'bold',\r\n                                border: scheduleBranch === b.id ? 'none' : '1px solid rgba(255,255,255,0.1)',\r\n                                background: scheduleBranch === b.id ? 'var(--primary-gold)' : 'rgba(255,255,255,0.03)',\r\n                                color: scheduleBranch === b.id ? 'black' : 'rgba(255,255,255,0.6)',\r\n                                fontSize: '0.9rem',\r\n                                transition: 'all 0.3s ease',\r\n                                boxShadow: scheduleBranch === b.id ? '0 4px 15px rgba(212, 175, 55, 0.3)' : 'none'\r\n                            }}\r\n                        >\r\n                            {t('branch' + (b.id === 'gwangheungchang' ? 'Gwangheungchang' : 'Mapo'))}\r\n                        </button>\r\n                    ))}\r\n                </div>\r\n                {scheduleView === 'calendar' ? (\r\n                    <MemberScheduleCalendar branchId={scheduleBranch || 'gwangheungchang'} attendanceLogs={validLogs} />\r\n                ) : (\r\n                    (() => {\r\n                        const now = new Date();\r\n                        const currentYear = now.getFullYear();\r\n                        const currentMonthStr = String(now.getMonth() + 1).padStart(2, '0');\r\n                        const currentKeyDate = `${currentYear}-${currentMonthStr}`;\r\n\r\n                        const nextDate = new Date(now.getFullYear(), now.getMonth() + 1, 1);\r\n                        const nextYear = nextDate.getFullYear();\r\n                        const nextMonthStr = String(nextDate.getMonth() + 1).padStart(2, '0');\r\n                        const nextKeyDate = `${nextYear}-${nextMonthStr}`;\r\n\r\n                        const currentBranchId = scheduleBranch || 'gwangheungchang';\r\n\r\n                        const currentKey = `timetable_${currentBranchId}_${currentKeyDate}`;\r\n                        const nextKey = `timetable_${currentBranchId}_${nextKeyDate}`;\r\n                        const oldKey = `timetable_${currentBranchId}`;\r\n\r\n                        const hasNext = !!images[nextKey];\r\n                        const activeMonth = scheduleMonth === 'next' && hasNext ? 'next' : 'current';\r\n                        const displayImage = activeMonth === 'next' ? images[nextKey] : (images[currentKey] || images[oldKey] || (currentBranchId === 'gwangheungchang' ? timeTable1 : timeTable2));\r\n\r\n                        return (\r\n                            <div style={{ position: 'relative', width: '100%', borderRadius: '10px', overflow: 'hidden' }}>\r\n                                {/* Month Navigation Overlay */}\r\n                                <div style={{\r\n                                    display: 'flex',\r\n                                    justifyContent: 'space-between',\r\n                                    alignItems: 'center',\r\n                                    marginBottom: '10px',\r\n                                    padding: '0 5px'\r\n                                }}>\r\n                                    <h3 style={{ margin: 0, fontSize: '1.2rem', fontWeight: 'bold', color: 'white' }}>\r\n                                        {activeMonth === 'current' ? `${currentMonthStr} ` : `${nextMonthStr}  ()`}\r\n                                    </h3>\r\n\r\n                                    {hasNext && (\r\n                                        <div style={{ display: 'flex', background: 'rgba(255,255,255,0.1)', borderRadius: '20px', padding: '2px' }}>\r\n                                            <button\r\n                                                onClick={() => setScheduleMonth('current')}\r\n                                                style={{\r\n                                                    background: activeMonth === 'current' ? 'var(--primary-gold)' : 'transparent',\r\n                                                    color: activeMonth === 'current' ? 'black' : 'rgba(255,255,255,0.6)',\r\n                                                    border: 'none',\r\n                                                    borderRadius: '20px',\r\n                                                    padding: '4px 12px',\r\n                                                    fontSize: '0.8rem',\r\n                                                    fontWeight: 'bold',\r\n                                                    cursor: 'pointer'\r\n                                                }}\r\n                                            >\r\n                                                {currentMonthStr}\r\n                                            </button>\r\n                                            <button\r\n                                                onClick={() => setScheduleMonth('next')}\r\n                                                style={{\r\n                                                    background: activeMonth === 'next' ? 'var(--primary-gold)' : 'transparent',\r\n                                                    color: activeMonth === 'next' ? 'black' : 'rgba(255,255,255,0.6)',\r\n                                                    border: 'none',\r\n                                                    borderRadius: '20px',\r\n                                                    padding: '4px 12px',\r\n                                                    fontSize: '0.8rem',\r\n                                                    fontWeight: 'bold',\r\n                                                    cursor: 'pointer'\r\n                                                }}\r\n                                            >\r\n                                                {nextMonthStr} &gt;\r\n                                            </button>\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n\r\n                                <img\r\n                                    src={displayImage}\r\n                                    style={{ width: '100%', display: 'block', borderRadius: '8px', cursor: 'pointer' }}\r\n                                    alt=\"timetable\"\r\n                                    onClick={() => setLightboxImage(displayImage)}\r\n                                    onError={(e) => { e.target.style.display = 'none'; e.target.nextSibling.style.display = 'flex'; }}\r\n                                />\r\n                                <div style={{ display: 'none', height: '200px', alignItems: 'center', justifyContent: 'center', color: 'rgba(255,255,255,0.3)', border: '1px dashed rgba(255,255,255,0.1)', borderRadius: '10px' }}>{t('noTimetableImage')}</div>\r\n                            </div>\r\n                        );\r\n                    })()\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default ScheduleTab;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\constants\\meditationConstants.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\context\\LanguageContext.jsx","messages":[],"suppressedMessages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":64,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":64,"endColumn":35,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\context\\NetworkContext.jsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":34,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":34,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createContext, useContext, useState, useEffect } from 'react';\r\n\r\nconst NetworkContext = createContext();\r\n\r\nexport const NetworkProvider = ({ children }) => {\r\n    const [isOnline, setIsOnline] = useState(navigator.onLine);\r\n\r\n    useEffect(() => {\r\n        const handleOnline = () => {\r\n            console.log('[NetworkContext] Connection restored');\r\n            setIsOnline(true);\r\n        };\r\n        const handleOffline = () => {\r\n            console.log('[NetworkContext] Connection lost');\r\n            setIsOnline(false);\r\n        };\r\n\r\n        window.addEventListener('online', handleOnline);\r\n        window.addEventListener('offline', handleOffline);\r\n\r\n        return () => {\r\n            window.removeEventListener('online', handleOnline);\r\n            window.removeEventListener('offline', handleOffline);\r\n        };\r\n    }, []);\r\n\r\n    return (\r\n        <NetworkContext.Provider value={{ isOnline, setIsOnline }}>\r\n            {children}\r\n        </NetworkContext.Provider>\r\n    );\r\n};\r\n\r\nexport const useNetwork = () => {\r\n    const context = useContext(NetworkContext);\r\n    if (!context) {\r\n        throw new Error('useNetwork must be used within a NetworkProvider');\r\n    }\r\n    return context;\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\context\\PWAContext.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\context\\PWAContextDef.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\firebase.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\hooks\\useAdminData.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'getTodayKST' is defined but never used.","line":3,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":21,"suggestions":[{"messageId":"removeVar","data":{"varName":"getTodayKST"},"fix":{"range":[131,143],"text":""},"desc":"Remove unused variable 'getTodayKST'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'STUDIO_CONFIG' is defined but never used.","line":4,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":23,"suggestions":[{"messageId":"removeVar","data":{"varName":"STUDIO_CONFIG"},"fix":{"range":[181,229],"text":""},"desc":"Remove unused variable 'STUDIO_CONFIG'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":145,"column":97,"nodeType":"Identifier","messageId":"unusedVar","endLine":145,"endColumn":100,"suggestions":[{"messageId":"removeVar","data":{"varName":"err"},"fix":{"range":[6139,6142],"text":"()"},"desc":"Remove unused variable 'err'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'currentMonth' is assigned a value but never used.","line":263,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":263,"endColumn":27,"suggestions":[{"messageId":"removeVar","data":{"varName":"currentMonth"},"fix":{"range":[11298,11344],"text":""},"desc":"Remove unused variable 'currentMonth'."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'members'. Either include it or remove the dependency array.","line":525,"column":8,"nodeType":"ArrayExpression","endLine":525,"endColumn":73,"suggestions":[{"desc":"Update the dependencies array to be: [currentBranch, calculateStats, members, isMemberActive, isMemberExpiring]","fix":{"range":[23042,23107],"text":"[currentBranch, calculateStats, members, isMemberActive, isMemberExpiring]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback, useRef } from 'react';\r\nimport { storageService } from '../services/storage';\r\nimport { getTodayKST, getKSTHour } from '../utils/dates';\r\nimport { STUDIO_CONFIG } from '../studioConfig';\r\nimport { guessClassTime, guessClassInfo } from '../utils/classUtils';\r\n\r\n\r\n// Helper for consistent date parsing\r\n\r\n\r\nexport const useAdminData = (activeTab, initialBranch = 'all') => {\r\n    const [currentBranch, setCurrentBranch] = useState(initialBranch);\r\n    const [members, setMembers] = useState([]);\r\n    const [sales, setSales] = useState([]);\r\n    const [logs, setLogs] = useState([]);\r\n    const [notices, setNotices] = useState([]);\r\n    const [stats, setStats] = useState({ byTime: [], bySubject: [] });\r\n    const [aiInsight, setAiInsight] = useState(null);\r\n    const [loadingInsight, setLoadingInsight] = useState(false);\r\n    const loadingRef = useRef(false); // [FIX] Use Ref to prevent dependency loop\r\n    const [images, setImages] = useState({});\r\n    const [optimisticImages, setOptimisticImages] = useState({});\r\n    const [todayClasses, setTodayClasses] = useState([]);\r\n    const [pushTokens, setPushTokens] = useState([]);\r\n    const [aiUsage, setAiUsage] = useState({ count: 0, limit: 2000 });\r\n    const [pendingApprovals, setPendingApprovals] = useState([]);\r\n    const [summary, setSummary] = useState({\r\n        totalMembers: 0,\r\n        activeMembers: 0,\r\n        todayAttendance: 0,\r\n        totalAttendanceToday: 0,\r\n        todayRegistration: 0,\r\n        totalRevenueToday: 0,\r\n        monthlyRevenue: 0,\r\n        expiringMembersCount: 0,\r\n        installedCount: 0,\r\n        pushEnabledCount: 0\r\n    });\r\n\r\n    // Helper: Is Member Active? (Domain Logic)\r\n    const isMemberActive = useCallback((m) => {\r\n        const credits = Number(m.credits || 0);\r\n        const todayStr = new Date().toLocaleDateString('sv-SE', { timeZone: 'Asia/Seoul' });\r\n\r\n        // If no endDate, check only credits\r\n        if (!m.endDate) {\r\n            return credits > 0;\r\n        }\r\n\r\n        // If has endDate, must be future/today AND have credits > 0\r\n        // (If credits are 0, member allows entry? usually no, unless unlimited type which has high credits)\r\n        return m.endDate >= todayStr && credits > 0;\r\n    }, []);\r\n\r\n    // Helper: Is Member Expiring?\r\n    const isMemberExpiring = useCallback((m) => {\r\n        // If no endDate, just check credits\r\n        const credits = Number(m.credits || 0);\r\n        const hasNoCredits = credits <= 1;\r\n\r\n        if (!m.endDate) return hasNoCredits;\r\n\r\n        const today = new Date();\r\n        today.setHours(0, 0, 0, 0);\r\n        const end = new Date(m.endDate);\r\n        const diffDays = Math.ceil((end - today) / (1000 * 60 * 60 * 24));\r\n\r\n        const isExpiringSoon = diffDays <= 7 && diffDays >= -30;\r\n        // [Logic] Imminent (0-7 days) or Recently Expired (within 30 days)\r\n\r\n        return isExpiringSoon || hasNoCredits;\r\n    }, []);\r\n\r\n    const calculateStats = useCallback((logs) => {\r\n        const timeCount = {};\r\n        logs.forEach(log => {\r\n            const hour = new Date(log.timestamp).getHours();\r\n            const key = `${hour}:00`;\r\n            timeCount[key] = (timeCount[key] || 0) + 1;\r\n        });\r\n\r\n        const sortedTime = Object.entries(timeCount).sort((a, b) => b[1] - a[1]);\r\n\r\n        const subjectCount = {};\r\n        logs.forEach(log => {\r\n            if (log.subject) {\r\n                subjectCount[log.subject] = (subjectCount[log.subject] || 0) + 1;\r\n            }\r\n        });\r\n        const sortedSubject = Object.entries(subjectCount).sort((a, b) => b[1] - a[1]);\r\n\r\n        setStats({ byTime: sortedTime, bySubject: sortedSubject });\r\n    }, []);\r\n\r\n    const loadAIInsight = useCallback(async (members, logs, currentSummary, currentTodayClasses) => {\r\n        if (loadingRef.current) return; // Check Ref\r\n        loadingRef.current = true;      // Set Ref\r\n        setLoadingInsight(true);\r\n        \r\n        try {\r\n            const statsData = {\r\n                activeCount: currentSummary.activeMembers,\r\n                attendanceToday: currentSummary.todayAttendance,\r\n                expiringCount: currentSummary.expiringMembersCount,\r\n                topClasses: currentTodayClasses.slice(0, 3)\r\n            };\r\n\r\n            const aiPromise = storageService.getAIAnalysis(\r\n                \"Administrator\",\r\n                logs.length,\r\n                logs,\r\n                getKSTHour(),\r\n                'ko',\r\n                'admin',\r\n                statsData,\r\n                'admin'\r\n            );\r\n\r\n            const timeoutPromise = new Promise((_, reject) =>\r\n                setTimeout(() => reject(new Error(\"AI Analysis Timeout\")), 8000)\r\n            );\r\n\r\n            const insight = await Promise.race([aiPromise, timeoutPromise]);\r\n            if (insight) setAiInsight(insight);\r\n        } catch (err) {\r\n            console.warn(\"[AI] Admin Insight failed or timed out. Using fallback summary.\", err);\r\n            const fallbackMsg = ` ${currentSummary.activeMembers}   ,  ${currentSummary.todayAttendance} .     .`;\r\n            setAiInsight({ message: fallbackMsg, isFallback: true });\r\n        } finally {\r\n            loadingRef.current = false; // Reset Ref\r\n            setLoadingInsight(false);\r\n        }\r\n    }, []); // Removed [loadingInsight] dependency to prevent loop\r\n\r\n    // [New] Re-registration Logic State\r\n    const [todayReRegMemberIds, setTodayReRegMemberIds] = useState([]);\r\n\r\n    const refreshData = useCallback(async () => {\r\n        console.time('[Admin] refreshData');\r\n        \r\n        // [PERF] Parallel data loading for faster initial render\r\n        // [FIX] Ensure all Promises have .catch() so one failure doesn't crash the dashboard\r\n        const [currentMembers, currentImages, tokensResult, usageResult, currentSales] = await Promise.all([\r\n            storageService.loadAllMembers().catch(err => { console.warn(\"[Admin] Member load error\", err); return []; }),\r\n            (storageService.getImages ? storageService.getImages() : Promise.resolve({})).catch(err => ({})),\r\n            storageService.getAllPushTokens().catch(err => { console.error('Failed to fetch push tokens:', err); return []; }),\r\n            storageService.getAiUsage().catch(e => { console.warn(\"Failed to fetch AI usage\", e); return { count: 0, limit: 2000 }; }),\r\n            storageService.getSales().catch(err => { console.warn(\"[Admin] Sales load error\", err); return []; })\r\n        ]);\r\n        \r\n        // Get cached data (sync, no await needed)\r\n        let currentLogs = storageService.getAttendance();\r\n        \r\n        // [FIX] Fallback:        fetch\r\n        if (currentLogs.length === 0) {\r\n            console.warn('[Admin] Attendance cache empty, fetching directly...');\r\n            const todayDateStr = new Date().toLocaleDateString('sv-SE', { timeZone: 'Asia/Seoul' });\r\n            try {\r\n                const directLogs = await storageService.getAttendanceByDate(todayDateStr);\r\n                if (directLogs.length > 0) {\r\n                    currentLogs = directLogs;\r\n                    console.log(`[Admin] Fallback fetched ${directLogs.length} attendance logs for today`);\r\n                }\r\n            } catch (e) {\r\n                console.warn('[Admin] Fallback attendance fetch failed:', e);\r\n            }\r\n        }\r\n        const currentNotices = storageService.getNotices();\r\n        \r\n        // Set state from parallel results\r\n        setPushTokens(tokensResult);\r\n        setAiUsage(usageResult);\r\n\r\n        // [FIX] Ensure Unique Members by ID (Prevent UI Duplicates) & Enrich with Install Date\r\n        const memberInstallDate = {};\r\n        if (tokensResult) {\r\n            tokensResult.forEach(t => {\r\n                if (!t.memberId) return;\r\n                const date = t.createdAt || null; // Only count tracked installs with createdAt\r\n                if (date) {\r\n                    if (!memberInstallDate[t.memberId] || date > memberInstallDate[t.memberId]) {\r\n                        memberInstallDate[t.memberId] = date;\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        const uniqueMembers = Array.from(new Map(currentMembers.map(m => [m.id, m])).values())\r\n            .map(m => ({\r\n                ...m,\r\n                installedAt: memberInstallDate[m.id] || null\r\n            }));\r\n\r\n        setMembers(uniqueMembers);\r\n        setLogs([...currentLogs]); // Force new reference\r\n        setNotices([...currentNotices]);\r\n        setImages({ ...currentImages }); // Force new object for images too\r\n        setSales([...currentSales]);\r\n        \r\n        console.timeEnd('[Admin] refreshData');\r\n\r\n        // Branch Filtering for Stats\r\n        const branchLogs = currentBranch === 'all'\r\n            ? currentLogs\r\n            : currentLogs.filter(l => l.branchId === currentBranch);\r\n\r\n        calculateStats(branchLogs);\r\n\r\n        const todayStr = new Date().toLocaleDateString('sv-SE', { timeZone: 'Asia/Seoul' });\r\n        \r\n        // [Perf] Enrich logs with KST string to prevent repeated Date parsing\r\n        const enrichedBranchLogs = branchLogs.map(l => {\r\n            if (!l.timestamp) return { ...l, isValidDate: false };\r\n            const d = new Date(l.timestamp);\r\n            if (isNaN(d.getTime())) return { ...l, isValidDate: false };\r\n            return {\r\n                ...l,\r\n                isValidDate: true,\r\n                logDate: d.toLocaleDateString('sv-SE', { timeZone: 'Asia/Seoul' })\r\n            };\r\n        });\r\n\r\n        // [Perf] Enrich sales\r\n        const enrichedSales = currentSales.map(s => {\r\n            const rawDate = s.date || s.timestamp;\r\n            let sDate = rawDate;\r\n            if (rawDate && rawDate.includes('T')) {\r\n                const d = new Date(rawDate);\r\n                if (!isNaN(d.getTime())) {\r\n                    sDate = d.toLocaleDateString('sv-SE', { timeZone: 'Asia/Seoul' });\r\n                }\r\n            }\r\n            return { ...s, parsedDate: sDate || null };\r\n        });\r\n\r\n        // [New] Multi-attendance Detection (Unique Class Time Base)\r\n        const uniqueAttendanceMap = {}; // memberId -> Set of classTimes\r\n        \r\n        try {\r\n            enrichedBranchLogs.forEach(l => {\r\n                if (!l.isValidDate || l.status === 'denied' || !l.memberId) return;\r\n\r\n                if (l.logDate !== todayStr) return;\r\n\r\n                    if (!uniqueAttendanceMap[l.memberId]) {\r\n                        uniqueAttendanceMap[l.memberId] = new Set();\r\n                    }\r\n                    \r\n                    // Use strict schedule time if available, otherwise strict fallback\r\n                    const info = guessClassInfo(l);\r\n                    const classTime = info?.startTime || guessClassTime(l) || '00:00';\r\n                    \r\n                    uniqueAttendanceMap[l.memberId].add(classTime);\r\n            });\r\n        } catch (err) {\r\n            console.error('[Admin] Error calculating multi-attendance:', err);\r\n        }\r\n\r\n        const multiAttendedMemberIds = Object.keys(uniqueAttendanceMap)\r\n            .filter(id => uniqueAttendanceMap[id].size >= 2);\r\n\r\n        // Stats Calculation\r\n        const currentMonth = todayStr.substring(0, 7);\r\n        const isMemberInBranch = (m) => currentBranch === 'all' || m.homeBranch === currentBranch;\r\n\r\n        const attendedMemberIds = new Set();\r\n        \r\n        // [New] Denied Stats\r\n        let deniedCount = 0;\r\n        let deniedExpiredCount = 0;\r\n        let deniedNoCreditsCount = 0;\r\n\r\n        // [New] Valid Total Attendance (Session Count)\r\n        let totalAttendanceToday = 0;\r\n\r\n        try {\r\n            enrichedBranchLogs.forEach(l => {\r\n                if (!l.isValidDate) return;\r\n                \r\n                if (l.logDate === todayStr) {\r\n                    if (l.status === 'denied') {\r\n                        deniedCount++;\r\n                        if (l.denialReason === 'expired') deniedExpiredCount++;\r\n                        if (l.denialReason === 'no_credits') deniedNoCreditsCount++;\r\n                    } else {\r\n                        // Valid Attendance\r\n                        attendedMemberIds.add(l.memberId);\r\n                        totalAttendanceToday++;\r\n                    }\r\n                }\r\n            });\r\n        } catch (err) {\r\n            console.error('[Admin] Error calculating stats:', err);\r\n        }\r\n\r\n        const checkIsAttended = (m) => attendedMemberIds.has(m.id);\r\n        const checkIsRegistered = (m) => m.regDate === todayStr;\r\n\r\n        const totalMembers = uniqueMembers.filter(m => isMemberInBranch(m)).length;\r\n        const activeMembers = uniqueMembers.filter(m => isMemberInBranch(m) && isMemberActive(m)).length;\r\n\r\n        // [Logic] Unique individuals attended (VALID only)\r\n        const todayAttendance = uniqueMembers.filter(m => isMemberInBranch(m) && checkIsAttended(m)).length;\r\n\r\n        // [Logic] Today Registration (New & Re-reg)\r\n        // 1. New: regDate === today\r\n        const todayNewMembers = uniqueMembers.filter(m => isMemberInBranch(m) && checkIsRegistered(m));\r\n        \r\n        // 2. Re-reg: Sales today AND NOT New\r\n        const todaySalesMemberIds = new Set();\r\n        enrichedSales.forEach(s => {\r\n            if (!s.parsedDate) return;\r\n            if (s.parsedDate === todayStr) {\r\n                // If branch filter applied, check sales branch OR member home branch\r\n                if (currentBranch === 'all' || s.branchId === currentBranch || uniqueMembers.find(m => m.id === s.memberId)?.homeBranch === currentBranch) {\r\n                    todaySalesMemberIds.add(s.memberId);\r\n                }\r\n            }\r\n        });\r\n\r\n        const todayReRegMembers = uniqueMembers.filter(m => \r\n            isMemberInBranch(m) && \r\n            todaySalesMemberIds.has(m.id) && \r\n            !checkIsRegistered(m) // Not new\r\n        );\r\n\r\n        setTodayReRegMemberIds(todayReRegMembers.map(m => m.id));\r\n\r\n        const todayNewCount = todayNewMembers.length;\r\n        const todayReRegCount = todayReRegMembers.length;\r\n        const todayRegistrationTotal = todayNewCount + todayReRegCount; // Combined\r\n\r\n        const expiringMembersCount = uniqueMembers.filter(m => isMemberInBranch(m) && isMemberExpiring(m)).length;\r\n\r\n        // [Unified Revenue Logic] Match AdminRevenue.jsx\r\n        // 1. Prepare All Items (Legacy + Sales)\r\n        const allRevenueItems = [];\r\n\r\n        // Legacy Members Data\r\n        uniqueMembers.forEach(m => {\r\n            const amt = Number(m.amount) || 0;\r\n            if (m.regDate && amt > 0) {\r\n                if (currentBranch !== 'all' && m.homeBranch !== currentBranch) return;\r\n                allRevenueItems.push({\r\n                    id: m.id,\r\n                    memberId: m.id, // [Fix] Explicit memberId\r\n                    date: m.regDate, // 'YYYY-MM-DD'\r\n                    amount: amt,\r\n                    name: m.name,\r\n                    type: 'legacy'\r\n                });\r\n            }\r\n        });\r\n\r\n        // New Sales Data\r\n        enrichedSales.forEach(s => {\r\n            if (currentBranch !== 'all') {\r\n                const member = uniqueMembers.find(m => m.id === s.memberId);\r\n                const memberBranch = member?.homeBranch;\r\n                const saleBranch = s.branchId;\r\n                \r\n                if ((saleBranch && saleBranch !== currentBranch) && (memberBranch && memberBranch !== currentBranch)) {\r\n                    return;\r\n                }\r\n                if (!saleBranch && !memberBranch) return;\r\n            }\r\n\r\n            if (!s.parsedDate) return;\r\n\r\n            allRevenueItems.push({\r\n                id: s.id,\r\n                memberId: s.memberId,\r\n                date: s.parsedDate,\r\n                amount: Number(s.amount) || 0,\r\n                name: s.memberName,\r\n                type: s.type,\r\n                item: s.item\r\n            });\r\n        });\r\n\r\n        // [Fix] Deduplicate: Remove 'legacy' item if a 'register' item exists for same member on same date\r\n        // AND remove duplicate sales items if they exist matches (MemberId + Date + Amount)\r\n        \r\n        // [Fix V4] Resolve Member IDs for Sales Items that lack them (backward compatibility)\r\n        const memberNameMap = new Map();\r\n        members.forEach(m => memberNameMap.set(m.name, m.id));\r\n\r\n        const uniqueRevenueItems = [];\r\n        const salesKeys = new Set(\r\n            allRevenueItems\r\n                .filter(i => i.type !== 'legacy')\r\n                .map(i => {\r\n                     const resolvedId = i.memberId || memberNameMap.get(i.name);\r\n                     return `${resolvedId}-${i.date}`;\r\n                })\r\n        );\r\n\r\n        const seenKeys = new Set();\r\n\r\n        allRevenueItems.forEach(item => {\r\n            const resolvedMemberId = item.memberId || memberNameMap.get(item.name);\r\n\r\n            // 1. Legacy Deduplication\r\n            if (item.type === 'legacy') {\r\n                const key = `${item.memberId}-${item.date}`;\r\n                if (salesKeys.has(key)) return; // Skip legacy if sale exists\r\n            }\r\n\r\n            // 2. Self Deduplication\r\n            // Key: MemberId + Date + Amount\r\n            const uniqueKey = `${resolvedMemberId}-${item.date}-${item.amount}`;\r\n            if (seenKeys.has(uniqueKey)) return;\r\n            seenKeys.add(uniqueKey);\r\n\r\n            // Attach resolved ID if missing\r\n            if (!item.memberId && resolvedMemberId) {\r\n                uniqueRevenueItems.push({ ...item, memberId: resolvedMemberId });\r\n            } else {\r\n                uniqueRevenueItems.push(item);\r\n            }\r\n        });\r\n\r\n        const todayRevenue = uniqueRevenueItems\r\n            .filter(i => i.date === todayStr)\r\n            .reduce((sum, item) => sum + item.amount, 0);\r\n\r\n        const currentMonthStr = todayStr.substring(0, 7); // 'YYYY-MM'\r\n        const monthlyRevenue = uniqueRevenueItems\r\n            .filter(i => i.date.startsWith(currentMonthStr))\r\n            .reduce((sum, item) => sum + item.amount, 0);\r\n\r\n        // ... Note: This logic assumes 'uniqueRevenueItems' covers all needed revenue data.\r\n        // Also note that 'members.amount' is usually the MOST RECENT payment amount.\r\n        // If a member paid last month AND this month, 'members' object only holds the LATEST.\r\n        // So 'legacy' logic is inherently flawed for historical data if only using 'members' snapshot.\r\n        // But for \"This Month\" revenue, it works IF the member registered/paid this month.\r\n        // The `sales` collection is the correct way forward.\r\n        // The dedup ensures we don't double count the *latest* payment if it's in both.\r\n\r\n        const newSummary = {\r\n            totalMembers,\r\n            activeMembers,\r\n            todayAttendance,\r\n            totalAttendanceToday,\r\n            todayRegistration: todayRegistrationTotal, // Updated to Combined\r\n            todayNewCount, // [New]\r\n            todayReRegCount, // [New]\r\n            totalRevenueToday: todayRevenue,\r\n            monthlyRevenue,\r\n            expiringMembersCount,\r\n            todayReRegMemberIds: todayReRegMembers.map(m => m.id), // [New] For Badges in MembersTab\r\n            multiAttendedMemberIds, // [NEW] Today 2+ attendance\r\n            // [New] Denied Stats\r\n            deniedCount,\r\n            deniedExpiredCount,\r\n            deniedNoCreditsCount,\r\n            \r\n            // [New] App Installation Stats\r\n            installedCount: uniqueMembers.filter(m => isMemberInBranch(m) && tokensResult.some(t => t.memberId === m.id)).length,\r\n            todayInstalledCount: uniqueMembers.filter(m => {\r\n                if (!isMemberInBranch(m)) return false;\r\n                const installDate = m.installedAt;\r\n                if (!installDate) return false;\r\n                const kstDate = new Date(installDate).toLocaleDateString('sv-SE', { timeZone: 'Asia/Seoul' });\r\n                return kstDate === todayStr;\r\n            }).length,\r\n            pushEnabledCount: uniqueMembers.filter(m => isMemberInBranch(m) && tokensResult.some(t => t.memberId === m.id) && m.pushEnabled !== false).length,\r\n            \r\n            // [New] Ratios for UI\r\n            installRatio: activeMembers > 0 ? Math.round((uniqueMembers.filter(m => isMemberInBranch(m) && tokensResult.some(t => t.memberId === m.id)).length / activeMembers) * 100) : 0,\r\n            reachableRatio: activeMembers > 0 ? Math.round((uniqueMembers.filter(m => isMemberInBranch(m) && tokensResult.some(t => t.memberId === m.id) && m.pushEnabled !== false).length / activeMembers) * 100) : 0\r\n        };\r\n        setSummary(newSummary);\r\n\r\n        // Today's Classes Calculation\r\n        const todayLogs = enrichedBranchLogs.filter(l => \r\n            l.isValidDate && l.logDate === todayStr && (currentBranch === 'all' || l.branchId === currentBranch)\r\n        );\r\n\r\n        const classGroups = {};\r\n\r\n        todayLogs.forEach(log => {\r\n            const info = guessClassInfo(log);\r\n            const classTime = info?.startTime || '00:00';\r\n            const canonicalClassName = info?.className || log.className || '';\r\n            const canonicalInstructor = info?.instructor || log.instructor || '';\r\n\r\n            const key = `${canonicalClassName}-${canonicalInstructor}-${log.branchId}-${classTime}`;\r\n            \r\n            if (!classGroups[key]) {\r\n                classGroups[key] = {\r\n                    className: canonicalClassName,\r\n                    instructor: canonicalInstructor,\r\n                    branchId: log.branchId,\r\n                    classTime: classTime,\r\n                    count: 0,\r\n                    deniedCount: 0,\r\n                    memberNames: [] // [NEW] Track member names for the card\r\n                };\r\n            }\r\n            if (log.status === 'denied') {\r\n                classGroups[key].deniedCount++;\r\n            } else {\r\n                classGroups[key].count++;\r\n                // Add name if it's a multi-attended member or specifically passion-member\r\n                if (log.memberName && (multiAttendedMemberIds.includes(log.memberId) || log.sessionCount > 1 || log.isMultiSession)) {\r\n                    if (!classGroups[key].memberNames.includes(log.memberName)) {\r\n                        classGroups[key].memberNames.push(log.memberName);\r\n                    }\r\n                }\r\n            }\r\n        });\r\n        \r\n        // [UX] Sort by classTime Descending (Latest First) as requested\r\n        const newTodayClasses = Object.values(classGroups).sort((a, b) => {\r\n            if (!a.classTime) return 1;\r\n            if (!b.classTime) return -1;\r\n            return b.classTime.localeCompare(a.classTime);\r\n        });\r\n        setTodayClasses(newTodayClasses);\r\n\r\n        // Trigger AI Insight if tab matches (handled by caller effectively)\r\n        // Returning summary for caller to decide on AI call\r\n\r\n    }, [currentBranch, calculateStats, isMemberActive, isMemberExpiring]);\r\n\r\n    // Subscriptions\r\n    useEffect(() => {\r\n        refreshData();\r\n        const unsubscribe = storageService.subscribe(refreshData);\r\n        // AI Pending Approvals (New)\r\n        const unsubPending = storageService.getPendingApprovals((items) => {\r\n            setPendingApprovals(items);\r\n        });\r\n\r\n        return () => {\r\n            unsubscribe();\r\n            if (unsubPending) unsubPending();\r\n        };\r\n    }, [refreshData]);\r\n\r\n    const handleApprovePush = async (id, title) => {\r\n        if (confirm(`'${title}'   ?`)) {\r\n            try {\r\n                await storageService.approvePush(id);\r\n            } catch (e) {\r\n                alert(\"    : \" + e.message);\r\n            }\r\n        }\r\n    };\r\n\r\n    const handleRejectPush = async (id) => {\r\n        if (confirm(\"   ()?\")) {\r\n            try {\r\n                await storageService.rejectPush(id);\r\n            } catch (e) {\r\n                alert(\"    : \" + e.message);\r\n            }\r\n        }\r\n    };\r\n\r\n    // [Feature 1] Chart Data States\r\n    const [revenueTrend, setRevenueTrend] = useState([]);\r\n    const [memberStatusDist, setMemberStatusDist] = useState([]);\r\n\r\n    useEffect(() => {\r\n        if (activeTab === 'members' && summary.activeMembers > 0) {\r\n            loadAIInsight(members, logs, summary, todayClasses);\r\n        }\r\n    }, [activeTab, summary, loadAIInsight, members, logs, todayClasses]);\r\n\r\n    // [Feature 1] Calculate Chart Data (Memoized or inside refreshData)\r\n    const calculateChartData = useCallback((currentSales, uniqueMembers, isMemberActiveFn) => {\r\n        // 1. Revenue Trend (Last 6 Months)\r\n        const trends = [];\r\n        const today = new Date();\r\n        for (let i = 5; i >= 0; i--) {\r\n            const d = new Date(today.getFullYear(), today.getMonth() - i, 1);\r\n            const yyyy = d.getFullYear();\r\n            const mm = String(d.getMonth() + 1).padStart(2, '0');\r\n            const key = `${yyyy}-${mm}`;\r\n\r\n            const monthRevenue = currentSales\r\n                .filter(s => {\r\n                    const rawDate = s.date || s.timestamp;\r\n                    if (!rawDate) return false;\r\n                    \r\n                    let sMonthKey;\r\n                    if (rawDate.includes('T')) {\r\n                        // KST conversion for ISO strings\r\n                        sMonthKey = new Date(rawDate).toLocaleDateString('sv-SE', { timeZone: 'Asia/Seoul' }).substring(0, 7);\r\n                    } else {\r\n                        sMonthKey = rawDate.substring(0, 7);\r\n                    }\r\n\r\n                    const member = uniqueMembers.find(m => m.id === s.memberId);\r\n                    const branchMatch = currentBranch === 'all' || s.branchId === currentBranch || member?.homeBranch === currentBranch;\r\n                    \r\n                    return sMonthKey === key && branchMatch;\r\n                })\r\n                .reduce((sum, s) => sum + (Number(s.amount) || 0), 0);\r\n\r\n            trends.push({ month: `${mm}`, amount: monthRevenue, fullKey: key });\r\n        }\r\n        setRevenueTrend(trends);\r\n\r\n        // 2. Member Status Distribution\r\n        // Active: Currently attending (Active & Attended within 14 days)\r\n        // Dormant: Active but no attendance > 14 days\r\n        // Expired: No credits or expired date\r\n        let activeCount = 0;\r\n        let dormantCount = 0;\r\n        let expiredCount = 0;\r\n\r\n        const twoWeeksAgo = new Date();\r\n        twoWeeksAgo.setDate(today.getDate() - 14);\r\n\r\n        uniqueMembers.filter(m => currentBranch === 'all' || m.homeBranch === currentBranch).forEach(m => {\r\n            const isActive = isMemberActiveFn(m);\r\n            if (!isActive) {\r\n                expiredCount++;\r\n            } else {\r\n                // Check dormancy\r\n                let lastAttDate = m.lastAttendance ? new Date(m.lastAttendance) : null;\r\n                // If no lastAttendance, check join date? Or assume dormant if old reg?\r\n                // Simple logic: if Active and lastAtt < 14 days ago -> Active, else Dormant\r\n                if (lastAttDate && lastAttDate >= twoWeeksAgo) {\r\n                    activeCount++;\r\n                } else if (m.regDate && new Date(m.regDate) >= twoWeeksAgo && !lastAttDate) {\r\n                    // New member (joined < 14 days) but no attendance yet -> Treat as Active (New)\r\n                    activeCount++;\r\n                } else {\r\n                    dormantCount++;\r\n                }\r\n            }\r\n        });\r\n\r\n        setMemberStatusDist([\r\n            { name: '', value: activeCount },\r\n            { name: '()', value: dormantCount },\r\n            { name: '', value: expiredCount }\r\n        ]);\r\n\r\n    }, [currentBranch]);\r\n\r\n    // Hook into refreshData to trigger chart calc\r\n    useEffect(() => {\r\n        if (members.length > 0) {\r\n            calculateChartData(sales, members, isMemberActive);\r\n        }\r\n    }, [calculateStats, members, sales, calculateChartData, isMemberActive]);\r\n\r\n\r\n    // [Added] AI Quota Check\r\n    const checkAIQuota = useCallback(() => {\r\n        return aiUsage.count < aiUsage.limit;\r\n    }, [aiUsage]);\r\n\r\n    // [Added] Filtered Members by Branch\r\n    const filteredMembers = members.filter(m => currentBranch === 'all' || m.homeBranch === currentBranch);\r\n\r\n    // [Added] Dormant Segments Logic\r\n    const getDormantSegments = useCallback((targetMembers) => {\r\n        const nowMs = Date.now();\r\n        const fourteenDaysMs = 1000 * 60 * 60 * 24 * 14;\r\n        const segments = { 'all': [] };\r\n\r\n        targetMembers.forEach(m => {\r\n            if (!isMemberActive(m)) return;\r\n\r\n            let lastDateMs = m.lastAttendance ? new Date(m.lastAttendance).getTime() : null;\r\n            if (!lastDateMs && m.regDate) {\r\n                const regMs = new Date(m.regDate).getTime();\r\n                if ((nowMs - regMs) > fourteenDaysMs) lastDateMs = regMs;\r\n            }\r\n\r\n            if (!lastDateMs) return;\r\n\r\n            if ((nowMs - lastDateMs) >= fourteenDaysMs) {\r\n                segments['all'].push(m);\r\n            }\r\n        });\r\n        return segments;\r\n    }, [isMemberActive]);\r\n\r\n    return {\r\n        // State\r\n        currentBranch,\r\n        members,\r\n        sales,\r\n        logs,\r\n        notices,\r\n        stats,\r\n        revenueTrend,   // [New]\r\n        memberStatusDist, // [New]\r\n        aiInsight,\r\n        loadingInsight,\r\n        images,\r\n        optimisticImages,\r\n        todayClasses,\r\n        pushTokens,\r\n        aiUsage,\r\n        pendingApprovals,\r\n        summary,\r\n\r\n        // Actions\r\n        setCurrentBranch: (branch) => {\r\n            setCurrentBranch(branch);\r\n            storageService.setBranch(branch); // Sync with storage\r\n        },\r\n        setOptimisticImages, // For immediate UI updates\r\n        refreshData,\r\n        handleApprovePush,\r\n        handleRejectPush,\r\n        isMemberActive,\r\n        checkAIQuota,\r\n        filteredMembers,\r\n        getDormantSegments, // [New]\r\n        isMemberExpiring,\r\n        todayReRegMemberIds // [New]\r\n    };\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\hooks\\useAttendanceStats.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\hooks\\useAudioAnalyzer.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\hooks\\useFilter.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\hooks\\useLanguage.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\hooks\\useMeditationAI.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":152,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":152,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useRef, useCallback } from 'react';\r\nimport { httpsCallable } from 'firebase/functions';\r\nimport { functions } from '../firebase';\r\nimport { AI_SESSION_MESSAGES, MEDITATION_MODES, DIAGNOSIS_OPTIONS } from '../constants/meditationConstants';\r\n\r\nconst generateMeditationGuidance = httpsCallable(functions, 'generateMeditationGuidance');\r\nconst SELECTED_DIAGNOSIS_FALLBACK = DIAGNOSIS_OPTIONS[0];\r\n\r\nexport const useMeditationAI = ({\r\n    memberName,\r\n    timeContext,\r\n    selectedIntention,\r\n    activeMode,\r\n    interactionType,\r\n    micVolume,\r\n    isPlayingRef,\r\n    ttcEnabled,\r\n    stopAllAudio,\r\n    playAudio,\r\n    speak,\r\n    onExit,\r\n    onMeditationReady\r\n}) => {\r\n    // Basic States\r\n    const [isAILoading, setIsAILoading] = useState(true);\r\n    const [aiRequestLock, setAiRequestLock] = useState(false);\r\n    const [aiLatency, setAiLatency] = useState(0);\r\n\r\n    // AI Contents\r\n    const [chatHistory, setChatHistory] = useState([]);\r\n    const [currentAIChat, setCurrentAIChat] = useState(null);\r\n    const [manualInput, setManualInput] = useState(\"\");\r\n    const [aiPrescription, setAiPrescription] = useState(null);\r\n    const [prescriptionReason, setPrescriptionReason] = useState('');\r\n    const [aiMessage, setAiMessage] = useState(\"\");\r\n    \r\n    // Session Tracking\r\n    const [sessionInfo, setSessionInfo] = useState(null);\r\n    const [feedbackData, setFeedbackData] = useState(null);\r\n    const [needsFeedback, setNeedsFeedback] = useState(false);\r\n\r\n    // Refs\r\n    const currentRequestIdRef = useRef(0);\r\n    const messageIndexRef = useRef(0);\r\n    const sessionDiagnosisRef = useRef(null);\r\n    const consecutiveFailsRef = useRef(0);\r\n\r\n    // -----------------------------------------------------\r\n    // 1. Pre-Session: fetchAIPrescription\r\n    // -----------------------------------------------------\r\n    const fetchAIPrescription = useCallback(async (diagnosisId, weatherId, modeId, intType, currentSummary) => {\r\n        try {\r\n            const startTime = Date.now();\r\n            const prescResult = await generateMeditationGuidance({\r\n                type: 'prescription',\r\n                memberName: memberName,\r\n                timeContext: timeContext,\r\n                weather: weatherId,\r\n                diagnosis: diagnosisId,\r\n                analysisSummary: currentSummary,\r\n                mode: modeId === 'breath' ? '3min' : (modeId === 'calm' ? '7min' : '15min'),\r\n                interactionType: intType\r\n            });\r\n            setAiLatency(Date.now() - startTime);\r\n            \r\n            if (prescResult.data) {\r\n                if (prescResult.data.prescriptionReason) {\r\n                    prescResult.data.prescriptionReason = prescResult.data.prescriptionReason.replace(/OO/g, `${memberName}`);\r\n                }\r\n                if (prescResult.data.message) {\r\n                    prescResult.data.message = prescResult.data.message.replace(/OO/g, `${memberName}`);\r\n                }\r\n                setAiPrescription(prescResult.data);\r\n                setPrescriptionReason(prescResult.data.prescriptionReason || prescResult.data.message || '');\r\n            }\r\n        } catch (err) {\r\n            console.error('Standalone Prescription fetch failed:', err);\r\n        }\r\n    }, [memberName, timeContext, setAiLatency]);\r\n\r\n    // -----------------------------------------------------\r\n    // 2. Pre-Session: fetchAIQuestion\r\n    // -----------------------------------------------------\r\n    const fetchAIQuestion = useCallback(async (history = []) => {\r\n        if (aiRequestLock) return; \r\n        setAiRequestLock(true);\r\n        setIsAILoading(true);\r\n\r\n        const requestId = currentRequestIdRef.current + 1;\r\n        currentRequestIdRef.current = requestId;\r\n        \r\n        try {\r\n            const hour = new Date().getHours();\r\n            let currentContext = 'night';\r\n            if (hour >= 5 && hour < 12) currentContext = 'morning';\r\n            else if (hour >= 12 && hour < 18) currentContext = 'afternoon';\r\n            \r\n            let timeoutId;\r\n            const timeoutPromise = new Promise((resolve) => {\r\n                timeoutId = setTimeout(() => {\r\n                    const fallbackMsg = (history && history.length > 0) \r\n                        ? \"  .   ?\" \r\n                        : \"   ?\";\r\n                        \r\n                    const fallbackOptions = (history && history.length > 0)\r\n                        ? [\", \", \" \"]\r\n                        : [\"\", \" \", \"\"];\r\n\r\n                    resolve({\r\n                        data: {\r\n                            message: fallbackMsg,\r\n                            isFinalAnalysis: false,\r\n                            options: fallbackOptions,\r\n                            error: \"timeout\"\r\n                        }\r\n                    });\r\n                }, 18000); \r\n            });\r\n\r\n            const startTime = Date.now();\r\n            const apiPromise = generateMeditationGuidance({ \r\n                type: 'question', \r\n                memberName: memberName || '', \r\n                timeContext: currentContext,\r\n                chatHistory: history,\r\n                intentionFocus: selectedIntention?.focus\r\n            });\r\n\r\n            const result = await Promise.race([apiPromise, timeoutPromise]);\r\n            setAiLatency(Date.now() - startTime);\r\n            clearTimeout(timeoutId);\r\n\r\n            if (requestId !== currentRequestIdRef.current) return;\r\n\r\n            if (result.data) {\r\n                if (result.data.message) result.data.message = result.data.message.replace(/OO/g, `${memberName}`);\r\n                if (result.data.question) result.data.question = result.data.question.replace(/OO/g, `${memberName}`);\r\n                \r\n                if (result.data.isFinalAnalysis) {\r\n                    result.data.options = [];\r\n                    result.data.isTransition = true;\r\n                }\r\n                \r\n                setCurrentAIChat(result.data);\r\n                \r\n                if (result.data.audioContent) {\r\n                    playAudio(result.data.audioContent);\r\n                } else if (result.data.isFinalAnalysis) {\r\n                    if (ttcEnabled) speak(result.data.message);\r\n                }\r\n            }\r\n        } catch (error) {\r\n            if (requestId !== currentRequestIdRef.current) return;\r\n            setCurrentAIChat({\r\n                message: \",    .  ?\",\r\n                options: [\", \", \" \"]\r\n            });\r\n        } finally {\r\n            if (requestId === currentRequestIdRef.current) {\r\n                setIsAILoading(false);\r\n                setAiRequestLock(false);\r\n            }\r\n        }\r\n    }, [aiRequestLock, memberName, selectedIntention, playAudio, ttcEnabled, speak, setAiLatency]);\r\n\r\n    const handleChatResponse = useCallback(async (answer) => {\r\n        if (!answer || aiRequestLock) return;\r\n        \r\n        stopAllAudio();\r\n\r\n        if (answer === \" \") {\r\n            if (onExit) onExit();\r\n            return;\r\n        }\r\n        \r\n        if (currentAIChat?.isFinalAnalysis || [\", \", \"  \", \" \", \"\", \" \", \" \"].some(trigger => answer.includes(trigger))) {\r\n            const diag = DIAGNOSIS_OPTIONS.find(o => o.id === currentAIChat?.mappedDiagnosis) || SELECTED_DIAGNOSIS_FALLBACK;\r\n            const defaultMode = MEDITATION_MODES.find(m => m.id === diag?.prescription?.modeId) || MEDITATION_MODES[1];\r\n            \r\n            if (onMeditationReady) {\r\n                onMeditationReady(diag, defaultMode, diag?.prescription?.type || 'v1');\r\n            }\r\n            return;\r\n        }\r\n        \r\n        stopAllAudio();\r\n\r\n        let updatedHistory = [...chatHistory];\r\n        if (currentAIChat) {\r\n            const aiText = currentAIChat.message || currentAIChat.question;\r\n            const isFallback = aiText?.includes(\" \") || aiText?.includes(\"  \");\r\n            \r\n            if (aiText && !isFallback) {\r\n                updatedHistory = [...updatedHistory, { role: 'model', content: aiText }];\r\n            }\r\n        }\r\n\r\n        const isRespondingToFallback = currentAIChat?.message?.includes(\" \") || currentAIChat?.message?.includes(\"  \");\r\n        \r\n        if (!isRespondingToFallback) {\r\n            updatedHistory = [...updatedHistory, { role: 'user', content: answer }];\r\n        }\r\n        \r\n        setChatHistory(updatedHistory);\r\n        setCurrentAIChat(null); \r\n        setIsAILoading(true);\r\n\r\n        await fetchAIQuestion(updatedHistory);\r\n    }, [aiRequestLock, currentAIChat, chatHistory, stopAllAudio, onExit, onMeditationReady, fetchAIQuestion]);\r\n\r\n    const handleManualSubmit = useCallback((e) => {\r\n        e.preventDefault();\r\n        if (!manualInput.trim()) return;\r\n        const text = manualInput;\r\n        setManualInput(\"\");\r\n        handleChatResponse(text);\r\n    }, [manualInput, handleChatResponse]);\r\n\r\n    const handleReturnToChat = useCallback(async () => {\r\n        setIsAILoading(true);\r\n        \r\n        const warmReconnectMsg = `${memberName},  .      ?`;\r\n        setCurrentAIChat({\r\n            message: warmReconnectMsg,\r\n            options: [\", \", \", \"]\r\n        });\r\n        \r\n        if (ttcEnabled) speak(warmReconnectMsg);\r\n\r\n        const lastUserMsg = chatHistory.filter(m => m.role === 'user').pop()?.content || '';\r\n        const newHistory = [...chatHistory, { \r\n            role: 'system',\r\n            content: `[Context] User briefly viewed meditation options but chose to continue conversation. Last discussed: \"${lastUserMsg}\". Gently ask if they want to explore that topic more deeply, in a warm, human, conversational tone. Do NOT sound robotic or templated.` \r\n        }];\r\n        setChatHistory(newHistory);\r\n        \r\n        await fetchAIQuestion(newHistory);\r\n    }, [memberName, chatHistory, ttcEnabled, speak, fetchAIQuestion]);\r\n\r\n    // -----------------------------------------------------\r\n    // 3. In-Session: fetchAISessionMessage\r\n    // -----------------------------------------------------\r\n    const fetchAISessionMessage = useCallback(async () => {\r\n        try {\r\n            const currentIndex = messageIndexRef.current;\r\n            const currentDiagnosis = sessionDiagnosisRef.current;\r\n            \r\n            const startTime = Date.now();\r\n            let timeoutId;\r\n            const timeoutPromise = new Promise((_, reject) => {\r\n                timeoutId = setTimeout(() => reject(new Error('Session AI timeout (8s)')), 8000);\r\n            });\r\n            \r\n            const apiPromise = generateMeditationGuidance({\r\n                type: 'session_message',\r\n                memberName: memberName,\r\n                timeContext: timeContext,\r\n                diagnosis: currentDiagnosis,\r\n                mode: activeMode?.id === 'breath' ? '3min' : (activeMode?.id === 'calm' ? '7min' : '15min'),\r\n                interactionType: interactionType,\r\n                messageIndex: currentIndex,\r\n                breathLevel: interactionType === 'v2' ? micVolume : null\r\n            });\r\n            \r\n            const result = await Promise.race([apiPromise, timeoutPromise]);\r\n            clearTimeout(timeoutId);\r\n            setAiLatency(Date.now() - startTime);\r\n            \r\n            if (result.data && result.data.error) throw new Error(\"Backend Returned Error: \" + result.data.error);\r\n\r\n            if (result.data && result.data.message) {\r\n                const personalizedMsg = result.data.message.replace(/OO/g, `${memberName}`);\r\n                if (isPlayingRef.current) {\r\n                    setAiMessage(personalizedMsg);\r\n                    messageIndexRef.current = currentIndex + 1;\r\n                    consecutiveFailsRef.current = 0;\r\n                    \r\n                    if (result.data.audioContent) {\r\n                        playAudio(result.data.audioContent);\r\n                    }\r\n                }\r\n            }\r\n        } catch (error) {\r\n            console.error('AI Session message failed:', error.message);\r\n            if (isPlayingRef.current) {\r\n                const currentIndex = messageIndexRef.current;\r\n                consecutiveFailsRef.current += 1;\r\n                const failCount = consecutiveFailsRef.current;\r\n                \r\n                if (failCount > 3) return;\r\n                \r\n                const messages = AI_SESSION_MESSAGES[interactionType] || AI_SESSION_MESSAGES['v1'];\r\n                const msg = messages[currentIndex % messages.length];\r\n                setAiMessage(msg);\r\n                messageIndexRef.current = currentIndex + 1;\r\n            }\r\n        }\r\n    }, [memberName, timeContext, activeMode, interactionType, micVolume, isPlayingRef, playAudio, setAiLatency]);\r\n\r\n    // -----------------------------------------------------\r\n    // 4. Post-Session: fetchAIFeedback\r\n    // -----------------------------------------------------\r\n    const fetchAIFeedback = useCallback(async (stabilityScore, customSummary) => {\r\n        try {\r\n            const result = await generateMeditationGuidance({\r\n                type: 'feedback',\r\n                memberName: memberName,\r\n                sessionInfo: sessionInfo,\r\n                postureFeedback: customSummary,\r\n                stabilityScore: stabilityScore\r\n            });\r\n            \r\n            if (result.data && result.data.feedbackMessage) {\r\n                setFeedbackData({ \r\n                    message: result.data.feedbackMessage.replace(/OO/g, `${memberName}`),\r\n                    analysis: result.data.analysis \r\n                });\r\n            }\r\n            return result.data;\r\n        } catch (err) {\r\n            console.error('AI Feedback Failed:', err);\r\n            return null;\r\n        }\r\n    }, [memberName, sessionInfo]);\r\n\r\n    // Helpers\r\n    const generateReason = useCallback((time, weatherId, diagnosisId) => {\r\n        const timeText = time === 'morning' ? '  ,' : time === 'afternoon' ? '  ,' : '  ,';\r\n        let coreMessage = \"      .      ?\";\r\n        \r\n        if (diagnosisId === 'stress' || diagnosisId === 'overthink') {\r\n            coreMessage = \"       .   ,          .    .\";\r\n        } else if (diagnosisId === 'stiff') {\r\n            coreMessage = \"    .     ,     .\";\r\n        } else if (diagnosisId === 'anxious' || diagnosisId === 'frustrated') {\r\n            coreMessage = \"         .            .  .\";\r\n        } else if (diagnosisId === 'tired' || diagnosisId === 'low_energy') {\r\n            coreMessage = \"      .        .     .\";\r\n        } else if (diagnosisId === 'distracted') {\r\n            coreMessage = \"     ?    ' '   .\";\r\n        } \r\n        return `${timeText} ${coreMessage}`;\r\n    }, []);\r\n\r\n    return {\r\n        isAILoading, setIsAILoading,\r\n        aiRequestLock, setAiRequestLock,\r\n        aiLatency, setAiLatency,\r\n        chatHistory, setChatHistory,\r\n        currentAIChat, setCurrentAIChat,\r\n        manualInput, setManualInput,\r\n        aiPrescription, setAiPrescription,\r\n        prescriptionReason, setPrescriptionReason,\r\n        aiMessage, setAiMessage,\r\n        sessionInfo, setSessionInfo,\r\n        feedbackData, setFeedbackData,\r\n        needsFeedback, setNeedsFeedback,\r\n        \r\n        messageIndexRef,\r\n        sessionDiagnosisRef,\r\n        consecutiveFailsRef,\r\n\r\n        fetchAIPrescription,\r\n        fetchAIQuestion,\r\n        fetchAISessionMessage,\r\n        fetchAIFeedback,\r\n        handleChatResponse,\r\n        handleManualSubmit,\r\n        handleReturnToChat,\r\n        generateReason\r\n    };\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\hooks\\useMeditationAudio.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'audioVolumes' is defined but never used.","line":3,"column":91,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":103,"suggestions":[{"messageId":"removeVar","data":{"varName":"audioVolumes"},"fix":{"range":[147,161],"text":""},"desc":"Remove unused variable 'audioVolumes'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'soundEnabled' is defined but never used.","line":3,"column":105,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":117,"suggestions":[{"messageId":"removeVar","data":{"varName":"soundEnabled"},"fix":{"range":[161,175],"text":""},"desc":"Remove unused variable 'soundEnabled'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useRef, useCallback, useEffect } from 'react';\r\n\r\nexport const useMeditationAudio = (ttcEnabled, isPlayingRef, step, logDebug, setTtsState, audioVolumes, soundEnabled) => {\r\n    const audioContextRef = useRef(null);\r\n    const oscLeftRef = useRef(null);\r\n    const oscRightRef = useRef(null);\r\n    const gainNodeRef = useRef(null);\r\n    const currentAudioRef = useRef(null);\r\n    const ambientAudioRef = useRef(null);\r\n\r\n    // Audio Context Getter\r\n    const getAudioContext = useCallback(() => {\r\n        if (!audioContextRef.current) {\r\n            audioContextRef.current = new (window.AudioContext || window.webkitAudioContext)();\r\n        }\r\n        return audioContextRef.current;\r\n    }, []);\r\n\r\n    // ---------------------------------------------------------\r\n    // 1. Binaural Beats Engine\r\n    // ---------------------------------------------------------\r\n    const playBinauralBeats = useCallback((carrierFreq = 200, beatFreq = 4, volume = 0.25) => {\r\n        const audioCtx = getAudioContext();\r\n        if (audioCtx.state === 'suspended') audioCtx.resume();\r\n\r\n        const oscL = audioCtx.createOscillator();\r\n        const oscR = audioCtx.createOscillator();\r\n        const gainNode = audioCtx.createGain();\r\n\r\n        oscL.type = 'sine'; oscR.type = 'sine';\r\n        oscL.frequency.value = carrierFreq;\r\n        oscR.frequency.value = carrierFreq + beatFreq;\r\n\r\n        const pannerL = audioCtx.createStereoPanner();\r\n        const pannerR = audioCtx.createStereoPanner();\r\n        pannerL.pan.value = -1; pannerR.pan.value = 1;\r\n\r\n        oscL.connect(pannerL); pannerL.connect(gainNode);\r\n        oscR.connect(pannerR); pannerR.connect(gainNode);\r\n\r\n        gainNode.connect(audioCtx.destination);\r\n        gainNode.gain.value = volume;\r\n\r\n        oscL.start(); oscR.start();\r\n\r\n        oscLeftRef.current = oscL;\r\n        oscRightRef.current = oscR;\r\n        gainNodeRef.current = gainNode;\r\n        \r\n        logDebug && logDebug(\"BinauralBeats:Start\", { carrierFreq, beatFreq, volume });\r\n    }, [getAudioContext, logDebug]);\r\n\r\n    const stopBinauralBeats = useCallback(() => {\r\n        if (oscLeftRef.current) { try { oscLeftRef.current.stop(); } catch { /* ignore */ } oscLeftRef.current = null; }\r\n        if (oscRightRef.current) { try { oscRightRef.current.stop(); } catch { /* ignore */ } oscRightRef.current = null; }\r\n        if (gainNodeRef.current) gainNodeRef.current = null;\r\n    }, []);\r\n\r\n    const updateBinauralVolume = useCallback((volume) => {\r\n        if (gainNodeRef.current && audioContextRef.current) {\r\n            const currentTime = audioContextRef.current.currentTime;\r\n            gainNodeRef.current.gain.setTargetAtTime(volume, currentTime, 0.5);\r\n        }\r\n    }, []);\r\n\r\n    // ---------------------------------------------------------\r\n    // 2. Ambient Environments Engine\r\n    // ---------------------------------------------------------\r\n    const updateAmbientVolume = useCallback((volume) => {\r\n        if (ambientAudioRef.current) {\r\n            ambientAudioRef.current.volume = volume;\r\n        }\r\n    }, []);\r\n\r\n    const playAmbientMusic = useCallback((ambientDef, volume) => {\r\n        if (!ambientDef || ambientDef.id === 'none') {\r\n            if (ambientAudioRef.current) {\r\n                ambientAudioRef.current.pause();\r\n                ambientAudioRef.current = null;\r\n            }\r\n            return;\r\n        }\r\n\r\n        if (!ambientAudioRef.current || !ambientAudioRef.current.src.includes(ambientDef.file)) {\r\n            if (ambientAudioRef.current) ambientAudioRef.current.pause();\r\n            const audio = new Audio(ambientDef.file);\r\n            audio.loop = true;\r\n            audio.volume = volume;\r\n            ambientAudioRef.current = audio;\r\n        }\r\n\r\n        ambientAudioRef.current.play().catch(e => {\r\n            console.warn(\"Ambient play failed:\", e);\r\n            logDebug && logDebug(\"Ambient:Error\", e);\r\n        });\r\n    }, [logDebug]);\r\n\r\n    const stopAmbientMusic = useCallback(() => {\r\n        if (ambientAudioRef.current) {\r\n            ambientAudioRef.current.pause();\r\n        }\r\n    }, []);\r\n\r\n    const stopAmbientMusicAndReset = useCallback(() => {\r\n        if (ambientAudioRef.current) {\r\n            ambientAudioRef.current.pause();\r\n            ambientAudioRef.current.currentTime = 0;\r\n            ambientAudioRef.current = null;\r\n        }\r\n    }, []);\r\n\r\n    // ---------------------------------------------------------\r\n    // 3. TTS Engines (Cloud & Local)\r\n    // ---------------------------------------------------------\r\n    const stopVoiceOnly = useCallback(() => {\r\n        if (window.speechSynthesis) window.speechSynthesis.cancel();\r\n        if (currentAudioRef.current) {\r\n            try { currentAudioRef.current.pause(); currentAudioRef.current.currentTime = 0; } catch { /* ignore */ }\r\n            currentAudioRef.current = null;\r\n        }\r\n    }, []);\r\n\r\n    const playAudio = useCallback((base64String, volume, onEndedCallback) => {\r\n        if (!ttcEnabled || !base64String) return null;\r\n        \r\n        try {\r\n            stopVoiceOnly();\r\n            \r\n            const audio = new Audio(`data:audio/mp3;base64,${base64String}`);\r\n            audio.volume = volume;\r\n            currentAudioRef.current = audio;\r\n\r\n            setTtsState && setTtsState({ isSpeaking: true, engine: 'Cloud TTS', volume: audio.volume });\r\n            logDebug && logDebug(\"PlayAudio:Start\", { vol: volume });\r\n\r\n            audio.onended = () => { \r\n                logDebug && logDebug(\"PlayAudio:Ended\");\r\n                setTtsState && setTtsState(prev => ({ ...prev, isSpeaking: false }));\r\n                if (currentAudioRef.current === audio) currentAudioRef.current = null;\r\n                if (onEndedCallback) onEndedCallback();\r\n            };\r\n            \r\n            const playPromise = audio.play();\r\n            if (playPromise !== undefined) {\r\n                playPromise.catch(e => {\r\n                    console.error(\" Audio Playback Failed:\", e);\r\n                    logDebug && logDebug(\"PlayAudio:Error\", e);\r\n                    setTtsState && setTtsState(prev => ({ ...prev, isSpeaking: false }));\r\n                });\r\n            }\r\n            \r\n            // Race condition check\r\n            if (!isPlayingRef.current && step === 'session') {\r\n                audio.pause();\r\n                currentAudioRef.current = null;\r\n            }\r\n            \r\n            return audio;\r\n        } catch (e) {\r\n            console.error(\" Audio Error:\", e);\r\n            logDebug && logDebug(\"PlayAudio:Catch\", e);\r\n            setTtsState && setTtsState(prev => ({ ...prev, isSpeaking: false }));\r\n            return null;\r\n        }\r\n    }, [ttcEnabled, stopVoiceOnly, setTtsState, logDebug, isPlayingRef, step]);\r\n\r\n    const speak = useCallback((text) => {\r\n        logDebug && logDebug(\"Speak:Start\", text);\r\n        console.log(\" [TTS Check] Speaking:\", text);\r\n        if (!text || typeof window === 'undefined' || !ttcEnabled || !window.speechSynthesis) return;\r\n        \r\n        stopVoiceOnly(); \r\n        \r\n        const utterance = new SpeechSynthesisUtterance(text);\r\n        utterance.lang = 'ko-KR';\r\n        utterance.rate = 0.9;\r\n        utterance.pitch = 1.0;\r\n        utterance.volume = 0.8;\r\n\r\n        utterance.onstart = () => setTtsState && setTtsState({ isSpeaking: true, engine: 'Local TTS', volume: 0.8 });\r\n        utterance.onend = () => setTtsState && setTtsState(prev => ({ ...prev, isSpeaking: false }));\r\n        utterance.onerror = () => setTtsState && setTtsState(prev => ({ ...prev, isSpeaking: false }));\r\n        \r\n        setTimeout(() => {\r\n            if (window.speechSynthesis && ttcEnabled && (step !== 'session' || isPlayingRef.current)) {\r\n                window.speechSynthesis.speak(utterance);\r\n            }\r\n        }, 100);\r\n    }, [ttcEnabled, step, stopVoiceOnly, logDebug, setTtsState, isPlayingRef]);\r\n\r\n    const speakFallback = useCallback((text) => {\r\n        if (!text || typeof window === 'undefined' || !ttcEnabled || !window.speechSynthesis) return;\r\n        \r\n        logDebug && logDebug(\"SpeakFallback\", text);\r\n        stopVoiceOnly();\r\n\r\n        const utterance = new SpeechSynthesisUtterance(text);\r\n        utterance.lang = 'ko-KR';\r\n        utterance.rate = 0.9;\r\n        utterance.pitch = 1.0; \r\n        utterance.volume = 0.8; \r\n        \r\n        setTimeout(() => {\r\n            if (window.speechSynthesis && ttcEnabled) {\r\n                window.speechSynthesis.speak(utterance);\r\n            }\r\n        }, 100);\r\n    }, [ttcEnabled, stopVoiceOnly, logDebug]);\r\n\r\n    // ---------------------------------------------------------\r\n    // 4. Global Cleanup\r\n    // ---------------------------------------------------------\r\n    const stopAllAudio = useCallback((stopAmbient = false) => {\r\n        stopVoiceOnly();\r\n        \r\n        if (stopAmbient) stopAmbientMusic();\r\n        \r\n        stopBinauralBeats();\r\n        \r\n        logDebug && logDebug(\"StopAllAudio\", { stopAmbient });\r\n    }, [stopVoiceOnly, stopAmbientMusic, stopBinauralBeats, logDebug]);\r\n\r\n    // Cleanup AudioContext on unmount\r\n    useEffect(() => {\r\n        return () => {\r\n            if (audioContextRef.current) {\r\n                audioContextRef.current.close().catch(e => console.error(e));\r\n                audioContextRef.current = null;\r\n            }\r\n        };\r\n    }, []);\r\n\r\n    // Provide raw refs to caller if needed\r\n    return {\r\n        audioContextRef,\r\n        ambientAudioRef,\r\n        currentAudioRef,\r\n        \r\n        getAudioContext,\r\n        playBinauralBeats,\r\n        stopBinauralBeats,\r\n        updateBinauralVolume,\r\n        playAmbientMusic,\r\n        stopAmbientMusic,\r\n        stopAmbientMusicAndReset,\r\n        updateAmbientVolume,\r\n        playAudio,\r\n        speak,\r\n        speakFallback,\r\n        stopVoiceOnly,\r\n        stopAllAudio\r\n    };\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\hooks\\useMeditationTimer.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\hooks\\useNetworkMonitor.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\hooks\\usePWA.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\hooks\\useRevenueStats.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'statLastWeekStr' is assigned a value but never used.","line":205,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":205,"endColumn":30,"suggestions":[{"messageId":"removeVar","data":{"varName":"statLastWeekStr"},"fix":{"range":[8289,8349],"text":""},"desc":"Remove unused variable 'statLastWeekStr'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useMemo } from 'react';\r\nimport { getHolidayName } from '../utils/holidays';\r\n\r\nexport const useRevenueStats = (sales, members, currentDate, currentBranch) => {\r\n    return useMemo(() => {\r\n        const year = currentDate.getFullYear();\r\n        const month = currentDate.getMonth() + 1;\r\n        const monthStr = `${year}-${String(month).padStart(2, '0')}`;\r\n\r\n        const allItems = [];\r\n        const salesKeySet = new Set(); // Format: `${memberId}_${date}`\r\n\r\n        // 1. Process New Sales Data First (Primary Source)\r\n        (sales || []).forEach(s => {\r\n            const member = (members || []).find(m => m.id === s.memberId);\r\n            const saleBranch = s.branchId;\r\n            const memberBranch = member?.homeBranch;\r\n\r\n            if (currentBranch !== 'all') {\r\n                // If branch filter applied, check saleBranch FIRST, then memberBranch\r\n                const matchFound = (saleBranch && saleBranch === currentBranch) || \r\n                                   (!saleBranch && memberBranch && memberBranch === currentBranch);\r\n                if (!matchFound) return;\r\n            }\r\n\r\n            // [FIX] Robust date extraction handling both string and Firestore Timestamp\r\n            let dateStr;\r\n            const rawDate = s.date || s.timestamp;\r\n            \r\n            if (!rawDate) {\r\n                console.warn('[Revenue] Sales record missing both date and timestamp:', s.id, s.memberName);\r\n                return;\r\n            }\r\n            \r\n            if (typeof rawDate === 'string' && rawDate.includes('T')) {\r\n                const d = new Date(rawDate);\r\n                dateStr = d.toLocaleDateString('sv-SE', { timeZone: 'Asia/Seoul' });\r\n            } else if (typeof rawDate === 'object' && rawDate.toDate) {\r\n                // Handle Firestore Timestamp just in case\r\n                dateStr = rawDate.toDate().toLocaleDateString('sv-SE', { timeZone: 'Asia/Seoul' });\r\n            } else {\r\n                dateStr = String(rawDate); // Fallback string conversion\r\n            }\r\n\r\n            // Determine isNew\r\n            let isNew = false;\r\n            if (s.type === 'extend') {\r\n                isNew = false;\r\n            } else if (s.type === 'register') {\r\n                if (member && member.regDate === dateStr) {\r\n                    isNew = true;\r\n                } else {\r\n                    isNew = false;\r\n                }\r\n            }\r\n\r\n            allItems.push({\r\n                id: s.id,\r\n                memberId: s.memberId,\r\n                date: dateStr,\r\n                amount: Number(s.amount) || 0, // Ensure amount is numeric\r\n                name: s.memberName,\r\n                type: s.type, // 'register' or 'extend'\r\n                item: s.item,\r\n                isNew: isNew\r\n            });\r\n\r\n            // Add to dedup set\r\n            if (s.memberId) {\r\n                salesKeySet.add(`${s.memberId}_${dateStr}`);\r\n            }\r\n        });\r\n\r\n        // 2. Process Legacy Members Data (Secondary Source)\r\n        // Performance Improvement: Use a Map for O(1) lookups instead of filtering `finalItems` later\r\n        const legacyMemberData = new Map();\r\n\r\n        (members || []).forEach(m => {\r\n            const amt = Number(m.amount) || 0;\r\n            if (m.regDate && amt > 0) {\r\n                // Basic validation for reasonable date structure before keeping it\r\n                if (typeof m.regDate !== 'string' || m.regDate.length < 10) return;\r\n\r\n                if (currentBranch !== 'all' && m.homeBranch !== currentBranch) return;\r\n\r\n                // [FIX] Deduplication Check\r\n                if (salesKeySet.has(`${m.id}_${m.regDate}`)) return;\r\n\r\n                legacyMemberData.set(m.id, {\r\n                    id: m.id,\r\n                    memberId: m.id,\r\n                    date: m.regDate,\r\n                    amount: amt,\r\n                    name: m.name,\r\n                    type: 'legacy',\r\n                    item: m.subject || '',\r\n                    isNew: true \r\n                });\r\n            }\r\n        });\r\n\r\n        const finalItems = [...allItems, ...Array.from(legacyMemberData.values())];\r\n        finalItems.sort((a, b) => new Date(b.date) - new Date(a.date));\r\n\r\n        // [Debug] Log Revenue Data\r\n        // console.log('Revenue Debug:', {\r\n        //     totalItems: finalItems.length,\r\n        //     sampleItems: finalItems.slice(0, 5)\r\n        // });\r\n\r\n        // Optimization: Use a Map to grouping daily amounts for O(1) lookups\r\n        const dailyAmountsMap = new Map();\r\n        finalItems.forEach(item => {\r\n            const currentObj = dailyAmountsMap.get(item.date) || { \r\n                amount: 0, count: 0, amountNew: 0, amountReReg: 0, amountNewCount: 0, amountReRegCount: 0 \r\n            };\r\n            \r\n            currentObj.amount += item.amount;\r\n            currentObj.count += 1;\r\n            \r\n            if (item.isNew) {\r\n                currentObj.amountNew += item.amount;\r\n                currentObj.amountNewCount += 1;\r\n            } else {\r\n                currentObj.amountReReg += item.amount;\r\n                currentObj.amountReRegCount += 1;\r\n            }\r\n            \r\n            dailyAmountsMap.set(item.date, currentObj);\r\n        });\r\n\r\n        // 2. Monthly Stats (for Calendar)\r\n        const daily = {};\r\n        const daysInMonth = new Date(year, month, 0).getDate();\r\n        \r\n        // Simple mapping for display\r\n        const holidayMap = {\r\n            'holiday_new_year': '',\r\n            'holiday_lunar_new_year': '',\r\n            'holiday_samiljeol': '',\r\n            'holiday_childrens_day': '',\r\n            'holiday_buddha': '',\r\n            'holiday_memorial': '',\r\n            'holiday_liberation': '',\r\n            'holiday_chuseok': '',\r\n            'holiday_foundation': '',\r\n            'holiday_hangul': '',\r\n            'holiday_christmas': '', // Shortened for space\r\n            'holiday_election': ''\r\n        };\r\n\r\n        let monthlyTotal = 0;\r\n        let monthlyNew = 0;\r\n        let monthlyReReg = 0;\r\n        let monthlyCount = 0;\r\n\r\n        for (let d = 1; d <= daysInMonth; d++) {\r\n            const dKey = `${monthStr}-${String(d).padStart(2, '0')}`;\r\n            const dateObj = new Date(year, month - 1, d);\r\n            const dayOfWeek = dateObj.getDay(); // 0=Sun\r\n            const holidayRaw = getHolidayName(dKey);\r\n            \r\n            // Fetch aggregated data from map (O(1) instead of filter loop)\r\n            const dayData = dailyAmountsMap.get(dKey) || { \r\n                amount: 0, count: 0, amountNew: 0, amountReReg: 0, amountNewCount: 0, amountReRegCount: 0 \r\n            };\r\n\r\n            daily[dKey] = {\r\n                date: dKey,\r\n                amount: dayData.amount,\r\n                count: dayData.count,\r\n                amountNew: dayData.amountNew,\r\n                amountReReg: dayData.amountReReg,\r\n                amountNewCount: dayData.amountNewCount,\r\n                amountReRegCount: dayData.amountReRegCount,\r\n                isSunday: dayOfWeek === 0,\r\n                isSaturday: dayOfWeek === 6,\r\n                holidayName: holidayRaw ? (holidayMap[holidayRaw] || '') : null\r\n            };\r\n            \r\n            monthlyTotal += dayData.amount;\r\n            monthlyNew += dayData.amountNew;\r\n            monthlyReReg += dayData.amountReReg;\r\n            monthlyCount += dayData.count;\r\n        }\r\n\r\n        // 3. Comparative Stats (Yesterday, Day Before, Last Week)\r\n        const today = new Date();\r\n        const getOffsetDateString = (offsetDays) => {\r\n            const d = new Date(today);\r\n            d.setDate(today.getDate() - offsetDays);\r\n            return d.toLocaleDateString('sv-SE');\r\n        }\r\n\r\n        const todayStr = getOffsetDateString(0);\r\n        const yesterdayStr = getOffsetDateString(1);\r\n        const dayBeforeStr = getOffsetDateString(2);\r\n        const lastWeekStr = getOffsetDateString(7);\r\n\r\n        const getDailyTotalOptimized = (dStr) => dailyAmountsMap.get(dStr)?.amount || 0;\r\n\r\n        const statYesterday = getDailyTotalOptimized(yesterdayStr);\r\n        const statDayBefore = getDailyTotalOptimized(dayBeforeStr);\r\n        const statToday = getDailyTotalOptimized(todayStr); \r\n        const statLastWeekStr = getDailyTotalOptimized(lastWeekStr);\r\n\r\n\r\n        // 4. Trend Graph (Last 14 Days)\r\n        const trendData = [];\r\n        for (let i = 13; i >= 0; i--) {\r\n            const d = new Date(today);\r\n            d.setDate(today.getDate() - i);\r\n            const dStr = d.toLocaleDateString('sv-SE');\r\n            trendData.push({\r\n                date: dStr,\r\n                displayDate: `${d.getMonth() + 1}/${d.getDate()}`,\r\n                amount: getDailyTotalOptimized(dStr)\r\n            });\r\n        }\r\n\r\n        // 5. Monthly Trend (Last 6 Months)\r\n        const monthlyTrendData = [];\r\n        for (let i = 5; i >= 0; i--) {\r\n            const d = new Date(year, month - 1 - i, 1);\r\n            const mStr = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}`;\r\n            const label = `${d.getMonth() + 1}`;\r\n            \r\n            // Sum revenue for this month using the dailyMap\r\n            let amount = 0;\r\n            // Iterate over all keys in the map and sum if they start with mStr\r\n            dailyAmountsMap.forEach((val, key) => {\r\n                if (key.startsWith(mStr)) amount += val.amount;\r\n            });\r\n\r\n            monthlyTrendData.push({\r\n                name: label,\r\n                monthParams: mStr, \r\n                amount: amount\r\n            });\r\n        }\r\n\r\n        return {\r\n            dailyStats: Object.values(daily),\r\n            monthlyStats: {\r\n                totalRevenue: monthlyTotal,\r\n                totalRevenueNew: monthlyNew,\r\n                totalRevenueReReg: monthlyReReg,\r\n                totalCount: monthlyCount\r\n            },\r\n            comparativeStats: {\r\n                yesterday: statYesterday,\r\n                dayBefore: statDayBefore,\r\n                today: statToday\r\n            },\r\n            recentTrend: trendData,\r\n            monthlyTrend: monthlyTrendData\r\n        };\r\n\r\n    }, [members, sales, currentDate, currentBranch]);\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\hooks\\useTTS.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\hooks\\useWeatherAwareness.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\main.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'colno' is defined but never used.","line":101,"column":46,"nodeType":"Identifier","messageId":"unusedVar","endLine":101,"endColumn":51,"suggestions":[{"messageId":"removeVar","data":{"varName":"colno"},"fix":{"range":[3967,3974],"text":""},"desc":"Remove unused variable 'colno'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":101,"column":53,"nodeType":"Identifier","messageId":"unusedVar","endLine":101,"endColumn":58,"suggestions":[{"messageId":"removeVar","data":{"varName":"error"},"fix":{"range":[3974,3981],"text":""},"desc":"Remove unused variable 'error'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// [Global Event Guard]\r\n// Prevent browser context menu (long-press menu) specifically for Kiosk/Tablet experience\r\n// This ensures that \"Download/Share/Print\" menu never appears on any part of the app.\r\nif (typeof window !== 'undefined') {\r\n  window.addEventListener('contextmenu', (e) => {\r\n    // [EXCEPTION] Allow context menu on inputs if needed for text editing (optional)\r\n    // if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;\r\n    \r\n    e.preventDefault();\r\n  }, { passive: false });\r\n}\r\n\r\nimport { StrictMode } from 'react'\r\nimport ReactDOM from 'react-dom/client'\r\nimport App from './App.jsx'\r\nimport './styles/index.css'\r\nimport ErrorBoundary from './components/ErrorBoundary'\r\nimport { LanguageProvider } from './context/LanguageContext'\r\nimport { httpsCallable } from 'firebase/functions'\r\nimport { functions } from './firebase'\r\n\r\n// [PERF] Critical Server Warm-up:      (Render  )\r\n//    UI     \r\nif (typeof window !== 'undefined') {\r\n  const warmUpServers = async () => {\r\n    try {\r\n      console.log(' [Warm-up] Sending signals to Cloud Functions...');\r\n      // 1. Check-in Core\r\n      httpsCallable(functions, 'checkInMemberV2Call')({ ping: true }).catch(() => {});\r\n      // 2. AI Mediation Engine\r\n      httpsCallable(functions, 'generateMeditationGuidance')({ type: 'warmup' }).catch(() => {});\r\n    } catch (e) {\r\n      console.debug('Warm-up signal failed (harmless):', e);\r\n    }\r\n  };\r\n  warmUpServers();\r\n}\r\n\r\n// [Agent Admin Mode] Enable ONLY in development via URL parameter (?agent_admin=true) or localStorage\r\nif (import.meta.env.DEV && typeof window !== 'undefined' && (window.location.search.includes('agent_admin=true') || localStorage.getItem('agent_admin_mode') === 'true')) {\r\n  window.__AGENT_ADMIN_MODE__ = true;\r\n  console.log(' Agent Admin Mode Enabled: Confirmation dialogs will be auto-processed.');\r\n\r\n  // Global mocks for common dialogs\r\n  window.confirm = (msg) => {\r\n    console.log('[Agent Mode] Auto-confirming:', msg);\r\n    return true;\r\n  };\r\n\r\n  window.prompt = (msg, defaultVal) => {\r\n    console.log('[Agent Mode] Auto-prompting:', msg);\r\n    if (msg.includes('')) return '';\r\n    if (msg.includes('')) return '';\r\n    return defaultVal || '';\r\n  };\r\n\r\n  window.alert = (msg) => {\r\n    console.log('[Agent Mode] Auto-alerting (Suppressed):', msg);\r\n  };\r\n}\r\n\r\ntry {\r\n  const root = ReactDOM.createRoot(document.getElementById('root'));\r\n\r\n  root.render(\r\n    <StrictMode>\r\n      <ErrorBoundary>\r\n        <LanguageProvider>\r\n          <App />\r\n        </LanguageProvider>\r\n      </ErrorBoundary>\r\n    </StrictMode>,\r\n  );\r\n\r\n\r\n  // [SAFETY] Global Async Error Handler - Enhanced with auto-recovery for kiosk\r\n  window.addEventListener('unhandledrejection', (event) => {\r\n    console.warn('[Global Safety] Unhandled Promise Rejection:', event.reason);\r\n    \r\n    // [ALWAYS-ON] (/)      \r\n    const isKiosk = window.location.pathname === '/';\r\n    const errorMsg = String(event.reason?.message || event.reason || '');\r\n    const isFatal = errorMsg.includes('ChunkLoadError') || \r\n                    errorMsg.includes('Failed to fetch') ||\r\n                    errorMsg.includes('Loading chunk') ||\r\n                    errorMsg.includes('dynamically imported module');\r\n    \r\n    if (isKiosk && isFatal) {\r\n      const reloadCount = parseInt(sessionStorage.getItem('auto_reload_count') || '0');\r\n      if (reloadCount < 3) {\r\n        sessionStorage.setItem('auto_reload_count', String(reloadCount + 1));\r\n        console.error('[AlwaysOn] Fatal error on kiosk, auto-reloading in 5s... (attempt ' + (reloadCount + 1) + '/3)');\r\n        setTimeout(() => window.location.reload(), 5000);\r\n      } else {\r\n        console.error('[AlwaysOn] Max reload attempts reached. Stopping auto-recovery.');\r\n      }\r\n    }\r\n  });\r\n\r\n  // [ALWAYS-ON] Global Sync Error Handler\r\n  window.onerror = (message, source, lineno, colno, error) => {\r\n    console.error('[Global Safety] Uncaught Error:', message, source, lineno);\r\n    \r\n    const isKiosk = window.location.pathname === '/';\r\n    if (isKiosk) {\r\n      const reloadCount = parseInt(sessionStorage.getItem('auto_reload_count') || '0');\r\n      if (reloadCount < 3) {\r\n        sessionStorage.setItem('auto_reload_count', String(reloadCount + 1));\r\n        console.error('[AlwaysOn] Fatal sync error on kiosk, auto-reloading in 5s...');\r\n        setTimeout(() => window.location.reload(), 5000);\r\n      }\r\n    }\r\n    return false; // Don't suppress default error reporting\r\n  };\r\n\r\n  // [ALWAYS-ON] Reset reload counter after successful boot (30s stability window)\r\n  setTimeout(() => {\r\n    sessionStorage.removeItem('auto_reload_count');\r\n  }, 30000);\r\n\r\n  /* \r\n   * [PWA CONFLICT REMOVED] \r\n   * Manual SW registration removed because it conflicts with vite-plugin-pwa (ReloadPrompt.jsx).\r\n   * The plugin handles registration and updates properly.\r\n   */\r\n} catch (fatalError) {\r\n  console.error(\" Fatal Application Error:\", fatalError);\r\n  document.getElementById('root').innerHTML = `\r\n    <div style=\"padding: 20px; color: red; background: #1a1a1a; height: 100vh;\">\r\n      <h1>Critical Error</h1>\r\n      <p>   .</p>\r\n      <pre>${fatalError.toString()}</pre>\r\n    </div>\r\n  `;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\pages\\AdminDashboard.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'getBranchName' is defined but never used.","line":4,"column":25,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":38,"suggestions":[{"messageId":"removeVar","data":{"varName":"getBranchName"},"fix":{"range":[201,216],"text":""},"desc":"Remove unused variable 'getBranchName'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'Warning' is defined but never used.","line":10,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":12,"suggestions":[{"messageId":"removeVar","data":{"varName":"Warning"},"fix":{"range":[452,466],"text":""},"desc":"Remove unused variable 'Warning'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'db' is defined but never used.","line":15,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":12,"suggestions":[{"messageId":"removeVar","data":{"varName":"db"},"fix":{"range":[705,738],"text":""},"desc":"Remove unused variable 'db'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useMemo } from 'react';\r\nimport { storageService } from '../services/storage';\r\nimport { useAdminData } from '../hooks/useAdminData'; // [Refactor]\r\nimport { STUDIO_CONFIG, getBranchName, getBranchThemeColor, getBranchColor } from '../studioConfig';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport {\r\n    Users, ClockCounterClockwise, PlusCircle,\r\n    Calendar, Megaphone, BellRinging,\r\n    Tag, SignOut, ChartBar,\r\n    Warning, Database\r\n} from '@phosphor-icons/react';\r\nimport AdminScheduleManager from '../components/AdminScheduleManager';\r\nimport AdminRevenue from '../components/AdminRevenue';\r\nimport AdminPriceManager from '../components/AdminPriceManager';\r\nimport { db } from '../firebase';\r\nimport AdminMemberDetailModal from '../components/AdminMemberDetailModal';\r\nimport InstallGuideModal from '../components/admin/modals/InstallGuideModal';\r\nimport NoticeModal from '../components/admin/modals/NoticeModal';\r\nimport MessageModal from '../components/admin/modals/MessageModal';\r\nimport BulkMessageModal from '../components/admin/modals/BulkMessageModal';\r\nimport MemberNoteModal from '../components/admin/modals/MemberNoteModal';\r\nimport ExtensionModal from '../components/admin/modals/ExtensionModal';\r\nimport MemberAddModal from '../components/admin/modals/MemberAddModal';\r\nimport { TimeTableModal, PriceTableModal } from '../components/admin/modals/ImageModals';\r\nimport timeTable1 from '../assets/timetable_gwangheungchang.png';\r\nimport timeTable2 from '../assets/timetable_mapo.png';\r\nimport priceTable1 from '../assets/price_table_1.png';\r\nimport priceTable2 from '../assets/price_table_2.png';\r\n\r\nimport logo from '../assets/logo.png';\r\nimport MembersTab from '../components/admin/tabs/MembersTab';\r\nimport StatsTab from '../components/admin/tabs/StatsTab';\r\nimport NoticesTab from '../components/admin/tabs/NoticesTab';\r\nimport LogsTab from '../components/admin/tabs/LogsTab';\r\n\r\nimport PushHistoryTab from '../components/admin/tabs/PushHistoryTab';\r\nimport DataMigrationTab from '../components/admin/tabs/DataMigrationTab';\r\nimport { usePWA } from '../hooks/usePWA';\r\n\r\n\r\n\r\n// [Helper] Robust Date Parsing (Unused locally now, but maybe useful? Linter says delete)\r\n// const parseDate = (dateStr) => { ... }\r\n\r\n// [Refactor] Logic moved to useAdminData or provided by simple functions if local only\r\n// Removing local definitions of isMemberActive and isMemberExpiring as they are imported from useAdminData\r\n\r\nconst isMemberDormant = (m, logs, isMemberActiveFn) => {\r\n    // 1. Check if member is deleted/inactive? (Optional, but \"Dormant\" usually implies they are still valid members who just stopped coming)\r\n    // Let's include all members who have credits but stopped coming.\r\n    // If credits == 0, they are Expired, not just Dormant. But they can be both.\r\n    // Let's focus on \"Active but not attending\".\r\n\r\n    /* \r\n       Definition:\r\n       - Has credits > 0 (Active)\r\n       - No attendance for 14 days\r\n    */\r\n    const active = isMemberActiveFn ? isMemberActiveFn(m) : (Number(m.credits || 0) > 0);\r\n    if (!active) return false;\r\n\r\n    const today = new Date();\r\n    const twoWeeksAgo = new Date();\r\n    twoWeeksAgo.setDate(today.getDate() - 14);\r\n\r\n    let lastAttDate = null;\r\n\r\n    if (m.lastAttendance) {\r\n        lastAttDate = new Date(m.lastAttendance);\r\n    } else if (m.attendanceCount > 0) {\r\n        // Fallback: If no lastAttendance field but has count, try to find in loaded logs\r\n        // Note: 'logs' passed here might be limited. \r\n        // If not found in recent logs, assume it was long ago -> Dormant.\r\n        const lastLog = logs.find(l => l.memberId === m.id);\r\n        if (lastLog) {\r\n            lastAttDate = new Date(lastLog.timestamp || lastLog.date);\r\n        } else {\r\n            // Not in recent logs -> Likely Dormant\r\n            return true;\r\n        }\r\n    } else {\r\n        // Attendance Count 0\r\n        // Check Reg Date\r\n        if (m.regDate) {\r\n            const regDate = new Date(m.regDate);\r\n            return regDate < twoWeeksAgo;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    return lastAttDate && lastAttDate < twoWeeksAgo;\r\n};\r\n\r\nconst AdminDashboard = () => {\r\n\r\n    const [activeTab, setActiveTab] = useState('members');\r\n    // [Refactor] Use Custom Hook for Data & Logic\r\n    const {\r\n        currentBranch, setCurrentBranch,\r\n        members, sales, logs, notices, stats,\r\n        // aiInsight, loadingInsight,  // Unused\r\n        images, optimisticImages, setOptimisticImages,\r\n        todayClasses, pushTokens, aiUsage,\r\n        pendingApprovals, summary,\r\n        handleApprovePush, handleRejectPush,\r\n        refreshData, isMemberActive, isMemberExpiring,\r\n        // New exports\r\n        revenueTrend, memberStatusDist, getDormantSegments,\r\n        todayReRegMemberIds // [New]\r\n    } = useAdminData(activeTab, 'all');\r\n\r\n    // Modals\r\n    const [showAddModal, setShowAddModal] = useState(false);\r\n    const [showPriceModal, setShowPriceModal] = useState(false);\r\n    const [showTimeModal, setShowTimeModal] = useState(false);\r\n    const [showMessageModal, setShowMessageModal] = useState(false);\r\n    const [showNoticeModal, setShowNoticeModal] = useState(false);\r\n    const [showBulkMessageModal, setShowBulkMessageModal] = useState(false);\r\n    const [showExtendModal, setShowExtendModal] = useState(false);\r\n    const [showNoteModal, setShowNoteModal] = useState(false);\r\n    const [showEditModal, setShowEditModal] = useState(false);\r\n    const [bulkMessageInitialText, setBulkMessageInitialText] = useState('');\r\n    const [showInstallGuide, setShowInstallGuide] = useState(false); // [PWA] Install Guide State\r\n    const { installApp } = usePWA();\r\n\r\n    // [PWA] Auto-show install guide for non-standalone users\r\n    useEffect(() => {\r\n        const isStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;\r\n        const hasSeenGuide = localStorage.getItem('has_seen_install_guide');\r\n        \r\n        if (!isStandalone && !hasSeenGuide) {\r\n            // Show guide after a short delay so it doesn't block initial render\r\n            const timer = setTimeout(() => {\r\n                setShowInstallGuide(true);\r\n                localStorage.setItem('has_seen_install_guide', 'true');\r\n            }, 3000);\r\n            return () => clearTimeout(timer);\r\n        }\r\n    }, []);\r\n\r\n    // Dynamic Pricing State\r\n    const [pricingConfig, setPricingConfig] = useState(STUDIO_CONFIG.PRICING); // Default fallback\r\n\r\n    useEffect(() => {\r\n        const loadPricing = async () => {\r\n            if (activeTab === 'pricing') {\r\n                const data = await storageService.getPricing();\r\n                if (data) setPricingConfig(data);\r\n            }\r\n        };\r\n        loadPricing();\r\n    }, [activeTab]);\r\n\r\n    // Editing State\r\n    const [selectedMember, setSelectedMember] = useState(null);\r\n    // const [subTab, setSubTab] = useState('notices'); // notices | history\r\n    // const [isSubmitting, setIsSubmitting] = useState(false);  // Unused\r\n\r\n\r\n    const [scheduleSubTab, setScheduleSubTab] = useState('monthly');\r\n    // const [showScheduleSettings, setShowScheduleSettings] = useState(false);\r\n\r\n\r\n\r\n\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n    const [currentPage, setCurrentPage] = useState(1);\r\n    const itemsPerPage = 8;\r\n\r\n    // Filter Type\r\n    const [filterType, setFilterType] = useState('all');\r\n    const [selectedMemberIds, setSelectedMemberIds] = useState([]);\r\n    const [pushEnabled, setPushEnabled] = useState(() => {\r\n        const saved = localStorage.getItem('admin_push_enabled');\r\n        return saved === 'true' && Notification.permission === 'granted';\r\n    });\r\n    const [currentLogPage, setCurrentLogPage] = useState(1);\r\n\r\n    // Auth Logout\r\n    const navigate = useNavigate();\r\n    const handleLogout = async () => {\r\n        const isAgentMode = window.__AGENT_ADMIN_MODE__ === true;\r\n        if (isAgentMode || confirm('  ?')) {\r\n            await storageService.logoutAdmin();\r\n            navigate('/login');\r\n        }\r\n    };\r\n\r\n    // [OPTIMIZATION] Pre-calculate today's attendees O(M)\r\n    // const todayAttendedMemberIds = useMemo(...) // Unused now\r\n\r\n    //      \r\n    const filteredMembers = useMemo(() => {\r\n        const todayStr = new Date().toLocaleDateString('sv-SE', { timeZone: 'Asia/Seoul' });\r\n        // const todayObj = new Date(todayStr);  // Unused\r\n\r\n        // Helper logic duplicated from refreshData for consistency\r\n        // [FIX] Use shared logic to ensure consistency with stats\r\n        const checkIsActive = (m) => isMemberActive(m);\r\n        const checkIsExpiring = (m) => isMemberExpiring(m);\r\n\r\n        if (filterType === 'attendance') {\r\n            const attendanceList = [];\r\n\r\n            // Show ALL logs for today (allow multiple attendances per member)\r\n            logs.forEach(l => {\r\n                if (!l.timestamp) return;\r\n                const logDate = new Date(l.timestamp).toLocaleDateString('sv-SE', { timeZone: 'Asia/Seoul' });\r\n\r\n                if (logDate === todayStr && (currentBranch === 'all' || l.branchId === currentBranch)) {\r\n                    const member = members.find(m => m.id === l.memberId);\r\n                    // Even if member is deleted, show the log if possible (or skip)\r\n                    if (member) {\r\n                        attendanceList.push({\r\n                            ...member,\r\n                            logId: l.id, // Use log ID for unique key if possible\r\n                            // Override member data with specific log data\r\n                            attendanceTime: new Date(l.timestamp).toLocaleTimeString('ko-KR', { timeZone: 'Asia/Seoul', hour: '2-digit', minute: '2-digit', hour12: false }),\r\n                            attendanceClass: l.className,\r\n                            instructorName: l.instructor, // Add instructor info\r\n                            attendanceStatus: l.status, // Pass status\r\n                            denialReason: l.denialReason, // Pass reason\r\n                            originalLog: l,\r\n                            credits: l.credits !== undefined ? l.credits : member.credits // [FIX] Use historical credits snapshot\r\n                        });\r\n                    }\r\n                }\r\n            });\r\n\r\n            // Sort by attendance time desc\r\n            return attendanceList.sort((a, b) => b.attendanceTime.localeCompare(a.attendanceTime));\r\n        }\r\n\r\n        return members.filter(m => {\r\n            if (currentBranch !== 'all' && m.homeBranch !== currentBranch) return false;\r\n\r\n            const matchesSearch = (m.name || '').toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n                (m.phone || '').includes(searchTerm);\r\n            if (!matchesSearch) return false;\r\n\r\n            if (filterType === 'active') return checkIsActive(m);\r\n            // [FIX] Registration Filter: New OR Re-Reg\r\n            if (filterType === 'registration') return m.regDate === todayStr || todayReRegMemberIds.includes(m.id);\r\n            // if (filterType === 'attendance') handled above\r\n            if (filterType === 'expiring') return checkIsExpiring(m);\r\n            if (filterType === 'dormant') return isMemberDormant(m, logs, isMemberActive);\r\n            // [New] Installed Filter\r\n            if (filterType === 'installed') return !!m.installedAt;\r\n\r\n            return true; // 'all'\r\n        }).sort((a, b) => {\r\n            if (filterType === 'installed') {\r\n                // Sort by installedAt desc\r\n                if (!a.installedAt) return 1;\r\n                if (!b.installedAt) return -1;\r\n                return new Date(b.installedAt) - new Date(a.installedAt);\r\n            }\r\n            return a.name.localeCompare(b.name, 'ko');\r\n        });\r\n    }, [members, logs, searchTerm, filterType, currentBranch, isMemberActive, isMemberExpiring, todayReRegMemberIds]);\r\n\r\n    const dormantCount = useMemo(() => {\r\n        return members.filter(m => {\r\n            if (currentBranch !== 'all' && m.homeBranch !== currentBranch) return false;\r\n            return isMemberDormant(m, logs, isMemberActive);\r\n        }).length;\r\n    }, [members, logs, currentBranch, isMemberActive]);\r\n\r\n    const extendedSummary = { ...summary, dormantMembersCount: dormantCount };\r\n\r\n    const handleInstallClick = async () => {\r\n        const result = await installApp();\r\n        if (!result) {\r\n            setShowInstallGuide(true);\r\n        }\r\n    };\r\n\r\n    const handleForceUpdate = async () => {\r\n        if (!window.confirm(` (v${STUDIO_CONFIG.APP_VERSION})    ?\\n(   )`)) return;\r\n\r\n        console.log('[App] Forcing update and clearing ALL caches...');\r\n        \r\n        // [CRITICAL] 1. Delete ALL Firestore/Firebase IndexedDB databases\r\n        try {\r\n            const dbs = await indexedDB.databases();\r\n            const targetDbs = dbs.filter(db => \r\n                db.name && (db.name.includes('firestore') || db.name.includes('firebase'))\r\n            );\r\n            for (const dbInfo of targetDbs) {\r\n                console.log(`[App] Deleting IndexedDB: ${dbInfo.name}`);\r\n                indexedDB.deleteDatabase(dbInfo.name);\r\n            }\r\n            console.log(`[App] Cleared ${targetDbs.length} IndexedDB database(s).`);\r\n        } catch (err) {\r\n            console.warn('[App] Failed to clear IndexedDB:', err);\r\n        }\r\n\r\n        // 2. Clear ALL Cache Storage (Service Worker caches)\r\n        try {\r\n            const cacheNames = await caches.keys();\r\n            for (const name of cacheNames) {\r\n                await caches.delete(name);\r\n                console.log(`[App] Deleted cache: ${name}`);\r\n            }\r\n            console.log(`[App] Cleared ${cacheNames.length} cache(s).`);\r\n        } catch (err) {\r\n            console.warn('[App] Failed to clear Cache Storage:', err);\r\n        }\r\n\r\n        // 3. Unregister ALL Service Workers\r\n        if ('serviceWorker' in navigator) {\r\n            const registrations = await navigator.serviceWorker.getRegistrations();\r\n            for (const registration of registrations) {\r\n                await registration.unregister();\r\n                console.log('[App] SW Unregistered:', registration);\r\n            }\r\n        }\r\n        \r\n        // Force reload ignoring cache\r\n        window.location.reload(true);\r\n    };\r\n\r\n    const handleBranchChange = (e) => {\r\n        const branch = e.target.value;\r\n        setCurrentBranch(branch);\r\n        storageService.setBranch(branch);\r\n    };\r\n\r\n\r\n\r\n\r\n\r\n\r\n    const handleImageUpload = (e, target) => {\r\n        const file = e.target.files[0];\r\n        if (!file) return;\r\n\r\n        // Optional: Check file size before processing\r\n        if (file.size > 5 * 1024 * 1024) {\r\n            alert('   . ( 5MB)');\r\n            return;\r\n        }\r\n\r\n        const reader = new FileReader();\r\n        reader.onload = (event) => {\r\n            const img = new Image();\r\n            img.onload = async () => {\r\n                // Setup canvas for compression\r\n                const canvas = document.createElement('canvas');\r\n                const MAX_WIDTH = 900; // Reduced from 1200\r\n                let width = img.width;\r\n                let height = img.height;\r\n\r\n                if (width > MAX_WIDTH) {\r\n                    height *= MAX_WIDTH / width;\r\n                    width = MAX_WIDTH;\r\n                }\r\n\r\n                canvas.width = width;\r\n                canvas.height = height;\r\n                const ctx = canvas.getContext('2d');\r\n                ctx.drawImage(img, 0, 0, width, height);\r\n\r\n                // Compress to JPEG with 0.8 quality (High quality for text readability)\r\n                const compressedBase64 = canvas.toDataURL('image/jpeg', 0.8);\r\n\r\n                if (target === 'notice') {\r\n                    // Managed by hook\r\n                    // setNewNotice({ ...newNotice, image: compressedBase64 });\r\n                    console.warn('Notice image upload not implemented');\r\n                } else {\r\n                    try {\r\n                        console.log(`[Admin] Uploading image for ${target}...`);\r\n                        // [FIX] Set optimistic state IMMEDIATELY and persist it in this component\r\n                        setOptimisticImages(prev => ({ ...prev, [target]: compressedBase64 }));\r\n\r\n                        await storageService.updateImage(target, compressedBase64);\r\n                        console.log(`[Admin] Upload success for ${target}`);\r\n                        // Removed setImages call as it is handled by subscription in hook\r\n                    } catch (err) {\r\n                        console.error(`[Admin] Upload failed for ${target}:`, err);\r\n                        alert(\"  . (5MB  )\");\r\n                    }\r\n                }\r\n            };\r\n            img.src = event.target.result;\r\n        };\r\n        reader.readAsDataURL(file);\r\n    };\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n    const handleOpenEdit = (member) => {\r\n        setSelectedMember(member);\r\n        setShowEditModal(true);\r\n    };\r\n\r\n    const handleAddSalesRecord = async (salesData) => {\r\n        try {\r\n            await storageService.addSalesRecord(salesData);\r\n            // Refresh sales data\r\n            // const updatedSales = await storageService.getSales();\r\n            // Managed by hook\r\n            // setSales(updatedSales);\r\n            await refreshData();  // Use refreshData instead\r\n            return true;\r\n        } catch (error) {\r\n            console.error('Error adding sales record:', error);\r\n            alert('     .');\r\n            return false;\r\n        }\r\n    };\r\n\r\n    // Wrapper for AdminMemberDetailModal - expects (memberId, dataToUpdate)\r\n    const handleMemberModalUpdate = async (memberId, dataToUpdate) => {\r\n        try {\r\n            await storageService.updateMember(memberId, dataToUpdate);\r\n            refreshData();\r\n            return true;\r\n        } catch (error) {\r\n            console.error('Error updating member:', error);\r\n            return false;\r\n        }\r\n    };\r\n\r\n\r\n\r\n    const handleSubscribePush = async () => {\r\n        if (pushEnabled) {\r\n            setPushEnabled(false);\r\n            localStorage.setItem('admin_push_enabled', 'false');\r\n            alert('     . (  )');\r\n            return;\r\n        }\r\n\r\n        const result = await storageService.requestPushPermission();\r\n        if (result === 'granted') {\r\n            setPushEnabled(true);\r\n            localStorage.setItem('admin_push_enabled', 'true');\r\n            alert('     .');\r\n        } else if (result === 'denied') {\r\n            setPushEnabled(false);\r\n            localStorage.setItem('admin_push_enabled', 'false');\r\n            alert('   .    .');\r\n        } else {\r\n            alert('    .');\r\n        }\r\n    };\r\n\r\n    const selectFilteredMembers = (filteredList) => {\r\n        const allFilteredIds = filteredList.map(m => m.id);\r\n        const allSelected = allFilteredIds.every(id => selectedMemberIds.includes(id));\r\n\r\n        if (allSelected) {\r\n            setSelectedMemberIds(prev => prev.filter(id => !allFilteredIds.includes(id)));\r\n        } else {\r\n            setSelectedMemberIds(prev => [...new Set([...prev, ...allFilteredIds])]);\r\n        }\r\n    };\r\n\r\n    const toggleMemberSelection = (id) => {\r\n        setSelectedMemberIds(prev =>\r\n            prev.includes(id) ? prev.filter(i => i !== id) : [...prev, id]\r\n        );\r\n    };\r\n\r\n\r\n\r\n    const handleToggleFilter = (type) => {\r\n        setFilterType(prev => prev === type ? 'all' : type);\r\n        setCurrentPage(1);\r\n    };\r\n\r\n    const selectExpiringMembers = () => {\r\n        handleToggleFilter('expiring');\r\n    };\r\n\r\n    // --- RENDER ---\r\n    return (\r\n        <div className=\"admin-container\">\r\n            {/* Header - Extremely compact for S25 mobile use */}\r\n            <header className=\"admin-header\" style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '12px', flexWrap: 'nowrap', gap: '8px' }}>\r\n                <div className=\"admin-title\" style={{ gap: '6px', fontSize: '0.9rem' }}>\r\n                    <img src={logo} alt=\"\" style={{ height: '20px', filter: 'invert(1) brightness(1.5) drop-shadow(0 0 8px rgba(212,175,55,0.4))' }} />\r\n                    <span style={{ whiteSpace: 'nowrap', fontWeight: '800' }}></span>\r\n                    \r\n                    {/* [NEW] Manual Update Button for PWA Cache Busting */}\r\n                    <button \r\n                        onClick={handleForceUpdate} \r\n                        style={{ \r\n                            marginLeft: '8px', \r\n                            background: 'rgba(255, 255, 255, 0.1)', \r\n                            border: '1px solid rgba(255, 255, 255, 0.2)', \r\n                            color: '#aaa', \r\n                            cursor: 'pointer', \r\n                            padding: '2px 6px', \r\n                            borderRadius: '4px', \r\n                            fontSize: '0.65rem',\r\n                            display: 'flex',\r\n                            alignItems: 'center',\r\n                            gap: '3px'\r\n                        }} \r\n                        title=\"   \"\r\n                    >\r\n                        <ClockCounterClockwise size={12} />\r\n                        v{STUDIO_CONFIG.APP_VERSION}\r\n                    </button>\r\n\r\n                    <button onClick={handleInstallClick} style={{ marginLeft: '6px', background: 'rgba(212,175,55,0.1)', border: '1px solid rgba(212,175,55,0.3)', color: 'var(--primary-gold)', cursor: 'pointer', padding: '4px', borderRadius: '6px', display: 'flex', alignItems: 'center', gap: '4px', fontSize: '0.7rem' }} title=\"  \">\r\n                        <PlusCircle size={18} weight=\"bold\" />\r\n                        <span className=\"hide-mobile\"></span>\r\n                    </button>\r\n                    <button onClick={handleLogout} style={{ marginLeft: '4px', background: 'none', border: 'none', color: 'var(--text-tertiary)', cursor: 'pointer', padding: '4px' }} title=\"\">\r\n                        <SignOut size={18} />\r\n                    </button>\r\n                </div>\r\n                <div style={{ display: 'flex', gap: '6px', alignItems: 'center', flexShrink: 0 }}>\r\n                    {/* [RESTORED] AI Status Indicator */}\r\n                    <div style={{\r\n                        padding: '6px 10px',\r\n                        borderRadius: '6px',\r\n                        background: 'rgba(212, 175, 55, 0.1)',\r\n                        border: '1px solid rgba(212, 175, 55, 0.3)',\r\n                        color: 'var(--primary-gold)',\r\n                        fontSize: '0.7rem',\r\n                        fontWeight: 'bold',\r\n                        display: 'flex',\r\n                        alignItems: 'center',\r\n                        gap: '4px'\r\n                    }}>\r\n                        <span> AI </span>\r\n                        <span style={{ width: '6px', height: '6px', borderRadius: '50%', background: '#4CD964', boxShadow: '0 0 5px #4CD964' }}></span>\r\n                        <span style={{ fontSize: '0.65rem', opacity: 0.8, marginLeft: '4px', paddingLeft: '4px', borderLeft: '1px solid rgba(212,175,55,0.3)' }}>\r\n                            {aiUsage.count}/{aiUsage.limit}\r\n                        </span>\r\n                    </div>\r\n\r\n                    <button\r\n                        onClick={handleSubscribePush}\r\n                        className={`action-btn sm ${pushEnabled ? 'primary' : ''}`}\r\n                        style={{\r\n                            padding: '6px 8px',\r\n                            minWidth: '60px',\r\n                            background: pushEnabled ? 'var(--primary-gold)' : 'rgba(255,255,255,0.05)',\r\n                            color: pushEnabled ? 'black' : 'var(--text-secondary)',\r\n                            fontWeight: 'bold',\r\n                            fontSize: '0.7rem',\r\n                            border: 'none',\r\n                            borderRadius: '6px'\r\n                        }}\r\n                    >\r\n                        {pushEnabled ? 'ON' : 'OFF'}\r\n                    </button>\r\n                    {/*  : ,    */}\r\n                    {(activeTab === 'members' || activeTab === 'revenue') && (\r\n                        <select\r\n                            className=\"styled-select\"\r\n                            value={currentBranch}\r\n                            onChange={handleBranchChange}\r\n                            style={{ padding: '6px 8px', fontSize: '0.75rem', borderRadius: '6px', width: 'auto', minWidth: '70px', height: '32px' }}\r\n                        >\r\n                            <option value=\"all\"></option>\r\n                            {STUDIO_CONFIG.BRANCHES.map(b => (\r\n                                <option key={b.id} value={b.id}>{b.name.replace('', '')}</option>\r\n                            ))}\r\n                        </select>\r\n                    )}\r\n                </div>\r\n            </header>\r\n\r\n\r\n\r\n\r\n            {/* Tab Navigation - Becomes Bottom Nav on Mobile */}\r\n            <nav className=\"admin-nav-tabs\">\r\n                <button onClick={() => setActiveTab('members')} className={`nav-tab-item ${activeTab === 'members' ? 'active' : ''}`}>\r\n                    <Users size={22} weight={activeTab === 'members' ? \"fill\" : \"regular\"} />\r\n                    <span></span>\r\n                </button>\r\n                <button onClick={() => setActiveTab('logs')} className={`nav-tab-item ${activeTab === 'logs' ? 'active' : ''}`}>\r\n                    <ClockCounterClockwise size={22} weight={activeTab === 'logs' ? \"fill\" : \"regular\"} />\r\n                    <span></span>\r\n                </button>\r\n                <button onClick={() => setActiveTab('schedule')} className={`nav-tab-item ${activeTab === 'schedule' ? 'active' : ''}`}>\r\n                    <Calendar size={22} weight={activeTab === 'schedule' ? \"fill\" : \"regular\"} />\r\n                    <span></span>\r\n                </button>\r\n                <button onClick={() => setActiveTab('pricing')} className={`nav-tab-item ${activeTab === 'pricing' ? 'active' : ''}`}>\r\n                    <Tag size={22} weight={activeTab === 'pricing' ? \"fill\" : \"regular\"} />\r\n                    <span></span>\r\n                </button>\r\n                <button onClick={() => setActiveTab('revenue')} className={`nav-tab-item ${activeTab === 'revenue' ? 'active' : ''}`}>\r\n                    <ChartBar size={22} weight={activeTab === 'revenue' ? \"fill\" : \"regular\"} />\r\n                    <span></span>\r\n                </button>\r\n                <button onClick={() => setActiveTab('notices')} className={`nav-tab-item ${activeTab === 'notices' ? 'active' : ''}`}>\r\n                    <Megaphone size={22} weight={activeTab === 'notices' ? \"fill\" : \"regular\"} />\r\n                    <span></span>\r\n                </button>\r\n                <button onClick={() => setActiveTab('push_history')} className={`nav-tab-item ${activeTab === 'push_history' ? 'active' : ''}`} style={{ position: 'relative' }}>\r\n                    <BellRinging size={22} weight={activeTab === 'push_history' ? \"fill\" : \"regular\"} />\r\n                    <span></span>\r\n                    {pendingApprovals.length > 0 && (\r\n                        <span style={{\r\n                            position: 'absolute',\r\n                            top: '5px',\r\n                            right: '5px',\r\n                            background: '#F43F5E',\r\n                            color: 'white',\r\n                            fontSize: '0.6rem',\r\n                            padding: '2px 5px',\r\n                            borderRadius: '10px',\r\n                            fontWeight: 'bold',\r\n                            border: '1.5px solid #121214',\r\n                            minWidth: '18px',\r\n                            textAlign: 'center'\r\n                        }}>\r\n                            {pendingApprovals.length}\r\n                        </span>\r\n                    )}\r\n                </button>\r\n\r\n                {STUDIO_CONFIG.FEATURES?.ENABLE_DATA_MIGRATION && (\r\n                    <button onClick={() => setActiveTab('data_migration')} className={`nav-tab-item ${activeTab === 'data_migration' ? 'active' : ''}`}>\r\n                        <Database size={22} weight={activeTab === 'data_migration' ? \"fill\" : \"regular\"} color=\"var(--primary-gold)\" />\r\n                        <span></span>\r\n                    </button>\r\n                )}\r\n            </nav>\r\n\r\n            {/* Main Content Area */}\r\n            <div style={{ flex: 1, padding: '20px', maxWidth: '1200px', margin: '0 auto', width: '100%', paddingBottom: '100px' }}>\r\n                {activeTab === 'push_history' && (\r\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '24px' }}>\r\n                        {/* AI Approval Pending Section */}\r\n                        {pendingApprovals.length > 0 && (\r\n                            <div className=\"dashboard-card\" style={{ border: '1px solid var(--primary-gold)', background: 'rgba(212, 175, 55, 0.05)' }}>\r\n                                <h3 className=\"card-label\" style={{ display: 'flex', alignItems: 'center', gap: '8px', color: 'var(--primary-gold)', marginBottom: '16px' }}>\r\n                                    <BellRinging size={20} weight=\"fill\" /> AI   ( )\r\n                                </h3>\r\n                                <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>\r\n                                    {pendingApprovals.map((item) => (\r\n                                        <div key={item.id} style={{\r\n                                            padding: '16px',\r\n                                            borderRadius: '12px',\r\n                                            background: 'rgba(255,255,255,0.03)',\r\n                                            border: '1px solid rgba(212,175,55,0.2)',\r\n                                            display: 'flex',\r\n                                            flexDirection: 'column',\r\n                                            gap: '10px'\r\n                                        }}>\r\n                                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' }}>\r\n                                                <div>\r\n                                                    <div style={{ fontSize: '0.9rem', fontWeight: 'bold', color: 'var(--text-primary)' }}>{item.memberName} </div>\r\n                                                    <div style={{ fontSize: '0.75rem', color: 'var(--primary-gold)', marginTop: '2px' }}>: {item.reason || '  '}</div>\r\n                                                </div>\r\n                                                <div style={{ display: 'flex', gap: '8px' }}>\r\n                                                    <button\r\n                                                        onClick={() => handleRejectPush(item.id)}\r\n                                                        className=\"action-btn sm\"\r\n                                                        style={{ width: 'auto', background: 'rgba(244, 63, 94, 0.1)', color: '#F43F5E', border: '1px solid rgba(244, 63, 94, 0.2)' }}\r\n                                                    ></button>\r\n                                                    <button\r\n                                                        onClick={() => handleApprovePush(item.id, item.title || ' ')}\r\n                                                        className=\"action-btn sm primary\"\r\n                                                        style={{ width: 'auto', boxShadow: '0 4px 12px var(--primary-gold-glow)' }}\r\n                                                    > </button>\r\n                                                </div>\r\n                                            </div>\r\n                                            <div style={{\r\n                                                padding: '12px',\r\n                                                background: 'rgba(0,0,0,0.2)',\r\n                                                borderRadius: '8px',\r\n                                                fontSize: '0.85rem',\r\n                                                color: 'var(--text-secondary)',\r\n                                                lineHeight: '1.5',\r\n                                                whiteSpace: 'pre-wrap',\r\n                                                borderLeft: '3px solid var(--primary-gold)'\r\n                                            }}>\r\n                                                {item.body || item.content}\r\n                                            </div>\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n                        <PushHistoryTab \r\n                            onSelectMember={handleOpenEdit} \r\n                            setActiveTab={setActiveTab} \r\n                            pendingApprovals={pendingApprovals}\r\n                            onApprove={handleApprovePush}\r\n                            onReject={handleRejectPush}\r\n                        />\r\n                    </div>\r\n                )}\r\n\r\n                {activeTab === 'revenue' && (\r\n                    <AdminRevenue members={members} sales={sales} currentBranch={currentBranch} />\r\n                )}\r\n\r\n                {activeTab === 'pricing' && (\r\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '30px' }}>\r\n                        <AdminPriceManager />\r\n                        <hr style={{ borderColor: 'rgba(255,255,255,0.05)', margin: '20px 0' }} />\r\n                        <div className=\"dashboard-card\">\r\n                            <h3 className=\"card-label\" style={{ marginBottom: '20px' }}>  ()</h3>\r\n                            <div style={{ display: 'flex', flexDirection: 'column', gap: '20px' }}>\r\n                                <div style={{ background: 'rgba(255,255,255,0.02)', padding: '20px', borderRadius: '16px', border: '1px solid var(--border-color)' }}>\r\n                                    <h3 style={{ fontSize: '1.5rem', fontWeight: '800', marginBottom: '15px' }}></h3>\r\n                                    <img src={images.price_table_1 || priceTable1} alt=\" 1\" style={{ width: '100%', borderRadius: '12px', marginBottom: '15px' }} />\r\n                                    <div style={{ display: 'flex', justifyContent: 'flex-end' }}>\r\n                                        <input type=\"file\" accept=\"image/*\" onChange={e => handleImageUpload(e, 'price_table_1')} style={{ display: 'none' }} id=\"up-price-1\" />\r\n                                        <label htmlFor=\"up-price-1\" className=\"action-btn sm\" style={{ background: 'rgba(255,255,255,0.05)', color: 'var(--text-secondary)', fontSize: '0.7rem', border: 'none', cursor: 'pointer' }}> </label>\r\n                                    </div>\r\n                                </div>\r\n                                <div style={{ background: 'rgba(255,255,255,0.02)', padding: '20px', borderRadius: '16px', border: '1px solid var(--border-color)' }}>\r\n                                    <h3 style={{ fontSize: '1.5rem', fontWeight: '800', marginBottom: '15px' }}></h3>\r\n                                    <img src={images.price_table_2 || priceTable2} alt=\" 2\" style={{ width: '100%', borderRadius: '12px', marginBottom: '15px' }} />\r\n                                    <div style={{ display: 'flex', justifyContent: 'flex-end' }}>\r\n                                        <input type=\"file\" accept=\"image/*\" onChange={e => handleImageUpload(e, 'price_table_2')} style={{ display: 'none' }} id=\"up-price-2\" />\r\n                                        <label htmlFor=\"up-price-2\" className=\"action-btn sm\" style={{ background: 'rgba(255,255,255,0.05)', color: 'var(--text-secondary)', fontSize: '0.7rem', border: 'none', cursor: 'pointer' }}> </label>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {activeTab === 'members' && (\r\n                    <MembersTab\r\n                        members={members}\r\n                        filteredMembers={filteredMembers}\r\n                        summary={extendedSummary}\r\n                        searchTerm={searchTerm}\r\n                        setSearchTerm={setSearchTerm}\r\n                        filterType={filterType}\r\n                        handleToggleFilter={handleToggleFilter}\r\n                        selectExpiringMembers={selectExpiringMembers}\r\n                        selectedMemberIds={selectedMemberIds}\r\n                        toggleMemberSelection={toggleMemberSelection}\r\n                        selectFilteredMembers={selectFilteredMembers}\r\n                        currentPage={currentPage}\r\n                        setCurrentPage={setCurrentPage}\r\n                        itemsPerPage={itemsPerPage}\r\n                        handleOpenEdit={handleOpenEdit}\r\n                        setShowAddModal={setShowAddModal}\r\n                        setShowBulkMessageModal={setShowBulkMessageModal}\r\n                        pushTokens={pushTokens}\r\n                        getDormantSegments={getDormantSegments}\r\n                        setBulkMessageInitialText={setBulkMessageInitialText}\r\n                        setActiveTab={setActiveTab}\r\n                    />\r\n                )}\r\n\r\n                {activeTab === 'schedule' && (\r\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '20px' }}>\r\n                        <div style={{ display: 'flex', gap: '10px', background: 'rgba(255,255,255,0.05)', padding: '5px', borderRadius: '12px' }}>\r\n                            <button\r\n                                onClick={() => setScheduleSubTab('monthly')}\r\n                                style={{ flex: 1, padding: '10px', borderRadius: '8px', border: 'none', background: scheduleSubTab === 'monthly' ? 'var(--primary-gold)' : 'transparent', color: scheduleSubTab === 'monthly' ? 'black' : 'white', fontWeight: 'bold', cursor: 'pointer' }}\r\n                            > </button>\r\n                            <button\r\n                                onClick={() => setScheduleSubTab('weekly')}\r\n                                style={{ flex: 1, padding: '10px', borderRadius: '8px', border: 'none', background: scheduleSubTab === 'weekly' ? 'var(--primary-gold)' : 'transparent', color: scheduleSubTab === 'weekly' ? 'black' : 'white', fontWeight: 'bold', cursor: 'pointer' }}\r\n                            > </button>\r\n                        </div>\r\n\r\n                        {scheduleSubTab === 'monthly' ? (\r\n                            <div style={{ display: 'flex', flexDirection: 'column', gap: '30px' }}>\r\n                                {STUDIO_CONFIG.BRANCHES.map((branch) => {\r\n                                    //      \r\n                                    const isGwang = branch.id === 'gwangheungchang';\r\n                                    const themeColor = getBranchThemeColor(branch.id);\r\n                                    const bgTint = `${getBranchColor(branch.id)}0D`; // 05 opacity hex\r\n\r\n                                    return (\r\n                                        <div key={branch.id} className=\"dashboard-card\" style={{ \r\n                                            position: 'relative',\r\n                                            border: `1px solid ${getBranchColor(branch.id)}4D`, // 0.3 opacity hex\r\n                                            background: `linear-gradient(180deg, ${bgTint} 0%, rgba(20, 20, 25, 0.5) 100%)`\r\n                                        }}>\r\n                                            <div style={{ \r\n                                                display: 'flex', \r\n                                                justifyContent: 'space-between', \r\n                                                alignItems: 'center', \r\n                                                marginBottom: '20px',\r\n                                                borderBottom: `1px solid ${getBranchColor(branch.id)}1A`, // 0.1 opacity hex\r\n                                                paddingBottom: '10px'\r\n                                            }}>\r\n                                                <h3 style={{ \r\n                                                    fontSize: '1.8rem', \r\n                                                    fontWeight: '800', \r\n                                                    color: themeColor,\r\n                                                    textShadow: `0 0 10px ${getBranchColor(branch.id)}4D`\r\n                                                }}>\r\n                                                    {branch.name}\r\n                                                </h3>\r\n                                                <div style={{\r\n                                                    padding: '4px 12px',\r\n                                                    borderRadius: '20px',\r\n                                                    background: `${getBranchColor(branch.id)}1A`,\r\n                                                    border: `1px solid ${getBranchColor(branch.id)}33`,\r\n                                                    color: themeColor,\r\n                                                    fontSize: '0.8rem',\r\n                                                    fontWeight: 'bold'\r\n                                                }}>\r\n                                                    {isGwang ? '' : ''}\r\n                                                </div>\r\n                                            </div>\r\n                                            <AdminScheduleManager branchId={branch.id} />\r\n                                        </div>\r\n                                    );\r\n                                })}\r\n                            </div>\r\n                        ) : (\r\n                            <div className=\"dashboard-card\">\r\n                                <h3 className=\"card-label\" style={{ marginBottom: '20px' }}>  ()</h3>\r\n                                <div style={{ display: 'flex', flexDirection: 'column', gap: '40px' }}>\r\n                                    {STUDIO_CONFIG.BRANCHES.map(branch => {\r\n                                        const now = new Date();\r\n                                        const curYear = now.getFullYear();\r\n                                        const curMonth = (now.getMonth() + 1).toString().padStart(2, '0');\r\n                                        const nextDate = new Date(now.getFullYear(), now.getMonth() + 1, 1);\r\n                                        const nextYear = nextDate.getFullYear();\r\n                                        const nextMonth = (nextDate.getMonth() + 1).toString().padStart(2, '0');\r\n                                        const curKey = `timetable_${branch.id}_${curYear}-${curMonth}`;\r\n                                        const nextKey = `timetable_${branch.id}_${nextYear}-${nextMonth}`;\r\n                                        const curImage = images[curKey] || images[`timetable_${branch.id}`] || (branch.id === 'gwangheungchang' ? timeTable1 : timeTable2);\r\n                                        const nextImage = images[nextKey];\r\n\r\n                                        return (\r\n                                            <div key={branch.id} style={{ background: 'rgba(255,255,255,0.02)', padding: '20px', borderRadius: '12px', border: '1px solid var(--border-color)' }}>\r\n                                                <h3 style={{ fontSize: '1.6rem', fontWeight: '800', marginBottom: '20px' }}>{branch.name}</h3>\r\n                                                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px' }}>\r\n                                                    <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\r\n                                                        <h4 style={{ margin: 0, color: 'var(--primary-gold)' }}>{curMonth} ()</h4>\r\n                                                        <div style={{ background: 'rgba(0,0,0,0.3)', borderRadius: '12px', overflow: 'hidden', minHeight: '200px', display: 'flex', alignItems: 'center', justifyContent: 'center', border: '1px dashed rgba(255,255,255,0.1)' }}>\r\n                                                            {(optimisticImages[curKey] || curImage) ? (\r\n                                                                <img src={optimisticImages[curKey] || curImage} alt=\"Current\" style={{ width: '100%' }} />\r\n                                                            ) : (\r\n                                                                <span style={{ color: 'var(--text-secondary)' }}> </span>\r\n                                                            )}\r\n                                                        </div>\r\n                                                        <div style={{ textAlign: 'right' }}>\r\n                                                            <input type=\"file\" accept=\"image/*\" onChange={e => handleImageUpload(e, curKey)} style={{ display: 'none' }} id={`up-cur-${branch.id}`} />\r\n                                                            <label htmlFor={`up-cur-${branch.id}`} className=\"action-btn sm\" style={{ padding: '6px 12px', fontSize: '0.8rem', cursor: 'pointer' }}> </label>\r\n                                                        </div>\r\n                                                    </div>\r\n                                                    <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\r\n                                                        <h4 style={{ margin: 0, color: '#a1a1aa' }}>{nextMonth} ()</h4>\r\n                                                        <div style={{ background: 'rgba(0,0,0,0.3)', borderRadius: '12px', overflow: 'hidden', minHeight: '200px', display: 'flex', alignItems: 'center', justifyContent: 'center', border: '1px dashed rgba(255,255,255,0.1)' }}>\r\n                                                            {(optimisticImages[nextKey] || nextImage) ? (\r\n                                                                <img src={optimisticImages[nextKey] || nextImage} alt=\"Next\" style={{ width: '100%' }} />\r\n                                                            ) : (\r\n                                                                <span style={{ color: 'var(--text-secondary)' }}> </span>\r\n                                                            )}\r\n                                                        </div>\r\n                                                        <div style={{ textAlign: 'right' }}>\r\n                                                            <input type=\"file\" accept=\"image/*\" onChange={e => handleImageUpload(e, nextKey)} style={{ display: 'none' }} id={`up-next-${branch.id}`} />\r\n                                                            <label htmlFor={`up-next-${branch.id}`} className=\"action-btn sm\" style={{ padding: '6px 12px', fontSize: '0.8rem', cursor: 'pointer' }}> /</label>\r\n                                                        </div>\r\n                                                    </div>\r\n                                                </div>\r\n                                            </div>\r\n                                        );\r\n                                    })}\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                )}\r\n\r\n                {activeTab === 'stats' && (\r\n                    <StatsTab stats={stats} revenueTrend={revenueTrend} memberStatusDist={memberStatusDist} />\r\n                )}\r\n\r\n                {activeTab === 'notices' && (\r\n                    <NoticesTab notices={notices} setShowNoticeModal={setShowNoticeModal} refreshData={refreshData} />\r\n                )}\r\n\r\n                {activeTab === 'logs' && (\r\n                    <LogsTab\r\n                        todayClasses={todayClasses}\r\n                        logs={logs}\r\n                        currentLogPage={currentLogPage}\r\n                        setCurrentLogPage={setCurrentLogPage}\r\n                        members={members}\r\n                        onMemberClick={handleOpenEdit}\r\n                        summary={summary}\r\n                    />\r\n                )}\r\n\r\n                {activeTab === 'data_migration' && STUDIO_CONFIG.FEATURES?.ENABLE_DATA_MIGRATION && (\r\n                    <DataMigrationTab />\r\n                )}\r\n            </div>\r\n\r\n\r\n            {/* --- MODALS --- */}\r\n            < MemberAddModal isOpen={showAddModal} onClose={() => setShowAddModal(false)} onSuccess={refreshData} />\r\n            <MemberNoteModal\r\n                isOpen={showNoteModal}\r\n                onClose={() => setShowNoteModal(false)}\r\n                key={selectedMember?.id || 'note-modal-empty'}\r\n                member={selectedMember && members.find(m => m.id === selectedMember.id) || selectedMember}\r\n                onSuccess={refreshData}\r\n            />\r\n            <NoticeModal isOpen={showNoticeModal} onClose={() => setShowNoticeModal(false)} onSuccess={refreshData} />\r\n            <BulkMessageModal\r\n                isOpen={showBulkMessageModal}\r\n                onClose={() => { setShowBulkMessageModal(false); setBulkMessageInitialText(''); }}\r\n                selectedMemberIds={selectedMemberIds}\r\n                memberCount={selectedMemberIds.length} // [FIX] Pass memberCount\r\n                initialMessage={bulkMessageInitialText}\r\n            />\r\n            <MessageModal isOpen={showMessageModal} onClose={() => setShowMessageModal(false)} member={selectedMember && members.find(m => m.id === selectedMember.id) || selectedMember} />\r\n            <ExtensionModal isOpen={showExtendModal} onClose={() => setShowExtendModal(false)} member={selectedMember && members.find(m => m.id === selectedMember.id) || selectedMember} onSuccess={refreshData} />\r\n\r\n            <TimeTableModal isOpen={showTimeModal} onClose={() => setShowTimeModal(false)} images={images} setOptimisticImages={setOptimisticImages} optimisticImages={optimisticImages} />\r\n            <PriceTableModal isOpen={showPriceModal} onClose={() => setShowPriceModal(false)} images={images} setOptimisticImages={setOptimisticImages} optimisticImages={optimisticImages} />\r\n            <InstallGuideModal isOpen={showInstallGuide} onClose={() => setShowInstallGuide(false)} />\r\n\r\n            {\r\n                showEditModal && selectedMember && (\r\n                    <AdminMemberDetailModal\r\n                        member={members.find(m => m.id === selectedMember.id) || selectedMember}\r\n                        memberLogs={logs.filter(log => log.memberId === selectedMember.id)}\r\n                        onClose={() => setShowEditModal(false)}\r\n                        pricingConfig={pricingConfig}\r\n                        onUpdateMember={handleMemberModalUpdate}\r\n                        onAddSalesRecord={handleAddSalesRecord}\r\n                        pushTokens={pushTokens}\r\n                    />\r\n                )\r\n            }\r\n        </div >\r\n    );\r\n};\r\n\r\nexport default AdminDashboard;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\pages\\CheckInPage.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'isOnline' is assigned a value but never used.","line":49,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":49,"endColumn":21,"suggestions":[{"messageId":"removeVar","data":{"varName":"isOnline"},"fix":{"range":[2542,2551],"text":""},"desc":"Remove unused variable 'isOnline'."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'confirmDuplicateCheckIn'. Either include it or remove the dependency array.","line":788,"column":8,"nodeType":"ArrayExpression","endLine":788,"endColumn":58,"suggestions":[{"desc":"Update the dependencies array to be: [duplicateTimer, showDuplicateConfirm, pendingPin, confirmDuplicateCheckIn]","fix":{"range":[32730,32780],"text":"[duplicateTimer, showDuplicateConfirm, pendingPin, confirmDuplicateCheckIn]"}}]},{"ruleId":"no-unused-vars","severity":1,"message":"'isActive' is assigned a value but never used.","line":1431,"column":41,"nodeType":"Identifier","messageId":"unusedVar","endLine":1431,"endColumn":49,"suggestions":[{"messageId":"removeVar","data":{"varName":"isActive"},"fix":{"range":[67606,67627],"text":""},"desc":"Remove unused variable 'isActive'."}]}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchWeatherAndAI'. Either include it or remove the dependency array.","line":255,"column":8,"nodeType":"ArrayExpression","endLine":255,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [fetchWeatherAndAI]","fix":{"range":[10449,10451],"text":"[fetchWeatherAndAI]"}}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'loadAIExperience' and 'weather'. Either include them or remove the dependency array.","line":263,"column":8,"nodeType":"ArrayExpression","endLine":263,"endColumn":33,"suggestions":[{"desc":"Update the dependencies array to be: [language, currentBranch, loadAIExperience, weather]","fix":{"range":[10833,10858],"text":"[language, currentBranch, loadAIExperience, weather]"}}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchWeatherAndAI'. Either include it or remove the dependency array.","line":308,"column":8,"nodeType":"ArrayExpression","endLine":308,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [fetchWeatherAndAI]","fix":{"range":[12735,12737],"text":"[fetchWeatherAndAI]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useRef } from 'react';\r\nimport Keypad from '../components/Keypad';\r\nimport { storageService } from '../services/storage';\r\nimport { auth } from '../firebase';\r\nimport { signInAnonymously } from 'firebase/auth';\r\nimport { getAllBranches, getBranchName } from '../studioConfig';\r\nimport logoWide from '../assets/logo_wide.png';\r\nimport rys200Logo from '../assets/RYS200.png';\r\nimport { getKSTHour, getDaysRemaining } from '../utils/dates';\r\nimport { logError } from '../services/modules/errorModule';\r\nimport { useNetworkMonitor } from '../hooks/useNetworkMonitor';\r\nimport { useTTS } from '../hooks/useTTS';\r\nimport { useNetwork } from '../context/NetworkContext';\r\nimport TopBar from '../components/checkin/TopBar';\r\n\r\n\r\n// [PERF]     (4  1, WebP )\r\nconst getBgForPeriod = (period) => {\r\n    switch (period) {\r\n        case 'morning': return import('../assets/bg_morning.webp');\r\n        case 'afternoon': return import('../assets/bg_afternoon.webp');\r\n        case 'evening': return import('../assets/bg_evening.webp');\r\n        default: return import('../assets/bg_night.webp');\r\n    }\r\n};\r\nimport InstallGuideModal from '../components/InstallGuideModal';\r\nimport InstructorQRModal from '../components/InstructorQRModal';\r\n\r\n\r\nconst CheckInPage = () => {\r\n    const [pin, setPin] = useState('');\r\n    const [message, setMessage] = useState(null);\r\n    const [loading, setLoading] = useState(false);\r\n    const [isReady, setIsReady] = useState(false); // [PERF] Cache ready state\r\n    const timerRef = useRef(null);\r\n    const [currentBranch, setCurrentBranch] = useState(() => storageService.getKioskBranch());\r\n    const [duplicateMembers, setDuplicateMembers] = useState([]);\r\n    const [showSelectionModal, setShowSelectionModal] = useState(false);\r\n    const [weather, setWeather] = useState(null);\r\n    const [isFullscreen, setIsFullscreen] = useState(false);\r\n    const [aiExperience, setAiExperience] = useState(null);\r\n    const [aiEnhancedMsg, setAiEnhancedMsg] = useState(null); // [AI]  AI   ( )\r\n    const [aiLoading, setAiLoading] = useState(false); // [AI] AI    \r\n    const [showKioskInstallGuide, setShowKioskInstallGuide] = useState(false);\r\n    const [showInstallGuide, setShowInstallGuide] = useState(false);\r\n    const [showInstructorQR, setShowInstructorQR] = useState(false);\r\n    const [deferredPrompt, setDeferredPrompt] = useState(null);\r\n    const [keypadLocked, setKeypadLocked] = useState(false); // [FIX] Prevent ghost touches\r\n    const { isOnline, checkConnection } = useNetworkMonitor();\r\n    const { setIsOnline } = useNetwork(); // [NETWORK] GLOBAL Connectivity state\r\n    const { speak } = useTTS();\r\n\r\n    // [DUPLICATE]   \r\n    const recentCheckInsRef = useRef([]); // [{pin, timestamp}, ...]\r\n    const [showDuplicateConfirm, setShowDuplicateConfirm] = useState(false);\r\n    const [pendingPin, setPendingPin] = useState(null);\r\n    const duplicateAutoCloseRef = useRef(null);\r\n    const [duplicateTimer, setDuplicateTimer] = useState(10); // [UX] 10s countdown for auto-confirm\r\n    // [FIX] State to track if we are in a forced duplicate check-in flow\r\n    const [isDuplicateFlow, setIsDuplicateFlow] = useState(false);\r\n    // [FIX] Always use Korean for Check-in Page as requested\r\n    // const { language } = useLanguage();\r\n    const language = 'ko';\r\n\r\n    // [UX] Loading Message Logic\r\n    const [loadingMessage, setLoadingMessage] = useState('  ...');\r\n    \r\n    useEffect(() => {\r\n        if (!loading) {\r\n            setLoadingMessage('  ...');\r\n            return;\r\n        }\r\n\r\n        const timer1 = setTimeout(() => {\r\n            setLoadingMessage(' ...');\r\n        }, 5000);\r\n\r\n        const timer2 = setTimeout(() => {\r\n            setLoadingMessage('  .\\n    ');\r\n        }, 12000);\r\n\r\n        return () => {\r\n            clearTimeout(timer1);\r\n            clearTimeout(timer2);\r\n        };\r\n    }, [loading]);\r\n\r\n\r\n\r\n    // ... (Use a slow timer for background period updates) ...\r\n\r\n    // ...\r\n\r\n\r\n\r\n    // Use a slow timer for background period updates (every 5 minutes)\r\n    const [period, setPeriod] = useState(() => {\r\n        const hour = getKSTHour();\r\n        if (hour >= 6 && hour < 12) return 'morning';\r\n        if (hour >= 12 && hour < 17) return 'afternoon';\r\n        if (hour >= 17 && hour < 21) return 'evening';\r\n        return 'night';\r\n    });\r\n\r\n\r\n\r\n    // [PERF]     \r\n    const [bgImage, setBgImage] = useState(null);\r\n    useEffect(() => {\r\n        getBgForPeriod(period).then(m => setBgImage(m.default));\r\n    }, [period]);\r\n\r\n    // [New] Auto-reset input after 20s of inactivity\r\n    useEffect(() => {\r\n        if (pin.length > 0) {\r\n            const timer = setTimeout(() => {\r\n                setPin('');\r\n                setMessage(null);\r\n            }, 20000);\r\n            return () => clearTimeout(timer);\r\n        }\r\n    }, [pin]);\r\n\r\n\r\n    const branches = getAllBranches();\r\n\r\n    useEffect(() => {\r\n        const handleBeforeInstallPrompt = (e) => {\r\n            e.preventDefault();\r\n            setDeferredPrompt(e);\r\n            window.deferredPrompt = e; // [FIX] Persist globally\r\n            console.log(\"Install prompt captured\");\r\n        };\r\n        window.addEventListener('beforeinstallprompt', handleBeforeInstallPrompt);\r\n\r\n        // Check if already captured before mount\r\n        if (window.deferredPrompt) {\r\n            setDeferredPrompt(window.deferredPrompt);\r\n        }\r\n\r\n        return () => window.removeEventListener('beforeinstallprompt', handleBeforeInstallPrompt);\r\n    }, []);\r\n\r\n    // [New] Auto-close Install Guide after 5 minutes\r\n    useEffect(() => {\r\n        let timer;\r\n        if (showInstallGuide || showKioskInstallGuide) {\r\n            timer = setTimeout(() => {\r\n                // Assuming handleModalClose is a function that sets state to close modals\r\n                // The instruction implies adding isOpen={true} to the *rendered* component,\r\n                // not within this useEffect's callback.\r\n                // This useEffect is for auto-closing, so we should call the close functions.\r\n                setShowInstallGuide(false);\r\n                setShowKioskInstallGuide(false);\r\n            }, 300000); // 5 minutes\r\n        }\r\n        return () => clearTimeout(timer);\r\n    }, [showInstallGuide, showKioskInstallGuide]);\r\n\r\n\r\n\r\n    // Correctly proceeding with logic...\r\n\r\n    const handleInstallClick = () => {\r\n        const promptEvent = deferredPrompt || window.deferredPrompt;\r\n        if (promptEvent) {\r\n            promptEvent.prompt();\r\n            promptEvent.userChoice.then((choiceResult) => {\r\n                if (choiceResult.outcome === 'accepted') {\r\n                    console.log('User accepted the install prompt');\r\n                }\r\n                setDeferredPrompt(null);\r\n                window.deferredPrompt = null;\r\n            });\r\n        } else {\r\n            setShowInstallGuide(true);\r\n        }\r\n    };\r\n\r\n    const fetchWeatherAndAI = async () => {\r\n        try {\r\n            const res = await fetch('https://api.open-meteo.com/v1/forecast?latitude=37.5665&longitude=126.9780&current_weather=true');\r\n            const data = await res.json();\r\n            const currentWeatherData = data.current_weather;\r\n            setWeather(currentWeatherData);\r\n            // AI standby loading will be handled by loadAIExperience which checks cache\r\n            loadAIExperience(\" \", null, null, currentWeatherData);\r\n        } catch (err) {\r\n            console.log('Weather fetch failed', err);\r\n            loadAIExperience();\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        // [KIOSK MODE] Initialize with cache warming for maximum speed\r\n        const initKiosk = async () => {\r\n            console.time('[CheckIn] Total Init');\r\n            \r\n            // [STABILITY] Get anonymous auth to ensure Firestore write permissions for logging\r\n            try {\r\n                await signInAnonymously(auth);\r\n                console.log('[CheckIn]  Anonymous auth successful');\r\n            } catch (authErr) {\r\n                console.warn('[CheckIn] Anonymous auth failed:', authErr.message);\r\n            }\r\n\r\n            await storageService.initialize({ mode: 'kiosk' });\r\n            setIsReady(true);\r\n            console.timeEnd('[CheckIn] Total Init');\r\n            console.log('[CheckIn]  Kiosk ready - keypad enabled');\r\n        };\r\n        initKiosk();\r\n\r\n        // Initial fetch (weather & AI - can run in parallel)\r\n        fetchWeatherAndAI();\r\n\r\n        // Background / Period Slow Timer\r\n        const periodTimer = setInterval(() => {\r\n            const hour = getKSTHour();\r\n            let newPeriod = 'night';\r\n            if (hour >= 6 && hour < 12) newPeriod = 'morning';\r\n            else if (hour >= 12 && hour < 17) newPeriod = 'afternoon';\r\n            else if (hour >= 17 && hour < 21) newPeriod = 'evening';\r\n            setPeriod(newPeriod);\r\n        }, 5 * 60 * 1000); // 5 minutes\r\n\r\n        // Auto-refresh Weather & AI Standby Message every 60 minutes (User requested 1-2h)\r\n        const refreshTimer = setInterval(() => {\r\n            console.log(\"Refreshing Weather & AI context (Hourly)...\");\r\n            fetchWeatherAndAI();\r\n        }, 60 * 60 * 1000);\r\n\r\n\r\n        //    (   / )\r\n        const handleFirstInteraction = () => {\r\n            if (!document.fullscreenElement) {\r\n                document.documentElement.requestFullscreen().catch(e => console.log(\"Fullscreen auto-entry blocked\", e));\r\n                setIsFullscreen(true);\r\n            }\r\n            window.removeEventListener('click', handleFirstInteraction);\r\n            window.removeEventListener('touchstart', handleFirstInteraction);\r\n        };\r\n\r\n        window.addEventListener('click', handleFirstInteraction);\r\n        window.addEventListener('touchstart', handleFirstInteraction);\r\n\r\n        return () => {\r\n            clearInterval(periodTimer);\r\n            clearInterval(refreshTimer);\r\n            if (duplicateAutoCloseRef.current) clearInterval(duplicateAutoCloseRef.current); //  Memory Leak Fix: Zombie Timer Destruction\r\n            window.removeEventListener('click', handleFirstInteraction);\r\n            window.removeEventListener('touchstart', handleFirstInteraction);\r\n        };\r\n        // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    }, []);\r\n\r\n    // Reload AI when significant state changes\r\n    useEffect(() => {\r\n        // [STABILITY] Don't clear aiExperience here (prevents flickering)\r\n        // loadAIExperience will handle the \"is loading\" state internally ONLY if no cache exists\r\n        loadAIExperience(\" \", null, null, weather);\r\n        // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    }, [language, currentBranch]);\r\n\r\n    // [NETWORK] Monitor online/offline status handled by NetworkContext\r\n\r\n\r\n    // ============================================================\r\n    // [ALWAYS-ON GUARD SYSTEM]    \r\n    // ============================================================\r\n\r\n    // [GUARD 1]    (visibilitychange)\r\n    //       +    \r\n    useEffect(() => {\r\n        let lastActiveTime = Date.now();\r\n\r\n        const handleVisibilityChange = async () => {\r\n            if (document.visibilityState === 'visible') {\r\n                const sleepDuration = Date.now() - lastActiveTime;\r\n                const sleepMinutes = Math.round(sleepDuration / 60000);\r\n                console.log(`[AlwaysOn] Tab woke up after ${sleepMinutes}m`);\r\n\r\n                // 5     (Firestore  )\r\n                if (sleepDuration > 5 * 60 * 1000) {\r\n                    console.log('[AlwaysOn] Long sleep detected, reloading page...');\r\n                    window.location.reload();\r\n                    return;\r\n                }\r\n\r\n                // 1    \r\n                if (sleepDuration > 60 * 1000) {\r\n                    try {\r\n                        console.log('[AlwaysOn] Refreshing cache after short sleep...');\r\n                        await storageService.loadAllMembers();\r\n                        fetchWeatherAndAI();\r\n                    } catch (e) {\r\n                        console.warn('[AlwaysOn] Cache refresh failed:', e);\r\n                    }\r\n                }\r\n            } else {\r\n                lastActiveTime = Date.now();\r\n            }\r\n        };\r\n\r\n        document.addEventListener('visibilitychange', handleVisibilityChange);\r\n        return () => document.removeEventListener('visibilitychange', handleVisibilityChange);\r\n        // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    }, []);\r\n\r\n    // [GUARD 2]    (Wake Lock API)\r\n    //     \r\n    useEffect(() => {\r\n        let wakeLock = null;\r\n\r\n        const requestWakeLock = async () => {\r\n            try {\r\n                if ('wakeLock' in navigator) {\r\n                    wakeLock = await navigator.wakeLock.request('screen');\r\n                    console.log('[AlwaysOn] Wake Lock acquired ');\r\n                    wakeLock.addEventListener('release', () => {\r\n                        console.log('[AlwaysOn] Wake Lock released, re-acquiring...');\r\n                        //  \r\n                        setTimeout(requestWakeLock, 1000);\r\n                    });\r\n                }\r\n            } catch (e) {\r\n                console.log('[AlwaysOn] Wake Lock not supported or failed:', e.message);\r\n            }\r\n        };\r\n\r\n        requestWakeLock();\r\n\r\n        // visibilitychange  Wake Lock  (   )\r\n        const handleWakeLockVisibility = () => {\r\n            if (document.visibilityState === 'visible') {\r\n                requestWakeLock();\r\n            }\r\n        };\r\n        document.addEventListener('visibilitychange', handleWakeLockVisibility);\r\n\r\n        return () => {\r\n            if (wakeLock) wakeLock.release().catch(() => {});\r\n            document.removeEventListener('visibilitychange', handleWakeLockVisibility);\r\n        };\r\n    }, []);\r\n\r\n    // [GUARD 3]    (Heartbeat)\r\n    // 3   ,    \r\n    useEffect(() => {\r\n        let heartbeatCount = 0;\r\n\r\n        const heartbeat = setInterval(() => {\r\n            heartbeatCount++;\r\n            const rootEl = document.getElementById('root');\r\n\r\n            // DOM    \r\n            if (!rootEl || !rootEl.children || rootEl.children.length === 0) {\r\n                console.error('[AlwaysOn] Heartbeat: DOM dead, reloading...');\r\n                window.location.reload();\r\n                return;\r\n            }\r\n\r\n            //  30(~90)   \r\n            if (heartbeatCount % 30 === 0) {\r\n                console.log('[AlwaysOn] Heartbeat: Preventive cache refresh');\r\n                storageService.loadAllMembers().catch(() => {});\r\n            }\r\n        }, 3 * 60 * 1000); // 3\r\n\r\n        return () => clearInterval(heartbeat);\r\n    }, []);\r\n\r\n    const loadAIExperience = async (memberName = \" \", credits = null, remainingDays = null, currentWeatherData = null) => {\r\n        const isStandby = memberName === \" \" || memberName === \"visitor\";\r\n\r\n        try {\r\n            const now = new Date();\r\n            const hour = getKSTHour();\r\n            const days = ['', '', '', '', '', '', ''];\r\n            const day = days[now.getDay()];\r\n\r\n            // [BUSINESS HOURS] Only use AI between 7am-11pm\r\n            const isBusinessHours = hour >= 7 && hour < 23;\r\n\r\n            if (!isBusinessHours) {\r\n                // Use fixed message outside business hours\r\n                const fallbackMsg = \"      .\";\r\n                setAiExperience({\r\n                    message: fallbackMsg,\r\n                    bgTheme: \"dawn\",\r\n                    colorTone: \"#FDFCF0\",\r\n                    isFallback: true\r\n                });\r\n                return;\r\n            }\r\n\r\n            // Find upcoming class to inform AI\r\n            const classInfo = await storageService.getCurrentClass(currentBranch);\r\n            const classTitle = classInfo?.title || \"\";\r\n            const weatherCode = currentWeatherData?.weathercode || weather?.weathercode || '0';\r\n\r\n            // [STATIC STANDBY LOGIC] Context-Aware Message Generator\r\n            if (isStandby) {\r\n                let staticMsg = \"\";\r\n\r\n                // 1. Weather Context (Priority 1)\r\n                const wCode = parseInt(weatherCode);\r\n                const isRainy = wCode >= 51 && wCode <= 67 || wCode >= 80 && wCode <= 82;\r\n                const isSnowy = wCode >= 71 && wCode <= 77 || wCode >= 85 && wCode <= 86;\r\n\r\n                if (isRainy && Math.random() > 0.3) {\r\n                    const rainMsgs = [\r\n                        \"  ,    .\",\r\n                        \"      .\",\r\n                        \"    .\",\r\n                        \"     .\",\r\n                        \" ,  .\"\r\n                    ];\r\n                    staticMsg = rainMsgs[Math.floor(Math.random() * rainMsgs.length)];\r\n                } else if (isSnowy && Math.random() > 0.3) {\r\n                    const snowMsgs = [\r\n                        \"  ,   .\",\r\n                        \"  ,   .\",\r\n                        \"     .\",\r\n                        \"    .\"\r\n                    ];\r\n                    staticMsg = snowMsgs[Math.floor(Math.random() * snowMsgs.length)];\r\n                }\r\n\r\n                // 2. Class Context (Priority 2)\r\n                if (!staticMsg && classTitle && classTitle !== \"\" && Math.random() > 0.5) {\r\n                    if (classTitle.includes(\"\")) {\r\n                        const flyingMsgs = [\r\n                            \"    .\",\r\n                            \"     .\",\r\n                            \" ,    .\",\r\n                            \" ,   .\"\r\n                        ];\r\n                        staticMsg = flyingMsgs[Math.floor(Math.random() * flyingMsgs.length)];\r\n                    } else if (classTitle.includes(\"\") || classTitle.includes(\"\")) {\r\n                        const healingMsgs = [\r\n                            \"    .\",\r\n                            \"   .\",\r\n                            \"    ,  .\",\r\n                            \"     .\"\r\n                        ];\r\n                        staticMsg = healingMsgs[Math.floor(Math.random() * healingMsgs.length)];\r\n                    } else if (classTitle.includes(\"\") || classTitle.includes(\"\")) {\r\n                        const flowMsgs = [\r\n                            \"     .\",\r\n                            \"   .\",\r\n                            \"    .\",\r\n                            \"    .\"\r\n                        ];\r\n                        staticMsg = flowMsgs[Math.floor(Math.random() * flowMsgs.length)];\r\n                    }\r\n                }\r\n\r\n                // 3. Time Context (Priority 3)\r\n                if (!staticMsg) {\r\n                    let timeMsgs = [];\r\n                    if (hour >= 6 && hour < 11) {\r\n                        timeMsgs = [\r\n                            \" ,   .\",\r\n                            \" ,    .\",\r\n                            \"    .\",\r\n                            \"    .\",\r\n                            \"    .\",\r\n                            \"      .\"\r\n                        ];\r\n                    } else if (hour >= 11 && hour < 14) {\r\n                        timeMsgs = [\r\n                            \"  ,  .\",\r\n                            \"    .\",\r\n                            \"  ,    .\",\r\n                            \" ,    .\",\r\n                            \"    .\"\r\n                        ];\r\n                    } else if (hour >= 14 && hour < 18) {\r\n                        timeMsgs = [\r\n                            \"    .\",\r\n                            \" ,     .\",\r\n                            \"     .\",\r\n                            \"  ,   .\",\r\n                            \"    .\"\r\n                        ];\r\n                    } else if (hour >= 18 && hour < 21) {\r\n                        timeMsgs = [\r\n                            \"    .\",\r\n                            \" ,    .\",\r\n                            \"    .\",\r\n                            \"    .\",\r\n                            \" ,    .\",\r\n                            \"     .\"\r\n                        ];\r\n                    } else {\r\n                        timeMsgs = [\r\n                            \" ,    .\",\r\n                            \" ,    .\",\r\n                            \"     .\",\r\n                            \"     .\",\r\n                            \"    .\"\r\n                        ];\r\n                    }\r\n                    staticMsg = timeMsgs[Math.floor(Math.random() * timeMsgs.length)];\r\n                }\r\n\r\n                // [INSTANT]     ( )\r\n                setAiExperience({\r\n                    message: staticMsg,\r\n                    bgTheme: (hour >= 6 && hour < 18) ? \"day\" : \"night\",\r\n                    colorTone: \"#FDFCF0\",\r\n                    isFallback: true\r\n                });\r\n\r\n                // [AI ENHANCEMENT]  AI   \r\n                setAiLoading(true);\r\n                storageService.getAIExperience(\r\n                    memberName, 0, day, hour, classTitle,\r\n                    currentWeatherData || weather,\r\n                    null, null, language, null, 'visitor', 'checkin'\r\n                ).then(aiResult => {\r\n                    if (aiResult && aiResult.message && !aiResult.isFallback) {\r\n                        let cleanMsg = aiResult.message\r\n                            .replace(/[.]?\\s*?/gi, '')\r\n                            .replace(/^.*,\\s*/, '')\r\n                            .trim();\r\n                        if (cleanMsg && cleanMsg !== staticMsg) {\r\n                            setAiEnhancedMsg(cleanMsg);\r\n                        }\r\n                        //  \r\n                        const cacheKey = `ai_standby_${currentBranch}_${hour}_${day}_${classTitle}_${weatherCode}`;\r\n                        localStorage.setItem('ai_standby_cache', JSON.stringify({ key: cacheKey, data: aiResult }));\r\n                    }\r\n                }).catch(err => {\r\n                    console.warn('[AI Standby] Background AI failed:', err);\r\n                }).finally(() => {\r\n                    setAiLoading(false);\r\n                });\r\n                return; //    (   AI )\r\n            }\r\n\r\n            const exp = await storageService.getAIExperience(\r\n                memberName,\r\n                0,\r\n                day,\r\n                hour,\r\n                classTitle,\r\n                currentWeatherData || weather,\r\n                credits,\r\n                remainingDays,\r\n                language,\r\n                null,\r\n                isStandby ? 'visitor' : 'member',\r\n                'checkin'\r\n            );\r\n\r\n            if (exp) {\r\n                // Aggressively remove 'Namaste' and any trailing variations\r\n                let cleanMsg = \"\";\r\n                if (exp.message) {\r\n                    cleanMsg = exp.message.replace(/[.]?\\s*?/gi, '');\r\n                    cleanMsg = cleanMsg.replace(/^.*,\\s*/, ''); // Remove \"Name,\" prefix if exists\r\n                    cleanMsg = cleanMsg.trim();\r\n                }\r\n\r\n                const finalData = {\r\n                    ...exp,\r\n                    message: cleanMsg || exp.message\r\n                };\r\n\r\n                setAiExperience(finalData);\r\n\r\n                // [CACHE SAVE]\r\n                if (isStandby) {\r\n                    const cacheKey = `ai_standby_${currentBranch}_${hour}_${day}_${classTitle}_${weatherCode}`;\r\n                    localStorage.setItem('ai_standby_cache', JSON.stringify({ key: cacheKey, data: finalData }));\r\n                }\r\n            }\r\n        } catch (e) {\r\n            console.error(\"AI Experience load failed\", e);\r\n        }\r\n    };\r\n\r\n\r\n\r\n    const handleKeyPress = (num) => {\r\n        setPin(prev => {\r\n            // [NETWORK]    ( )     (Just-in-Time Check)\r\n            //         \r\n            if (prev.length === 0) {\r\n                console.log('[CheckIn] User started typing - Triggering background network check');\r\n                checkConnection().catch(e => console.debug('[CheckIn] Background check failed', e));\r\n            }\r\n\r\n            if (prev.length < 4) {\r\n                const newPin = prev + num;\r\n                if (newPin.length === 4) {\r\n                    // Immediate submission for performance\r\n                    handleSubmit(newPin);\r\n                }\r\n                return newPin;\r\n            }\r\n            return prev;\r\n        });\r\n    };\r\n\r\n    const handleClear = () => {\r\n        setPin(prev => prev.slice(0, -1));\r\n    };\r\n\r\n    const handleQRInteraction = (e) => {\r\n        // [FIX] Robust touch handling to prevent \"open then close\" ghost clicks\r\n        if (e.type === 'touchstart') {\r\n            e.preventDefault(); // Stop mouse emulation\r\n        }\r\n        e.stopPropagation(); // Stop bubbling\r\n\r\n        // Toggle logic or Ensure Open\r\n        // If modal logic is buggy (auto-close), force it open with a small delay to bypass race conditions\r\n        setTimeout(() => setShowInstallGuide(true), 10);\r\n    };\r\n\r\n    const handleBranchChange = (branchId) => {\r\n        setCurrentBranch(branchId);\r\n        storageService.setKioskBranch(branchId);\r\n    };\r\n\r\n    const toggleFullscreen = () => {\r\n        if (!document.fullscreenElement) {\r\n            document.documentElement.requestFullscreen().catch(e => {\r\n                console.error(`Error attempting to enable full-screen mode: ${e.message}`);\r\n            });\r\n            setIsFullscreen(true);\r\n        } else {\r\n            if (document.exitFullscreen) {\r\n                document.exitFullscreen();\r\n                setIsFullscreen(false);\r\n            }\r\n        }\r\n    };\r\n\r\n\r\n\r\n    // [DUPLICATE]       \r\n    const proceedWithCheckIn = async (pinCode, isDuplicateConfirm = false) => {\r\n        console.log(`[CheckIn] Starting submission for PIN: ${pinCode}`);\r\n        setLoading(true);\r\n        try {\r\n            const members = await storageService.findMembersByPhone(pinCode);\r\n            console.log(`[CheckIn] Members found: ${members.length}`);\r\n\r\n            if (members.length === 0) {\r\n                setMessage({ type: 'error', text: '    .' });\r\n                speak(\"error\");\r\n                setPin('');\r\n                startDismissTimer(3000);\r\n                setIsDuplicateFlow(false); // Reset flow\r\n                return;\r\n            }\r\n\r\n            // [FIX] Set flow state if confirmed\r\n            if (isDuplicateConfirm) {\r\n                setIsDuplicateFlow(true);\r\n            } else {\r\n                setIsDuplicateFlow(false);\r\n            }\r\n\r\n            if (members.length > 1) {\r\n                console.log(`[CheckIn] Multiple members found, showing selection modal`);\r\n                setDuplicateMembers(members);\r\n                setShowSelectionModal(true);\r\n                return;\r\n            }\r\n\r\n            const member = members[0];\r\n            console.log(`[CheckIn] Single member selected: ${member.name} (${member.id}), force: ${isDuplicateConfirm}`);\r\n\r\n            const result = await storageService.checkInById(member.id, currentBranch, isDuplicateConfirm);\r\n\r\n            if (result.success) {\r\n                // [NETWORK] If success and NOT offline, ensure we are Online\r\n                if (!result.isOffline) {\r\n                    setIsOnline(true);\r\n                } else {\r\n                    // [NETWORK] Sync status if we fell back to offline\r\n                    setIsOnline(false);\r\n                }\r\n\r\n                if (result.attendanceStatus === 'denied') {\r\n                    handleCheckInError(`   .`);\r\n                } else {\r\n                    //     \r\n                    recentCheckInsRef.current.push({ pin: pinCode, timestamp: Date.now() });\r\n                    showCheckInSuccess(result, isDuplicateConfirm);\r\n                }\r\n            } else {\r\n                handleCheckInError(result.message);\r\n            }\r\n        } catch (err) {\r\n            handleCheckInError(err.message || String(err));\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    // [DUPLICATE]   \" \" \r\n    const confirmDuplicateCheckIn = async () => {\r\n        if (duplicateAutoCloseRef.current) clearInterval(duplicateAutoCloseRef.current);\r\n        setShowDuplicateConfirm(false);\r\n        if (pendingPin) {\r\n            await proceedWithCheckIn(pendingPin, true);\r\n            setPendingPin(null);\r\n        }\r\n    };\r\n\r\n    // [DUPLICATE]   \"\" \r\n    const cancelDuplicateCheckIn = () => {\r\n        if (duplicateAutoCloseRef.current) clearInterval(duplicateAutoCloseRef.current);\r\n        setShowDuplicateConfirm(false);\r\n        setPendingPin(null);\r\n        setPin('');\r\n        setLoading(false);\r\n        setDuplicateTimer(10); // Reset\r\n    };\r\n\r\n    const handleSubmit = async (code) => {\r\n        const pinCode = code || pin;\r\n        if (pinCode.length !== 4 || loading) return;\r\n\r\n        // [NETWORK] We now support offline check-in via storageService fallback\r\n        // The navigator.onLine check is no longer a blocker. \r\n        // We will show a warning but allow the user to proceed.\r\n        if (!navigator.onLine) {\r\n            console.log('[CheckIn] Proceeding in offline mode...');\r\n        }\r\n\r\n        // [DUPLICATE] 60   PIN  \r\n        const now = Date.now();\r\n        const DUPLICATE_WINDOW_MS = 600000; // 10\r\n        //   \r\n        recentCheckInsRef.current = recentCheckInsRef.current.filter(\r\n            entry => (now - entry.timestamp) < DUPLICATE_WINDOW_MS\r\n        );\r\n        const isDuplicate = recentCheckInsRef.current.some(entry => entry.pin === pinCode);\r\n\r\n        if (isDuplicate) {\r\n            console.log(`[CheckIn] Duplicate PIN detected: ${pinCode} (within ${DUPLICATE_WINDOW_MS/1000}s)`);\r\n            setPendingPin(pinCode);\r\n            setShowDuplicateConfirm(true);\r\n            setPin('');\r\n            \r\n            // [UX] Start 10s Countdown for Auto-Confirm (Request: \"If I do nothing, attendance should be checked\")\r\n            setDuplicateTimer(10);\r\n            \r\n            // Clear existing timer if any\r\n            if (duplicateAutoCloseRef.current) clearInterval(duplicateAutoCloseRef.current);\r\n\r\n            duplicateAutoCloseRef.current = setInterval(() => {\r\n                setDuplicateTimer(prev => {\r\n                    if (prev <= 1) {\r\n                        clearInterval(duplicateAutoCloseRef.current);\r\n                        // [UX] Auto-Confirm Logic\r\n                        console.log(\"Auto-confirming duplicate check-in due to timeout\");\r\n                        // We need to trigger confirmDuplicateCheckIn, but we can't call it directly inside state update easily\r\n                        // So we use an effect or just call a wrapped version.\r\n                        // However, duplicatePin state acts as a trigger.\r\n                        // Let's call a separate function or use useEffect to watch timer?\r\n                        // Actually, simpler to just trigger it here if we refactor confirmDuplicateCheckIn to not depend on event.\r\n                        // Check below for confirmDuplicateCheckIn implementation. It uses pendingPin.\r\n                        return 0; \r\n                    }\r\n                    return prev - 1;\r\n                });\r\n            }, 1000);\r\n\r\n            return;\r\n        }\r\n\r\n        await proceedWithCheckIn(pinCode);\r\n    };\r\n\r\n    // [UX] Watch for timer reaching 0 to trigger auto-confirm\r\n    useEffect(() => {\r\n        if (duplicateTimer === 0 && showDuplicateConfirm && pendingPin) {\r\n            confirmDuplicateCheckIn();\r\n        }\r\n    }, [duplicateTimer, showDuplicateConfirm, pendingPin]);\r\n\r\n    const handleCheckInError = (errorStr) => {\r\n        console.error(\"[CheckIn] Error caught:\", errorStr);\r\n        \r\n        // [STABILITY] Log error to Firestore for tracking (e.g., Da-sol Joung's case)\r\n        logError(new Error(errorStr), { \r\n            context: 'Kiosk CheckIn', \r\n            branch: currentBranch,\r\n            pin: pin.slice(-4), // Only log last 4 digits for privacy if possible, but here 'pin' is usually last 4 anyway\r\n            pathname: window.location.pathname\r\n        });\r\n\r\n        let displayMsg = '    .';\r\n        const lowerErr = errorStr.toLowerCase();\r\n\r\n        // [NETWORK] Network-specific error messages (check first for better UX)\r\n        if (lowerErr.includes(' ') || lowerErr.includes('timeout')) {\r\n            displayMsg = '     -  ';\r\n        } else if (lowerErr.includes('network') || lowerErr.includes('fetch') || lowerErr.includes('failed to fetch')) {\r\n            displayMsg = '   -  ';\r\n        } else if (lowerErr.includes(\"insufficient credits\")) {\r\n            displayMsg = \"  . (0)\";\r\n        } else if (lowerErr.includes(\"membership expired\") || lowerErr.includes(\"expired\") || lowerErr.includes(\"\")) {\r\n            const dateMatch = errorStr.match(/\\((.*?)\\)/);\r\n            const date = dateMatch ? dateMatch[1] : '';\r\n            displayMsg = date ? `   . (~${date})` : \"   .\";\r\n        } else if (lowerErr.includes(\"not-found\")) {\r\n            displayMsg = \"    .\";\r\n        } else if (lowerErr.includes(\"infinity\")) { // [FIX] Handle 'Infinity' error specifically\r\n            displayMsg = \"  . (Infinity)\";\r\n            console.error(\"[CheckIn] Critical Data Error: Infinity detected\");\r\n        } else if (lowerErr.includes(\"\")) {\r\n             displayMsg = ` ${errorStr}`; // Special icon for denial\r\n        } else {\r\n            // [FIX] Prevent showing \"Infinity\" in raw error messages\r\n            if (errorStr.includes(\"Infinity\")) {\r\n                 displayMsg = \"  . (Infinity)\";\r\n            } else {\r\n                 displayMsg += ` (${errorStr})`;\r\n            }\r\n        }\r\n\r\n        if (lowerErr.includes(\"insufficient credits\") || lowerErr.includes(\"expired\") || lowerErr.includes(\"\") || lowerErr.includes(\"\") || lowerErr.includes(\"not-found\")) {\r\n             speak(\"denied\"); // [TTS] Denied Feedback\r\n        }\r\n\r\n        setMessage({ type: 'error', text: displayMsg });\r\n        setPin('');\r\n        startDismissTimer(3000);\r\n    };\r\n\r\n    const handleSelectMember = async (memberId) => {\r\n        if (loading) return;\r\n        setShowSelectionModal(false);\r\n        setLoading(true);\r\n        try {\r\n            const member = duplicateMembers.find(m => m.id === memberId);\r\n            console.log(`[CheckIn] Selected member from modal: ${member?.name} (${memberId})`);\r\n\r\n            // [FIX] Pass force flag if in duplicate flow\r\n            const result = await storageService.checkInById(memberId, currentBranch, isDuplicateFlow);\r\n            console.log(`[CheckIn] SelectMember Result: ${result.success ? 'Success' : 'Fail'}`);\r\n\r\n            if (result.success) {\r\n                 // [FIX] Check for DENIED status even if success=true\r\n                 if (result.attendanceStatus === 'denied') {\r\n                    const reason = result.denialReason === 'expired' ? ' ' : ' ';\r\n                    handleCheckInError(` . (${reason})`);\r\n                } else {\r\n                    // [NETWORK] Sync status if we fell back to offline\r\n                    if (result.isOffline) {\r\n                        setIsOnline(false);\r\n                    } else {\r\n                        setIsOnline(true);\r\n                    }\r\n                    showCheckInSuccess(result);\r\n                }\r\n            } else {\r\n                handleCheckInError(result.message);\r\n            }\r\n        } catch (err) {\r\n            handleCheckInError(err.message || String(err));\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const showCheckInSuccess = (result, isDuplicate = false) => {\r\n        console.log(`[CheckIn] Showing success for: ${result.member?.name}, isDuplicate: ${isDuplicate}`);\r\n\r\n        // [PERSONALIZED FORMULA] No AI, just logic\r\n        const member = result.member;\r\n        const streak = member.streak || 0;\r\n        const credits = member.credits || 0;\r\n        const attCount = member.attendanceCount || 0;\r\n        const today = new Date();\r\n        const endDate = member.endDate ? new Date(member.endDate) : null;\r\n        let daysLeft = 999;\r\n\r\n        if (endDate) {\r\n            today.setHours(0, 0, 0, 0);\r\n            endDate.setHours(0, 0, 0, 0);\r\n            daysLeft = Math.ceil((endDate - today) / (1000 * 60 * 60 * 24));\r\n            if (!Number.isFinite(daysLeft)) daysLeft = 999; // [FIX] Prevent Infinity\r\n        }\r\n\r\n        let finalMsg = \"  .\";\r\n\r\n        // EXPIRY Check first (before duplicate msg)\r\n        const isExpiredPeriod = daysLeft < 0;\r\n        const isExpiredCredits = credits <= 0 && Number.isFinite(credits);\r\n\r\n        // [TTS] Feedback logic\r\n        if (isExpiredPeriod || isExpiredCredits) {\r\n            speak(\"denied\"); \r\n        } else {\r\n            speak(\"success\"); \r\n        }\r\n\r\n        // [New] Duplicate Check-in Feedback\r\n        if (result.isDuplicate) {\r\n             finalMsg = \"  .\";\r\n        } else if (isExpiredPeriod && isExpiredCredits) {\r\n            finalMsg = \"   .\";\r\n        } else if (isExpiredPeriod) {\r\n            finalMsg = \" .\";\r\n        } else if (isExpiredCredits) {\r\n            finalMsg = \" .\";\r\n        // Priority Logic matches context\r\n        } else if (streak >= 10 && Number.isFinite(streak)) { // [FIX] Check finite\r\n            finalMsg = `${streak}   .  !`;\r\n        } else if (streak >= 3 && Number.isFinite(streak)) { // [FIX] Check finite\r\n            finalMsg = `${streak}   .  .`;\r\n        } else if (daysLeft <= 7 && daysLeft >= 0) {\r\n            finalMsg = `  ${daysLeft} .`;\r\n        } else if (credits <= 3 && credits > 0 && Number.isFinite(credits)) { // [FIX] Check finite\r\n            finalMsg = `  ${credits} .`;\r\n        } else if (attCount >= 100) {\r\n            finalMsg = `${attCount} .    .`;\r\n        } else if (attCount === 1) {\r\n            finalMsg = \"   !   .\";\r\n        } else {\r\n            // Random Fallback\r\n            const fallbacks = [\r\n                \"    .\",\r\n                \"    .\",\r\n                \"   .\",\r\n                \"   .\",\r\n                \"    .\"\r\n            ];\r\n            finalMsg = fallbacks[Math.floor(Math.random() * fallbacks.length)];\r\n        }\r\n\r\n        // [AI ENHANCEMENT]     + AI  \r\n        setAiEnhancedMsg(null); // \r\n        setAiLoading(true); // AI  \r\n\r\n            setMessage({\r\n                type: 'success', // [UX] Always show success style\r\n                member: result.member,\r\n                text: `${result.member.name}`,\r\n                subText: finalMsg, // [UX] No special offline text\r\n            details: (\r\n                <div className=\"attendance-info\" style={{\r\n                    marginTop: '30px',\r\n                    padding: '30px',\r\n                    background: 'rgba(255,255,255,0.05)',\r\n                    borderRadius: '24px',\r\n                    border: '1px solid rgba(255,255,255,0.1)'\r\n                }}>\r\n                    <div style={{ display: 'flex', justifyContent: 'center', gap: '40px' }}>\r\n                        <div style={{ textAlign: 'center' }}>\r\n                            <div style={{ fontSize: '1.2rem', opacity: 0.6, marginBottom: '8px' }}> </div>\r\n                            <div style={{ fontSize: '3rem', fontWeight: 800, color: 'var(--primary-gold)' }}>\r\n                                {result.member.credits}\r\n                            </div>\r\n                        </div>\r\n                        <div style={{ width: '1px', background: 'rgba(255,255,255,0.1)' }} />\r\n\r\n                        <div style={{ textAlign: 'center' }}>\r\n                            <div style={{ fontSize: '1.2rem', opacity: 0.6, marginBottom: '8px' }}> </div>\r\n                            <div style={{ fontSize: '3rem', fontWeight: 800, color: '#4CAF50' }}>\r\n                                {(() => {\r\n                                    if (!result.member.endDate || result.member.endDate === 'TBD') {\r\n                                        return <span style={{ fontSize: '2rem' }}> </span>;\r\n                                    }\r\n                                    if (result.member.endDate === 'unlimited') {\r\n                                        return <span style={{ fontSize: '2rem' }}></span>;\r\n                                    }\r\n                                    const days = getDaysRemaining(result.member.endDate);\r\n                                    if (days === null) return <span style={{ fontSize: '2rem' }}> </span>;\r\n                                    if (days < 0) return <span style={{ color: '#FF5252' }}></span>;\r\n                                    return `D-${days}`;\r\n                                })()}\r\n                            </div>\r\n                        </div>\r\n                        <div style={{ width: '1px', background: 'rgba(255,255,255,0.1)' }} />\r\n\r\n                        <div style={{ textAlign: 'center' }}>\r\n                            <div style={{ fontSize: '1.2rem', opacity: 0.6, marginBottom: '8px' }}> </div>\r\n                            <div style={{ fontSize: '3rem', fontWeight: 800, color: '#FF6B6B', display: 'flex', alignItems: 'center', gap: '5px' }}>\r\n                                <span></span> {result.member.streak > 1 ? `${result.member.streak}` : (result.member.attendanceCount || result.attendanceCount || 0) + ''}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )\r\n        });\r\n        setPin('');\r\n        startDismissTimer(7000); // [EXTENDED] AI     (5s  7s)\r\n\r\n        // [AI]  AI   \r\n        const now2 = new Date();\r\n        const dayNames = ['', '', '', '', '', '', ''];\r\n        storageService.getAIExperience(\r\n            member.name, attCount, dayNames[now2.getDay()], now2.getHours(),\r\n            null, weather, credits, daysLeft, language,\r\n            { streak, lastAttendanceAt: null },\r\n            'member', 'checkin'\r\n        ).then(aiResult => {\r\n            if (aiResult && aiResult.message && !aiResult.isFallback) {\r\n                let cleanMsg = aiResult.message\r\n                    .replace(/[.]?\\s*?/gi, '')\r\n                    .replace(/^.*,\\s*/, '')\r\n                    .trim();\r\n                if (cleanMsg) {\r\n                    setAiEnhancedMsg(cleanMsg);\r\n                }\r\n            }\r\n        }).catch(err => {\r\n            console.warn('[AI CheckIn] Background AI failed:', err);\r\n        }).finally(() => {\r\n            setAiLoading(false);\r\n        });\r\n    };\r\n\r\n    const startDismissTimer = (duration = 5000) => {\r\n        if (timerRef.current) clearTimeout(timerRef.current);\r\n        timerRef.current = setTimeout(() => {\r\n            handleModalClose(() => setMessage(null));\r\n            setPin(''); // [FIX] Ensure PIN is clear when returning to standby\r\n        }, duration);\r\n    };\r\n\r\n    // [FIX] Centralized modal close handler with ghost touch prevention\r\n    const handleModalClose = (closeAction) => {\r\n        setKeypadLocked(true);\r\n        closeAction();\r\n        setPin(''); // [FIX]     PIN \r\n        setAiEnhancedMsg(null); // [AI]   \r\n        setAiLoading(false); // [AI]   \r\n        // Buffer time to ignore any lingering touch/click events (ghost touches)\r\n        setTimeout(() => {\r\n            setKeypadLocked(false);\r\n        }, 350);\r\n    };\r\n\r\n    // [UX] Auto-close Selection Modal after 30s\r\n    useEffect(() => {\r\n        let timer;\r\n        if (showSelectionModal) {\r\n            timer = setTimeout(() => {\r\n                handleModalClose(() => setShowSelectionModal(false));\r\n            }, 30000); // 30s timeout\r\n        }\r\n        return () => clearTimeout(timer);\r\n    }, [showSelectionModal]);\r\n\r\n    const qrCodeUrl = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodeURIComponent(window.location.origin + '/member')}&bgcolor=ffffff&color=2c2c2c&margin=10`;\r\n\r\n    return (\r\n        <div className=\"checkin-wrapper\" style={{\r\n            position: 'relative',\r\n            width: '100%',\r\n            height: '100dvh',\r\n            overflow: 'hidden',\r\n            display: 'flex',\r\n            flexDirection: 'column',\r\n            background: '#000'\r\n        }}>\r\n            {/* [NETWORK] Global indicator moved to bottom right per user request */}\r\n\r\n            {/* Background Image with optimized rendering */}\r\n            <div className=\"bg-container\" style={{\r\n                position: 'fixed',\r\n                top: 0,\r\n                left: 0,\r\n                width: '100%',\r\n                height: '100%',\r\n                zIndex: 0\r\n            }}>\r\n                <img\r\n                    src={bgImage}\r\n                    alt=\"bg\"\r\n                    className=\"static-bg\"\r\n                    style={{\r\n                        width: '100%',\r\n                        height: '100%',\r\n                        objectFit: 'cover'\r\n                    }}\r\n                />\r\n                <div className=\"bg-overlay\" style={{\r\n                    position: 'absolute',\r\n                    top: 0,\r\n                    left: 0,\r\n                    width: '100%',\r\n                    height: '100%',\r\n                    background: 'rgba(0,0,0,0.5)' // Solid overlay for speed\r\n                }} />\r\n            </div>\r\n\r\n            {/* Top Bar - Optimized with Memoization & Internal Clock */}\r\n            <TopBar\r\n                weather={weather}\r\n                currentBranch={currentBranch}\r\n                branches={branches}\r\n                handleBranchChange={handleBranchChange}\r\n                toggleFullscreen={toggleFullscreen}\r\n                isFullscreen={isFullscreen}\r\n                language={language}\r\n                onInstructorClick={() => setShowInstructorQR(true)}\r\n            />\r\n\r\n            <div className=\"checkin-content\" style={{\r\n                zIndex: 5,\r\n                flex: 1,\r\n                display: 'flex',\r\n                gap: '40px',\r\n                padding: '20px 40px 40px',\r\n                width: '100%',\r\n                margin: '0 auto',\r\n                alignItems: 'stretch',\r\n                overflow: 'hidden'\r\n            }}>\r\n                <div className=\"checkin-info-section\" style={{\r\n                    display: 'flex',\r\n                    flexDirection: 'column',\r\n                    justifyContent: 'center'\r\n                }}>\r\n                    {!message && (\r\n                        <header className=\"info-header\" style={{ marginBottom: '40px' }}>\r\n                            <div className=\"logo-container\" style={{ display: 'flex', alignItems: 'center', gap: '35px', justifyContent: 'center' }}>\r\n                                {/* [ADJUSTED] Logo sizes: RYS200 (80px), Main Logo (80px) per user request */}\r\n                                <img src={rys200Logo} alt=\"RYS200\" style={{ height: '80px', width: 'auto', filter: 'brightness(0) invert(1)', opacity: 0.8 }} />\r\n                                <img src={logoWide} alt=\"logo\" style={{ height: '78px', width: 'auto' }} />\r\n                            </div>\r\n                        </header>\r\n                    )}\r\n\r\n                    <div className=\"info-body\">\r\n                        {!message && !showInstallGuide && (\r\n                            <div className=\"pin-display\">\r\n                                {pin.padEnd(4, '').split('').map((c, i) => (\r\n                                    <span key={i} className={i < pin.length ? 'pin-active' : 'pin-inactive'}>{c}</span>\r\n                                ))}\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* [FIX] Moved message modal logic to root level or use portal concept */}\r\n                        <div className=\"message-container\">\r\n                            {/* Only show instruction when no message */}\r\n                            {!message && (\r\n                                <div className={`instruction-text ${loading ? 'loading' : ''}`}>\r\n                                    {aiExperience ? (\r\n                                        <div>\r\n                                            <span className=\"outfit-font\" style={{\r\n                                                fontSize: 'clamp(1.8rem, 4.5vh, 2.6rem)',\r\n                                                fontWeight: 700,\r\n                                                display: 'block',\r\n                                                marginBottom: '15px',\r\n                                                color: '#FFFFFF',\r\n                                                textShadow: '0 2px 4px rgba(0,0,0,0.8)',\r\n                                                wordBreak: 'keep-all',\r\n                                                lineHeight: 1.2,\r\n                                                opacity: loading ? 0.3 : 1\r\n                                            }}>\r\n                                                {aiExperience.message}\r\n                                            </span>\r\n                                            {/* [AI] AI   -     */}\r\n                                            {aiEnhancedMsg && !loading && (\r\n                                                <div style={{\r\n                                                    marginTop: '8px',\r\n                                                    padding: '12px 16px',\r\n                                                    background: 'linear-gradient(135deg, rgba(212,175,55,0.12), rgba(212,175,55,0.04))',\r\n                                                    border: '1px solid rgba(212,175,55,0.25)',\r\n                                                    borderRadius: '16px',\r\n                                                    animation: 'slideUp 0.6s ease-out',\r\n                                                    display: 'flex',\r\n                                                    alignItems: 'flex-start',\r\n                                                    gap: '10px'\r\n                                                }}>\r\n                                                    <span style={{ fontSize: '1.2rem', flexShrink: 0, marginTop: '2px' }}></span>\r\n                                                    <span style={{\r\n                                                        fontSize: 'clamp(1rem, 2.5vh, 1.4rem)',\r\n                                                        color: 'rgba(255,255,255,0.9)',\r\n                                                        lineHeight: 1.5,\r\n                                                        fontWeight: 500,\r\n                                                        wordBreak: 'keep-all',\r\n                                                        fontStyle: 'italic'\r\n                                                    }}>\r\n                                                        {aiEnhancedMsg}\r\n                                                    </span>\r\n                                                </div>\r\n                                            )}\r\n                                            {/* [AI] AI   -   */}\r\n                                            {aiLoading && !loading && (\r\n                                                <div style={{\r\n                                                    marginTop: '12px',\r\n                                                    display: 'flex',\r\n                                                    alignItems: 'center',\r\n                                                    justifyContent: 'center',\r\n                                                    gap: '10px',\r\n                                                    padding: '10px 16px',\r\n                                                    borderRadius: '20px',\r\n                                                    background: 'rgba(212,175,55,0.08)',\r\n                                                    border: '1px solid rgba(212,175,55,0.15)',\r\n                                                    animation: 'fadeIn 0.5s ease-out'\r\n                                                }}>\r\n                                                    <div className=\"ai-thinking-icon\" style={{\r\n                                                        width: '24px', height: '24px',\r\n                                                        display: 'flex', alignItems: 'center', justifyContent: 'center'\r\n                                                    }}>\r\n                                                        <svg width=\"20\" height=\"20\" viewBox=\"0 0 256 256\" fill=\"var(--primary-gold)\">\r\n                                                            <path d=\"M200,48H136V16a8,8,0,0,0-16,0V48H56A32,32,0,0,0,24,80v96a32,32,0,0,0,32,32h80v32a8,8,0,0,0,16,0V208h48a32,32,0,0,0,32-32V80A32,32,0,0,0,200,48ZM172,168H84a12,12,0,0,1,0-24h88a12,12,0,0,1,0,24Zm0-48H84a12,12,0,0,1,0-24h88a12,12,0,0,1,0,24Z\"/>\r\n                                                        </svg>\r\n                                                    </div>\r\n                                                    <span style={{\r\n                                                        color: 'rgba(212,175,55,0.85)',\r\n                                                        fontSize: '0.95rem',\r\n                                                        fontWeight: 500,\r\n                                                        animation: 'pulse 1.5s ease-in-out infinite'\r\n                                                    }}>\r\n                                                        AI    \r\n                                                    </span>\r\n                                                    <div style={{\r\n                                                        display: 'flex', gap: '4px'\r\n                                                    }}>\r\n                                                        {[0, 1, 2].map(i => (\r\n                                                            <div key={i} style={{\r\n                                                                width: '6px', height: '6px',\r\n                                                                borderRadius: '50%',\r\n                                                                background: 'var(--primary-gold)',\r\n                                                                opacity: 0.7,\r\n                                                                animation: `pulse 1.4s ease-in-out ${i * 0.2}s infinite`\r\n                                                            }} />\r\n                                                        ))}\r\n                                                    </div>\r\n                                                </div>\r\n                                            )}\r\n                                            {loading && (\r\n                                                <div className=\"mini-loader\" style={{\r\n                                                    fontSize: '1.1rem',\r\n                                                    color: 'var(--primary-gold)',\r\n                                                    fontWeight: 'bold',\r\n                                                    marginTop: '-10px'\r\n                                                }}>\r\n                                                       ...\r\n                                                </div>\r\n                                            )}\r\n                                        </div>\r\n                                    ) : (\r\n                                        <div style={{ opacity: 0.5, display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '10px' }}>\r\n                                            <div className=\"ai-thinking-icon\" style={{ width: '24px', height: '24px', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>\r\n                                                <svg width=\"20\" height=\"20\" viewBox=\"0 0 256 256\" fill=\"var(--primary-gold)\">\r\n                                                    <path d=\"M200,48H136V16a8,8,0,0,0-16,0V48H56A32,32,0,0,0,24,80v96a32,32,0,0,0,32,32h80v32a8,8,0,0,0,16,0V208h48a32,32,0,0,0,32-32V80A32,32,0,0,0,200,48ZM172,168H84a12,12,0,0,1,0-24h88a12,12,0,0,1,0,24Zm0-48H84a12,12,0,0,1,0-24h88a12,12,0,0,1,0,24Z\"/>\r\n                                                </svg>\r\n                                            </div>\r\n                                            <span style={{ animation: 'pulse 1.5s ease-in-out infinite' }}>    ...</span>\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {!message && (\r\n                        <div\r\n                            className=\"qr-box\" // Removed glass-panel\r\n                            style={{\r\n                                background: 'rgba(0,0,0,0.6)', // Simple background\r\n                                borderRadius: '20px',\r\n                                padding: '20px 30px',\r\n                                cursor: 'pointer',\r\n                                display: 'flex',\r\n                                alignItems: 'center',\r\n                                justifyContent: 'center',\r\n                                gap: '25px',\r\n                                alignSelf: 'center',\r\n                                border: '1px solid rgba(255, 215, 0, 0.4)',\r\n                                touchAction: 'none'\r\n                            }}\r\n                            onTouchStart={handleQRInteraction}\r\n                            onMouseDown={(e) => {\r\n                                if (e.button === 0) handleQRInteraction(e);\r\n                            }}\r\n                        >\r\n                            <div className=\"qr-img-wrapper\" style={{ background: 'white', padding: '12px', borderRadius: '16px', flexShrink: 0 }}>\r\n                                <img src={qrCodeUrl} alt=\"QR\" style={{ width: '130px', height: '130px', display: 'block' }} />\r\n                            </div>\r\n                            <div className=\"qr-text\" style={{\r\n                                textAlign: 'left',\r\n                                display: 'flex',\r\n                                flexDirection: 'column',\r\n                                justifyContent: 'center',\r\n                                marginTop: '-5px' // Adjusted alignment\r\n                            }}>\r\n                                <h3 style={{ fontSize: '1.9rem', color: 'var(--primary-gold)', marginBottom: '16px', fontWeight: 900, lineHeight: 1 }}>\r\n                                     \r\n                                </h3>\r\n                                <ul style={{ listStyle: 'none', padding: 0, margin: 0, display: 'flex', flexDirection: 'column', gap: '5px' }}>\r\n                                    <li style={{ fontSize: '1.2rem', color: 'rgba(255, 255, 255, 0.95)', display: 'flex', alignItems: 'center', gap: '8px', lineHeight: 1.1 }}>\r\n                                           \r\n                                    </li>\r\n                                    <li style={{ fontSize: '1.2rem', color: 'rgba(255, 255, 255, 0.95)', display: 'flex', alignItems: 'center', gap: '8px', lineHeight: 1.1 }}>\r\n                                           \r\n                                    </li>\r\n                                    <li style={{ fontSize: '1.2rem', color: 'rgba(255, 255, 255, 0.95)', display: 'flex', alignItems: 'center', gap: '8px', lineHeight: 1.1 }}>\r\n                                           \r\n                                    </li>\r\n                                </ul>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                <div className=\"checkin-keypad-section\" style={{ position: 'relative', background: 'transparent', boxShadow: 'none', border: 'none' }}>\r\n                    {/* [UX] Loading Overlay with Friendly Messages (30s Timeout Support) */}\r\n                    {loading && (\r\n                        <div style={{\r\n                            position: 'absolute',\r\n                            top: 0,\r\n                            left: 0,\r\n                            right: 0,\r\n                            bottom: 0,\r\n                            display: 'flex',\r\n                            flexDirection: 'column',\r\n                            alignItems: 'center',\r\n                            justifyContent: 'center',\r\n                            background: 'rgba(0,0,0,0.85)',\r\n                            borderRadius: '24px',\r\n                            zIndex: 100,\r\n                            padding: '20px',\r\n                            textAlign: 'center'\r\n                        }}>\r\n                            <div style={{\r\n                                width: '40px',\r\n                                height: '40px',\r\n                                border: '3px solid rgba(255,215,0,0.3)',\r\n                                borderTop: '3px solid var(--primary-gold)',\r\n                                borderRadius: '50%',\r\n                                animation: 'spin 1s linear infinite',\r\n                                marginBottom: '20px'\r\n                            }} />\r\n                            <p style={{ color: 'var(--primary-gold)', fontSize: '1.2rem', fontWeight: 600, margin: 0 }}>\r\n                                {loadingMessage || '  ...'}\r\n                            </p>\r\n                            <p style={{ color: 'rgba(255,255,255,0.7)', fontSize: '0.9rem', marginTop: '8px' }}>\r\n                                 \r\n                            </p>\r\n                        </div>\r\n                    )}\r\n                    {/* [PERF] Loading overlay while cache is warming */}\r\n                    {!isReady && (\r\n                        <div style={{\r\n                            position: 'absolute',\r\n                            top: 0,\r\n                            left: 0,\r\n                            right: 0,\r\n                            bottom: 0,\r\n                            display: 'flex',\r\n                            flexDirection: 'column',\r\n                            alignItems: 'center',\r\n                            justifyContent: 'center',\r\n                            background: 'rgba(0,0,0,0.7)',\r\n                            borderRadius: '24px',\r\n                            zIndex: 100\r\n                        }}>\r\n                            <div style={{\r\n                                width: '50px',\r\n                                height: '50px',\r\n                                border: '4px solid rgba(255,215,0,0.3)',\r\n                                borderTop: '4px solid var(--primary-gold)',\r\n                                borderRadius: '50%',\r\n                                animation: 'spin 1s linear infinite'\r\n                            }} />\r\n                            <p style={{ marginTop: '20px', color: 'var(--primary-gold)', fontSize: '1.2rem', fontWeight: 600 }}>\r\n                                   ...\r\n                            </p>\r\n                        </div>\r\n                    )}\r\n                    {pin.length === 0 && !message && isReady && (\r\n                        <div className=\"keypad-floating-instruction\">\r\n                              4 \r\n                        </div>\r\n                    )}\r\n                    <Keypad\r\n                        onKeyPress={handleKeyPress}\r\n                        onClear={handleClear}\r\n                        onSubmit={handleSubmit}\r\n                        disabled={loading || keypadLocked || !!message || showSelectionModal || showInstallGuide || showKioskInstallGuide || !isReady}\r\n                    />\r\n                </div>\r\n            </div >\r\n\r\n            {\r\n                showSelectionModal && (\r\n                    <div\r\n                        className=\"modal-overlay\"\r\n                        onClick={(e) => e.stopPropagation()}\r\n                        onTouchStart={(e) => {\r\n                            if (e.cancelable) e.preventDefault();\r\n                            e.stopPropagation();\r\n                        }}\r\n                        style={{ zIndex: 3000, touchAction: 'none' }} // Ensure it's on top and blocks gestures\r\n                    >\r\n                        <div className=\"modal-content glass-panel\" style={{\r\n                            width: '95%',\r\n                            maxWidth: '1100px',\r\n                            maxHeight: '90vh',\r\n                            padding: '25px 30px',\r\n                            display: 'flex',\r\n                            flexDirection: 'column',\r\n                            gap: '12px',\r\n                            overflow: 'hidden'\r\n                        }}>\r\n                            <h2 style={{ fontSize: '2rem', marginBottom: '5px', textAlign: 'center' }}> </h2>\r\n                            <p style={{ textAlign: 'center', opacity: 0.7, marginBottom: '10px', fontSize: '0.95rem' }}>\r\n                                  \r\n                                <span style={{ marginLeft: '10px', fontSize: '0.85em', color: '#ff6b6b' }}>\r\n                                    (30   )\r\n                                </span>\r\n                            </p>\r\n\r\n                            {/* [LOGIC] Split Active / Inactive Members */}\r\n                            {(() => {\r\n                                const today = new Date();\r\n                                today.setHours(0, 0, 0, 0);\r\n\r\n                                const activeMembers = [];\r\n                                const inactiveMembers = [];\r\n\r\n                                duplicateMembers.forEach(m => {\r\n                                    let isActive = false;\r\n                                    const credits = m.credits || 0;\r\n                                    const endDateStr = m.endDate;\r\n\r\n                                    // 1. Check Credits\r\n                                    const hasCredits = credits > 0 || credits === Infinity;\r\n\r\n                                    // 2. Check Date\r\n                                    let hasValidDate = true;\r\n                                    if (endDateStr && endDateStr !== 'unlimited' && endDateStr !== 'TBD') {\r\n                                        const endDate = new Date(endDateStr);\r\n                                        endDate.setHours(0, 0, 0, 0);\r\n                                        if (endDate < today) {\r\n                                            hasValidDate = false;\r\n                                        }\r\n                                    }\r\n\r\n                                    // Active Logic: Must have credits AND valid date\r\n                                    if (hasCredits && hasValidDate) {\r\n                                        activeMembers.push(m);\r\n                                    } else {\r\n                                        inactiveMembers.push(m);\r\n                                    }\r\n                                });\r\n\r\n                                return (\r\n                                    <div style={{ display: 'flex', gap: '20px', flex: 1, minHeight: '280px' }}>\r\n                                        {/* LEFT: Active Members (Prominent) */}\r\n                                        <div style={{ flex: 2, display: 'flex', flexDirection: 'column', gap: '10px' }}>\r\n                                            <h3 style={{ fontSize: '1.2rem', color: 'var(--primary-gold)', borderBottom: '1px solid rgba(212,175,55,0.3)', paddingBottom: '8px' }}>\r\n                                                   \r\n                                            </h3>\r\n                                            <div style={{\r\n                                                display: 'grid',\r\n                                                gridTemplateColumns: activeMembers.length > 4 ? 'repeat(2, 1fr)' : '1fr',\r\n                                                gap: '10px',\r\n                                                flex: 1,\r\n                                                overflowY: 'auto',\r\n                                                alignContent: 'start',\r\n                                                paddingRight: '5px'\r\n                                            }}>\r\n                                                {activeMembers.length > 0 ? activeMembers.map(m => (\r\n                                                    <button\r\n                                                        key={m.id}\r\n                                                        onClick={(e) => {\r\n                                                            if (loading) return;\r\n                                                            e.stopPropagation();\r\n                                                            handleSelectMember(m.id);\r\n                                                        }}\r\n                                                        className=\"member-card active-member-card\"\r\n                                                        style={{\r\n                                                            padding: '18px',\r\n                                                            borderRadius: '16px',\r\n                                                            background: 'linear-gradient(135deg, rgba(255,255,255,0.15), rgba(255,255,255,0.05))',\r\n                                                            color: 'white',\r\n                                                            border: '2px solid rgba(212,175,55,0.5)',\r\n                                                            boxShadow: '0 8px 32px rgba(0,0,0,0.2)',\r\n                                                            display: 'flex',\r\n                                                            flexDirection: 'column',\r\n                                                            alignItems: 'center',\r\n                                                            justifyContent: 'center',\r\n                                                            gap: '8px',\r\n                                                            cursor: 'pointer',\r\n                                                            transition: 'transform 0.2s',\r\n                                                            minHeight: '120px'\r\n                                                        }}\r\n                                                    >\r\n                                                        <span style={{ fontSize: '1.8rem', fontWeight: '800', color: 'var(--primary-gold)' }}>{m.name}</span>\r\n                                                        <div style={{ display: 'flex', gap: '8px', flexWrap: 'wrap', justifyContent: 'center' }}>\r\n                                                            <span style={{ fontSize: '1rem', background: 'rgba(0,0,0,0.4)', padding: '4px 10px', borderRadius: '50px' }}>\r\n                                                                {getBranchName(m.homeBranch)}\r\n                                                            </span>\r\n                                                            <span style={{ fontSize: '1rem', background: 'rgba(76, 175, 80, 0.3)', padding: '4px 10px', borderRadius: '50px', color: '#81c784' }}>\r\n                                                                {m.credits > 900 ? '' : `${m.credits}`}\r\n                                                            </span>\r\n                                                        </div>\r\n                                                    </button>\r\n                                                )) : (\r\n                                                    <div style={{ gridColumn: '1/-1', display: 'flex', alignItems: 'center', justifyContent: 'center', opacity: 0.5, fontSize: '1.2rem' }}>\r\n                                                          .\r\n                                                    </div>\r\n                                                )}\r\n                                            </div>\r\n                                        </div>\r\n\r\n                                        {/* RIGHT: Inactive Members (Compact) */}\r\n                                        <div style={{ flex: 1, display: 'flex', flexDirection: 'column', gap: '10px', borderLeft: '1px solid rgba(255,255,255,0.1)', paddingLeft: '20px' }}>\r\n                                            <h3 style={{ fontSize: '1.2rem', color: 'rgba(255,255,255,0.5)', borderBottom: '1px solid rgba(255,255,255,0.1)', paddingBottom: '8px' }}>\r\n                                                 / \r\n                                            </h3>\r\n                                            <div style={{ display: 'flex', flexDirection: 'column', gap: '10px', overflowY: 'auto' }}>\r\n                                                {inactiveMembers.length > 0 ? inactiveMembers.map(m => (\r\n                                                    <button\r\n                                                        key={m.id}\r\n                                                        onClick={(e) => {\r\n                                                            if (loading) return;\r\n                                                            e.stopPropagation();\r\n                                                            handleSelectMember(m.id);\r\n                                                        }}\r\n                                                        className=\"member-card inactive-member-card\"\r\n                                                        style={{\r\n                                                            padding: '15px',\r\n                                                            borderRadius: '12px',\r\n                                                            background: 'rgba(0,0,0,0.2)',\r\n                                                            color: 'rgba(255,255,255,0.6)',\r\n                                                            border: '1px solid rgba(255,255,255,0.1)',\r\n                                                            display: 'flex',\r\n                                                            alignItems: 'center',\r\n                                                            justifyContent: 'space-between',\r\n                                                            cursor: 'pointer',\r\n                                                            textAlign: 'left'\r\n                                                        }}\r\n                                                    >\r\n                                                        <div>\r\n                                                            <div style={{ fontSize: '1.2rem', fontWeight: '600' }}>{m.name}</div>\r\n                                                            <div style={{ fontSize: '0.8rem', opacity: 0.7 }}>{getBranchName(m.homeBranch)}</div>\r\n                                                        </div>\r\n                                                        <div style={{ fontSize: '0.9rem', color: '#ff6b6b' }}></div>\r\n                                                    </button>\r\n                                                )) : (\r\n                                                    <div style={{ opacity: 0.3, textAlign: 'center', padding: '20px' }}>\r\n                                                         \r\n                                                    </div>\r\n                                                )}\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                );\r\n                            })()}\r\n\r\n                            <div style={{ display: 'flex', justifyContent: 'center', marginTop: '10px' }}>\r\n                                <button\r\n                                    onClick={() => handleModalClose(() => setShowSelectionModal(false))}\r\n                                    style={{\r\n                                        background: 'transparent',\r\n                                        border: '1px solid rgba(255,255,255,0.3)',\r\n                                        color: 'rgba(255,255,255,0.6)',\r\n                                        padding: '10px 30px',\r\n                                        borderRadius: '50px',\r\n                                        fontSize: '1rem',\r\n                                        cursor: 'pointer',\r\n                                        transition: 'all 0.2s',\r\n                                    }}\r\n                                    onMouseOver={(e) => e.currentTarget.style.borderColor = 'rgba(255,255,255,0.8)'}\r\n                                    onMouseOut={(e) => e.currentTarget.style.borderColor = 'rgba(255,255,255,0.3)'}\r\n                                >\r\n                                     ()\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                )\r\n            }\r\n\r\n            {/* [FIX] Message Modal as Fixed Overlay for reliable closing */}\r\n            {\r\n                message && (\r\n                    <div\r\n                        className=\"modal-overlay\"\r\n                        style={{\r\n                            zIndex: 2500,\r\n                            background: 'rgba(0,0,0,0.8)',\r\n                            display: 'flex',\r\n                            alignItems: 'center',\r\n                            justifyContent: 'center'\r\n                        }}\r\n                        onClick={(e) => {\r\n                            e.stopPropagation();\r\n                            handleModalClose(() => setMessage(null));\r\n                            setPin('');\r\n                            if (timerRef.current) clearTimeout(timerRef.current);\r\n                        }}\r\n                        onTouchStart={(e) => {\r\n                            if (e.cancelable) e.preventDefault();\r\n                            e.stopPropagation();\r\n                            handleModalClose(() => setMessage(null));\r\n                            setPin('');\r\n                            if (timerRef.current) clearTimeout(timerRef.current);\r\n                        }}\r\n                    >\r\n                        <div\r\n                            className={`message-box ${message.type}`}\r\n                            style={{\r\n                                maxWidth: '900px', // Restrict width so it looks like a modal\r\n                                width: '90%',\r\n                                height: 'auto',\r\n                                maxHeight: '80vh',\r\n                                display: 'flex', // Re-apply flex inside\r\n                                flexDirection: 'column'\r\n                            }}\r\n                            onClick={(e) => {\r\n                                // Also allow clicking inside the box to close it (per user request: \"touch screen to close immediately\")\r\n                                e.stopPropagation();\r\n                                handleModalClose(() => setMessage(null));\r\n                                setPin('');\r\n                                if (timerRef.current) clearTimeout(timerRef.current);\r\n                            }}\r\n                        >\r\n                            <div className=\"message-content\">\r\n                                <div className=\"message-text\" style={{ fontSize: '2.5rem', fontWeight: '800', marginBottom: '15px' }}>{message.text}</div>\r\n                                {message.subText && <div className=\"message-subtext\" style={{ fontSize: '1.5rem', opacity: 1, marginBottom: '20px', whiteSpace: 'pre-wrap', lineHeight: '1.3' }}>{message.subText}</div>}\r\n                                {/* [AI]   AI   */}\r\n                                {message.type === 'success' && aiEnhancedMsg && (\r\n                                    <div style={{\r\n                                        margin: '0 20px 15px',\r\n                                        padding: '14px 18px',\r\n                                        background: 'linear-gradient(135deg, rgba(212,175,55,0.15), rgba(212,175,55,0.05))',\r\n                                        border: '1px solid rgba(212,175,55,0.3)',\r\n                                        borderRadius: '16px',\r\n                                        animation: 'slideUp 0.6s ease-out',\r\n                                        display: 'flex',\r\n                                        alignItems: 'flex-start',\r\n                                        gap: '10px'\r\n                                    }}>\r\n                                        <span style={{ fontSize: '1.3rem', flexShrink: 0, marginTop: '2px' }}></span>\r\n                                        <span style={{\r\n                                            fontSize: '1.15rem',\r\n                                            color: 'rgba(255,255,255,0.95)',\r\n                                            lineHeight: 1.5,\r\n                                            fontWeight: 500,\r\n                                            wordBreak: 'keep-all',\r\n                                            fontStyle: 'italic'\r\n                                        }}>\r\n                                            {aiEnhancedMsg}\r\n                                        </span>\r\n                                    </div>\r\n                                )}\r\n                                {/* [AI]   AI   */}\r\n                                {message.type === 'success' && aiLoading && (\r\n                                    <div style={{\r\n                                        margin: '0 20px 15px',\r\n                                        display: 'flex',\r\n                                        alignItems: 'center',\r\n                                        justifyContent: 'center',\r\n                                        gap: '8px',\r\n                                        padding: '10px 16px',\r\n                                        borderRadius: '20px',\r\n                                        background: 'rgba(212,175,55,0.08)',\r\n                                        border: '1px solid rgba(212,175,55,0.15)',\r\n                                        animation: 'fadeIn 0.5s ease-out'\r\n                                    }}>\r\n                                        <div className=\"ai-thinking-icon\" style={{\r\n                                            width: '20px', height: '20px',\r\n                                            display: 'flex', alignItems: 'center', justifyContent: 'center'\r\n                                        }}>\r\n                                            <svg width=\"16\" height=\"16\" viewBox=\"0 0 256 256\" fill=\"var(--primary-gold)\">\r\n                                                <path d=\"M200,48H136V16a8,8,0,0,0-16,0V48H56A32,32,0,0,0,24,80v96a32,32,0,0,0,32,32h80v32a8,8,0,0,0,16,0V208h48a32,32,0,0,0,32-32V80A32,32,0,0,0,200,48ZM172,168H84a12,12,0,0,1,0-24h88a12,12,0,0,1,0,24Zm0-48H84a12,12,0,0,1,0-24h88a12,12,0,0,1,0,24Z\"/>\r\n                                            </svg>\r\n                                        </div>\r\n                                        <span style={{\r\n                                            color: 'rgba(212,175,55,0.85)',\r\n                                            fontSize: '0.85rem',\r\n                                            fontWeight: 500,\r\n                                            animation: 'pulse 1.5s ease-in-out infinite'\r\n                                        }}>\r\n                                                ...\r\n                                        </span>\r\n                                        <div style={{ display: 'flex', gap: '3px' }}>\r\n                                            {[0, 1, 2].map(i => (\r\n                                                <div key={i} style={{\r\n                                                    width: '5px', height: '5px',\r\n                                                    borderRadius: '50%',\r\n                                                    background: 'var(--primary-gold)',\r\n                                                    opacity: 0.7,\r\n                                                    animation: `pulse 1.4s ease-in-out ${i * 0.2}s infinite`\r\n                                                }} />\r\n                                            ))}\r\n                                        </div>\r\n                                    </div>\r\n                                )}\r\n                                {message.details}\r\n                            </div>\r\n                            <p className=\"message-dismiss-text\" style={{ fontSize: '1.2rem', opacity: 0.7 }}>   </p>\r\n                        </div>\r\n                    </div>\r\n                )\r\n            }\r\n\r\n            {/* PWA Install Guide for Admin Kiosk */}\r\n            {/* Combined Install Guide with Retry Logic */}\r\n            {\r\n                (showKioskInstallGuide || showInstallGuide) && (\r\n                    <InstallGuideModal\r\n                        onClose={() => handleModalClose(() => {\r\n                            setShowKioskInstallGuide(false);\r\n                            setShowInstallGuide(false);\r\n                        })}\r\n                        onRetry={handleInstallClick}\r\n                    // [New] Auto-close after 5 minutes (300s) if passed as prop, but here handled by wrapper or inside modal.\r\n                    // Since we can't easily change InstallGuideModal props without checking it, let's wrap it here or add a timer effect in CheckInPage that watches this state.\r\n                    />\r\n                )\r\n            }\r\n\r\n            {/* Instructor QR Modal */}\r\n            <InstructorQRModal \r\n                isOpen={showInstructorQR} \r\n                onClose={() => setShowInstructorQR(false)} \r\n            />\r\n\r\n            {showDuplicateConfirm && (\r\n                <div style={{\r\n                    position: 'fixed',\r\n                    top: 0, left: 0, right: 0, bottom: 0,\r\n                    background: 'rgba(0,0,0,0.85)', // [UI] Darker background for focus\r\n                    zIndex: 10000,\r\n                    display: 'flex',\r\n                    alignItems: 'center',\r\n                    justifyContent: 'center',\r\n                    animation: 'fadeIn 0.2s ease-out'\r\n                }}>\r\n                    <div style={{\r\n                        background: 'rgba(30,30,30,0.98)',\r\n                        backdropFilter: 'blur(30px)',\r\n                        border: '2px solid rgba(255,80,80,0.5)',\r\n                        borderRadius: '28px',\r\n                        padding: '30px 40px',\r\n                        maxWidth: '750px',\r\n                        width: '95%',\r\n                        textAlign: 'center',\r\n                        boxShadow: '0 30px 80px rgba(0,0,0,0.7)',\r\n                        animation: 'scaleUp 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)'\r\n                    }}>\r\n                        <div style={{\r\n                            fontSize: '3rem',\r\n                            marginBottom: '10px'\r\n                        }}></div>\r\n                        <h3 style={{\r\n                            color: '#ff6b6b',\r\n                            fontSize: '2rem',\r\n                            fontWeight: 800,\r\n                            marginBottom: '12px',\r\n                            textShadow: '0 2px 10px rgba(255,107,107,0.3)'\r\n                        }}>!  </h3>\r\n                        \r\n                        <p style={{\r\n                            color: 'white',\r\n                            fontSize: '1.3rem',\r\n                            lineHeight: 1.4,\r\n                            marginBottom: '6px',\r\n                            fontWeight: 600\r\n                        }}>\r\n                             <span style={{color: '#ffd700'}}>/</span>  ?\r\n                        </p>\r\n                        <p style={{\r\n                            color: 'rgba(255,255,255,0.7)',\r\n                            fontSize: '1.1rem',\r\n                            marginBottom: '25px'\r\n                        }}>\r\n                             ,  <span style={{color: '#ff6b6b', textDecoration: 'underline'}}> </span> !\r\n                        </p>\r\n\r\n                        <div style={{\r\n                            display: 'flex',\r\n                            gap: '20px',\r\n                            justifyContent: 'center',\r\n                            flexWrap: 'wrap'\r\n                        }}>\r\n                            {/* [UI] Huge Cancel Button */}\r\n                            <button\r\n                                onClick={cancelDuplicateCheckIn}\r\n                                style={{\r\n                                    flex: '1 1 280px',\r\n                                    padding: '20px 15px',\r\n                                    borderRadius: '20px',\r\n                                    border: '3px solid #ff6b6b',\r\n                                    background: 'rgba(255,107,107,0.15)',\r\n                                    color: '#ff6b6b',\r\n                                    fontSize: '1.5rem',\r\n                                    fontWeight: 800,\r\n                                    cursor: 'pointer',\r\n                                    boxShadow: '0 10px 30px rgba(255,107,107,0.2)',\r\n                                    transition: 'all 0.2s',\r\n                                    display: 'flex',\r\n                                    flexDirection: 'column',\r\n                                    alignItems: 'center',\r\n                                    gap: '6px'\r\n                                }}\r\n                            >\r\n                                <span>  !</span>\r\n                                <span style={{fontSize: '0.85rem', fontWeight: 500, opacity: 0.8}}>()</span>\r\n                            </button>\r\n\r\n                            {/* [UI] Huge Confirm Button */}\r\n                            <button\r\n                                onClick={confirmDuplicateCheckIn}\r\n                                style={{\r\n                                    flex: '1 1 280px',\r\n                                    padding: '20px 15px',\r\n                                    borderRadius: '20px',\r\n                                    border: 'none',\r\n                                    background: 'linear-gradient(135deg, #d4af37, #f5d76e)',\r\n                                    color: '#1a1a1a',\r\n                                    fontSize: '1.5rem',\r\n                                    fontWeight: 800,\r\n                                    cursor: 'pointer',\r\n                                    boxShadow: '0 10px 30px rgba(212,175,55,0.4)',\r\n                                    transition: 'all 0.2s',\r\n                                    display: 'flex',\r\n                                    flexDirection: 'column',\r\n                                    alignItems: 'center',\r\n                                    gap: '6px'\r\n                                }}\r\n                            >\r\n                                <span> ,  </span>\r\n                            </button>\r\n                        </div>\r\n\r\n                        {/* [Logic] Auto-confirm countdown */}\r\n                        <div style={{\r\n                            marginTop: '20px',\r\n                            padding: '12px 15px',\r\n                            background: 'rgba(255,255,255,0.05)',\r\n                            borderRadius: '14px',\r\n                            border: '1px dashed rgba(255,255,255,0.2)'\r\n                        }}>\r\n                            <p style={{\r\n                                color: 'rgba(255,255,255,0.9)',\r\n                                fontSize: '1rem',\r\n                                marginBottom: '6px'\r\n                            }}>\r\n                                  ...\r\n                            </p>\r\n                            <div style={{\r\n                                fontSize: '1.2rem',\r\n                                fontWeight: 700,\r\n                                color: '#ffd700'\r\n                            }}>\r\n                                <span style={{fontSize: '1.5rem', color: '#fff'}}>{duplicateTimer}</span>   <span style={{textDecoration: 'underline'}}> </span>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div >\r\n    );\r\n};\r\n\r\n// [ADD] Effect to auto-close InstallGuide after 5 minutes\r\n// Since we are inside the component, we can add this useEffect inside CheckInPage\r\n// But CheckInPage is large, let's inject it near other effects or just add a self-closing wrapper?\r\n// Actually, let's just add the useEffect hook in the main component body for simplicity.\r\n\r\n\r\nexport default CheckInPage;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\pages\\InstructorPage.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'aiGreeting'. Either include it or remove the dependency array.","line":255,"column":8,"nodeType":"ArrayExpression","endLine":255,"endColumn":78,"suggestions":[{"desc":"Update the dependencies array to be: [instructorName, attendance.length, attendanceLoading, hour, todayStr, aiGreeting]","fix":{"range":[12076,12146],"text":"[instructorName, attendance.length, attendanceLoading, hour, todayStr, aiGreeting]"}}]},{"ruleId":"no-unused-vars","severity":1,"message":"'navBtnStyle' is assigned a value but never used.","line":418,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":418,"endColumn":18,"suggestions":[{"messageId":"removeVar","data":{"varName":"navBtnStyle"},"fix":{"range":[20008,20208],"text":""},"desc":"Remove unused variable 'navBtnStyle'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useMemo, useRef } from 'react';\r\nimport { CalendarBlank, Bell, House, SignOut } from '@phosphor-icons/react';\r\nimport { storageService } from '../services/storage';\r\nimport { getKSTHour } from '../utils/dates';\r\nimport CosmicParticles from '../components/common/CosmicParticles';\r\n\r\nimport InstructorLogin from '../components/instructor/InstructorLogin';\r\nimport InstructorSchedule from '../components/instructor/InstructorSchedule';\r\nimport InstructorNotices from '../components/instructor/InstructorNotices';\r\nimport InstructorHome from '../components/instructor/InstructorHome';\r\nimport InstallGuideModal from '../components/InstallGuideModal';\r\n\r\n// === Helper for Default Greeting ===\r\nconst getDefaultGreeting = (name, h, day) => {\r\n    const timeGreeting = h < 12 ? ' ' : h < 17 ? '  ' : '';\r\n    const dayContext = day === '' ? '   !' : \r\n                      day === '' ? ' !' : \r\n                      (day === '' || day === '') ? ' !' : '';\r\n    return `${name} , ${timeGreeting}  ${dayContext}`;\r\n};\r\n\r\n// === Main Page ===\r\nconst InstructorPage = () => {\r\n    const [instructorName, setInstructorName] = useState(localStorage.getItem('instructorName') || '');\r\n    const [instructors, setInstructors] = useState([]);\r\n    const [activeTab, setActiveTab] = useState('home');\r\n    const [loading, setLoading] = useState(true);\r\n    \r\n    // Subscription Cleanup Ref\r\n    const unsubscribesRef = useRef([]);\r\n    const lastAiFetchArgs = useRef(''); // [FIX] AI     \r\n\r\n    // AI Greeting State (Global)\r\n    const [aiGreeting, setAiGreeting] = useState('');\r\n    const [aiGreetingLoading, setAiGreetingLoading] = useState(false); // [AI]  \r\n    const [aiEnhancedGreeting, setAiEnhancedGreeting] = useState(null); // [AI] AI  \r\n    const [showInstallGuide, setShowInstallGuide] = useState(false); // [PWA] Install Guide\r\n    \r\n    // Attendance State (Global)\r\n    const [attendance, setAttendance] = useState([]);\r\n    const [instructorClasses, setInstructorClasses] = useState([]);\r\n    const [attendanceLoading, setAttendanceLoading] = useState(true);\r\n    const todayStr = useMemo(() => new Date().toLocaleDateString('sv-SE', { timeZone: 'Asia/Seoul' }), []);\r\n    const hour = getKSTHour();\r\n\r\n    const branches = useMemo(() => [\r\n        { id: 'gwangheungchang', name: '' },\r\n        { id: 'mapo', name: '' }\r\n    ], []);\r\n\r\n    // Load Instructors\r\n    useEffect(() => {\r\n        const loadInstructors = async () => {\r\n            try {\r\n                const insts = await storageService.getInstructors();\r\n                if (insts && insts.length > 0) {\r\n                    setInstructors(insts);\r\n                }\r\n            } catch (e) {\r\n                console.error('Failed to load instructors:', e);\r\n            } finally {\r\n                setLoading(false);\r\n            }\r\n        };\r\n        loadInstructors();\r\n    }, []);\r\n\r\n    // [PWA] Auto-show install guide for non-standalone users\r\n    useEffect(() => {\r\n        const isStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone === true;\r\n        const hasSeenGuide = localStorage.getItem('has_seen_inst_install_guide');\r\n        \r\n        // Show after a slight delay\r\n        if (!isStandalone && !hasSeenGuide) {\r\n            const timer = setTimeout(() => {\r\n                setShowInstallGuide(true);\r\n                localStorage.setItem('has_seen_inst_install_guide', 'true');\r\n            }, 3000);\r\n            return () => clearTimeout(timer);\r\n        }\r\n    }, []);\r\n\r\n    // Load Attendance & Schedule in Real-time\r\n    useEffect(() => {\r\n        if (!instructorName) return;\r\n\r\n        // 1. Initial Load for Classes & Attendance (Baseline)\r\n        const loadInitialData = async () => {\r\n            try {\r\n                // Fetch Classes (Static for the day)\r\n                const classPromises = branches.map(b => storageService.getDailyClasses(b.id, instructorName));\r\n                \r\n                // Fetch Attendance (Baseline)\r\n                const attendancePromises = branches.map(b => storageService.getAttendanceByDate(todayStr, b.id));\r\n\r\n                const [classResults, attendanceResults] = await Promise.all([\r\n                    Promise.all(classPromises),\r\n                    Promise.all(attendancePromises)\r\n                ]);\r\n                \r\n                // Process Classes\r\n                let allMyClasses = [];\r\n                classResults.forEach((data, idx) => {\r\n                    const branchName = branches[idx].name;\r\n                    const branchId = branches[idx].id;\r\n                    const branchClasses = (data || []).map(c => ({ ...c, branchName, branchId }));\r\n                    allMyClasses = [...allMyClasses, ...branchClasses];\r\n                });\r\n                setInstructorClasses(allMyClasses);\r\n\r\n                // Process Attendance Baseline\r\n                let allBaselineAttendance = [];\r\n                attendanceResults.forEach((data, idx) => {\r\n                    const branchName = branches[idx].name;\r\n                    const branchId = branches[idx].id;\r\n                    \r\n                    const myBranchClasses = allMyClasses.filter(c => c.branchId === branchId);\r\n                    const myClassTitles = new Set(myBranchClasses.map(c => c.title));\r\n\r\n                    console.log(`[InstructorPage] Branch: ${branchId}, Fetched: ${data?.length} logs`);\r\n                    \r\n                    const branchRecords = (data || [])\r\n                        .filter(r => {\r\n                            // Relaxed Filtering Logic\r\n                            const recordInstructor = r.instructor ? r.instructor.trim() : '';\r\n                            const currentInstructor = instructorName.trim();\r\n                            \r\n                            const isExactMatch = recordInstructor === currentInstructor;\r\n                            const isUndesignated = recordInstructor === '' || !recordInstructor;\r\n                            const isClassMatch = myClassTitles.has(r.className);\r\n\r\n                            // Debug logging for unmatched but potential candidates\r\n                            if (isUndesignated && isClassMatch) {\r\n                                console.log('[InstructorPage] Included Undesignated:', r);\r\n                            }\r\n\r\n                            return isExactMatch || (isUndesignated && isClassMatch);\r\n                        })\r\n                        .map(r => ({ ...r, branchName, branchId }));\r\n                    allBaselineAttendance = [...allBaselineAttendance, ...branchRecords];\r\n                });\r\n                \r\n                allBaselineAttendance.forEach(a => a._ts = new Date(a.timestamp).getTime());\r\n                setAttendance(allBaselineAttendance.sort((a, b) => b._ts - a._ts));\r\n                setAttendanceLoading(false); // Initial load done\r\n\r\n                // 2. Real-time Subscription (Moved inside to access allMyClasses)\r\n                const newUnsubscribes = branches.map(branch => {\r\n                    return storageService.subscribeAttendance(todayStr, branch.id, (records) => {\r\n                        setAttendance(prev => {\r\n                            const otherBranches = prev.filter(r => r.branchId !== branch.id);\r\n                            const branchName = branch.name;\r\n                            const branchId = branch.id;\r\n                            \r\n                            // Re-filter with the known classes\r\n                            const myBranchClasses = allMyClasses.filter(c => c.branchId === branchId);\r\n                            const myClassTitles = new Set(myBranchClasses.map(c => c.title));\r\n\r\n                            const branchRecords = (records || [])\r\n                                .filter(r => {\r\n                                    const recordInstructor = r.instructor ? r.instructor.trim() : '';\r\n                                    const currentInstructor = instructorName.trim();\r\n                                    \r\n                                    const isExactMatch = recordInstructor === currentInstructor;\r\n                                    const isUndesignated = recordInstructor === '' || !recordInstructor;\r\n                                    const isClassMatch = myClassTitles.has(r.className);\r\n                                    \r\n                                    return isExactMatch || (isUndesignated && isClassMatch);\r\n                                })\r\n                                .map(r => ({ ...r, branchName, branchId }));\r\n                            \r\n                            const merged = [...otherBranches, ...branchRecords];\r\n                            merged.sort((a, b) => {\r\n                                const ta = a._ts || (a._ts = new Date(a.timestamp).getTime());\r\n                                const tb = b._ts || (b._ts = new Date(b.timestamp).getTime());\r\n                                return tb - ta;\r\n                            });\r\n                            return merged;\r\n                        });\r\n                    });\r\n                });\r\n                unsubscribesRef.current = newUnsubscribes;\r\n\r\n            } catch (e) {\r\n                console.error('Failed to load initial data:', e);\r\n                setAttendanceLoading(false);\r\n            }\r\n        };\r\n\r\n        loadInitialData();\r\n\r\n        // Cleanup function\r\n        return () => {\r\n             if (unsubscribesRef.current) {\r\n                unsubscribesRef.current.forEach(unsub => unsub());\r\n             }\r\n        };\r\n    }, [instructorName, todayStr, branches]);\r\n\r\n    // Initialize AI Greeting (Instant + Fetch)\r\n    useEffect(() => {\r\n        if (!instructorName) return;\r\n\r\n        const dayOfWeek = ['', '', '', '', '', '', ''][new Date().getDay()];\r\n        \r\n        // 1. Try Cache First for instant display\r\n        const cacheKey = `ai_greeting_${instructorName}_${todayStr}_${hour}`;\r\n        const cached = localStorage.getItem(cacheKey);\r\n        \r\n        if (cached) {\r\n            setAiGreeting(cached);\r\n        } else {\r\n            // If no cache, set default instant message (to avoid \"Loading...\")\r\n            setAiGreeting(getDefaultGreeting(instructorName, hour, dayOfWeek));\r\n        }\r\n\r\n        // 2. Fetch fresh AI message in background\r\n        const currentArgs = `${instructorName}_${attendance.length}_${hour}`;\r\n        const fetchAI = async () => {\r\n            if (attendanceLoading || lastAiFetchArgs.current === currentArgs) return;\r\n            \r\n            lastAiFetchArgs.current = currentArgs;\r\n            setAiGreetingLoading(true); // [AI]  \r\n            try {\r\n                const result = await storageService.getAIExperience(\r\n                    instructorName,\r\n                    attendance.length,\r\n                    dayOfWeek,\r\n                    hour,\r\n                    null, null, null, null, 'ko', null, 'instructor'\r\n                );\r\n                \r\n                const greetingText = typeof result === 'string' \r\n                    ? result \r\n                    : (result?.message || getDefaultGreeting(instructorName, hour, dayOfWeek, attendance.length));\r\n                \r\n                // [AI] AI       \r\n                if (greetingText && greetingText !== aiGreeting && !result?.isFallback) {\r\n                    setAiEnhancedGreeting(greetingText);\r\n                } else {\r\n                    setAiGreeting(greetingText);\r\n                }\r\n                localStorage.setItem(cacheKey, greetingText);\r\n            } catch (e) {\r\n                console.error('AI greeting background fetch failed:', e);\r\n            } finally {\r\n                setAiGreetingLoading(false); // [AI]  \r\n            }\r\n        };\r\n\r\n        if (!attendanceLoading && !cached && lastAiFetchArgs.current !== currentArgs) {\r\n            fetchAI();\r\n        }\r\n\r\n    }, [instructorName, attendance.length, attendanceLoading, hour, todayStr]);\r\n\r\n    const handleLogout = () => {\r\n        localStorage.removeItem('instructorName');\r\n        setInstructorName('');\r\n        setAiGreeting('');\r\n        setAttendance([]);\r\n    };\r\n\r\n    if (loading) {\r\n        return (\r\n            <div style={{ minHeight: '100dvh', background: 'var(--bg-primary)', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>\r\n                <div style={{ textAlign: 'center', color: 'var(--primary-gold)' }}> ...</div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (!instructorName) {\r\n        return (\r\n            <>\r\n                <CosmicParticles />\r\n                <InstructorLogin onLogin={setInstructorName} instructors={instructors} />\r\n            </>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div style={{ minHeight: '100vh', background: 'transparent', paddingBottom: '80px', position: 'relative' }}>\r\n            <CosmicParticles />\r\n            \r\n            {/* Header */}\r\n            <div style={{ background: 'rgba(20, 20, 25, 0.95)', padding: '16px 20px', display: 'flex', justifyContent: 'space-between', alignItems: 'center', borderBottom: '1px solid var(--border-color)', position: 'relative', zIndex: 2 }}>\r\n                <div>\r\n                    <h1 style={{ margin: 0, fontSize: '1.2rem', color: 'var(--primary-gold)' }}> </h1>\r\n                    <div style={{ margin: '4px 0 0', fontSize: '0.9rem', color: 'var(--text-secondary)' }}>{instructorName} </div>\r\n                </div>\r\n                <button onClick={handleLogout} style={{ background: 'none', border: 'none', cursor: 'pointer' }}>\r\n                    <SignOut size={24} color=\"var(--text-secondary)\" />\r\n                </button>\r\n            </div>\r\n\r\n            {/* AI Greeting (Top of Content) */}\r\n            <div style={{ \r\n                position: 'relative', zIndex: 1,\r\n                background: 'linear-gradient(135deg, rgba(212, 175, 55, 0.15) 0%, rgba(212, 175, 55, 0.05) 100%)', \r\n                padding: '16px 20px', \r\n                borderBottom: '1px solid rgba(212, 175, 55, 0.1)'\r\n            }}>\r\n                <div style={{ margin: 0, fontSize: '1rem', lineHeight: 1.5, color: 'var(--text-primary)', textAlign: 'center', fontStyle: 'italic' }}>\r\n                    &quot;{aiGreeting}&quot;\r\n                </div>\r\n                {/* [AI]   -     */}\r\n                {aiEnhancedGreeting && (\r\n                    <div style={{\r\n                        marginTop: '10px',\r\n                        padding: '10px 14px',\r\n                        background: 'rgba(212,175,55,0.08)',\r\n                        border: '1px solid rgba(212,175,55,0.2)',\r\n                        borderRadius: '12px',\r\n                        animation: 'slideUp 0.6s ease-out',\r\n                        display: 'flex',\r\n                        alignItems: 'flex-start',\r\n                        gap: '8px'\r\n                    }}>\r\n                        <span style={{ fontSize: '1rem', flexShrink: 0 }}></span>\r\n                        <span style={{\r\n                            fontSize: '0.9rem',\r\n                            color: 'rgba(255,255,255,0.85)',\r\n                            lineHeight: 1.5,\r\n                            fontWeight: 400,\r\n                            fontStyle: 'italic',\r\n                            wordBreak: 'keep-all'\r\n                        }}>\r\n                            {aiEnhancedGreeting}\r\n                        </span>\r\n                    </div>\r\n                )}\r\n                {/* [AI]   */}\r\n                {aiGreetingLoading && (\r\n                    <div style={{\r\n                        marginTop: '8px',\r\n                        display: 'flex',\r\n                        alignItems: 'center',\r\n                        justifyContent: 'center',\r\n                        gap: '8px',\r\n                        animation: 'fadeIn 0.3s ease-out'\r\n                    }}>\r\n                        <div className=\"ai-thinking-icon\" style={{ width: '16px', height: '16px', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>\r\n                            <svg width=\"14\" height=\"14\" viewBox=\"0 0 256 256\" fill=\"var(--primary-gold)\">\r\n                                <path d=\"M200,48H136V16a8,8,0,0,0-16,0V48H56A32,32,0,0,0,24,80v96a32,32,0,0,0,32,32h80v32a8,8,0,0,0,16,0V208h48a32,32,0,0,0,32-32V80A32,32,0,0,0,200,48ZM172,168H84a12,12,0,0,1,0-24h88a12,12,0,0,1,0,24Zm0-48H84a12,12,0,0,1,0-24h88a12,12,0,0,1,0,24Z\"/>\r\n                            </svg>\r\n                        </div>\r\n                        <span style={{\r\n                            color: 'rgba(212,175,55,0.7)',\r\n                            fontSize: '0.8rem',\r\n                            fontWeight: 400,\r\n                            animation: 'pulse 1.5s ease-in-out infinite'\r\n                        }}>\r\n                            AI    \r\n                        </span>\r\n                        <div style={{ display: 'flex', gap: '3px' }}>\r\n                            {[0, 1, 2].map(i => (\r\n                                <div key={i} style={{\r\n                                    width: '4px', height: '4px',\r\n                                    borderRadius: '50%',\r\n                                    background: 'var(--primary-gold)',\r\n                                    opacity: 0.6,\r\n                                    animation: `pulse 1.4s ease-in-out ${i * 0.2}s infinite`\r\n                                }} />\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* Content Area */}\r\n            <div style={{ position: 'relative', zIndex: 1, minHeight: 'calc(100vh - 220px)' }}>\r\n                {activeTab === 'home' && <InstructorHome instructorName={instructorName} attendance={attendance} attendanceLoading={attendanceLoading} instructorClasses={instructorClasses} />}\r\n                {activeTab === 'schedule' && <InstructorSchedule instructorName={instructorName} />}\r\n                {activeTab === 'notices' && <InstructorNotices />}\r\n            </div>\r\n\r\n            {/* Bottom Navigation */}\r\n            <div style={{\r\n                position: 'fixed', bottom: 0, left: 0, right: 0, background: 'var(--bg-surface)',\r\n                display: 'flex', justifyContent: 'space-around', padding: '8px 0', borderTop: '1px solid var(--border-color)',\r\n                zIndex: 10\r\n            }}>\r\n                <TabButton icon={<House size={24} />} label=\"\" active={activeTab === 'home'} onClick={() => setActiveTab('home')} />\r\n                <TabButton icon={<CalendarBlank size={24} />} label=\"\" active={activeTab === 'schedule'} onClick={() => setActiveTab('schedule')} />\r\n                <TabButton icon={<Bell size={24} />} label=\"\" active={activeTab === 'notices'} onClick={() => setActiveTab('notices')} />\r\n            </div>\r\n\r\n            <InstallGuideModal isOpen={showInstallGuide} onClose={() => setShowInstallGuide(false)} />\r\n        </div>\r\n    );\r\n};\r\n\r\nconst TabButton = ({ icon, label, active, onClick }) => (\r\n    <button\r\n        onClick={onClick}\r\n        style={{\r\n            background: 'none', \r\n            border: 'none', \r\n            display: 'flex', \r\n            flexDirection: 'column', \r\n            alignItems: 'center', \r\n            gap: '4px',\r\n            color: active ? 'var(--primary-gold)' : 'var(--text-secondary)', \r\n            cursor: 'pointer',\r\n            padding: '12px 20px',\r\n            minWidth: '64px',\r\n            touchAction: 'manipulation',\r\n            userSelect: 'none',\r\n            WebkitTapHighlightColor: 'transparent',\r\n            transition: 'transform 0.1s, opacity 0.1s'\r\n        }}\r\n    >\r\n        {icon}\r\n        <span style={{ fontSize: '0.75rem' }}>{label}</span>\r\n    </button>\r\n);\r\n\r\nconst navBtnStyle = {\r\n    background: 'var(--bg-input)', border: 'none', color: 'var(--text-primary)', width: '36px', height: '36px',\r\n    borderRadius: '50%', cursor: 'pointer', fontSize: '1rem'\r\n};\r\n\r\nexport default InstructorPage;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\pages\\LoginPage.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\pages\\MeditationPage.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'Icons' is defined but never used.","line":5,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":15,"suggestions":[{"messageId":"removeVar","data":{"varName":"Icons"},"fix":{"range":[211,261],"text":""},"desc":"Remove unused variable 'Icons'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'SPECIALIST_QUESTIONS' is defined but never used.","line":6,"column":83,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":103,"suggestions":[{"messageId":"removeVar","data":{"varName":"SPECIALIST_QUESTIONS"},"fix":{"range":[343,365],"text":""},"desc":"Remove unused variable 'SPECIALIST_QUESTIONS'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'AI_SESSION_MESSAGES' is defined but never used.","line":6,"column":105,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":124,"suggestions":[{"messageId":"removeVar","data":{"varName":"AI_SESSION_MESSAGES"},"fix":{"range":[365,386],"text":""},"desc":"Remove unused variable 'AI_SESSION_MESSAGES'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'ChatDialog' is defined but never used.","line":18,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":18,"endColumn":20,"suggestions":[{"messageId":"removeVar","data":{"varName":"ChatDialog"},"fix":{"range":[1161,1229],"text":""},"desc":"Remove unused variable 'ChatDialog'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'PoseCanvas' is defined but never used.","line":19,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":19,"endColumn":20,"suggestions":[{"messageId":"removeVar","data":{"varName":"PoseCanvas"},"fix":{"range":[1231,1299],"text":""},"desc":"Remove unused variable 'PoseCanvas'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'storageService' is defined but never used.","line":24,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":24,"endColumn":24,"suggestions":[{"messageId":"removeVar","data":{"varName":"storageService"},"fix":{"range":[1621,1674],"text":""},"desc":"Remove unused variable 'storageService'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'setTtcEnabled' is assigned a value but never used.","line":86,"column":24,"nodeType":"Identifier","messageId":"unusedVar","endLine":86,"endColumn":37,"suggestions":[{"messageId":"removeVar","data":{"varName":"setTtcEnabled"},"fix":{"range":[4505,4520],"text":""},"desc":"Remove unused variable 'setTtcEnabled'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'ambientAudioRef' is assigned a value but never used.","line":141,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":141,"endColumn":24,"suggestions":[{"messageId":"removeVar","data":{"varName":"ambientAudioRef"},"fix":{"range":[6772,6798],"text":""},"desc":"Remove unused variable 'ambientAudioRef'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'stopBinauralBeats' is assigned a value but never used.","line":145,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":145,"endColumn":26,"suggestions":[{"messageId":"removeVar","data":{"varName":"stopBinauralBeats"},"fix":{"range":[6878,6906],"text":""},"desc":"Remove unused variable 'stopBinauralBeats'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'stopAmbientMusicAndReset' is assigned a value but never used.","line":149,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":149,"endColumn":33,"suggestions":[{"messageId":"removeVar","data":{"varName":"stopAmbientMusicAndReset"},"fix":{"range":[6991,7026],"text":""},"desc":"Remove unused variable 'stopAmbientMusicAndReset'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'stopVoiceOnly' is assigned a value but never used.","line":154,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":154,"endColumn":22,"suggestions":[{"messageId":"removeVar","data":{"varName":"stopVoiceOnly"},"fix":{"range":[7116,7140],"text":""},"desc":"Remove unused variable 'stopVoiceOnly'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'aiRequestLock' is assigned a value but never used.","line":160,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":160,"endColumn":22,"suggestions":[{"messageId":"removeVar","data":{"varName":"aiRequestLock"},"fix":{"range":[7327,7351],"text":""},"desc":"Remove unused variable 'aiRequestLock'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'aiPrescription' is assigned a value but never used.","line":165,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":165,"endColumn":23,"suggestions":[{"messageId":"removeVar","data":{"varName":"aiPrescription"},"fix":{"range":[7521,7546],"text":""},"desc":"Remove unused variable 'aiPrescription'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'setAiPrescription' is assigned a value but never used.","line":165,"column":25,"nodeType":"Identifier","messageId":"unusedVar","endLine":165,"endColumn":42,"suggestions":[{"messageId":"removeVar","data":{"varName":"setAiPrescription"},"fix":{"range":[7546,7565],"text":""},"desc":"Remove unused variable 'setAiPrescription'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'fetchAIFeedback' is assigned a value but never used.","line":174,"column":70,"nodeType":"Identifier","messageId":"unusedVar","endLine":174,"endColumn":85,"suggestions":[{"messageId":"removeVar","data":{"varName":"fetchAIFeedback"},"fix":{"range":[7921,7938],"text":""},"desc":"Remove unused variable 'fetchAIFeedback'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'setLastSpokenMessage' is assigned a value but never used.","line":199,"column":31,"nodeType":"Identifier","messageId":"unusedVar","endLine":199,"endColumn":51,"suggestions":[{"messageId":"removeVar","data":{"varName":"setLastSpokenMessage"},"fix":{"range":[8747,8769],"text":""},"desc":"Remove unused variable 'setLastSpokenMessage'."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'logDebug'. Either include it or remove the dependency array.","line":213,"column":8,"nodeType":"ArrayExpression","endLine":213,"endColumn":24,"suggestions":[{"desc":"Update the dependencies array to be: [step, prepStep, logDebug]","fix":{"range":[9408,9424],"text":"[step, prepStep, logDebug]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'logDebug', 'prepStep', 'setAiLatency', and 'step'. Either include them or remove the dependency array.","line":272,"column":8,"nodeType":"ArrayExpression","endLine":272,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [logDebug, prepStep, setAiLatency, step]","fix":{"range":[12137,12139],"text":"[logDebug, prepStep, setAiLatency, step]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has missing dependencies: 'audioContextRef', 'currentAudioRef', 'setAiMessage', 'setChatHistory', 'setIsAILoading', 'setNeedsFeedback', 'setPrescriptionReason', 'setSessionInfo', 'setWeatherContext', and 'stopAllAudio'. Either include them or remove the dependency array.","line":355,"column":8,"nodeType":"ArrayExpression","endLine":355,"endColumn":68,"suggestions":[{"desc":"Update the dependencies array to be: [currentAudioRef, stopAudioAnalysis, stopAllAudio, audioContextRef, activeMode, selectedDiagnosis, timeLeft, setChatHistory, setIsAILoading, setNeedsFeedback, setAiMessage, setPrescriptionReason, setWeatherContext, setSessionInfo]","fix":{"range":[15215,15275],"text":"[currentAudioRef, stopAudioAnalysis, stopAllAudio, audioContextRef, activeMode, selectedDiagnosis, timeLeft, setChatHistory, setIsAILoading, setNeedsFeedback, setAiMessage, setPrescriptionReason, setWeatherContext, setSessionInfo]"}}]},{"ruleId":"no-unused-vars","severity":1,"message":"'tf' is assigned a value but never used.","line":455,"column":30,"nodeType":"Identifier","messageId":"unusedVar","endLine":455,"endColumn":32,"suggestions":[{"messageId":"removeVar","data":{"varName":"tf"},"fix":{"range":[19502,19504],"text":""},"desc":"Remove unused variable 'tf'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'tfBackend' is assigned a value but never used.","line":455,"column":34,"nodeType":"Identifier","messageId":"unusedVar","endLine":455,"endColumn":43,"suggestions":[{"messageId":"removeVar","data":{"varName":"tfBackend"},"fix":{"range":[19504,19515],"text":""},"desc":"Remove unused variable 'tfBackend'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":1479,"column":92,"nodeType":"Identifier","messageId":"unusedVar","endLine":1479,"endColumn":95},{"ruleId":"no-unused-vars","severity":1,"message":"'breathingScale' is assigned a value but never used.","line":2005,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":2005,"endColumn":25}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'detectWeather'. Either include it or remove the dependency array.","line":529,"column":8,"nodeType":"ArrayExpression","endLine":529,"endColumn":21,"suggestions":[{"desc":"Update the dependencies array to be: [detectWeather, stopSession]","fix":{"range":[22229,22242],"text":"[detectWeather, stopSession]"}}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'currentAIChat' and 'fetchAIQuestion'. Either include them or remove the dependency array.","line":538,"column":8,"nodeType":"ArrayExpression","endLine":538,"endColumn":34,"suggestions":[{"desc":"Update the dependencies array to be: [step, chatHistory.length, currentAIChat, fetchAIQuestion]","fix":{"range":[22625,22651],"text":"[step, chatHistory.length, currentAIChat, fetchAIQuestion]"}}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'setAiRequestLock', 'setCurrentAIChat', 'setIsAILoading', and 'setNeedsFeedback'. Either include them or remove the dependency array.","line":612,"column":8,"nodeType":"ArrayExpression","endLine":612,"endColumn":112,"suggestions":[{"desc":"Update the dependencies array to be: [step, needsFeedback, ttcEnabled, speakFallback, memberName, sessionInfo, timeContext, playAudio, speak, setAiRequestLock, setIsAILoading, setCurrentAIChat, setNeedsFeedback]","fix":{"range":[25922,26026],"text":"[step, needsFeedback, ttcEnabled, speakFallback, memberName, sessionInfo, timeContext, playAudio, speak, setAiRequestLock, setIsAILoading, setCurrentAIChat, setNeedsFeedback]"}}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has missing dependencies: 'setChatHistory' and 'stopSession'. Either include them or remove the dependency array.","line":916,"column":8,"nodeType":"ArrayExpression","endLine":916,"endColumn":47,"suggestions":[{"desc":"Update the dependencies array to be: [chatHistory.length, setChatHistory, ttcEnabled, speak, stopSession]","fix":{"range":[37737,37776],"text":"[chatHistory.length, setChatHistory, ttcEnabled, speak, stopSession]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":23,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useRef, useCallback } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { httpsCallable } from 'firebase/functions';\r\nimport { functions } from '../firebase';\r\nimport { Icons } from '../components/CommonIcons';\r\nimport { MEDITATION_MODES, INTERACTION_TYPES, DIAGNOSIS_OPTIONS, WEATHER_OPTIONS, SPECIALIST_QUESTIONS, AI_SESSION_MESSAGES, AMBIENT_SOUNDS, MEDITATION_INTENTIONS, MEDITATION_CATEGORIES } from '../constants/meditationConstants';\r\n\r\n//  AI Posture Analysis (MediaPipe) - Loaded Dynamically\r\n// import { Pose } from '@mediapipe/pose'; // REMOVED: Dynamic import used instead\r\n// import * as tf from '@tensorflow/tfjs-core'; // REMOVED: Dynamic import used instead\r\n// import '@tensorflow/tfjs-backend-webgl'; // REMOVED: Dynamic import used instead\r\n\r\nimport { useAudioAnalyzer } from '../hooks/useAudioAnalyzer';\r\nimport { useMeditationAudio } from '../hooks/useMeditationAudio';\r\nimport { useMeditationAI } from '../hooks/useMeditationAI';\r\nimport { useWeatherAwareness } from '../hooks/useWeatherAwareness';\r\nimport { AILoadingIndicator } from '../components/meditation/ui/AILoadingIndicator';\r\nimport { ChatDialog } from '../components/meditation/ui/ChatDialog';\r\nimport { PoseCanvas } from '../components/meditation/ui/PoseCanvas';\r\nimport { VolumeControlPanel } from '../components/meditation/ui/VolumeControlPanel';\r\nimport { FeedbackView } from '../components/meditation/ui/FeedbackView';\r\nimport { MeditationDebugOverlay } from '../components/meditation/MeditationDebugOverlay';\r\nimport { Icons as PhosphorIcons } from '../components/CommonIcons';\r\nimport { storageService } from '../services/storage';\r\nconst { \r\n    Play, Pause, X, Wind, SpeakerHigh, SpeakerSlash, Brain, Microphone, VideoCamera, \r\n    LockKey, Heartbeat, SmileySad, Lightning, Barbell, Sparkle, Sun, CloudRain, \r\n    CloudSnow, Cloud\r\n} = PhosphorIcons;\r\n\r\n// [HOTFIX] Local ArrowLeft to prevent 'Ar' ReferenceError\r\nconst ArrowLeft = ({ size = 24, color = \"currentColor\" }) => (\r\n    <svg width={size} height={size} viewBox=\"0 0 256 256\" fill={color}>\r\n        <path d=\"M224,128a8,8,0,0,1-8,8H59.31l58.35,58.34a8,8,0,0,1-11.32,11.32l-72-72a8,8,0,0,1,0-11.32l72-72a8,8,0,0,1,11.32,11.32L59.31,120H216A8,8,0,0,1,224,128Z\" />\r\n    </svg>\r\n);\r\n\r\nconst ArrowUp = ({ size = 24, color = \"currentColor\" }) => (\r\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width={size} height={size} fill={color} viewBox=\"0 0 256 256\">\r\n        <path d=\"M213.66,122.34a8,8,0,0,1-11.32,0L136,56v152a8,8,0,0,1-16,0V56L53.66,122.34a8,8,0,0,1-11.32-11.32l80-80a8,8,0,0,1,11.32,0l80,80A8,8,0,0,1,213.66,122.34Z\"></path>\r\n    </svg>\r\n);\r\n\r\nconst ICON_MAP = {\r\n    Wind, Brain, Sparkle, Microphone, VideoCamera, Lightning, Barbell, Heartbeat, SmileySad, Sun, CloudRain, CloudSnow, Cloud\r\n};\r\n\r\n// Initialize Firebase Functions\r\nconst generateMeditationGuidance = httpsCallable(functions, 'generateMeditationGuidance');\r\n\r\nconst SELECTED_DIAGNOSIS_FALLBACK = DIAGNOSIS_OPTIONS[0];\r\n\r\n\r\nconst MeditationPage = ({ onClose }) => {\r\n    const navigate = useNavigate();\r\n    \r\n    // Stable Refs for cleanup without re-triggering effects\r\n    const cameraStreamRef = useRef(null);\r\n    const isPlayingRef = useRef(false); //      Ref ( )\r\n    const [step, setStep] = useState('initial_prep'); //     \r\n    \r\n    // Context State\r\n    const [timeContext, setTimeContext] = useState('morning');\r\n    const { weatherContext, setWeatherContext, detectWeather } = useWeatherAwareness();\r\n    const [selectedDiagnosis, setSelectedDiagnosis] = useState(null);\r\n    const [selectedIntention, setSelectedIntention] = useState(null); //   \r\n    const [selectedCategory, setSelectedCategory] = useState(null); //    (/)\r\n\r\n    // Session Settings\r\n    const [activeMode, setActiveMode] = useState(null); \r\n    const [interactionType, setInteractionType] = useState('v1');\r\n    \r\n    //  Visual Theme (Randomized)\r\n    const [visualTheme, setVisualTheme] = useState('heartbeat'); \r\n    \r\n    useEffect(() => {\r\n        const themes = ['heartbeat', 'candle', 'rain', 'snow'];\r\n        const randomTheme = themes[Math.floor(Math.random() * themes.length)];\r\n        setVisualTheme(randomTheme);\r\n        console.log(` [Visual Theme] Selected: ${randomTheme}`);\r\n    }, []);\r\n\r\n    const [isPlaying, setIsPlaying] = useState(false);\r\n    const [timeLeft, setTimeLeft] = useState(0);\r\n    const [soundEnabled, setSoundEnabled] = useState(true); \r\n    const [ttcEnabled, setTtcEnabled] = useState(true); // TTC (Text To Calm) Voice Guidance - Default ON\r\n    const [selectedAmbient, setSelectedAmbient] = useState('rain'); //  Default to 'rain' (User Request: Calm music from start)\r\n    const [audioVolumes, setAudioVolumes] = useState({\r\n        voice: 0.8,    //    ( 1)\r\n        ambient: 0.35, //   ()\r\n        binaural: 0.1  //    ( -  )\r\n    });\r\n    \r\n    // Audio/Video State\r\n    const { micVolume, setupAudioAnalysis, stopAudioAnalysis, pauseAudioAnalysis, resumeAudioAnalysis } = useAudioAnalyzer();\r\n\r\n    const [permissionError, setPermissionError] = useState(null);\r\n    const [cameraStream, setCameraStream] = useState(null);\r\n    const [showVolumePanel, setShowVolumePanel] = useState(false); //  Phase 3:   \r\n    const [showVolumeHint, setShowVolumeHint] = useState(false); //    \r\n\r\n    //  REAL-TIME AI States\r\n    const [memberName] = useState(() => {\r\n        try {\r\n            const stored = localStorage.getItem('member');\r\n            if (stored) {\r\n                const member = JSON.parse(stored);\r\n                return member.name || \"\";\r\n            }\r\n        } catch (e) {\r\n            console.warn(\"Failed to load member name\", e);\r\n        }\r\n        return \"\";\r\n    });\r\n\r\n    //  DEBUG MODE STATES (User Request)\r\n    const [isDebugMode, setIsDebugMode] = useState(false); //  Default to false (User: Record internally only)\r\n    const [, setDebugClickCount] = useState(0);\r\n    const [ttsState, setTtsState] = useState({ isSpeaking: false, engine: 'None', volume: 0 });\r\n\r\n    const handleDebugToggle = useCallback(() => {\r\n        setDebugClickCount(prev => {\r\n            const next = prev + 1;\r\n            if (next >= 5) {\r\n                setIsDebugMode(v => !v);\r\n                return 0;\r\n            }\r\n            return next;\r\n        });\r\n    }, []);\r\n\r\n    //  DEBUG LOGGING SYSTEM (User Request)\r\n    const logDebug = useCallback((action, data) => {\r\n        const timestamp = new Date().toLocaleTimeString();\r\n        console.log(`%c[MeditationDebug] ${timestamp} [${action}]`, 'color: #00ffff; font-weight: bold;', data || '');\r\n    }, []);\r\n\r\n    //  Extract Audio System hook\r\n    const {\r\n        audioContextRef,\r\n        ambientAudioRef,\r\n        currentAudioRef,\r\n        getAudioContext,\r\n        playBinauralBeats,\r\n        stopBinauralBeats,\r\n        updateBinauralVolume,\r\n        playAmbientMusic,\r\n        stopAmbientMusic,\r\n        stopAmbientMusicAndReset,\r\n        updateAmbientVolume,\r\n        playAudio,\r\n        speak,\r\n        speakFallback,\r\n        stopVoiceOnly,\r\n        stopAllAudio\r\n    } = useMeditationAudio(ttcEnabled, isPlayingRef, step, logDebug, setTtsState, audioVolumes, soundEnabled);\r\n\r\n    const {\r\n        isAILoading, setIsAILoading,\r\n        aiRequestLock, setAiRequestLock,\r\n        aiLatency, setAiLatency,\r\n        chatHistory, setChatHistory,\r\n        currentAIChat, setCurrentAIChat,\r\n        manualInput, setManualInput,\r\n        aiPrescription, setAiPrescription,\r\n        prescriptionReason, setPrescriptionReason,\r\n        aiMessage, setAiMessage,\r\n        sessionInfo, setSessionInfo,\r\n        feedbackData, setFeedbackData,\r\n        needsFeedback, setNeedsFeedback,\r\n        \r\n        messageIndexRef, sessionDiagnosisRef, consecutiveFailsRef,\r\n\r\n        fetchAIPrescription, fetchAIQuestion, fetchAISessionMessage, fetchAIFeedback,\r\n        handleChatResponse, handleManualSubmit, handleReturnToChat, generateReason\r\n    } = useMeditationAI({\r\n        memberName, \r\n        timeContext, \r\n        selectedIntention, \r\n        activeMode, \r\n        interactionType, \r\n        micVolume, \r\n        isPlayingRef, \r\n        ttcEnabled,\r\n        stopAllAudio, \r\n        playAudio, \r\n        speak,\r\n        onExit: () => { stopAllAudio(); if (onClose) onClose(); else navigate('/'); },\r\n        onMeditationReady: (diag, defaultMode, intType) => {\r\n            stopAllAudio();\r\n            setSelectedDiagnosis(diag);\r\n            setActiveMode(defaultMode);\r\n            setTimeLeft(defaultMode.time);\r\n            setInteractionType(intType);\r\n            setStep('interaction_select');\r\n        }\r\n    });\r\n    \r\n    const [lastSpokenMessage, setLastSpokenMessage] = useState(\"\"); // debug overlay\r\n    \r\n    //  Dynamic Options State (AI Generated)\r\n    const [dynamicCategories, setDynamicCategories] = useState(MEDITATION_CATEGORIES);\r\n    const [dynamicIntentions, setDynamicIntentions] = useState(MEDITATION_INTENTIONS);\r\n    const [isOptionsLoading, setIsOptionsLoading] = useState(true); //  Start with meditative loading\r\n\r\n    // [MOVED TO TOP] Debug & Audio Hooks\r\n    //  Preparation Flow States\r\n    const [prepStep, setPrepStep] = useState(1); \r\n    \r\n    //  Log Step Change for shared visibility\r\n    useEffect(() => {\r\n        logDebug(\"StepChange\", { step, prepStep });\r\n    }, [step, prepStep]);\r\n\r\n    const [prepSelections, setPrepSelections] = useState({\r\n        notified: false,\r\n        posture: 'chair', // 'chair', 'floor', 'lying'\r\n        goal: null\r\n    });\r\n\r\n    //  Initial AI Options Fetch\r\n    useEffect(() => {\r\n        logDebug(\"Mount\", { step, prepStep });\r\n        \r\n        const fetchOptions = async () => {\r\n            try {\r\n                // Time Context\r\n                const hour = new Date().getHours();\r\n                const tCtx = (hour >= 5 && hour < 11) ? 'morning' : \r\n                             (hour >= 18 || hour < 5) ? 'evening' : 'day';\r\n                setTimeContext(tCtx);\r\n                logDebug(\"TimeContext\", { tCtx });\r\n\r\n                // Fetch Dynamic Options\r\n                logDebug(\"FetchOptions:Start\");\r\n                const startTime = Date.now();\r\n                const result = await generateMeditationGuidance({ \r\n                    type: 'options_refresh', \r\n                    timeContext: tCtx,\r\n                    weather: 'unknown' // Client-side weather can be added if needed\r\n                });\r\n                setAiLatency(Date.now() - startTime);\r\n                logDebug(\"FetchOptions:Result\", result.data);\r\n\r\n                if (result.data) {\r\n                    if (result.data.categories && Array.isArray(result.data.categories)) {\r\n                        // Merge with constants to keep emojis/IDs but update labels\r\n                        const mergedCats = MEDITATION_CATEGORIES.map(c => {\r\n                            const dyn = result.data.categories.find(d => d.id === c.id);\r\n                            return dyn ? { ...c, label: dyn.label, description: dyn.description } : c;\r\n                        });\r\n                        setDynamicCategories(mergedCats);\r\n                    }\r\n                    if (result.data.intentions && Array.isArray(result.data.intentions)) {\r\n                        const mergedInts = MEDITATION_INTENTIONS.map(i => {\r\n                            const dyn = result.data.intentions.find(d => d.id === i.id);\r\n                            return dyn ? { ...i, label: dyn.label } : i;\r\n                        });\r\n                        setDynamicIntentions(mergedInts);\r\n                    }\r\n                }\r\n            } catch (error) {\r\n                console.error(\"Failed to fetch dynamic options:\", error);\r\n                logDebug(\"FetchOptions:Error\", error);\r\n                // Fallback to constants (already set as default)\r\n            } finally {\r\n                //  Minimum loading time for meditative feel (2s)\r\n                setTimeout(() => setIsOptionsLoading(false), 2000);\r\n            }\r\n        };\r\n        fetchOptions();\r\n    }, []);\r\n\r\n\r\n    // V3 Pose States\r\n    const [, setPoseData] = useState(null); //   \r\n    const [, setIsPoseLoading] = useState(false);\r\n    const [, setAlignmentScore] = useState(100); // 0-100  \r\n    \r\n    // Canvas Refs for Golden Skeleton\r\n    const canvasRef = useRef(null);\r\n    const poseRef = useRef(null); // MediaPipe Pose Instance Ref\r\n\r\n    // Refs\r\n    const timerRef = useRef(null);\r\n    const messageIntervalRef = useRef(null);\r\n    const videoRef = useRef(null);\r\n    const chatEndRef = useRef(null); // Fixed: Missing Ref\r\n    \r\n    // [MOVED TO TOP] Extra Audio System hooks\r\n    // Stop Session (useCallback for stability - removed stream dependency to fix V3 crash)\r\n    const stopSession = useCallback((stopAmbient = false) => {\r\n        //  STOP AI AUDIO (Fixed Bug)\r\n        if (currentAudioRef.current) {\r\n            currentAudioRef.current.pause();\r\n            currentAudioRef.current.currentTime = 0;\r\n            currentAudioRef.current = null; \r\n        }\r\n\r\n        clearInterval(timerRef.current); \r\n        clearInterval(messageIntervalRef.current);\r\n        // Stop Audio Analyzer Hook\r\n        stopAudioAnalysis();\r\n        \r\n        // Use Global Audio Manager\r\n        stopAllAudio(stopAmbient);\r\n        \r\n        // Use Ref for camera cleanup\r\n        if (cameraStreamRef.current) { \r\n            cameraStreamRef.current.getTracks().forEach(track => track.stop()); \r\n            cameraStreamRef.current = null;\r\n            setCameraStream(null); \r\n        }\r\n\r\n        if (audioContextRef.current) { audioContextRef.current.close().catch(e => console.error(e)); audioContextRef.current = null; }\r\n\r\n        if (poseRef.current) {\r\n            poseRef.current.close(); \r\n            poseRef.current = null;\r\n        }\r\n\r\n        //  Save session info before clearing (for feedback AI)\r\n        const currentMode = activeMode;\r\n        const currentDiag = selectedDiagnosis;\r\n        const elapsedTime = currentMode ? (currentMode.time - timeLeft) : 0;\r\n        \r\n        setIsPlaying(false);\r\n        isPlayingRef.current = false; //  Ref \r\n        setStep('diagnosis');\r\n        setPrepStep(1); // Reset prep\r\n        \r\n        // Save session info for feedback\r\n        if (currentMode) {\r\n            setSessionInfo({\r\n                mode: currentMode.id,\r\n                modeName: currentMode.label,\r\n                duration: elapsedTime,\r\n                diagnosis: currentDiag?.id\r\n            });\r\n        }\r\n        \r\n        //  [FIX]     (  )\r\n        setActiveMode(null);\r\n        setSelectedDiagnosis(null);\r\n        setSelectedIntention(null);\r\n        setSelectedCategory(null);\r\n        setChatHistory([]);\r\n        setIsAILoading(false); \r\n        setNeedsFeedback(true); //  Signal that we need to show feedback greeting\r\n        console.log(\" stopSession: needsFeedback set to true, step to diagnosis\");\r\n        setAiMessage(\"\");\r\n        setPrescriptionReason('');\r\n        setWeatherContext(null);\r\n        if (window.speechSynthesis) window.speechSynthesis.cancel();\r\n    }, [activeMode, selectedDiagnosis, timeLeft, stopAudioAnalysis]); \r\n\r\n    //  Stability Analysis Refs\r\n    const stabilityHistoryRef = useRef([]); // Stores {score, timestamp}\r\n    const postureIssuesRef = useRef(new Set()); // Stores detected issues (e.g., \"leaning_left\")\r\n\r\n    //  Draw Skeleton on Canvas (V3)\r\n    const onPoseResults = useCallback((results) => {\r\n        if (!results.poseLandmarks || !canvasRef.current || !videoRef.current) return;\r\n        \r\n        const canvas = canvasRef.current;\r\n        const ctx = canvas.getContext('2d');\r\n        const { width, height } = canvas;\r\n        \r\n        ctx.clearRect(0, 0, width, height);\r\n        \r\n        //  Draw Golden Skeleton\r\n        ctx.strokeStyle = '#d4af37'; // Gold\r\n        ctx.lineWidth = 4;\r\n        ctx.lineJoin = 'round';\r\n        ctx.lineCap = 'round';\r\n        ctx.shadowBlur = 10;\r\n        ctx.shadowColor = 'rgba(212, 175, 55, 0.5)';\r\n\r\n        const drawLine = (p1, p2) => {\r\n            if (!p1 || !p2 || p1.visibility < 0.5 || p2.visibility < 0.5) return;\r\n            ctx.beginPath();\r\n            ctx.moveTo(p1.x * width, p1.y * height);\r\n            ctx.lineTo(p2.x * width, p2.y * height);\r\n            ctx.stroke();\r\n        };\r\n\r\n        const landmarks = results.poseLandmarks;\r\n        \r\n        // Body Links (Simplified for Meditation)\r\n        drawLine(landmarks[11], landmarks[12]); // Shoulders\r\n        drawLine(landmarks[11], landmarks[23]); // Left Torso\r\n        drawLine(landmarks[12], landmarks[24]); // Right Torso\r\n        drawLine(landmarks[23], landmarks[24]); // Hips\r\n        drawLine(landmarks[11], landmarks[13]); // Left Arm\r\n        drawLine(landmarks[13], landmarks[15]);\r\n        drawLine(landmarks[12], landmarks[14]); // Right Arm\r\n        drawLine(landmarks[14], landmarks[16]);\r\n        \r\n        // Head (Simplified circle)\r\n        const nose = landmarks[0];\r\n        if (nose && nose.visibility > 0.5) {\r\n            ctx.beginPath();\r\n            ctx.arc(nose.x * width, nose.y * height, 10, 0, 2 * Math.PI);\r\n            ctx.stroke();\r\n        }\r\n\r\n        //  REAL-TIME STABILITY CALCULATION\r\n        if (nose && landmarks[11] && landmarks[12]) {\r\n            const leftShoulder = landmarks[11];\r\n            const rightShoulder = landmarks[12];\r\n            \r\n            // 1. Calculate Center of Shoulders\r\n            const shoulderCenterX = (leftShoulder.x + rightShoulder.x) / 2;\r\n            \r\n            // 2. Calculate Deviation (Nose vs Shoulder Center) - checks for leaning/sway\r\n            const deviation = Math.abs(nose.x - shoulderCenterX);\r\n            \r\n            // 3. Vertical alignment (Head drop check)\r\n            const shoulderY = (leftShoulder.y + rightShoulder.y) / 2;\r\n            const neckLength = Math.abs(nose.y - shoulderY);\r\n            \r\n            // 4. Score Calculation (0-100) - Simple inverse mapping\r\n            // Deviation > 0.1 is bad, < 0.02 is excellent\r\n            let currentScore = Math.max(0, 100 - (deviation * 500));\r\n            \r\n            // 5. Detect Issues\r\n            if (deviation > 0.08) {\r\n                if (nose.x < shoulderCenterX) postureIssuesRef.current.add(\"leaning_right\"); // Mirrored\r\n                else postureIssuesRef.current.add(\"leaning_left\");\r\n            }\r\n            if (neckLength < 0.15) { // Threshold depends on camera distance, heuristic\r\n                postureIssuesRef.current.add(\"head_drop\");\r\n            }\r\n\r\n            // 6. Smooth & Store\r\n            setAlignmentScore(prev => Math.round(prev * 0.9 + currentScore * 0.1));\r\n            stabilityHistoryRef.current.push({ score: currentScore, timestamp: Date.now() });\r\n\r\n            // Keep history manageable (last 5 mins max @ ~30fps is too much, keep last 1000 points?)\r\n            if (stabilityHistoryRef.current.length > 1000) stabilityHistoryRef.current.shift();\r\n        }\r\n\r\n        setPoseData(landmarks);\r\n    }, []);\r\n\r\n    //  AI Pose Initializer - DYNAMIC IMPORT\r\n    const initPoseEngine = useCallback(async () => {\r\n        if (!videoRef.current || poseRef.current) return;\r\n        \r\n        setIsPoseLoading(true);\r\n        try {\r\n            console.log(\" Loading AI Libraries Dynamically...\");\r\n            \r\n            // DYNAMIC IMPORTS\r\n            const [{ Pose }, tf, tfBackend] = await Promise.all([\r\n                import('@mediapipe/pose'),\r\n                import('@tensorflow/tfjs-core'),\r\n                import('@tensorflow/tfjs-backend-webgl')\r\n            ]);\r\n            \r\n            console.log(\" AI Libraries Loaded!\");\r\n\r\n            const pose = new Pose({\r\n                locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/pose@latest/${file}`,\r\n            });\r\n\r\n            pose.setOptions({\r\n                modelComplexity: 1,\r\n                smoothLandmarks: true,\r\n                enableSegmentation: false,\r\n                minDetectionConfidence: 0.5,\r\n                minTrackingConfidence: 0.5\r\n            });\r\n\r\n            pose.onResults(onPoseResults);\r\n            poseRef.current = pose;\r\n            \r\n            // Start detection loop\r\n            const detectFrame = async () => {\r\n                if (videoRef.current && poseRef.current && isPlaying) {\r\n                    await poseRef.current.send({ image: videoRef.current });\r\n                    if (isPlaying) requestAnimationFrame(detectFrame);\r\n                }\r\n            };\r\n            detectFrame();\r\n\r\n        } catch (error) {\r\n            console.error(\" Failed to load AI libraries:\", error);\r\n            setPermissionError(\"AI   .  .\");\r\n        } finally {\r\n            setIsPoseLoading(false);\r\n        }\r\n    }, [onPoseResults, isPlaying]);\r\n\r\n\r\n    // Initial Load with Auto Weather Detection\r\n    // ==========================================\r\n    //  REAL-TIME AI API CALLS (Hoisted Helpers - TDZ Fix)\r\n    // ==========================================\r\n    //  stopAllAudio useRef    \r\n    //  NEW: Stop Voice Only (preserves ambient & binaural)\r\n    const stopVoiceOnlyRef = useRef(null);\r\n    stopVoiceOnlyRef.current = () => {\r\n         if (typeof window !== 'undefined' && window.speechSynthesis) window.speechSynthesis.cancel();\r\n         // Cloud TTS Audio\r\n         if (currentAudioRef.current) {\r\n            try { currentAudioRef.current.pause(); currentAudioRef.current.currentTime = 0; } catch { /* ignore */ }\r\n            currentAudioRef.current = null;\r\n        }\r\n    };\r\n\r\n    //  Cleanup on Unmount\r\n    useEffect(() => {\r\n        const hour = new Date().getHours();\r\n        let context = 'morning';\r\n        if (hour >= 5 && hour < 12) context = 'morning';\r\n        else if (hour >= 12 && hour < 18) context = 'afternoon';\r\n        else context = 'night';\r\n        \r\n        setTimeContext(context);\r\n        \r\n\r\n\r\n        //  AUTO WEATHER DETECTION\r\n        detectWeather();\r\n\r\n        return () => { stopSession(); };\r\n        // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    }, [stopSession]);\r\n\r\n    //  Initial AI Question Load: Immediate Fetch (All AI)\r\n    useEffect(() => {\r\n        // [FIX] Removed !isAILoading ensure fetch triggers even if initialized as loading\r\n        if (step === 'diagnosis' && chatHistory.length === 0 && !currentAIChat) {\r\n             fetchAIQuestion(); \r\n        }\r\n        // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    }, [step, chatHistory.length]);\r\n\r\n    //  SESSION END FEEDBACK GREETING (Rock-solid trigger)\r\n    useEffect(() => {\r\n        console.log(` Feedback Effect check: step=${step}, needsFeedback=${needsFeedback}`);\r\n        if (step === 'diagnosis' && needsFeedback) {\r\n            console.log(\" Session Ended - Injecting Feedback Greeting for:\", memberName);\r\n            \r\n            //    (AI  )\r\n            const hour = new Date().getHours();\r\n            let fallbackMsg;\r\n            if (hour >= 5 && hour < 12) {\r\n                fallbackMsg = `${memberName},   ?       .     ?`;\r\n            } else if (hour >= 12 && hour < 18) {\r\n                fallbackMsg = `${memberName},  ?      .     ?`;\r\n            } else {\r\n                fallbackMsg = `${memberName},   ?    .     ?`;\r\n            }\r\n            \r\n            //  Clean up state\r\n            setAiRequestLock(false);\r\n            setIsAILoading(false);\r\n            \r\n            //    \r\n            setCurrentAIChat({\r\n                message: fallbackMsg,\r\n                options: [\",  \", \", \"]\r\n            });\r\n            \r\n            //  AI    ()\r\n            if (sessionInfo) {\r\n                (async () => {\r\n                    try {\r\n                        const feedbackResult = await generateMeditationGuidance({\r\n                            type: 'feedback_message',\r\n                            memberName: memberName,\r\n                            timeContext: timeContext,\r\n                            modeName: sessionInfo.modeName,\r\n                            duration: sessionInfo.duration,\r\n                            diagnosis: sessionInfo.diagnosis\r\n                        });\r\n                        \r\n                        if (feedbackResult.data?.message) {\r\n                            const aiMsg = feedbackResult.data.message.replace(/OO/g, `${memberName}`);\r\n                            setCurrentAIChat({\r\n                                message: aiMsg,\r\n                                options: [\" \"] //  \" ?\"  \" \"\r\n                            });\r\n                            \r\n                            // AI  \r\n                            if (feedbackResult.data.audioContent) {\r\n                                playAudio(feedbackResult.data.audioContent);\r\n                            } else if (ttcEnabled) {\r\n                                speak(aiMsg);\r\n                            }\r\n                        }\r\n                    } catch (err) {\r\n                        console.error('Feedback message AI failed, using fallback:', err);\r\n                        //   \r\n                        if (ttcEnabled) {\r\n                            speakFallback(fallbackMsg);\r\n                        }\r\n                    }\r\n                })();\r\n            } else {\r\n                //     TTS\r\n                if (ttcEnabled) {\r\n                    speakFallback(fallbackMsg);\r\n                }\r\n            }\r\n            \r\n            setNeedsFeedback(false); // Reset flag\r\n        }\r\n        // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    }, [step, needsFeedback, ttcEnabled, speakFallback, memberName, sessionInfo, timeContext, playAudio, speak]);\r\n\r\n\r\n    useEffect(() => {\r\n        if (cameraStream && videoRef.current) {\r\n            videoRef.current.srcObject = cameraStream;\r\n        }\r\n    }, [cameraStream]);\r\n\r\n    useEffect(() => {\r\n        // 1. Binaural Beats Volume\r\n        updateBinauralVolume(soundEnabled ? audioVolumes.binaural : 0);\r\n        // 2. Ambient Audio Volume\r\n        updateAmbientVolume(soundEnabled ? audioVolumes.ambient : 0);\r\n    }, [soundEnabled, audioVolumes, updateBinauralVolume, updateAmbientVolume]);\r\n\r\n    //  Global Ambient Audio Manager\r\n    useEffect(() => {\r\n        const activeAmbientSteps = ['prescription_summary', 'interaction_select', 'prescription', 'preparation', 'session'];\r\n        const shouldPlay = (isPlaying || activeAmbientSteps.includes(step)) && soundEnabled;\r\n\r\n        if (shouldPlay) {\r\n            const ambientDef = AMBIENT_SOUNDS.find(s => s.id === selectedAmbient);\r\n            playAmbientMusic(ambientDef, audioVolumes.ambient);\r\n        } else {\r\n            stopAmbientMusic();\r\n        }\r\n    }, [selectedAmbient, isPlaying, soundEnabled, audioVolumes.ambient, step, playAmbientMusic, stopAmbientMusic]);\r\n\r\n\r\n\r\n\r\n\r\n    const startMessageLoop = () => {\r\n        if (messageIntervalRef.current) clearInterval(messageIntervalRef.current);\r\n        \r\n        //     \r\n        consecutiveFailsRef.current = 0;\r\n        \r\n        // First message - try AI\r\n        fetchAISessionMessage();\r\n        \r\n        //   :  20,    35 \r\n        messageIntervalRef.current = setInterval(() => {\r\n            //   3    \r\n            if (consecutiveFailsRef.current >= 3) {\r\n                clearInterval(messageIntervalRef.current);\r\n                console.log('[Session] AI    35  ');\r\n                messageIntervalRef.current = setInterval(() => {\r\n                    fetchAISessionMessage();\r\n                }, 35000);\r\n            }\r\n            fetchAISessionMessage();\r\n        }, 20000);\r\n    };\r\n\r\n    //  TTS Wrapper (Consolidated)\r\n    // Removed auto-speak useEffect to prevent duplicate audio with Cloud TTS\r\n\r\n    // Auto-scroll to bottom of chat\r\n    useEffect(() => {\r\n        if (step === 'diagnosis' && chatEndRef.current) {\r\n            chatEndRef.current.scrollIntoView({ behavior: 'smooth' });\r\n        }\r\n    }, [chatHistory, isAILoading, currentAIChat, step]);\r\n\r\n\r\n\r\n    // --- Flow Handlers ---\r\n    const handleDiagnosisSelect = async (option) => {\r\n        setSelectedDiagnosis(option);\r\n        \r\n        // Get mode from diagnosis prescription\r\n        const mode = MEDITATION_MODES.find(m => m.id === option.prescription.modeId);\r\n        const intType = option.prescription.type;\r\n        \r\n        setActiveMode(mode);\r\n        setInteractionType(intType);\r\n        \r\n        // Weather is already auto-detected - use it directly\r\n        const weather = weatherContext || { id: 'sun', temp: 20, humidity: 50 };\r\n        \r\n        // Set fallback reason first\r\n        const fallbackReason = generateReason(timeContext, weather.id, option.id);\r\n        setPrescriptionReason(fallbackReason);\r\n        \r\n        // Then fetch real-time AI prescription\r\n        fetchAIPrescription(option.id, weather.id, mode.id, intType, \"\");\r\n        \r\n        // Skip weather step - go directly to prescription\r\n        setStep('prescription');\r\n    };\r\n\r\n    const handleWeatherSelect = async (weatherOption) => {\r\n        setWeatherContext(weatherOption);\r\n        \r\n        // Get AI prescription mode from diagnosis\r\n        const mode = MEDITATION_MODES.find(m => m.id === selectedDiagnosis.prescription.modeId);\r\n        const intType = selectedDiagnosis.prescription.type;\r\n        \r\n        setActiveMode(mode);\r\n        setInteractionType(intType);\r\n        \r\n        // Set local fallback first\r\n        const fallbackReason = generateReason(timeContext, weatherOption.id, selectedDiagnosis.id);\r\n        setPrescriptionReason(fallbackReason);\r\n        \r\n        // Then try to get real-time AI prescription (async, will update if successful)\r\n        fetchAIPrescription(selectedDiagnosis.id, weatherOption.id, mode.id, intType, \"\");\r\n        \r\n        setStep('prescription');\r\n    };\r\n\r\n\r\n\r\n    const startFromPrescription = () => {\r\n         logDebug(\"Flow:StartFromPrescription\");\r\n         setStep('preparation');\r\n         setPrepStep(3); //  Start with Posture Guide (New Flow)\r\n    };\r\n\r\n    // --- Session Logic ---\r\n    const startSession = async (mode) => {\r\n        setStep('session');\r\n        setPermissionError(null);\r\n        \r\n        //  FIX:       ref \r\n        sessionDiagnosisRef.current = selectedDiagnosis?.id || null;\r\n        messageIndexRef.current = 0;\r\n\r\n        \r\n        //       ( )\r\n        setShowVolumeHint(true);\r\n        setTimeout(() => setShowVolumeHint(false), 5000);\r\n        \r\n        const audioCtx = getAudioContext();\r\n\r\n        //  Always ensure AudioContext is ACTIVE\r\n        if (audioCtx.state === 'suspended') {\r\n            await audioCtx.resume();\r\n        }\r\n\r\n        // Binaural Beats\r\n        const initialVolume = soundEnabled ? audioVolumes.binaural : 0;\r\n        playBinauralBeats(200, mode.freq, initialVolume);\r\n\r\n        // Sensors\r\n        if (interactionType === 'v2') {\r\n            try {\r\n                const stream = await navigator.mediaDevices.getUserMedia({ \r\n                    audio: { echoCancellation: true, noiseSuppression: true, autoGainControl: true } \r\n                });\r\n                setupAudioAnalysis(stream, audioCtx);\r\n            } catch (err) {\r\n                console.error(\"Mic Error:\", err);\r\n                setPermissionError(\"  .\");\r\n                stopSession();\r\n                return;\r\n            }\r\n        } else if (interactionType === 'v3') {\r\n            try {\r\n                // AudioContext resumed above already\r\n                \r\n                const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' } });\r\n                cameraStreamRef.current = stream; // Update Ref\r\n                setCameraStream(stream);\r\n                initPoseEngine(); // Call (MOCKED) engine\r\n            } catch (err) {\r\n                console.error(\"Camera Error:\", err);\r\n                setPermissionError(\"  .    .\");\r\n                // Give user a moment to see the error before stopping\r\n                setTimeout(() => stopSession(), 3000);\r\n                return;\r\n            }\r\n        }\r\n\r\n        //  Ambient Sound is now handled by global useEffect\r\n        if (selectedAmbient === 'none') {\r\n             console.log(` [Audio Debug] No ambient sound selected (mode: 'none')`);\r\n        } else {\r\n             console.log(` [Audio Debug] Ambient '${selectedAmbient}' managing globally`);\r\n        }\r\n\r\n\r\n        setTimeLeft(mode.time);\r\n        setIsPlaying(true);\r\n        isPlayingRef.current = true; //  Misting Ref Update Fix\r\n\r\n        //  Opening Message - Phase 4 Pre-intro Logic\r\n        //  Opening Message - Phase 4 Pre-intro Logic\r\n        const getPreIntro = () => {\r\n             if (selectedIntention?.label) {\r\n                 return ` '${selectedIntention.label}'()  ,   .`;\r\n             }\r\n             return \"   ,    .\";\r\n        };\r\n        \r\n        const introMessage = getPreIntro();\r\n        setAiMessage(introMessage);\r\n        \r\n        \r\n        //  TTC Voice for Pre-intro - Cloud TTS (High Quality)\r\n        if (ttcEnabled) {\r\n            (async () => {\r\n                try {\r\n                    const introTTS = await generateMeditationGuidance({\r\n                        type: 'session_message',\r\n                        memberName: memberName,\r\n                        timeContext: timeContext,\r\n                        message: introMessage,\r\n                        messageIndex: 0\r\n                    });\r\n                    \r\n                    //  [FIX]        \r\n                    if (isPlayingRef.current) {\r\n                        if (introTTS.data?.message) {\r\n                            //  AI       (  )\r\n                            const finalIntroMsg = introTTS.data.message.replace(/OO/g, `${memberName}`);\r\n                            setAiMessage(finalIntroMsg);\r\n                        }\r\n\r\n                        if (introTTS.data?.audioContent) {\r\n                            playAudio(introTTS.data.audioContent);\r\n                        } else {\r\n                            // Fallback: Browser TTS\r\n                            speak(introMessage);\r\n                        }\r\n                    }\r\n                } catch (err) {\r\n                    console.error('Intro TTS failed:', err);\r\n                    if (isPlayingRef.current) speak(introMessage);\r\n                }\r\n            })();\r\n        }\r\n        \r\n        startTimer();\r\n        \r\n        // Delay the first AI session message to let pre-intro breathe\r\n        setTimeout(() => {\r\n            startMessageLoop();\r\n        }, 8000);\r\n    };\r\n\r\n\r\n\r\n    const startTimer = () => {\r\n        if (timerRef.current) clearInterval(timerRef.current);\r\n        timerRef.current = setInterval(() => {\r\n            setTimeLeft((prev) => {\r\n                if (prev <= 1) { completeSession(); return 0; }\r\n                return prev - 1;\r\n            });\r\n        }, 1000);\r\n    };\r\n\r\n    const togglePlay = () => {\r\n        if (isPlaying) {\r\n            clearInterval(timerRef.current); clearInterval(messageIntervalRef.current);\r\n            if (audioContextRef.current) audioContextRef.current.suspend();\r\n            pauseAudioAnalysis();\r\n            if (videoRef.current) videoRef.current.pause();\r\n            setIsPlaying(false);\r\n            isPlayingRef.current = false; //  Ref \r\n        } else {\r\n            setIsPlaying(true); \r\n            isPlayingRef.current = true; //  Ref \r\n            startTimer(); startMessageLoop();\r\n            if (audioContextRef.current) audioContextRef.current.resume();\r\n            if (interactionType === 'v2') resumeAudioAnalysis();\r\n            if (videoRef.current) videoRef.current.play();\r\n        }\r\n    };\r\n\r\n    // State for Analysis Transition\r\n    const [isAnalyzing, setIsAnalyzing] = useState(false);\r\n\r\n    const finishAnalysis = useCallback((forceStart = false) => {\r\n        setIsAnalyzing(true);\r\n        // Clean up chat loop\r\n        if (messageIntervalRef.current) clearInterval(messageIntervalRef.current);\r\n        \r\n        //  AI's empathetic/regret message when user chooses quick start\r\n        if (forceStart && chatHistory.length < 3) {\r\n            const regretMessages = [\r\n                \" , .    . \",\r\n                \"  ,    . .\",\r\n                \" . ,    .\"\r\n            ];\r\n            const randomMsg = regretMessages[Math.floor(Math.random() * regretMessages.length)];\r\n            setChatHistory(prev => [...prev, { role: 'model', content: randomMsg }]);\r\n            \r\n            // Speak the regret message if TTS is enabled\r\n            if (ttcEnabled) {\r\n                speak(randomMsg);\r\n            }\r\n        }\r\n        \r\n        // Transition delay for effect (longer to let user see the message)\r\n        setTimeout(() => {\r\n            setIsAnalyzing(false);\r\n            stopSession(true); // Stop background audio if any\r\n            setStep('interaction_select'); // Move to meditation type selection (//)\r\n        }, forceStart && chatHistory.length < 3 ? 3000 : 2000);\r\n        // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    }, [chatHistory.length, ttcEnabled, speak]);\r\n\r\n    const completeSession = () => {\r\n        stopSession(false); //  Keep ambient music playing\r\n        setStep('feedback');\r\n        setIsAILoading(true); // Show loading state in feedback screen\r\n\r\n        //  Calculate V3 Pose Metrics\r\n        let poseMetrics = null;\r\n        if (interactionType === 'v3' && stabilityHistoryRef.current.length > 0) {\r\n            const history = stabilityHistoryRef.current;\r\n            const avgScore = Math.round(history.reduce((acc, curr) => acc + curr.score, 0) / history.length);\r\n            const issues = Array.from(postureIssuesRef.current);\r\n            poseMetrics = {\r\n                stabilityScore: avgScore,\r\n                issues: issues\r\n            };\r\n            console.log(\" V3 Pose Analysis Result:\", poseMetrics);\r\n        }\r\n\r\n        // Generate Post-Session Feedback (Async)\r\n        (async () => {\r\n            try {\r\n                // Determine duration logic for context\r\n                // const duration = activeMode?.time || 300;\r\n                \r\n                const startTime = Date.now();\r\n                const fbResult = await generateMeditationGuidance({\r\n                    type: 'feedback_message',\r\n                    memberName, \r\n                    timeContext,\r\n                    diagnosis: selectedDiagnosis?.id || 'stress',\r\n                    mode: activeMode?.id || 'calm',\r\n                    poseMetrics: poseMetrics //  NEW\r\n                });\r\n                setAiLatency(Date.now() - startTime);\r\n                \r\n                if (fbResult.data) {\r\n                    // Personalize\r\n                    if (fbResult.data.message) {\r\n                        fbResult.data.message = fbResult.data.message.replace(/OO/g, `${memberName}`);\r\n                    }\r\n                    if (fbResult.data.feedbackPoints) {\r\n                        // Assuming backend returns points\r\n                        fbResult.data.feedbackPoints = fbResult.data.feedbackPoints.map(p => p.replace(/OO/g, `${memberName}`));\r\n                    }\r\n                    \r\n                    setFeedbackData(fbResult.data);\r\n                    \r\n                    if (fbResult.data.audioContent) {\r\n                        playAudio(fbResult.data.audioContent);\r\n                    } else if (ttcEnabled && fbResult.data.message) {\r\n                        speak(fbResult.data.message);\r\n                    }\r\n                }\r\n            } catch (e) {\r\n                console.error(\"Feedback Generation Failed:\", e);\r\n                // Fallback Feedback\r\n                setFeedbackData({\r\n                    message: `${memberName},      .`,\r\n                    feedbackPoints: [\r\n                        \"    .\",\r\n                        \"     .\",\r\n                        \"     .\",\r\n                        \"    .\"\r\n                    ]\r\n                });\r\n            } finally {\r\n                setIsAILoading(false);\r\n            }\r\n        })();\r\n    };\r\n\r\n    const formatTime = (seconds) => {\r\n        const mins = Math.floor(seconds / 60);\r\n        const secs = seconds % 60;\r\n        return `${mins}:${secs < 10 ? '0' : ''}${secs}`;\r\n    };\r\n\r\n    // ==========================================\r\n    //  RENDER (Refining V3 Overlay Rendering)\r\n    // ==========================================\r\n\r\n    // 0. Initial Preparation Step (Notifications Off - First Screen)\r\n    if (step === 'initial_prep') {\r\n        return (\r\n            <div style={{\r\n                position: 'fixed', inset: 0, background: '#0a0a0c', zIndex: 9999,\r\n                display: 'flex', flexDirection: 'column', padding: '20px', overflow: 'hidden'\r\n            }}>\r\n                <div className={`soul-light-base soul-theme-${visualTheme} active`} style={{ transition: 'all 1s ease', opacity: 0.4 }} />\r\n                <div style={{ position: 'relative', zIndex: 10, display: 'flex', flexDirection: 'column', height: '100%', width: '100%', alignItems: 'center', justifyContent: 'center' }}>\r\n                     {/*  Debug Overlay */}\r\n                     <MeditationDebugOverlay \r\n                        isVisible={isDebugMode}\r\n                        ttsState={ttsState}\r\n                        currentStep={step}\r\n                        audioLevels={audioVolumes}\r\n                        currentText={aiMessage}\r\n                        aiLatency={aiLatency}\r\n                    />\r\n                     <div style={{ width: '100%', maxWidth: '350px', animation: 'fadeIn 0.5s ease', textAlign: 'center' }}>\r\n                        <div style={{ marginBottom: '40px' }}>\r\n                            <div style={{ fontSize: '4rem', marginBottom: '20px' }}></div>\r\n                            <h3 style={{ fontSize: '1.5rem', fontWeight: 700, color: 'white', marginBottom: '10px' }}> </h3>\r\n                            <p style={{ color: 'rgba(255,255,255,0.5)', lineHeight: 1.6, marginBottom: '20px' }}>\r\n                                  <br/> &apos;&apos;  &apos;&apos;  <br/>?\r\n                            </p>\r\n                            \r\n                            {/*      */}\r\n                            <div style={{ \r\n                                background: 'rgba(76, 155, 251, 0.1)', \r\n                                border: '1px solid rgba(76, 155, 251, 0.2)',\r\n                                borderRadius: '15px', padding: '15px', marginTop: '10px',\r\n                                textAlign: 'left', fontSize: '0.85rem'\r\n                            }}>\r\n                                <div style={{ color: '#4c9bfb', fontWeight: 700, marginBottom: '5px', display: 'flex', alignItems: 'center', gap: '5px' }}>\r\n                                    <SpeakerHigh size={14} weight=\"fill\" /> \r\n                                </div>\r\n                                <div style={{ color: 'rgba(255,255,255,0.7)', lineHeight: 1.5 }}>\r\n                                    &apos;&apos; &apos;&apos;  **    .**     .\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                        <button onClick={() => { \r\n                            setPrepSelections(prev => ({...prev, notified: true})); \r\n                            setStep('intention'); // Proceed to Category Selection\r\n                        }}\r\n                            style={{\r\n                                width: '100%', background: 'var(--primary-gold)', color: 'black',\r\n                                padding: '18px', borderRadius: '20px', fontSize: '1.1rem', fontWeight: 800, border: 'none',\r\n                                cursor: 'pointer', display: 'flex', alignItems: 'center', justifyContent: 'center'\r\n                            }}></button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // 0-a. Intention Step (  - 2 )\r\n    if (step === 'intention') {\r\n        //  Meditative Loading Screen\r\n        if (isOptionsLoading) {\r\n             return (\r\n                <div style={{\r\n                    position: 'fixed', inset: 0, background: '#0a0a0c', zIndex: 9999,\r\n                    display: 'flex', flexDirection: 'column',\r\n                    justifyContent: 'center', alignItems: 'center', overflow: 'hidden'\r\n                }}>\r\n                    <div className={`soul-light-base soul-theme-${visualTheme} active`} style={{ transition: 'all 1s ease', opacity: 0.5 }} />\r\n                <div style={{ zIndex: 10, display: 'flex', flexDirection: 'column', alignItems: 'center' }}>\r\n                    {/*  Debug Overlay */}\r\n                    <MeditationDebugOverlay \r\n                        isVisible={isDebugMode}\r\n                        ttsState={ttsState}\r\n                        currentStep={step}\r\n                        audioLevels={audioVolumes}\r\n                        currentText={aiMessage}\r\n                        aiLatency={aiLatency}\r\n                    />\r\n                    <AILoadingIndicator />\r\n                    </div>\r\n                </div>\r\n             );\r\n        }\r\n\r\n        // 2-1:      \r\n        if (!selectedCategory) {\r\n            return (\r\n                <div style={{\r\n                    position: 'fixed', inset: 0, background: '#0a0a0c', zIndex: 9999,\r\n                    display: 'flex', flexDirection: 'column', overflow: 'hidden'\r\n                }}>\r\n                    <div className={`soul-light-base soul-theme-${visualTheme} active`} style={{ transition: 'all 1s ease', opacity: 0.4 }} />\r\n                    {/* Header */}\r\n                    <div style={{\r\n                        padding: '15px 20px', paddingTop: 'max(15px, env(safe-area-inset-top))',\r\n                        display: 'flex', alignItems: 'center', justifyContent: 'space-between',\r\n                        background: 'rgba(20, 20, 20, 0.4)',\r\n                        borderBottom: '1px solid rgba(255,255,255,0.05)', backdropFilter: 'blur(20px)',\r\n                        zIndex: 20\r\n                    }}>\r\n                        {/*  Debug Overlay */}\r\n                        <MeditationDebugOverlay \r\n                            isVisible={isDebugMode}\r\n                            ttsState={ttsState}\r\n                            currentStep={step}\r\n                            audioLevels={audioVolumes}\r\n                            currentText={lastSpokenMessage || aiMessage || currentAIChat?.message}\r\n                            aiLatency={aiLatency}\r\n                        />\r\n\r\n                        {/* Title - Left Side */}\r\n                        <div onClick={handleDebugToggle} style={{ cursor: 'pointer' }}>\r\n                            <span style={{ fontSize: '1.1rem', fontWeight: 700, color: 'white' }}>\r\n                                 \r\n                            </span>\r\n                        </div>\r\n                        <button onClick={() => { \r\n                                stopAllAudio(); \r\n                                if(onClose) onClose(); else navigate(-1); \r\n                            }} \r\n                            style={{ \r\n                                padding: '8px 16px', \r\n                                border: '1px solid rgba(255,255,255,0.15)', \r\n                                borderRadius: '20px',\r\n                                background: 'rgba(255, 255, 255, 0.08)', \r\n                                cursor: 'pointer',\r\n                                color: 'rgba(255,255,255,0.9)',\r\n                                fontSize: '0.85rem',\r\n                                fontWeight: '600',\r\n                                display: 'flex',\r\n                                alignItems: 'center',\r\n                                gap: '6px'\r\n                            }}>\r\n                            <span></span>\r\n                            <X size={16} weight=\"bold\" />\r\n                        </button>\r\n                    </div>\r\n\r\n                    {/* Main Content */}\r\n                    <div style={{\r\n                        flex: 1, display: 'flex', flexDirection: 'column', \r\n                        justifyContent: 'flex-start', alignItems: 'center', padding: '100px 20px 40px', //  Adjusted layout\r\n                        zIndex: 10\r\n                    }}>\r\n                        {/* Title */}\r\n                        <div style={{ textAlign: 'center', marginBottom: '50px' }}>\r\n                            <h2 style={{ \r\n                                fontSize: '1.6rem', fontWeight: 600, color: '#4c9bfb', \r\n                                marginBottom: '15px', lineHeight: 1.4\r\n                            }}>\r\n                                  <br/>  ?\r\n                            </h2>\r\n                            <p style={{ fontSize: '0.9rem', color: 'rgba(255,255,255,0.5)' }}>\r\n                                    \r\n                            </p>\r\n                        </div>\r\n\r\n                        {/* Category Options (Dynamic) */}\r\n                        <div style={{ width: '100%', maxWidth: '400px', display: 'flex', flexDirection: 'column', gap: '20px' }}>\r\n                            {dynamicCategories.map(category => (\r\n                                <button\r\n                                    key={category.id}\r\n                                    onClick={() => {\r\n                                        setSelectedCategory(category);\r\n                                    }}\r\n                                    style={{\r\n                                        padding: '30px 25px',\r\n                                        background: 'rgba(255, 255, 255, 0.05)',\r\n                                        border: '1px solid rgba(255, 255, 255, 0.1)',\r\n                                        borderRadius: '20px',\r\n                                        color: 'white',\r\n                                        cursor: 'pointer',\r\n                                        transition: 'all 0.3s ease',\r\n                                        textAlign: 'left'\r\n                                    }}\r\n                                    onMouseEnter={(e) => {\r\n                                        e.currentTarget.style.background = 'rgba(76, 155, 251, 0.15)';\r\n                                        e.currentTarget.style.borderColor = '#4c9bfb';\r\n                                        e.currentTarget.style.transform = 'translateY(-2px)';\r\n                                    }}\r\n                                    onMouseLeave={(e) => {\r\n                                        e.currentTarget.style.background = 'rgba(255, 255, 255, 0.05)';\r\n                                        e.currentTarget.style.borderColor = 'rgba(255, 255, 255, 0.1)';\r\n                                        e.currentTarget.style.transform = 'translateY(0)';\r\n                                    }}\r\n                                >\r\n                                    <div style={{ display: 'flex', alignItems: 'center', marginBottom: '10px' }}>\r\n                                        <span style={{ fontSize: '2rem', marginRight: '15px' }}>{category.emoji}</span>\r\n                                        <div style={{ flex: 1 }}>\r\n                                            <div style={{ fontSize: '1.1rem', fontWeight: 600, marginBottom: '5px' }}>\r\n                                                {category.label}\r\n                                            </div>\r\n                                            <div style={{ fontSize: '0.85rem', color: 'rgba(255,255,255,0.5)' }}>\r\n                                                {category.description || category.subtitle}\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            );\r\n        }\r\n\r\n        // 2-2:       \r\n        const categoryIntentions = dynamicIntentions.filter(i => i.category === selectedCategory.id);\r\n        \r\n        return (\r\n            <div style={{\r\n                position: 'fixed', inset: 0, background: '#0a0a0c', zIndex: 9999,\r\n                display: 'flex', flexDirection: 'column', overflow: 'hidden'\r\n            }}>\r\n                <div className={`soul-light-base soul-theme-${visualTheme} active`} style={{ transition: 'all 1s ease', opacity: 0.4 }} />\r\n                <div style={{ position: 'relative', zIndex: 10, display: 'flex', flexDirection: 'column', height: '100%', width: '100%' }}>\r\n                    {/*  Debug Overlay */}\r\n                    <MeditationDebugOverlay \r\n                        isVisible={isDebugMode}\r\n                        ttsState={ttsState}\r\n                        currentStep={step}\r\n                        audioLevels={audioVolumes}\r\n                        currentText={aiMessage}\r\n                        aiLatency={aiLatency}\r\n                    />\r\n                    {/* Header */}\r\n                    <div style={{\r\n                        padding: '10px 15px', paddingTop: 'max(10px, env(safe-area-inset-top))',\r\n                        display: 'flex', alignItems: 'center', background: 'rgba(20, 20, 20, 0.4)',\r\n                        borderBottom: '1px solid rgba(255,255,255,0.05)', backdropFilter: 'blur(20px)',\r\n                        zIndex: 20\r\n                    }}>\r\n                        <button onClick={() => setSelectedCategory(null)} \r\n                            style={{ padding: '8px', border: 'none', background: 'none', cursor: 'pointer' }}>\r\n                            <ArrowLeft size={22} color=\"white\" />\r\n                        </button>\r\n                        <div style={{ marginLeft: '10px' }}>\r\n                            <span style={{ fontSize: '1rem', fontWeight: 600, color: 'white' }}>\r\n                                {selectedCategory.label}\r\n                            </span>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Main Content */}\r\n                    <div style={{\r\n                        flex: 1, display: 'flex', flexDirection: 'column', \r\n                        justifyContent: 'center', alignItems: 'center', padding: '40px 20px'\r\n                    }}>\r\n                        {/* Title */}\r\n                        <div style={{ textAlign: 'center', marginBottom: '40px' }}>\r\n                            <h2 style={{ \r\n                                fontSize: '1.5rem', fontWeight: 600, color: '#4c9bfb', \r\n                                marginBottom: '10px' \r\n                            }}>\r\n                                   ?\r\n                            </h2>\r\n                            <p style={{ fontSize: '0.9rem', color: 'rgba(255,255,255,0.6)', lineHeight: 1.6 }}>\r\n                                {selectedCategory.description}\r\n                            </p>\r\n                        </div>\r\n\r\n                        {/* Options (Dynamic) */}\r\n                        <div style={{ width: '100%', maxWidth: '400px', display: 'flex', flexDirection: 'column', gap: '15px' }}>\r\n                            {categoryIntentions.map(intention => (\r\n                                <button\r\n                                    key={intention.id}\r\n                                    onClick={() => {\r\n                                        setSelectedIntention(intention);\r\n                                        setStep('diagnosis');\r\n                                        fetchAIQuestion([{ role: 'user', content: intention.label }]);\r\n                                    }}\r\n                                    style={{\r\n                                        padding: '20px', background: 'rgba(255, 255, 255, 0.05)',\r\n                                        border: '1px solid rgba(255, 255, 255, 0.1)', borderRadius: '15px',\r\n                                        color: 'white', fontSize: '1rem', cursor: 'pointer', transition: 'all 0.3s ease', textAlign: 'left'\r\n                                    }}\r\n                                >\r\n                                    <div style={{ display: 'flex', alignItems: 'center' }}>\r\n                                        <span style={{ marginRight: '12px', fontSize: '1.5rem' }}>{intention.emoji}</span>\r\n                                        <div style={{ flex: 1 }}>\r\n                                            <div style={{ fontSize: '0.75rem', color: 'rgba(255,255,255,0.5)', marginBottom: '5px' }}>\r\n                                                {intention.tag}\r\n                                            </div>\r\n                                            <div style={{ fontSize: '0.95rem' }}>\r\n                                                {intention.label}\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // 1. Diagnosis Step (Conversational AI - Dark Mode)\r\n    if (step === 'diagnosis') {\r\n        return (\r\n            <div style={{\r\n                position: 'fixed', inset: 0, background: '#0a0a0c', zIndex: 9999, //  Dark Mode\r\n                display: 'flex', flexDirection: 'column', overflow: 'hidden'\r\n            }}>\r\n                <div className={`soul-light-base soul-theme-${visualTheme} active`} style={{ transition: 'all 1s ease', opacity: 0.4 }} />\r\n                <div style={{ position: 'relative', zIndex: 10, display: 'flex', flexDirection: 'column', height: '100%', width: '100%' }}>\r\n                    {/*  Debug Overlay */}\r\n                    <MeditationDebugOverlay \r\n                        isVisible={isDebugMode}\r\n                        ttsState={ttsState}\r\n                        currentStep={step}\r\n                        audioLevels={audioVolumes}\r\n                        currentText={aiMessage}\r\n                        aiLatency={aiLatency}\r\n                    />\r\n                    {/* 1. Header (Translucent Dark) */}\r\n                    <div style={{\r\n                        padding: '10px 15px', paddingTop: 'max(10px, env(safe-area-inset-top))',\r\n                        display: 'flex', alignItems: 'center', justifyContent: 'space-between', //  Adjusted layout\r\n                        background: 'rgba(20, 20, 20, 0.4)',\r\n                        borderBottom: '1px solid rgba(255,255,255,0.05)', backdropFilter: 'blur(20px)',\r\n                        zIndex: 20\r\n                    }}>\r\n                        <div style={{ display: 'flex', alignItems: 'center' }}>\r\n                            <button onClick={() => { stopAllAudio(); if(onClose) onClose(); else navigate(-1); }} style={{ padding: '8px', border: 'none', background: 'none', cursor: 'pointer' }}>\r\n                                <ArrowLeft size={22} color=\"white\" />\r\n                            </button>\r\n                            <div onClick={handleDebugToggle} style={{ marginLeft: '10px', display: 'flex', flexDirection: 'column', cursor: 'pointer' }}>\r\n                                <span style={{ fontSize: '1rem', fontWeight: 600, color: 'white' }}> ( )</span>\r\n                                <div style={{ display: 'flex', alignItems: 'center', gap: '4px' }}>\r\n                                    <SpeakerHigh size={12} color={ttcEnabled ? \"#4caf50\" : \"#666\"} weight=\"fill\" />\r\n                                    <span style={{ fontSize: '0.7rem', color: 'rgba(255,255,255,0.6)' }}>\r\n                                        {isAnalyzing ? (\r\n                                            <span className=\"blinking-text\"> ...</span> //  Blinking Effect\r\n                                        ) : isAILoading ? ' ...' : '  '}\r\n                                    </span>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/*  START NOW BUTTON */}\r\n                        {!isAnalyzing && (\r\n                            <button \r\n                                onClick={() => finishAnalysis(true)}\r\n                                style={{\r\n                                    padding: '6px 12px',\r\n                                    borderRadius: '20px',\r\n                                    background: 'rgba(76, 155, 251, 0.2)',\r\n                                    border: '1px solid #4c9bfb',\r\n                                    color: '#4c9bfb',\r\n                                    fontSize: '0.8rem',\r\n                                    fontWeight: '600',\r\n                                    cursor: 'pointer'\r\n                                }}\r\n                            >\r\n                                 \r\n                            </button>\r\n                        )}\r\n                    </div>\r\n\r\n                    {/* 2. Chat Area (Scrollable) */}\r\n                    <div style={{\r\n                        flex: 1, overflowY: 'auto', padding: '20px 15px',\r\n                        paddingBottom: '20px', display: 'flex', flexDirection: 'column', gap: '20px'\r\n                    }} className=\"no-scrollbar\">\r\n                        {/* Date Divider */}\r\n                        <div style={{ alignSelf: 'center', background: 'rgba(255,255,255,0.1)', padding: '4px 12px', borderRadius: '12px', fontSize: '0.75rem', color: 'rgba(255,255,255,0.6)', marginBottom: '10px' }}>\r\n                            {new Date().toLocaleDateString()}\r\n                        </div>\r\n\r\n                        {/* Chat Bubbles */}\r\n                        {chatHistory.filter(msg => !msg.content.startsWith('[System]:')).map((msg, idx) => {\r\n                            const isMe = msg.role === 'user';\r\n                            const timeStr = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\r\n\r\n                            return (\r\n                                <div key={idx} style={{\r\n                                    display: 'flex', justifyContent: isMe ? 'flex-end' : 'flex-start',\r\n                                    alignItems: 'flex-start', gap: '8px'\r\n                                }}>\r\n                                    {!isMe && (\r\n                                        <div style={{\r\n                                            width: '40px', height: '40px', borderRadius: '50%',\r\n                                            background: 'var(--primary-gold)', display: 'flex', alignItems: 'center', justifyContent: 'center',\r\n                                            overflow: 'hidden', border: '1px solid rgba(255,255,255,0.1)', flexShrink: 0,\r\n                                            fontSize: '1.2rem'\r\n                                        }}></div>\r\n                                    )}\r\n                                    <div style={{ display: 'flex', flexDirection: isMe ? 'row-reverse' : 'row', alignItems: 'flex-end', gap: '6px' }}>\r\n                                         <div style={{\r\n                                             background: isMe ? 'linear-gradient(135deg, #d4af37, #f1c40f)' : 'rgba(255,255,255,0.08)',\r\n                                             color: isMe ? '#000' : '#fff', padding: '12px 16px',\r\n                                             borderRadius: isMe ? '18px 4px 18px 18px' : '4px 18px 18px 18px',\r\n                                             maxWidth: '75vw', fontSize: '0.95rem', lineHeight: '1.6',\r\n                                             boxShadow: '0 4px 15px rgba(0,0,0,0.2)', wordBreak: 'keep-all',\r\n                                             border: isMe ? 'none' : '1px solid rgba(255,255,255,0.1)'\r\n                                         }}>{msg.content}</div>\r\n                                         <span style={{ fontSize: '0.7rem', color: 'rgba(255,255,255,0.4)', marginBottom: '2px', minWidth: '55px', textAlign: isMe ? 'right' : 'left' }}>\r\n                                             {timeStr}\r\n                                         </span>\r\n                                    </div>\r\n                                </div>\r\n                            );\r\n                        })}\r\n\r\n                        {/* Latest AI Question */}\r\n                        {currentAIChat && !isAILoading && (\r\n                             <div style={{ display: 'flex', justifyContent: 'flex-start', alignItems: 'flex-start', gap: '8px' }}>\r\n                                 <div style={{\r\n                                     width: '40px', height: '40px', borderRadius: '50%',\r\n                                     background: 'white', display: 'flex', alignItems: 'center', justifyContent: 'center',\r\n                                     overflow: 'hidden', border: '1px solid rgba(255,255,255,0.1)', flexShrink: 0\r\n                                 }}>\r\n                                      <img src=\"/pwa-192x192.png\" alt=\"AI\" style={{ width: '100%', height: '100%', objectFit: 'cover' }} onError={(e) => { e.target.style.display='none'; e.target.parentNode.innerText=''; }} />\r\n                                 </div>\r\n                                 <div style={{ display: 'flex', flexDirection: 'row', alignItems: 'flex-end', gap: '6px' }}>\r\n                                     <div style={{\r\n                                         background: 'rgba(255,255,255,0.08)', color: 'white', padding: '14px 18px',\r\n                                         borderRadius: '4px 18px 18px 18px', maxWidth: '75vw', fontSize: '1.0rem', lineHeight: '1.6',\r\n                                         boxShadow: '0 4px 15px rgba(0,0,0,0.3)', border: '1px solid rgba(255,255,255,0.15)', backdropFilter: 'blur(10px)'\r\n                                     }}>{currentAIChat.message || currentAIChat.question || \"  ?\"}</div>\r\n                                     <span style={{ fontSize: '0.7rem', color: 'rgba(255,255,255,0.4)', marginBottom: '2px' }}>\r\n                                         {new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\r\n                                     </span>\r\n                                 </div>\r\n                             </div>\r\n                        )}\r\n\r\n                        {isAILoading && (\r\n                             <div style={{ alignSelf: 'center', marginTop: '10px' }}>\r\n                                 <AILoadingIndicator compact={true} message={chatHistory.length === 0 ? \"AI     ...\" : null} />\r\n                             </div>\r\n                        )}\r\n                        <div ref={chatEndRef} style={{ height: '2px', width: '100%' }} />\r\n                    </div>\r\n\r\n                    {/* 3. Bottom Options & Input */}\r\n                    <div style={{\r\n                        background: '#1a1a1d', borderTop: '1px solid rgba(255,255,255,0.1)',\r\n                        padding: '15px', paddingBottom: 'calc(15px + env(safe-area-inset-bottom))',\r\n                        display: 'flex', flexDirection: 'column', gap: '12px', zIndex: 20\r\n                    }}>\r\n                        {/*  Phase 1:    -    */}\r\n                        {!isAILoading && currentAIChat?.isFinalAnalysis && (\r\n                            <div style={{ display: 'flex', flexDirection: 'column', gap: '10px', animation: 'fadeIn 0.5s ease' }}>\r\n                                <button onClick={() => {\r\n                                    stopAllAudio();\r\n                                    const diag = DIAGNOSIS_OPTIONS.find(o => o.id === currentAIChat?.mappedDiagnosis) || SELECTED_DIAGNOSIS_FALLBACK;\r\n                                    setSelectedDiagnosis(diag);\r\n                                    const defaultMode = MEDITATION_MODES.find(m => m.id === diag?.prescription?.modeId) || MEDITATION_MODES[1];\r\n                                    setActiveMode(defaultMode);\r\n                                    setTimeLeft(defaultMode.time);\r\n                                    setInteractionType(diag?.prescription?.type || 'v1');\r\n                                    setStep('interaction_select');\r\n                                }} style={{\r\n                                    width: '100%', background: 'var(--primary-gold)', color: 'black',\r\n                                    padding: '18px', borderRadius: '20px', fontSize: '1.1rem', fontWeight: 800, border: 'none',\r\n                                    cursor: 'pointer', display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '8px',\r\n                                    boxShadow: '0 10px 20px rgba(212,175,55,0.3)'\r\n                                }}>  </button>\r\n                                <p style={{ textAlign: 'center', fontSize: '0.8rem', color: 'rgba(255,255,255,0.4)' }}>\r\n                                       \r\n                                </p>\r\n                            </div>\r\n                        )}\r\n\r\n                        {/*   :   (isFinalAnalysis  ) */}\r\n                        {!isAILoading && currentAIChat?.options?.length > 0 && !currentAIChat?.isFinalAnalysis && (\r\n                            <div className=\"no-scrollbar\" style={{ display: 'flex', gap: '8px', overflowX: 'auto', paddingBottom: '10px', scrollbarWidth: 'none', justifyContent: 'flex-start' }}>\r\n                                {currentAIChat.options.map((opt, i) => (\r\n                                    <button key={i} onClick={() => { stopAllAudio(); handleChatResponse(opt); }}\r\n                                        style={{\r\n                                            flex: '0 0 auto', background: 'rgba(255,255,255,0.08)', border: '1px solid rgba(255,255,255,0.15)',\r\n                                            padding: '10px 18px', borderRadius: '18px', color: 'rgba(255,255,255,0.9)', \r\n                                            fontSize: '0.9rem', cursor: 'pointer', transition: 'all 0.2s', backdropFilter: 'blur(5px)'\r\n                                        }}>{opt}</button>\r\n                                ))}\r\n                            </div>\r\n                        )}\r\n\r\n                        {/*  :    isTransition   */}\r\n                        {!currentAIChat?.isFinalAnalysis && !currentAIChat?.isTransition && !isAnalyzing && (\r\n                            <form onSubmit={(e) => { try { handleManualSubmit(e); } catch (err) { setIsAILoading(false); } }} \r\n                                style={{ \r\n                                    display: 'flex', gap: '10px', alignItems: 'center', background: 'rgba(255,255,255,0.05)', \r\n                                    borderRadius: '28px', padding: '6px 6px 6px 20px', border: '1px solid rgba(255,255,255,0.1)'\r\n                                }}>\r\n                                <input type=\"text\" value={manualInput} onChange={(e) => setManualInput(e.target.value)}\r\n                                    disabled={isAILoading} autoFocus placeholder={isAILoading ? \"  ...\" : \" ...\"}\r\n                                    style={{ flex: 1, background: 'transparent', border: 'none', color: 'white', fontSize: '1rem', outline: 'none' }} />\r\n                                <button type=\"submit\" disabled={!manualInput.trim() || isAILoading}\r\n                                    style={{\r\n                                        background: manualInput.trim() ? 'var(--primary-gold)' : 'rgba(255,255,255,0.1)',\r\n                                        color: manualInput.trim() ? 'black' : 'rgba(255,255,255,0.2)',\r\n                                        border: 'none', borderRadius: '50%', width: '40px', height: '40px',\r\n                                        display: 'flex', alignItems: 'center', justifyContent: 'center', cursor: 'pointer'\r\n                                    }}><ArrowUp size={24} weight=\"bold\" /></button>\r\n                            </form>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (step === 'diagnosis_manual') {\r\n        return (\r\n            <div style={{\r\n                position: 'fixed', inset: 0, background: '#0a0a0c', zIndex: 2000,\r\n                display: 'flex', flexDirection: 'column', padding: '20px', overflow: 'hidden'\r\n            }}>\r\n                <div className={`soul-light-base soul-theme-${visualTheme} active`} style={{ transition: 'all 1s ease', opacity: 0.4 }} />\r\n                <div style={{ position: 'relative', zIndex: 10, display: 'flex', flexDirection: 'column', height: '100%', width: '100%' }}>\r\n                    {/*  Debug Overlay */}\r\n                    <MeditationDebugOverlay \r\n                        isVisible={isDebugMode}\r\n                        ttsState={ttsState}\r\n                        currentStep={step}\r\n                        audioLevels={audioVolumes}\r\n                        currentText={aiMessage}\r\n                        aiLatency={aiLatency}\r\n                    />\r\n                    <div style={{ display: 'flex', alignItems: 'center', marginBottom: '30px' }}>\r\n                        <button onClick={() => setStep('diagnosis')} style={{ padding: '10px', color: 'white', background: 'none', border: 'none' }}>\r\n                            <ArrowLeft size={24} />\r\n                        </button>\r\n                        <h1 style={{ flex: 1, textAlign: 'center', fontSize: '1.1rem', fontWeight: 600, color: 'rgba(255,255,255,0.5)', marginRight: '44px' }}>\r\n                             \r\n                        </h1>\r\n                    </div>\r\n\r\n                    <div style={{ flex: 1, display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'flex-start', paddingTop: '30px' }}>\r\n                        <p style={{ color: 'rgba(255,255,255,0.6)', marginBottom: '25px', fontSize: '0.95rem' }}>\r\n                               \r\n                        </p>\r\n\r\n                        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '15px', width: '100%', maxWidth: '400px' }}>\r\n                            {DIAGNOSIS_OPTIONS.map((option) => (\r\n                                <button key={option.id} onClick={() => handleDiagnosisSelect(option)} style={{\r\n                                    background: 'rgba(255,255,255,0.05)', border: '1px solid rgba(255,255,255,0.1)',\r\n                                    borderRadius: '20px', padding: '20px', display: 'flex', flexDirection: 'column', alignItems: 'center', gap: '15px',\r\n                                    transition: 'all 0.3s ease', cursor: 'pointer'\r\n                                }}>\r\n                                    <div style={{ \r\n                                        width: '50px', height: '50px', borderRadius: '50%', background: `${option.color}20`,\r\n                                        display: 'flex', alignItems: 'center', justifyContent: 'center', color: option.color \r\n                                    }}>\r\n                                        <option.icon size={28} weight=\"fill\" />\r\n                                    </div>\r\n                                    <span style={{ color: 'white', fontWeight: 600 }}>{option.label}</span>\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // 2. Weather Step\r\n    if (step === 'weather') {\r\n        return (\r\n             <div style={{\r\n                position: 'fixed', inset: 0, background: '#0a0a0c', zIndex: 2000,\r\n                display: 'flex', flexDirection: 'column', padding: '20px', overflow: 'hidden'\r\n            }}>\r\n                <div className={`soul-light-base soul-theme-${visualTheme} active`} style={{ transition: 'all 1s ease', opacity: 0.4 }} />\r\n                <div style={{ position: 'relative', zIndex: 10, display: 'flex', flexDirection: 'column', height: '100%', width: '100%' }}>\r\n                    {/*  Debug Overlay */}\r\n                    <MeditationDebugOverlay \r\n                        isVisible={isDebugMode}\r\n                        ttsState={ttsState}\r\n                        currentStep={step}\r\n                        audioLevels={audioVolumes}\r\n                        currentText={aiMessage}\r\n                        aiLatency={aiLatency}\r\n                    />\r\n                    <div style={{ display: 'flex', alignItems: 'center', marginBottom: '30px' }}>\r\n                        <button onClick={() => setStep('diagnosis')} style={{ padding: '10px', color: 'white', background: 'none', border: 'none' }}>\r\n                            <ArrowLeft size={24} />\r\n                        </button>\r\n                        <h1 style={{ flex: 1, textAlign: 'center', fontSize: '1.1rem', fontWeight: 600, color: 'rgba(255,255,255,0.5)', marginRight: '44px' }}>\r\n                             \r\n                        </h1>\r\n                    </div>\r\n\r\n                    <div style={{ flex: 1, display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'flex-start', paddingTop: '40px' }}>\r\n                        <h2 style={{ fontSize: '1.6rem', fontWeight: 700, color: 'white', marginBottom: '10px', textAlign: 'center' }}>\r\n                               ?\r\n                        </h2>\r\n                        <p style={{ color: 'rgba(255,255,255,0.5)', marginBottom: '50px', textAlign: 'center', fontSize: '0.9rem' }}>\r\n                                 \r\n                        </p>\r\n\r\n                        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '15px', width: '100%', maxWidth: '400px' }}>\r\n                            {WEATHER_OPTIONS.map((option) => (\r\n                                <button key={option.id} onClick={() => handleWeatherSelect(option)} style={{\r\n                                    background: 'rgba(255,255,255,0.05)', border: '1px solid rgba(255,255,255,0.1)',\r\n                                    borderRadius: '20px', padding: '24px', display: 'flex', flexDirection: 'column', alignItems: 'center', gap: '10px',\r\n                                    cursor: 'pointer'\r\n                                }}>\r\n                                    <option.icon size={36} color={option.color} weight=\"duotone\" />\r\n                                    <span style={{ color: 'white', fontSize: '1.1rem', marginTop: '5px' }}>{option.label}</span>\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // 1-a. Prescription Summary (New AI Analysis View)\r\n    if (step === 'prescription_summary') {\r\n        const summary = currentAIChat?.analysisSummary || prescriptionReason || \"    .\";\r\n        return (\r\n            <div style={{\r\n                position: 'fixed', inset: 0, background: '#0a0a0c', zIndex: 2000,\r\n                display: 'flex', flexDirection: 'column', padding: '20px', overflow: 'hidden'\r\n            }}>\r\n                <div className={`soul-light-base soul-theme-${visualTheme} active`} style={{ transition: 'all 1s ease', opacity: 0.4 }} />\r\n                <div style={{ position: 'relative', zIndex: 10, display: 'flex', flexDirection: 'column', height: '100%', width: '100%', alignItems: 'center', justifyContent: 'center' }}>\r\n                    <div style={{ marginBottom: '30px', color: 'var(--primary-gold)', textAlign: 'center' }}>\r\n                        <Brain size={60} weight=\"fill\" />\r\n                        <h2 style={{ fontSize: '1.8rem', fontWeight: 800, color: 'white', marginTop: '20px' }}>AI  </h2>\r\n                    </div>\r\n                    \r\n                    <div style={{ \r\n                        width: '100%', maxWidth: '400px', background: 'rgba(255,255,255,0.08)', \r\n                        borderRadius: '24px', padding: '30px', border: '1px solid rgba(255,255,255,0.1)',\r\n                        marginBottom: '40px', boxShadow: '0 20px 40px rgba(0,0,0,0.5)'\r\n                    }}>\r\n                        <p style={{ color: 'white', fontSize: '1.15rem', lineHeight: 1.7, textAlign: 'center', wordBreak: 'keep-all' }}>\r\n                            &quot;{summary}&quot;\r\n                        </p>\r\n                    </div>\r\n\r\n                    <button onClick={() => setStep('interaction_select')}\r\n                        style={{\r\n                            width: '100%', maxWidth: '300px', background: 'var(--primary-gold)', color: 'black',\r\n                            padding: '20px', borderRadius: '20px', fontSize: '1.2rem', fontWeight: 800, border: 'none',\r\n                            cursor: 'pointer', boxShadow: '0 10px 20px rgba(212,175,55,0.3)'\r\n                        }}>  </button>\r\n                    \r\n                    <button onClick={() => {\r\n                            //  AI's warm welcome message when returning to chat\r\n                            const welcomeBackMessages = [\r\n                                \" !   ? \",\r\n                                \",    .  ?\",\r\n                                \"  .       .\"\r\n                            ];\r\n                            const randomWelcome = welcomeBackMessages[Math.floor(Math.random() * welcomeBackMessages.length)];\r\n                            setChatHistory(prev => [...prev, { role: 'model', content: randomWelcome }]);\r\n                            if (ttcEnabled) speak(randomWelcome);\r\n                            setStep('diagnosis');\r\n                        }}\r\n                        style={{ marginTop: '20px', background: 'none', border: 'none', color: 'rgba(255,255,255,0.4)', textDecoration: 'underline' }}>\r\n                          \r\n                    </button>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // 1-b. Interaction Selection (New Dedicated View)\r\n    if (step === 'interaction_select') {\r\n        return (\r\n            <div style={{\r\n                position: 'fixed', inset: 0, background: '#0a0a0c', zIndex: 2000,\r\n                display: 'flex', flexDirection: 'column', padding: '20px', overflow: 'hidden'\r\n            }}>\r\n                <div className={`soul-light-base soul-theme-${visualTheme} active`} style={{ transition: 'all 1s ease', opacity: 0.4 }} />\r\n                <div style={{ position: 'relative', zIndex: 10, display: 'flex', flexDirection: 'column', height: '100%', width: '100%' }}>\r\n                    <div style={{ padding: '20px 0', textAlign: 'center' }}>\r\n                        <h2 style={{ fontSize: '1.6rem', fontWeight: 800, color: 'white' }}>  ?</h2>\r\n                        <p style={{ color: 'rgba(255,255,255,0.5)', marginTop: '8px' }}>    </p>\r\n                    </div>\r\n\r\n                    <div style={{ flex: 1, display: 'flex', flexDirection: 'column', gap: '15px', justifyContent: 'center', width: '100%', maxWidth: '400px', margin: '0 auto' }}>\r\n                        {Object.values(INTERACTION_TYPES).map(t => (\r\n                            <button key={t.id} onClick={() => {\r\n                                setInteractionType(t.id);\r\n                                const defaultMode = MEDITATION_MODES.find(m => m.id === selectedDiagnosis?.prescription.modeId) || MEDITATION_MODES[1];\r\n                                setActiveMode(defaultMode);\r\n                                setTimeLeft(defaultMode.time);\r\n                                // Fetch real prescription details in background\r\n                                fetchAIPrescription(selectedDiagnosis?.id || 'stress', weatherContext?.id || 'sun', defaultMode.id, t.id, \"\");\r\n                                setStep('preparation');\r\n                                setPrepStep(3); // Go to Posture Guide\r\n                            }}\r\n                                style={{\r\n                                    display: 'flex', alignItems: 'center', gap: '20px', padding: '25px',\r\n                                    background: 'rgba(255,255,255,0.05)', border: '1px solid rgba(255,255,255,0.1)',\r\n                                    borderRadius: '24px', color: 'white', textAlign: 'left', cursor: 'pointer', transition: 'all 0.3s'\r\n                                }}>\r\n                                <div style={{ width: '50px', height: '50px', borderRadius: '15px', background: 'rgba(212,175,55,0.1)', display: 'flex', alignItems: 'center', justifyContent: 'center', color: 'var(--primary-gold)' }}>\r\n                                    {t.id === 'v1' ? <Wind size={28} /> : t.id === 'v2' ? <Microphone size={28} /> : <VideoCamera size={28} />}\r\n                                </div>\r\n                                <div style={{ flex: 1 }}>\r\n                                    <div style={{ fontSize: '1.15rem', fontWeight: 700, marginBottom: '4px' }}>{t.label}</div>\r\n                                    <div style={{ fontSize: '0.85rem', color: 'rgba(255,255,255,0.5)', lineHeight: 1.4 }}>{t.desc}</div>\r\n                                </div>\r\n                            </button>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (step === 'prescription' && selectedDiagnosis && activeMode) {\r\n        const ModeIcon = ICON_MAP[activeMode.iconName] || ICON_MAP.Wind;\r\n        \r\n        return (\r\n            <div style={{\r\n                position: 'fixed', inset: 0, background: '#0a0a0c', zIndex: 2000,\r\n                display: 'flex', flexDirection: 'column', padding: '20px', overflow: 'hidden'\r\n            }}>\r\n                <div className={`soul-light-base soul-theme-${visualTheme} active`} style={{ transition: 'all 1s ease', opacity: 0.4 }} />\r\n                <div style={{ position: 'relative', zIndex: 10, display: 'flex', flexDirection: 'column', height: '100%', width: '100%', overflowY: 'auto' }} className=\"no-scrollbar\">\r\n                    {/*  Debug Overlay */}\r\n                    <MeditationDebugOverlay \r\n                        isVisible={isDebugMode}\r\n                        ttsState={ttsState}\r\n                        currentStep={step}\r\n                        audioLevels={audioVolumes}\r\n                        currentText={aiMessage}\r\n                        aiLatency={aiLatency}\r\n                    />\r\n                    <div style={{ marginTop: '20px', flex: 1, display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'flex-start', paddingBottom: '40px' }}>\r\n                        <div style={{ marginBottom: '20px', color: 'var(--primary-gold)' }}><Sparkle size={48} weight=\"fill\" /></div>\r\n                        <h2 style={{ fontSize: '1.4rem', fontWeight: 700, color: 'white', marginBottom: '20px', textAlign: 'center' }}>\r\n                              AI \r\n                        </h2>\r\n\r\n                        <div style={{ \r\n                            width: '100%', maxWidth: '350px', background: 'rgba(255,255,255,0.08)', \r\n                            borderRadius: '24px', padding: '20px', border: '1px solid rgba(255,255,255,0.1)',\r\n                            display: 'flex', flexDirection: 'column', gap: '15px'\r\n                        }}>\r\n                            {/* 1. AI Analysis */}\r\n                            <div style={{ background: 'rgba(255,255,255,0.05)', padding: '15px', borderRadius: '15px', fontSize: '0.9rem', color: 'rgba(255,255,255,0.9)', lineHeight: 1.6 }}>\r\n                                <div style={{ color: 'var(--primary-gold)', fontWeight: 700, marginBottom: '8px', fontSize: '0.85rem' }}> AI   </div>\r\n                                <div>{currentAIChat?.isFinalAnalysis ? (currentAIChat.analysisSummary || prescriptionReason) : prescriptionReason}</div>\r\n                            </div>\r\n\r\n                            <div style={{ height: '1px', background: 'rgba(255,255,255,0.1)', margin: '5px 0' }} />\r\n\r\n                            {/* 2. Recommendation Hero Card */}\r\n                            <div style={{ display: 'flex', alignItems: 'center', gap: '15px' }}>\r\n                                <div style={{ width: '60px', height: '60px', borderRadius: '18px', background: `${activeMode.color}30`, display: 'flex', alignItems: 'center', justifyContent: 'center', color: activeMode.color }}>\r\n                                    <ModeIcon size={32} weight=\"duotone\" />\r\n                                </div>\r\n                                <div>\r\n                                    <div style={{ fontSize: '0.85rem', color: 'var(--primary-gold)', fontWeight: 600, marginBottom: '2px' }}> AI  </div>\r\n                                    <div style={{ fontSize: '1.25rem', fontWeight: 700, color: 'white' }}>{activeMode.label}</div>\r\n                                    <div style={{ fontSize: '0.85rem', color: 'rgba(255,255,255,0.6)' }}>\r\n                                        {interactionType === 'v1' && '  '}\r\n                                        {interactionType === 'v2' && ' '}\r\n                                        {interactionType === 'v3' && ' '}\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* 3. User Options */}\r\n                            <div style={{ marginTop: '10px' }}>\r\n                                 <div style={{ color: 'rgba(255,255,255,0.5)', fontSize: '0.75rem', marginBottom: '10px' }}> </div>\r\n                                \r\n                                {/* Time Selection */}\r\n                                <div style={{ marginBottom: '10px', display: 'flex', gap: '8px' }}>\r\n                                    {MEDITATION_MODES.map(m => (\r\n                                        <button key={m.id} onClick={() => { setActiveMode(m); setTimeLeft(m.time); }}\r\n                                            style={{\r\n                                                flex: 1, padding: '8px', borderRadius: '10px', fontSize: '0.75rem',\r\n                                                background: activeMode.id === m.id ? 'rgba(255,255,255,0.2)' : 'rgba(255,255,255,0.05)',\r\n                                                color: activeMode.id === m.id ? 'white' : 'rgba(255,255,255,0.6)',\r\n                                                border: activeMode.id === m.id ? '1px solid rgba(255,255,255,0.3)' : 'none', fontWeight: 600\r\n                                            }}>{m.label.split(' ')[0]}</button>\r\n                                    ))}\r\n                                </div>\r\n\r\n                                {/* Type Selection */}\r\n                                <div style={{ display: 'flex', gap: '8px' }}>\r\n                                    {Object.values(INTERACTION_TYPES).map(t => (\r\n                                        <button key={t.id} onClick={() => setInteractionType(t.id)}\r\n                                            style={{\r\n                                                flex: 1, padding: '8px', borderRadius: '10px', fontSize: '0.75rem',\r\n                                                background: interactionType === t.id ? 'rgba(255,255,255,0.2)' : 'rgba(255,255,255,0.05)',\r\n                                                color: interactionType === t.id ? 'white' : 'rgba(255,255,255,0.6)',\r\n                                                border: interactionType === t.id ? '1px solid rgba(255,255,255,0.3)' : 'none', fontWeight: 600\r\n                                            }}>{t.id === 'v1' ? '' : t.id === 'v2' ? '' : ''}</button>\r\n                                    ))}\r\n                                </div>\r\n\r\n                                {/*  Ambient Sound Selection */}\r\n                                <div style={{ marginTop: '15px' }}>\r\n                                    <div style={{ color: 'rgba(255,255,255,0.5)', fontSize: '0.75rem', marginBottom: '8px' }}> </div>\r\n                                    <div style={{ display: 'flex', gap: '6px', flexWrap: 'wrap' }}>\r\n                                        {AMBIENT_SOUNDS.map(a => (\r\n                                            <button key={a.id} onClick={() => setSelectedAmbient(a.id)}\r\n                                                style={{\r\n                                                    padding: '6px 12px', borderRadius: '12px', fontSize: '0.7rem',\r\n                                                    background: selectedAmbient === a.id ? `${a.color}30` : 'rgba(255,255,255,0.05)',\r\n                                                    color: selectedAmbient === a.id ? a.color : 'rgba(255,255,255,0.5)',\r\n                                                    border: selectedAmbient === a.id ? `1px solid ${a.color}50` : '1px solid transparent',\r\n                                                    fontWeight: 600, cursor: 'pointer'\r\n                                                }}>{a.label}</button>\r\n                                        ))}\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div style={{ width: '100%', maxWidth: '350px', marginTop: '30px' }}>\r\n                            <button onClick={startFromPrescription} style={{\r\n                                width: '100%', background: 'var(--primary-gold)', color: 'black',\r\n                                padding: '16px', borderRadius: '18px', fontSize: '1.1rem', fontWeight: 800, border: 'none',\r\n                                display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '10px', \r\n                                cursor: 'pointer', boxShadow: '0 10px 20px rgba(212,175,55,0.3)'\r\n                            }}><Play size={24} weight=\"fill\" /> </button>\r\n                            \r\n                            <button onClick={handleReturnToChat} style={{ \r\n                                marginTop: '15px', width: '100%', background: 'transparent', border: 'none', \r\n                                color: 'rgba(255,255,255,0.4)', textDecoration: 'underline', cursor: 'pointer', fontSize: '0.85rem'\r\n                            }}>  ( )</button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    //  Phase 4: Preparation Flow Step\r\n    if (step === 'preparation') {\r\n        const PREPARATION_GUIDES = {\r\n            chair: {\r\n                title: \" \", desc: \"  \",\r\n                steps: [\"    .\", \"     .\", \"    .\"]\r\n            },\r\n            floor: {\r\n                title: \" \", desc: \"  \",\r\n                steps: [\"    .\", \"     .\", \"     .\"]\r\n            },\r\n            lying: {\r\n                title: \" \", desc: \"   \",\r\n                steps: [\"   .\", \"     .\", \"       .\"]\r\n            }\r\n        };\r\n\r\n        return (\r\n            <div style={{\r\n                position: 'fixed', inset: 0, background: '#0a0a0c', zIndex: 2000,\r\n                display: 'flex', flexDirection: 'column', padding: '20px', overflow: 'hidden'\r\n            }}>\r\n                <div className={`soul-light-base soul-theme-${visualTheme} active`} style={{ transition: 'all 1s ease', opacity: 0.4 }} />\r\n                <div style={{ position: 'relative', zIndex: 10, display: 'flex', flexDirection: 'column', height: '100%', width: '100%' }}>\r\n                    {/*  Debug Overlay */}\r\n                    <MeditationDebugOverlay \r\n                        isVisible={isDebugMode}\r\n                        ttsState={ttsState}\r\n                        currentStep={step}\r\n                        audioLevels={audioVolumes}\r\n                        currentText={aiMessage}\r\n                        aiLatency={aiLatency}\r\n                    />\r\n                    <div style={{ display: 'flex', alignItems: 'center', marginBottom: '30px' }}>\r\n                        <button onClick={() => setStep('interaction_select')} style={{ padding: '10px', color: 'white', background: 'none', border: 'none' }}>\r\n                            <ArrowLeft size={24} />\r\n                        </button>\r\n                        <div style={{ flex: 1, textAlign: 'center' }}>\r\n                            <div style={{ fontSize: '0.8rem', color: 'var(--primary-gold)', fontWeight: 600 }}>  ({prepStep}/3)</div>\r\n                            <div style={{ fontSize: '1.1rem', fontWeight: 700, color: 'white' }}> </div>\r\n                        </div>\r\n                        <div style={{ width: '44px' }} />\r\n                    </div>\r\n\r\n                    <div style={{ flex: 1, display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'flex-start', paddingTop: '10px' }}>\r\n                        {/* STEP 1: Notifications Off */}\r\n                        {prepStep === 1 && (\r\n                            <div style={{ width: '100%', maxWidth: '350px', animation: 'fadeIn 0.5s ease' }}>\r\n                                <div style={{ textAlign: 'center', marginBottom: '40px' }}>\r\n                                    <div style={{ fontSize: '4rem', marginBottom: '20px' }}></div>\r\n                                    <h3 style={{ fontSize: '1.5rem', fontWeight: 700, color: 'white', marginBottom: '10px' }}> </h3>\r\n                                    <p style={{ color: 'rgba(255,255,255,0.5)', lineHeight: 1.6, marginBottom: '20px' }}>\r\n                                          <br/> &apos;&apos;  &apos;&apos;  <br/>?\r\n                                    </p>\r\n\r\n                                    {/*      */}\r\n                                    <div style={{ \r\n                                        background: 'rgba(76, 155, 251, 0.1)', \r\n                                        border: '1px solid rgba(76, 155, 251, 0.2)',\r\n                                        borderRadius: '15px', padding: '15px', marginTop: '10px',\r\n                                        textAlign: 'left', fontSize: '0.85rem'\r\n                                    }}>\r\n                                        <div style={{ color: '#4c9bfb', fontWeight: 700, marginBottom: '5px', display: 'flex', alignItems: 'center', gap: '5px' }}>\r\n                                            <SpeakerHigh size={14} weight=\"fill\" /> \r\n                                        </div>\r\n                                        <div style={{ color: 'rgba(255,255,255,0.7)', lineHeight: 1.5 }}>\r\n                                            &apos;&apos; &apos;&apos;  **    .**     .\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                                <button onClick={() => { setPrepSelections({...prepSelections, notified: true}); setPrepStep(2); }}\r\n                                    style={{\r\n                                        width: '100%', background: 'var(--primary-gold)', color: 'black',\r\n                                        padding: '18px', borderRadius: '20px', fontSize: '1.1rem', fontWeight: 800, border: 'none',\r\n                                        cursor: 'pointer', display: 'flex', alignItems: 'center', justifyContent: 'center'\r\n                                    }}></button>\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* STEP 3: Posture Guide */}\r\n                        {prepStep === 3 && (\r\n                            <div style={{ width: '100%', maxWidth: '400px', animation: 'fadeIn 0.5s ease' }}>\r\n                                <h3 style={{ fontSize: '1.3rem', fontWeight: 700, color: 'white', marginBottom: '15px', textAlign: 'center' }}>   </h3>\r\n                                <div style={{ display: 'flex', gap: '8px', marginBottom: '15px' }}>\r\n                                    {Object.entries(PREPARATION_GUIDES).map(([key, info]) => (\r\n                                        <button key={key} onClick={() => setPrepSelections({...prepSelections, posture: key})}\r\n                                            style={{\r\n                                                flex: 1, padding: '10px 4px', borderRadius: '12px', fontSize: '0.8rem',\r\n                                                background: prepSelections.posture === key ? 'rgba(255,255,255,0.15)' : 'rgba(255,255,255,0.03)',\r\n                                                color: prepSelections.posture === key ? 'white' : 'rgba(255,255,255,0.4)',\r\n                                                border: prepSelections.posture === key ? '1px solid rgba(255,255,255,0.3)' : '1px solid transparent',\r\n                                                fontWeight: 600\r\n                                            }}>{info.title}</button>\r\n                                    ))}\r\n                                </div>\r\n                                <div style={{ \r\n                                    background: 'rgba(255,255,255,0.05)', borderRadius: '24px', padding: '20px',\r\n                                    border: '1px solid rgba(255,255,255,0.1)', marginBottom: '20px', minHeight: '180px'\r\n                                }}>\r\n                                    <div style={{ color: 'var(--primary-gold)', fontSize: '0.75rem', fontWeight: 700, marginBottom: '4px' }}>{PREPARATION_GUIDES[prepSelections.posture].desc}</div>\r\n                                    <div style={{ fontSize: '1.1rem', fontWeight: 800, color: 'white', marginBottom: '12px' }}>{PREPARATION_GUIDES[prepSelections.posture].title} </div>\r\n                                    <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\r\n                                        {PREPARATION_GUIDES[prepSelections.posture].steps.map((s, i) => (\r\n                                            <div key={i} style={{ display: 'flex', gap: '8px', color: 'rgba(255,255,255,0.8)', fontSize: '0.9rem', lineHeight: 1.4 }}>\r\n                                                <span style={{ color: 'var(--primary-gold)', fontWeight: 800 }}>{i+1}</span>\r\n                                                <span>{s}</span>\r\n                                            </div>\r\n                                        ))}\r\n                                    </div>\r\n                                </div>\r\n                                <button onClick={() => setPrepStep(2)} //  Go to Phone Placement NEXT\r\n                                    style={{\r\n                                        width: '100%', background: 'white', color: 'black',\r\n                                        padding: '18px', borderRadius: '20px', fontSize: '1.1rem', fontWeight: 800, border: 'none',\r\n                                        cursor: 'pointer', marginBottom: '15px'\r\n                                    }}>  </button>\r\n                            </div>\r\n                        )}\r\n                        \r\n                        {/* STEP 2: Phone Placement (Moved AFTER posture) */}\r\n                        {prepStep === 2 && (\r\n                            <div style={{ width: '100%', maxWidth: '350px', animation: 'fadeIn 0.5s ease' }}>\r\n                                <div style={{ textAlign: 'center', marginBottom: '40px' }}>\r\n                                    <div style={{ fontSize: '4rem', marginBottom: '20px' }}>\r\n                                        {interactionType === 'v3' ? '' : (interactionType === 'v2' ? '' : '')}\r\n                                    </div>\r\n                                    <h3 style={{ fontSize: '1.5rem', fontWeight: 700, color: 'white', marginBottom: '10px' }}>  </h3>\r\n                                    <p style={{ color: 'rgba(255,255,255,0.7)', lineHeight: 1.6, fontSize: '1.1rem' }}>\r\n                                        {interactionType === 'v3' ? \"     2m  .\" : (interactionType === 'v2' ? \"     (30cm )  .\" : \"     .\")}\r\n                                    </p>\r\n                                    {interactionType === 'v2' && (\r\n                                        <div style={{ \r\n                                            marginTop: '20px', padding: '12px', background: 'rgba(74, 222, 128, 0.1)', \r\n                                            borderRadius: '12px', border: '1px solid rgba(74, 222, 128, 0.2)', fontSize: '0.85rem', color: '#4ade80'\r\n                                        }}> <b>Tip:</b>           .</div>\r\n                                    )}\r\n                                </div>\r\n                                <button onClick={() => startSession(activeMode)}\r\n                                    style={{\r\n                                        width: '100%', background: 'var(--primary-gold)', color: 'black',\r\n                                        padding: '18px', borderRadius: '20px', fontSize: '1.1rem', fontWeight: 800, border: 'none',\r\n                                        cursor: 'pointer', display: 'flex', alignItems: 'center', justifyContent: 'center'\r\n                                    }}>  ( )</button>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // 5. Feedback Step\r\n    if (step === 'feedback') {\r\n        const points = feedbackData?.feedbackPoints || [];\r\n        \r\n        return (\r\n            <FeedbackView\r\n                visualTheme={visualTheme}\r\n                isDebugMode={isDebugMode}\r\n                ttsState={ttsState}\r\n                step={step}\r\n                audioVolumes={audioVolumes}\r\n                aiMessage={aiMessage}\r\n                aiLatency={aiLatency}\r\n                isAILoading={isAILoading}\r\n                points={points}\r\n                feedbackData={feedbackData}\r\n                stopAllAudio={stopAllAudio}\r\n                setAiMessage={setAiMessage}\r\n                setChatHistory={setChatHistory}\r\n                onClose={onClose}\r\n            />\r\n        );\r\n    }\r\n\r\n    // 4. Active Session Step\r\n    const breathingScale = interactionType === 'v2' ? 1 + micVolume : 1;\r\n\r\n    return (\r\n        <div style={{\r\n            position: 'fixed', inset: 0, background: '#0a0a0c', zIndex: 3000,\r\n            display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center',\r\n            overflow: 'hidden'\r\n        }}>\r\n            {/* V3 Camera Layer */}\r\n            {interactionType === 'v3' && (\r\n                <div style={{ position: 'absolute', inset: 0, zIndex: 1, opacity: 0.6 }}>\r\n                    <video \r\n                        ref={videoRef} \r\n                        autoPlay \r\n                        playsInline \r\n                        muted \r\n                        style={{ width: '100%', height: '100%', objectFit: 'cover', transform: 'scaleX(-1)' }} \r\n                    />\r\n                    <canvas\r\n                        ref={canvasRef}\r\n                        width={window.innerWidth}\r\n                        height={window.innerHeight}\r\n                        style={{\r\n                            position: 'absolute', inset: 0,\r\n                            width: '100%', height: '100%',\r\n                            transform: 'scaleX(-1)', // Mirror to match video\r\n                            pointerEvents: 'none'\r\n                        }}\r\n                    />\r\n                    <div style={{\r\n                        position: 'absolute', top: '50%', left: '50%', transform: 'translate(-50%, -50%)',\r\n                        width: '280px', height: '350px',\r\n                        border: '1px solid rgba(255, 215, 0, 0.3)', borderRadius: '120px',\r\n                        boxShadow: '0 0 80px rgba(255, 215, 0, 0.1) inset'\r\n                    }} />\r\n                </div>\r\n            )}\r\n\r\n            {/* Global Dynamic Background */}\r\n            <div \r\n                className={`soul-light-base soul-theme-${visualTheme} ${isPlaying && interactionType !== 'v2' ? 'active' : ''}`} \r\n                style={{\r\n                     transform: interactionType === 'v2' && isPlaying \r\n                        ? `translate(-50%, -50%) scale(${1 + Math.min(micVolume, 0.5)})` \r\n                        : undefined,\r\n                     transition: interactionType === 'v2' ? 'transform 0.1s ease-out' : 'all 1s ease',\r\n                     zIndex: 0\r\n                 }}\r\n            />\r\n\r\n            {/* Content Overlay */}\r\n            <div style={{ zIndex: 10, textAlign: 'center', width: '100%', padding: '20px', maxWidth: '600px' }}>\r\n                <div style={{ marginBottom: '20px', minHeight: '80px', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>\r\n                    <p style={{ \r\n                        color: 'white', fontSize: '1.2rem', fontWeight: 500, lineHeight: 1.6,\r\n                        opacity: isPlaying ? 1 : 0.5, transition: 'opacity 1s ease',\r\n                        textShadow: '0 4px 20px rgba(0,0,0,0.8)', background: interactionType === 'v3' ? 'rgba(0,0,0,0.6)' : 'transparent',\r\n                        padding: interactionType === 'v3' ? '15px' : '0', borderRadius: '15px'\r\n                    }}>\r\n                        {aiMessage}\r\n                    </p>\r\n                </div>\r\n\r\n                <div style={{ fontSize: '4.5rem', fontWeight: 200, color: 'white', fontVariantNumeric: 'tabular-nums', letterSpacing: '-2px', textShadow: '0 0 30px rgba(255,255,255,0.3)', marginBottom: '10px' }}>\r\n                    {formatTime(timeLeft)}\r\n                </div>\r\n\r\n                {/*  Breath Level Meter (NEW: User Request) */}\r\n                {interactionType === 'v2' && (\r\n                    <div style={{ \r\n                        marginTop: '20px', display: 'flex', flexDirection: 'column', alignItems: 'center', gap: '8px',\r\n                        animation: 'fadeIn 0.5s ease'\r\n                    }}>\r\n                        <div style={{ display: 'flex', alignItems: 'center', gap: '8px', color: micVolume > 0.1 ? '#4ade80' : 'rgba(255,255,255,0.3)', transition: 'color 0.2s' }}>\r\n                            <Microphone size={20} weight={micVolume > 0.1 ? \"fill\" : \"regular\"} style={{ transform: `scale(${1 + Math.min(micVolume, 0.5)})` }} />\r\n                            <span style={{ fontSize: '0.8rem', fontWeight: 600, letterSpacing: '1px' }}>BREATH LEVEL</span>\r\n                        </div>\r\n                        <div style={{ \r\n                            width: '120px', height: '4px', background: 'rgba(255,255,255,0.1)', borderRadius: '2px', overflow: 'hidden',\r\n                            boxShadow: '0 0 10px rgba(0,0,0,0.5)'\r\n                        }}>\r\n                            <div style={{ \r\n                                height: '100%', \r\n                                width: `${Math.min(micVolume * 100, 100)}%`, \r\n                                background: 'linear-gradient(90deg, #4ade80, #32ff7e)',\r\n                                transition: 'width 0.1s ease-out',\r\n                                boxShadow: '0 0 10px rgba(74, 222, 128, 0.5)'\r\n                            }} />\r\n                        </div>\r\n                        {micVolume > 0.1 && (\r\n                            <span style={{ fontSize: '0.7rem', color: '#4ade80', animation: 'pulse 1s infinite' }}> ...</span>\r\n                        )}\r\n                    </div>\r\n                )}\r\n\r\n                {/* Privacy Notice or TTC Indicator */}\r\n                <div style={{ height: '30px', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>\r\n                    {ttcEnabled ? (\r\n                        <div style={{ display: 'flex', alignItems: 'center', gap: '5px', color: 'var(--primary-gold)', fontSize: '0.8rem', fontWeight: 'bold', animation: 'pulse 2s infinite' }}>\r\n                            <SpeakerHigh size={16} weight=\"fill\" />    \r\n                        </div>\r\n                    ) : (\r\n                        (interactionType === 'v2' || interactionType === 'v3') && (\r\n                            <div style={{ display: 'flex', alignItems: 'center', gap: '5px', color: 'rgba(255,255,255,0.4)', fontSize: '0.75rem' }}>\r\n                                <LockKey size={12} weight=\"fill\" color=\"#4ade80\" />    \r\n                            </div>\r\n                        )\r\n                    )}\r\n                </div>\r\n                \r\n                {permissionError && (\r\n                    <div style={{ marginTop: '20px', padding: '10px', background: 'rgba(255,0,0,0.2)', color: '#ff6b6b', borderRadius: '8px', fontSize: '0.9rem' }}>\r\n                         {permissionError}\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* Controls */}\r\n            <div style={{ position: 'absolute', bottom: '60px', display: 'flex', alignItems: 'center', gap: '40px', zIndex: 20 }}>\r\n                <button onClick={() => { \r\n                    //  Phase 2: X      ( )\r\n                    completeSession();\r\n                }} style={{\r\n                    width: '60px', height: '60px', borderRadius: '50%',\r\n                    background: 'rgba(255,255,255,0.1)', border: 'none', color: 'white',\r\n                    display: 'flex', alignItems: 'center', justifyContent: 'center', cursor: 'pointer'\r\n                }}>\r\n                    <X size={28} />\r\n                </button>\r\n\r\n                <button onClick={togglePlay} style={{\r\n                    width: '80px', height: '80px', borderRadius: '50%',\r\n                    background: activeMode?.color, border: 'none', color: '#000',\r\n                    display: 'flex', alignItems: 'center', justifyContent: 'center',\r\n                    boxShadow: `0 0 30px ${activeMode?.color}60`, cursor: 'pointer'\r\n                }}>\r\n                    {isPlaying ? <Pause size={32} weight=\"fill\" /> : <Play size={32} weight=\"fill\" />}\r\n                </button>\r\n\r\n                <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', gap: '4px' }}>\r\n                    <button onClick={() => setShowVolumePanel(!showVolumePanel)} style={{\r\n                        width: '60px', height: '60px', borderRadius: '50%',\r\n                        background: showVolumePanel ? 'rgba(212,175,55,0.3)' : 'rgba(255,255,255,0.1)', border: 'none', \r\n                        color: soundEnabled ? 'white' : 'rgba(255,255,255,0.3)',\r\n                        display: 'flex', alignItems: 'center', justifyContent: 'center', cursor: 'pointer',\r\n                        transition: 'all 0.3s ease'\r\n                    }}>\r\n                        {soundEnabled ? <SpeakerHigh size={28} /> : <SpeakerSlash size={28} />}\r\n                    </button>\r\n                    <span style={{ fontSize: '0.65rem', color: 'rgba(255,255,255,0.5)', fontWeight: '600' }}> </span>\r\n                </div>\r\n\r\n\r\n            </div>\r\n\r\n            {/*  Phase 3: Volume Control Panel */}\r\n            <VolumeControlPanel\r\n                showVolumePanel={showVolumePanel}\r\n                setShowVolumePanel={setShowVolumePanel}\r\n                audioVolumes={audioVolumes}\r\n                setAudioVolumes={setAudioVolumes}\r\n                currentAudioRef={currentAudioRef}\r\n                updateAmbientVolume={updateAmbientVolume}\r\n                updateBinauralVolume={updateBinauralVolume}\r\n                soundEnabled={soundEnabled}\r\n                setSoundEnabled={setSoundEnabled}\r\n            />\r\n\r\n            {/*      */}\r\n            {showVolumeHint && !showVolumePanel && (\r\n                <div style={{\r\n                    position: 'absolute', bottom: '190px', left: '50%', transform: 'translateX(-50%)',\r\n                    background: 'rgba(212,175,55,0.2)', backdropFilter: 'blur(10px)',\r\n                    border: '1px solid rgba(212,175,55,0.3)', borderRadius: '20px',\r\n                    padding: '8px 16px', color: 'rgba(255,255,255,0.8)', fontSize: '0.75rem',\r\n                    whiteSpace: 'nowrap', animation: 'fadeIn 0.5s ease-out',\r\n                    pointerEvents: 'none'\r\n                }}>\r\n                         \r\n                </div>\r\n            )}\r\n\r\n            {/*  Debug Overlay */}\r\n            <MeditationDebugOverlay \r\n                isVisible={isDebugMode}\r\n                ttsState={ttsState}\r\n                currentStep={step}\r\n                audioLevels={audioVolumes}\r\n                currentText={aiMessage}\r\n                aiLatency={aiLatency}\r\n            />\r\n\r\n            <style>{`\r\n                .no-scrollbar::-webkit-scrollbar {\r\n                    display: none;\r\n                }\r\n                .no-scrollbar {\r\n                    -ms-overflow-style: none;  /* IE and Edge */\r\n                    scrollbar-width: none;  /* Firefox */\r\n                }\r\n                @keyframes breathe {\r\n                    0%, 100% { transform: scale(1); opacity: 0.5; }\r\n                    50% { transform: scale(1.5); opacity: 0.8; }\r\n                }\r\n                @keyframes breathe-inner {\r\n                    0%, 100% { transform: scale(1); opacity: 0.8; }\r\n                    50% { transform: scale(1.3); opacity: 0.4; }\r\n                }\r\n                @keyframes float {\r\n                    0% { transform: rotate(0deg) scale(1) translate(0, 0); }\r\n                    33% { transform: rotate(120deg) scale(1.1) translate(20px, -20px); }\r\n                    66% { transform: rotate(240deg) scale(0.9) translate(-20px, 20px); }\r\n                    100% { transform: rotate(360deg) scale(1) translate(0, 0); }\r\n                }\r\n                @keyframes float-rev {\r\n                    0% { transform: rotate(0deg) scale(1.1) translate(0, 0); }\r\n                    50% { transform: rotate(-180deg) scale(0.9) translate(30px, 30px); }\r\n                    100% { transform: rotate(-360deg) scale(1.1) translate(0, 0); }\r\n                }\r\n\r\n                .breathing-circle.animate { animation: breathe 8s infinite ease-in-out; }\r\n                .breathing-circle-inner.animate-inner { animation: breathe-inner 8s infinite ease-in-out; }\r\n                .floating-circle.animate-float { animation: float 20s infinite linear; }\r\n                .floating-circle-rev.animate-float-rev { animation: float-rev 25s infinite linear; }\r\n                .paused { animation-play-state: paused !important; }\r\n                @keyframes fadeIn {\r\n                    from { opacity: 0; transform: translateY(10px); }\r\n                    to { opacity: 1; transform: translateY(0); }\r\n                }\r\n            `}</style>\r\n        </div>\r\n    );\r\n};\r\n\r\n\r\n\r\nexport default MeditationPage;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\pages\\MemberProfile.jsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'member'. Either include it or remove the dependency array.","line":195,"column":8,"nodeType":"ArrayExpression","endLine":195,"endColumn":48,"suggestions":[{"desc":"Update the dependencies array to be: [language, member, member.id, member.language]","fix":{"range":[8762,8802],"text":"[language, member, member.id, member.language]"}}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadMemberData'. Either include it or remove the dependency array.","line":469,"column":8,"nodeType":"ArrayExpression","endLine":469,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [loadMemberData]","fix":{"range":[20782,20784],"text":"[loadMemberData]"}}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'member'. Either include it or remove the dependency array.","line":541,"column":8,"nodeType":"ArrayExpression","endLine":541,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [member, member.id]","fix":{"range":[24003,24015],"text":"[member, member.id]"}}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'loadAIExperience', 'logs', 'member', 'notices', 't', and 'weatherData'. Either include them or remove the dependency array.","line":656,"column":8,"nodeType":"ArrayExpression","endLine":656,"endColumn":18,"suggestions":[{"desc":"Update the dependencies array to be: [language, loadAIExperience, logs, member, notices, t, weatherData]","fix":{"range":[28743,28753],"text":"[language, loadAIExperience, logs, member, notices, t, weatherData]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\services\\aiService.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\services\\attendanceService.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\services\\memberService.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\services\\messageService.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\services\\modules\\aiModule.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\services\\modules\\attendanceModule.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\services\\modules\\errorModule.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\services\\modules\\imageModule.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\services\\modules\\memberModule.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\services\\modules\\messageModule.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\services\\modules\\noticeModule.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\services\\modules\\salesModule.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\services\\noticeService.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\services\\paymentService.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\services\\scheduleService.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\services\\storage.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\studioConfig.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\styles\\commonStyles.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\utils\\classMapping.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\utils\\classUtils.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\utils\\colors.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\utils\\csvParser.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\utils\\dates.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\utils\\diligence.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\utils\\holidays.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\utils\\logger.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\src\\utils\\translations.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\test-fallback-logic.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\test_dates.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\test_feb_schedule_existence.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\test_integration.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\test_push_direct.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\test_push_log.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\test_schedule_logic.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\test_simulation.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\token_check.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\token_check_all.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\verify_storage.js","messages":[],"suppressedMessages":[{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":7,"column":12,"nodeType":"Identifier","messageId":"undef","endLine":7,"endColumn":19,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-undef","severity":2,"message":"'require' is not defined.","line":8,"column":14,"nodeType":"Identifier","messageId":"undef","endLine":8,"endColumn":21,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\boksoon\\.gemini\\antigravity\\scratch\\yoga-app\\vite.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]